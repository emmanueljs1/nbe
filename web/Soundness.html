<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Soundness</title>
  <style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}
</style>
  <style type="text/css">
.Agda .Comment { color: #B22222 }
.Agda .Background {}
.Agda .Markup { color: #000000 }
.Agda .Keyword { color: #CD6600 }
.Agda .String { color: #B22222 }
.Agda .Number { color: #A020F0 }
.Agda .Symbol { color: #404040 }
.Agda .PrimitiveType { color: #0000CD }
.Agda .Pragma { color: black }
.Agda .Operator {}
.Agda .Hole { background: #B4EEB4 }

.Agda .Bound { color: black }
.Agda .Generalizable { color: black }
.Agda .InductiveConstructor { color: #008B00 }
.Agda .CoinductiveConstructor { color: #8B7500 }
.Agda .Datatype { color: #0000CD }
.Agda .Field { color: #EE1289 }
.Agda .Function { color: #0000CD }
.Agda .Module { color: #A020F0 }
.Agda .Postulate { color: #0000CD }
.Agda .Primitive { color: #0000CD }
.Agda .Record { color: #0000CD }

.Agda .DottedPattern {}
.Agda .UnsolvedMeta { color: black; background: yellow }
.Agda .UnsolvedConstraint { color: black; background: yellow }
.Agda .TerminationProblem { color: black; background: #FFA07A }
.Agda .IncompletePattern { color: black; background: #F5DEB3 }
.Agda .Error { color: red; text-decoration: underline }
.Agda .TypeChecks { color: black; background: #ADD8E6 }
.Agda .Deadcode { color: black; background: #808080 }
.Agda .ShadowingInTelescope { color: black; background: #808080 }

.Agda a { text-decoration: none }
.Agda a[href]:hover { background-color: #B4EEB4 }
.Agda [href].hover-highlight { background-color: #B4EEB4; }
</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="soundness">Soundness</h1>
<pre class="Agda"><a id="22" class="Keyword">import</a> <a id="29" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="67" class="Symbol">as</a> <a id="70" class="Module">Eq</a>
<a id="73" class="Keyword">open</a> <a id="78" class="Keyword">import</a> <a id="85" href="Data.Unit.html" class="Module">Data.Unit</a> <a id="95" class="Keyword">using</a> <a id="101" class="Symbol">(</a><a id="102" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a><a id="103" class="Symbol">;</a> <a id="105" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a><a id="107" class="Symbol">)</a>
<a id="109" class="Keyword">open</a> <a id="114" class="Keyword">import</a> <a id="121" href="Data.Empty.html" class="Module">Data.Empty</a> <a id="132" class="Keyword">using</a> <a id="138" class="Symbol">(</a><a id="139" href="Data.Empty.html#526" class="Datatype">⊥</a><a id="140" class="Symbol">)</a>
<a id="142" class="Keyword">open</a> <a id="147" class="Keyword">import</a> <a id="154" href="Data.Sum.html" class="Module">Data.Sum</a> <a id="163" class="Keyword">using</a> <a id="169" class="Symbol">(</a><a id="170" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a><a id="174" class="Symbol">;</a> <a id="176" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a><a id="180" class="Symbol">)</a>
<a id="182" class="Keyword">open</a> <a id="187" class="Keyword">import</a> <a id="194" href="Data.Product.html" class="Module">Data.Product</a> <a id="207" class="Keyword">using</a> <a id="213" class="Symbol">(</a><a id="214" href="Data.Product.html#1167" class="Function Operator">_×_</a><a id="217" class="Symbol">;</a> <a id="219" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a><a id="224" class="Symbol">;</a> <a id="226" href="Data.Product.html#1369" class="Function">∃</a><a id="227" class="Symbol">;</a> <a id="229" href="Data.Product.html#1806" class="Function">∃-syntax</a><a id="237" class="Symbol">)</a> <a id="239" class="Keyword">renaming</a> <a id="248" class="Symbol">(</a><a id="249" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="253" class="Symbol">to</a> <a id="256" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="261" class="Symbol">)</a>
<a id="263" class="Keyword">open</a> <a id="268" class="Keyword">import</a> <a id="275" href="Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="292" class="Keyword">using</a> <a id="298" class="Symbol">(</a><a id="299" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a><a id="302" class="Symbol">;</a> <a id="304" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a><a id="306" class="Symbol">)</a>
<a id="308" class="Keyword">open</a> <a id="313" href="Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="316" class="Keyword">using</a> <a id="322" class="Symbol">(</a><a id="323" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="327" class="Symbol">;</a> <a id="329" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="332" class="Symbol">)</a> <a id="334" class="Keyword">renaming</a> <a id="343" class="Symbol">(</a><a id="344" href="Relation.Binary.PropositionalEquality.Core.html#1684" class="Function">sym</a> <a id="348" class="Symbol">to</a> <a id="351" class="Function">≡-sym</a><a id="356" class="Symbol">;</a> <a id="358" href="Relation.Binary.PropositionalEquality.Core.html#1729" class="Function">trans</a> <a id="364" class="Symbol">to</a> <a id="367" class="Function">≡-trans</a><a id="374" class="Symbol">)</a>

<a id="377" class="Keyword">open</a> <a id="382" class="Keyword">import</a> <a id="389" href="SystemT.html" class="Module">SystemT</a>
<a id="397" class="Keyword">open</a> <a id="402" class="Keyword">import</a> <a id="409" href="NbE.html" class="Module">NbE</a>
<a id="413" class="Keyword">open</a> <a id="418" class="Keyword">import</a> <a id="425" href="Lemmas.html" class="Module">Lemmas</a>

<a id="433" class="Keyword">module</a> <a id="440" href="Soundness.html" class="Module">Soundness</a> <a id="450" class="Keyword">where</a>
</pre>
<p>We prove the soundness property of preservation of meaning of NbE
(i.e. <code>⟦ nf(t) ⟧ = ⟦ t ⟧</code>), which we just call soundness here
for brevity, by proving the definitional equality of a term and its
normal form:</p>
<pre><code>Γ ⊢ t = nf(t) : T</code></pre>
<p>which expands to:</p>
<pre><code>Γ ⊢ t = ↓ᵀ a Γ, where a = ⟦ t ⟧ ↑Γ</code></pre>
<p>For this, a logical relation <code>t Ⓡ a</code> is defined such that
it implies <code>Γ ⊢ t = ↓ᵀ a Γ : T</code>.</p>
For defining the relation in Agda, we will need some functions first.
The first “lifts” definitional equality over liftable neutrals.
Formally, this represents the condition <code>Γ ⊢ 𝓊 = 𝓊̂(Γ) : T</code>,
or equivalently in Agda:
<pre class="Agda"><a id="_==↑_"></a><a id="1073" href="Soundness.html#1073" class="Function Operator">_==↑_</a> <a id="1079" class="Symbol">:</a> <a id="1081" class="Symbol">{</a><a id="1082" href="Soundness.html#1082" class="Bound">Γ</a> <a id="1084" class="Symbol">:</a> <a id="1086" href="SystemT.html#1272" class="Datatype">Γ</a><a id="1087" class="Symbol">}</a> <a id="1089" class="Symbol">{</a><a id="1090" href="Soundness.html#1090" class="Bound">T</a> <a id="1092" class="Symbol">:</a> <a id="1094" href="SystemT.html#561" class="Datatype">Type</a><a id="1098" class="Symbol">}</a> <a id="1100" class="Symbol">→</a> <a id="1102" href="Soundness.html#1082" class="Bound">Γ</a> <a id="1104" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="1106" href="Soundness.html#1090" class="Bound">T</a> <a id="1108" class="Symbol">→</a> <a id="1110" href="NbE.html#7764" class="Function">Ne↑</a> <a id="1114" href="Soundness.html#1090" class="Bound">T</a> <a id="1116" class="Symbol">→</a> <a id="1118" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="1122" href="Soundness.html#1073" class="Function Operator">_==↑_</a> <a id="1128" class="Symbol">{</a><a id="1129" href="Soundness.html#1129" class="Bound">Γ</a><a id="1130" class="Symbol">}</a> <a id="1132" href="Soundness.html#1132" class="Bound">t</a> <a id="1134" href="Soundness.html#1134" class="Bound">𝓊̂</a> <a id="1137" class="Keyword">with</a> <a id="1142" href="Soundness.html#1134" class="Bound">𝓊̂</a> <a id="1145" href="Soundness.html#1129" class="Bound">Γ</a>
<a id="1147" class="Symbol">...</a> <a id="1151" class="Symbol">|</a> <a id="1153" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="1158" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="1160" href="Soundness.html#1160" class="Bound">𝓊</a> <a id="1162" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="1164" class="Symbol">_</a> <a id="1166" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="1168" class="Symbol">=</a>
      <a id="1176" class="Comment">-- If the liftable neutral can be lifted to the</a>
      <a id="1230" class="Comment">-- context Γ, this is just definitional equality</a>
      <a id="1285" class="Bound">t</a> <a id="1287" href="SystemT.html#11908" class="Datatype Operator">==</a> <a id="1290" href="Soundness.html#1160" class="Bound">𝓊</a>
<a id="1292" class="Symbol">...</a> <a id="1296" class="Symbol">|</a> <a id="1298" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="1303" class="Symbol">_</a> <a id="1305" class="Symbol">=</a>
      <a id="1313" class="Comment">-- Otherwise, the proposition cannot be proven,</a>
      <a id="1367" class="Comment">-- as there is no lifted term in the context</a>
      <a id="1418" class="Comment">-- to compare a term to</a>
      <a id="1448" href="Data.Empty.html#526" class="Datatype">⊥</a>

<a id="1451" class="Keyword">infix</a> <a id="1457" class="Number">3</a> <a id="1459" href="Soundness.html#1073" class="Function Operator">_==↑_</a>
</pre>
We also provide shorthand for reifying the interpretation of a term t
and then immediately applying a context Γ (we use lowercase γ as our
subscript as Γ is not a valid subscript)
<pre class="Agda"><a id="↓ᵀᵧ"></a><a id="1658" href="Soundness.html#1658" class="Function">↓ᵀᵧ</a> <a id="1662" class="Symbol">:</a> <a id="1664" class="Symbol">∀</a> <a id="1666" class="Symbol">{</a><a id="1667" href="Soundness.html#1667" class="Bound">Γ</a> <a id="1669" class="Symbol">:</a> <a id="1671" href="SystemT.html#1272" class="Datatype">Γ</a><a id="1672" class="Symbol">}</a> <a id="1674" class="Symbol">{</a><a id="1675" href="Soundness.html#1675" class="Bound">T</a> <a id="1677" class="Symbol">:</a> <a id="1679" href="SystemT.html#561" class="Datatype">Type</a><a id="1683" class="Symbol">}</a> <a id="1685" class="Symbol">→</a> <a id="1687" class="Symbol">(</a><a id="1688" href="Soundness.html#1688" class="Bound">a</a> <a id="1690" class="Symbol">:</a> <a id="1692" href="NbE.html#849" class="Field Operator">⟦</a> <a id="1694" href="Soundness.html#1675" class="Bound">T</a> <a id="1696" href="NbE.html#849" class="Field Operator">⟧</a><a id="1697" class="Symbol">)</a> <a id="1699" class="Symbol">→</a> <a id="1701" href="Soundness.html#1667" class="Bound">Γ</a> <a id="1703" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="1705" href="Soundness.html#1675" class="Bound">T</a>
<a id="1707" href="Soundness.html#1658" class="Function">↓ᵀᵧ</a> <a id="1711" class="Symbol">{</a><a id="1712" href="Soundness.html#1712" class="Bound">Γ</a><a id="1713" class="Symbol">}</a> <a id="1715" href="Soundness.html#1715" class="Bound">a</a> <a id="1717" class="Keyword">with</a> <a id="1722" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="1725" href="Soundness.html#1715" class="Bound">a</a>
<a id="1727" class="Symbol">...</a> <a id="1731" class="Symbol">|</a> <a id="1733" href="Soundness.html#1733" class="Bound">a↑</a> <a id="1736" class="Symbol">=</a> <a id="1738" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="1744" class="Symbol">(</a><a id="1745" href="Soundness.html#1733" class="Bound">a↑</a> <a id="1748" class="Bound">Γ</a><a id="1749" class="Symbol">)</a>
</pre>
<p>With these, we can begin to introduce the Kripe logical relation
<code>Γ ⊢ t : T Ⓡ a</code> between a typed term <code>Γ ⊢ t : T</code>
and a value <code>a ∈ ⟦ T ⟧</code>. The logical relation will be defined
inductively on types. At type nat, the relation is defined as:</p>
<pre><code>Γ : nat Ⓡ 𝓋̂ ⇔ ∀ Γ′ ≤ Γ. Γ′ ⊢ t = 𝓋̂(Γ′) : nat</code></pre>
For Agda’s termination checking, we have to define the logical relation
at type nat separately, which we do so in the form of Ⓝ:
<pre class="Agda"><a id="_Ⓝ_"></a><a id="2185" href="Soundness.html#2185" class="Function Operator">_Ⓝ_</a> <a id="2189" class="Symbol">:</a> <a id="2191" class="Symbol">∀</a> <a id="2193" class="Symbol">{</a><a id="2194" href="Soundness.html#2194" class="Bound">Γ</a> <a id="2196" class="Symbol">:</a> <a id="2198" href="SystemT.html#1272" class="Datatype">Γ</a><a id="2199" class="Symbol">}</a> <a id="2201" class="Symbol">→</a> <a id="2203" href="Soundness.html#2194" class="Bound">Γ</a> <a id="2205" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="2207" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="2211" class="Symbol">→</a> <a id="2213" href="NbE.html#849" class="Field Operator">⟦</a> <a id="2215" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="2219" href="NbE.html#849" class="Field Operator">⟧</a> <a id="2221" class="Symbol">→</a> <a id="2223" href="Agda.Primitive.html#326" class="Primitive">Set</a>
</pre>
<p>We define Ⓝ mutually with ==ℕ̂, a relation representing the condition
<code>Γ′ ⊢ t = 𝓋̂(Γ′) : nat</code>, which lifts definitional equality to
be over naturals with embedded liftable neutrals</p>
<pre class="Agda"><a id="_==ℕ̂_"></a><a id="2422" href="Soundness.html#2422" class="Function Operator">_==ℕ̂_</a> <a id="2429" class="Symbol">:</a> <a id="2431" class="Symbol">∀</a> <a id="2433" class="Symbol">{</a><a id="2434" href="Soundness.html#2434" class="Bound">Γ</a> <a id="2436" class="Symbol">:</a> <a id="2438" href="SystemT.html#1272" class="Datatype">Γ</a><a id="2439" class="Symbol">}</a> <a id="2441" class="Symbol">→</a> <a id="2443" href="Soundness.html#2434" class="Bound">Γ</a> <a id="2445" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="2447" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="2451" class="Symbol">→</a> <a id="2453" href="NbE.html#849" class="Field Operator">⟦</a> <a id="2455" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="2459" href="NbE.html#849" class="Field Operator">⟧</a> <a id="2461" class="Symbol">→</a> <a id="2463" href="Agda.Primitive.html#326" class="Primitive">Set</a>

<a id="2468" href="Soundness.html#2185" class="Function Operator">_Ⓝ_</a> <a id="2472" class="Symbol">{</a><a id="2473" href="Soundness.html#2473" class="Bound">Γ</a><a id="2474" class="Symbol">}</a> <a id="2476" href="Soundness.html#2476" class="Bound">n</a> <a id="2478" href="Soundness.html#2478" class="Bound">𝓋̂</a> <a id="2481" class="Symbol">=</a>
  <a id="2485" class="Symbol">∀</a> <a id="2487" class="Symbol">{</a><a id="2488" href="Soundness.html#2488" class="Bound">Γ′</a> <a id="2491" class="Symbol">:</a> <a id="2493" href="SystemT.html#1272" class="Datatype">SystemT.Γ</a><a id="2502" class="Symbol">}</a>
  <a id="2506" class="Symbol">→</a> <a id="2508" class="Symbol">(</a><a id="2509" href="Soundness.html#2509" class="Bound">Γ′≤Γ</a> <a id="2514" class="Symbol">:</a> <a id="2516" href="Soundness.html#2488" class="Bound">Γ′</a> <a id="2519" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="2521" href="Soundness.html#2473" class="Bound">Γ</a><a id="2522" class="Symbol">)</a>
    <a id="2528" class="Comment">---------------</a>
  <a id="2546" class="Symbol">→</a> <a id="2548" href="Soundness.html#2509" class="Bound">Γ′≤Γ</a> <a id="2553" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="2556" href="Soundness.html#2476" class="Bound">n</a> <a id="2558" href="Soundness.html#2422" class="Function Operator">==ℕ̂</a> <a id="2563" href="Soundness.html#2478" class="Bound">𝓋̂</a>

<a id="2567" class="Keyword">infix</a> <a id="2573" class="Number">4</a> <a id="2575" href="Soundness.html#2185" class="Function Operator">_Ⓝ_</a>
</pre>
For <code>zero</code>, the ==ℕ̂ relation is a simple definitional
equality judgement:
<pre class="Agda"><a id="2667" href="Soundness.html#2422" class="Function Operator">_==ℕ̂_</a> <a id="2674" class="Symbol">{</a><a id="2675" href="Soundness.html#2675" class="Bound">Γ</a><a id="2676" class="Symbol">}</a> <a id="2678" href="Soundness.html#2678" class="Bound">t</a> <a id="2680" href="NbE.html#8617" class="InductiveConstructor">zero</a> <a id="2685" class="Symbol">=</a> <a id="2687" href="Soundness.html#2678" class="Bound">t</a> <a id="2689" href="SystemT.html#11908" class="Datatype Operator">==</a> <a id="2692" href="SystemT.html#3378" class="InductiveConstructor">zero</a>
</pre>
However, for our recursive case (suc 𝓋̂), the definition is a bit more
involved. We want the term to be definitionally equal to
<code>suc · n</code> such that n is logically related to 𝓋̂, a condition
stronger than ==ℕ̂, as it holds for all extensions of the context – this
is why we need to define ==ℕ̂ mutually with Ⓝ. We want our recursive
condition to be stronger to have an easier time with the embedded
liftable neutrals
<pre class="Agda"><a id="3126" href="Soundness.html#2422" class="Function Operator">_==ℕ̂_</a> <a id="3133" class="Symbol">{</a><a id="3134" href="Soundness.html#3134" class="Bound">Γ</a><a id="3135" class="Symbol">}</a> <a id="3137" href="Soundness.html#3137" class="Bound">t</a> <a id="3139" class="Symbol">(</a><a id="3140" href="NbE.html#8629" class="InductiveConstructor">suc</a> <a id="3144" href="Soundness.html#3144" class="Bound">𝓋̂</a><a id="3146" class="Symbol">)</a> <a id="3148" class="Symbol">=</a> <a id="3150" href="Data.Product.html#1806" class="Function">∃[</a> <a id="3153" href="Soundness.html#3153" class="Bound">n</a> <a id="3155" href="Data.Product.html#1806" class="Function">]</a> <a id="3157" href="Soundness.html#3137" class="Bound">t</a> <a id="3159" href="SystemT.html#11908" class="Datatype Operator">==</a> <a id="3162" href="SystemT.html#3396" class="InductiveConstructor">suc</a> <a id="3166" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="3168" href="Soundness.html#3153" class="Bound">n</a> <a id="3170" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="3172" href="Soundness.html#3153" class="Bound">n</a> <a id="3174" href="Soundness.html#2185" class="Function Operator">Ⓝ</a> <a id="3176" href="Soundness.html#3144" class="Bound">𝓋̂</a>
</pre>
For an embedded liftable neutral, the relation is the lifted
definitional equality defined earlier
<pre class="Agda"><a id="3290" href="Soundness.html#2422" class="Function Operator">_==ℕ̂_</a> <a id="3297" class="Symbol">{</a><a id="3298" href="Soundness.html#3298" class="Bound">Γ</a><a id="3299" class="Symbol">}</a> <a id="3301" href="Soundness.html#3301" class="Bound">t</a> <a id="3303" class="Symbol">(</a><a id="3304" href="NbE.html#8645" class="InductiveConstructor">ne</a> <a id="3307" href="Soundness.html#3307" class="Bound">𝓊̂</a><a id="3309" class="Symbol">)</a> <a id="3311" class="Symbol">=</a> <a id="3313" href="Soundness.html#3301" class="Bound">t</a> <a id="3315" href="Soundness.html#1073" class="Function Operator">==↑</a> <a id="3319" href="Soundness.html#3307" class="Bound">𝓊̂</a>

<a id="3323" class="Keyword">infix</a> <a id="3329" class="Number">3</a> <a id="3331" href="Soundness.html#2422" class="Function Operator">_==ℕ̂_</a>
</pre>
With these in place, we can start defining the logical relation Ⓡ itself
by induction on types, using Ⓝ for the base type nat
<pre class="Agda"><a id="_Ⓡ_"></a><a id="3477" href="Soundness.html#3477" class="Function Operator">_Ⓡ_</a> <a id="3481" class="Symbol">:</a> <a id="3483" class="Symbol">∀</a> <a id="3485" class="Symbol">{</a><a id="3486" href="Soundness.html#3486" class="Bound">Γ</a> <a id="3488" class="Symbol">:</a> <a id="3490" href="SystemT.html#1272" class="Datatype">Γ</a><a id="3491" class="Symbol">}</a> <a id="3493" class="Symbol">{</a><a id="3494" href="Soundness.html#3494" class="Bound">T</a> <a id="3496" class="Symbol">:</a> <a id="3498" href="SystemT.html#561" class="Datatype">Type</a><a id="3502" class="Symbol">}</a> <a id="3504" class="Symbol">→</a> <a id="3506" href="Soundness.html#3486" class="Bound">Γ</a> <a id="3508" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="3510" href="Soundness.html#3494" class="Bound">T</a> <a id="3512" class="Symbol">→</a> <a id="3514" href="NbE.html#849" class="Field Operator">⟦</a> <a id="3516" href="Soundness.html#3494" class="Bound">T</a> <a id="3518" href="NbE.html#849" class="Field Operator">⟧</a> <a id="3520" class="Symbol">→</a> <a id="3522" href="Agda.Primitive.html#326" class="Primitive">Set</a>

<a id="3527" href="Soundness.html#3477" class="Function Operator">_Ⓡ_</a> <a id="3531" class="Symbol">{</a><a id="3532" href="Soundness.html#3532" class="Bound">Γ</a><a id="3533" class="Symbol">}</a> <a id="3535" class="Symbol">{</a><a id="3536" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="3539" class="Symbol">}</a> <a id="3541" href="Soundness.html#3541" class="Bound">t</a> <a id="3543" href="Soundness.html#3543" class="Bound">𝓋̂</a> <a id="3546" class="Symbol">=</a> <a id="3548" href="Soundness.html#3541" class="Bound">t</a> <a id="3550" href="Soundness.html#2185" class="Function Operator">Ⓝ</a> <a id="3552" href="Soundness.html#3543" class="Bound">𝓋̂</a>
</pre>
For function types, the relation is defined as: Γ ⊢ r : S → T Ⓡ f ⇔ ∀ Γ′
≤ Γ. Γ′ ⊢ s : S Ⓡ a ⇒ Γ′ ⊢ r s : T Ⓡ f(a)
<pre class="Agda"><a id="3687" href="Soundness.html#3477" class="Function Operator">_Ⓡ_</a> <a id="3691" class="Symbol">{</a><a id="3692" href="Soundness.html#3692" class="Bound">Γ</a><a id="3693" class="Symbol">}</a> <a id="3695" class="Symbol">{</a><a id="3696" href="Soundness.html#3696" class="Bound">S</a> <a id="3698" href="SystemT.html#593" class="InductiveConstructor Operator">⇒</a> <a id="3700" href="Soundness.html#3700" class="Bound">T</a><a id="3701" class="Symbol">}</a> <a id="3703" href="Soundness.html#3703" class="Bound">r</a> <a id="3705" href="Soundness.html#3705" class="Bound">f</a> <a id="3707" class="Symbol">=</a>
  <a id="3711" class="Symbol">∀</a> <a id="3713" class="Symbol">{</a><a id="3714" href="Soundness.html#3714" class="Bound">Γ′</a> <a id="3717" class="Symbol">:</a> <a id="3719" href="SystemT.html#1272" class="Datatype">SystemT.Γ</a><a id="3728" class="Symbol">}</a>
  <a id="3732" class="Symbol">→</a> <a id="3734" class="Symbol">(</a><a id="3735" href="Soundness.html#3735" class="Bound">Γ′≤Γ</a> <a id="3740" class="Symbol">:</a> <a id="3742" href="Soundness.html#3714" class="Bound">Γ′</a> <a id="3745" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="3747" href="Soundness.html#3692" class="Bound">Γ</a><a id="3748" class="Symbol">)</a>
  <a id="3752" class="Symbol">→</a> <a id="3754" class="Symbol">∀</a> <a id="3756" class="Symbol">{</a><a id="3757" href="Soundness.html#3757" class="Bound">s</a> <a id="3759" class="Symbol">:</a> <a id="3761" href="Soundness.html#3714" class="Bound">Γ′</a> <a id="3764" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="3766" href="Soundness.html#3696" class="Bound">S</a><a id="3767" class="Symbol">}</a> <a id="3769" class="Symbol">{</a><a id="3770" href="Soundness.html#3770" class="Bound">a</a> <a id="3772" class="Symbol">:</a> <a id="3774" href="NbE.html#849" class="Field Operator">⟦</a> <a id="3776" href="Soundness.html#3696" class="Bound">S</a> <a id="3778" href="NbE.html#849" class="Field Operator">⟧</a><a id="3779" class="Symbol">}</a>
  <a id="3783" class="Symbol">→</a> <a id="3785" href="Soundness.html#3757" class="Bound">s</a> <a id="3787" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="3789" href="Soundness.html#3770" class="Bound">a</a>
    <a id="3795" class="Comment">----------------------</a>
  <a id="3820" class="Symbol">→</a> <a id="3822" class="Symbol">(</a><a id="3823" href="Soundness.html#3735" class="Bound">Γ′≤Γ</a> <a id="3828" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="3831" href="Soundness.html#3703" class="Bound">r</a><a id="3832" class="Symbol">)</a> <a id="3834" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="3836" href="Soundness.html#3757" class="Bound">s</a> <a id="3838" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="3840" href="Soundness.html#3705" class="Bound">f</a> <a id="3842" href="Soundness.html#3770" class="Bound">a</a>

<a id="3845" class="Keyword">infix</a> <a id="3851" class="Number">4</a> <a id="3853" href="Soundness.html#3477" class="Function Operator">_Ⓡ_</a>
</pre>
A result of defining our Kripe logical relation in terms of definitional
equality is that the relation is transitive with respect to definitional
equality
<pre class="Agda"><a id="==-Ⓡ-trans"></a><a id="4025" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="4036" class="Symbol">:</a> <a id="4038" class="Symbol">∀</a> <a id="4040" class="Symbol">{</a><a id="4041" href="Soundness.html#4041" class="Bound">Γ</a> <a id="4043" class="Symbol">:</a> <a id="4045" href="SystemT.html#1272" class="Datatype">Γ</a><a id="4046" class="Symbol">}</a> <a id="4048" class="Symbol">{</a><a id="4049" href="Soundness.html#4049" class="Bound">T</a> <a id="4051" class="Symbol">:</a> <a id="4053" href="SystemT.html#561" class="Datatype">Type</a><a id="4057" class="Symbol">}</a> <a id="4059" class="Symbol">{</a><a id="4060" href="Soundness.html#4060" class="Bound">t</a> <a id="4062" href="Soundness.html#4062" class="Bound">t′</a> <a id="4065" class="Symbol">:</a> <a id="4067" href="Soundness.html#4041" class="Bound">Γ</a> <a id="4069" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="4071" href="Soundness.html#4049" class="Bound">T</a><a id="4072" class="Symbol">}</a> <a id="4074" class="Symbol">{</a><a id="4075" href="Soundness.html#4075" class="Bound">a</a> <a id="4077" class="Symbol">:</a> <a id="4079" href="NbE.html#849" class="Field Operator">⟦</a> <a id="4081" href="Soundness.html#4049" class="Bound">T</a> <a id="4083" href="NbE.html#849" class="Field Operator">⟧</a><a id="4084" class="Symbol">}</a>
           <a id="4097" class="Symbol">→</a> <a id="4099" href="Soundness.html#4060" class="Bound">t</a> <a id="4101" href="SystemT.html#11908" class="Datatype Operator">==</a> <a id="4104" href="Soundness.html#4062" class="Bound">t′</a>
           <a id="4118" class="Symbol">→</a> <a id="4120" href="Soundness.html#4060" class="Bound">t</a> <a id="4122" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="4124" href="Soundness.html#4075" class="Bound">a</a>
             <a id="4139" class="Comment">-------</a>
           <a id="4158" class="Symbol">→</a> <a id="4160" href="Soundness.html#4062" class="Bound">t′</a> <a id="4163" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="4165" href="Soundness.html#4075" class="Bound">a</a>
<a id="4167" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="4178" class="Symbol">{</a><a id="4179" class="Argument">T</a> <a id="4181" class="Symbol">=</a> <a id="4183" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="4186" class="Symbol">}</a> <a id="4188" class="Symbol">{</a><a id="4189" class="Argument">a</a> <a id="4191" class="Symbol">=</a> <a id="4193" href="NbE.html#8617" class="InductiveConstructor">zero</a><a id="4197" class="Symbol">}</a> <a id="4199" href="Soundness.html#4199" class="Bound">t==t′</a> <a id="4205" href="Soundness.html#4205" class="Bound">pf</a> <a id="4208" href="Soundness.html#4208" class="Bound">Γ′≤Γ</a> <a id="4213" class="Symbol">=</a>
  <a id="4217" href="SystemT.html#13516" class="InductiveConstructor">trans</a> <a id="4223" class="Symbol">(</a><a id="4224" href="SystemT.html#13417" class="InductiveConstructor">sym</a> <a id="4228" class="Symbol">(</a><a id="4229" href="Lemmas.html#5879" class="Postulate">==-subst</a> <a id="4238" href="Soundness.html#4199" class="Bound">t==t′</a><a id="4243" class="Symbol">))</a> <a id="4246" class="Symbol">(</a><a id="4247" href="Soundness.html#4205" class="Bound">pf</a> <a id="4250" href="Soundness.html#4208" class="Bound">Γ′≤Γ</a><a id="4254" class="Symbol">)</a>
<a id="4256" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="4267" class="Symbol">{</a><a id="4268" class="Argument">T</a> <a id="4270" class="Symbol">=</a> <a id="4272" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="4275" class="Symbol">}</a> <a id="4277" class="Symbol">{</a><a id="4278" class="Argument">a</a> <a id="4280" class="Symbol">=</a> <a id="4282" href="NbE.html#8629" class="InductiveConstructor">suc</a> <a id="4286" href="Soundness.html#4286" class="Bound">a</a><a id="4287" class="Symbol">}</a> <a id="4289" href="Soundness.html#4289" class="Bound">t==t′</a> <a id="4295" href="Soundness.html#4295" class="Bound">pf</a> <a id="4298" href="Soundness.html#4298" class="Bound">Γ′≤Γ</a>
  <a id="4305" class="Keyword">with</a> <a id="4310" href="Soundness.html#4295" class="Bound">pf</a> <a id="4313" href="Soundness.html#4298" class="Bound">Γ′≤Γ</a>
<a id="4318" class="Symbol">...</a> <a id="4322" class="Symbol">|</a> <a id="4324" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="4326" href="Soundness.html#4326" class="Bound">n</a> <a id="4328" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="4330" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="4332" href="Soundness.html#4332" class="Bound">t==sn</a> <a id="4338" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="4340" href="Soundness.html#4340" class="Bound">n==a</a> <a id="4345" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="4347" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="4349" class="Symbol">=</a>
  <a id="4353" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="4355" href="Soundness.html#4326" class="Bound">n</a> <a id="4357" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="4359" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="4361" href="SystemT.html#13516" class="InductiveConstructor">trans</a> <a id="4367" class="Symbol">(</a><a id="4368" href="SystemT.html#13417" class="InductiveConstructor">sym</a> <a id="4372" class="Symbol">(</a><a id="4373" href="Lemmas.html#5879" class="Postulate">==-subst</a> <a id="4382" class="Bound">t==t′</a><a id="4387" class="Symbol">))</a> <a id="4390" href="Soundness.html#4332" class="Bound">t==sn</a> <a id="4396" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="4398" href="Soundness.html#4340" class="Bound">n==a</a> <a id="4403" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="4405" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
<a id="4407" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="4418" class="Symbol">{</a><a id="4419" class="Argument">T</a> <a id="4421" class="Symbol">=</a> <a id="4423" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="4426" class="Symbol">}</a> <a id="4428" class="Symbol">{</a><a id="4429" class="Argument">a</a> <a id="4431" class="Symbol">=</a> <a id="4433" href="NbE.html#8645" class="InductiveConstructor">ne</a> <a id="4436" href="Soundness.html#4436" class="Bound">𝓊̂</a><a id="4438" class="Symbol">}</a> <a id="4440" href="Soundness.html#4440" class="Bound">t==t′</a> <a id="4446" href="Soundness.html#4446" class="Bound">pf</a> <a id="4449" class="Symbol">{</a><a id="4450" href="Soundness.html#4450" class="Bound">Γ′</a><a id="4452" class="Symbol">}</a> <a id="4454" href="Soundness.html#4454" class="Bound">Γ′≤Γ</a>
  <a id="4461" class="Keyword">with</a> <a id="4466" href="Soundness.html#4436" class="Bound">𝓊̂</a> <a id="4469" href="Soundness.html#4450" class="Bound">Γ′</a>          <a id="4481" class="Symbol">|</a> <a id="4483" href="Soundness.html#4446" class="Bound">pf</a> <a id="4486" href="Soundness.html#4454" class="Bound">Γ′≤Γ</a>
<a id="4491" class="Symbol">...</a> <a id="4495" class="Symbol">|</a> <a id="4497" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="4502" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="4504" href="Soundness.html#4504" class="Bound">𝓊</a> <a id="4506" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="4508" class="Symbol">_</a> <a id="4510" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="4512" class="Symbol">|</a> <a id="4514" href="Soundness.html#4514" class="Bound">t==𝓊</a> <a id="4519" class="Symbol">=</a>
  <a id="4523" href="SystemT.html#13516" class="InductiveConstructor">trans</a> <a id="4529" class="Symbol">(</a><a id="4530" href="SystemT.html#13417" class="InductiveConstructor">sym</a> <a id="4534" class="Symbol">(</a><a id="4535" href="Lemmas.html#5879" class="Postulate">==-subst</a> <a id="4544" class="Bound">t==t′</a><a id="4549" class="Symbol">))</a> <a id="4552" href="Soundness.html#4514" class="Bound">t==𝓊</a>
<a id="4557" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="4568" class="Symbol">{</a><a id="4569" class="Argument">T</a> <a id="4571" class="Symbol">=</a> <a id="4573" href="Soundness.html#4573" class="Bound">S</a> <a id="4575" href="SystemT.html#593" class="InductiveConstructor Operator">⇒</a> <a id="4577" href="Soundness.html#4577" class="Bound">T</a><a id="4578" class="Symbol">}</a> <a id="4580" href="Soundness.html#4580" class="Bound">t==t′</a> <a id="4586" href="Soundness.html#4586" class="Bound">pf</a> <a id="4589" href="Soundness.html#4589" class="Bound">Γ′≤Γ</a> <a id="4594" href="Soundness.html#4594" class="Bound">sⓇa</a> <a id="4598" class="Symbol">=</a>
  <a id="4602" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="4613" class="Symbol">(</a><a id="4614" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a> <a id="4629" class="Symbol">(</a><a id="4630" href="Lemmas.html#5879" class="Postulate">==-subst</a> <a id="4639" href="Soundness.html#4580" class="Bound">t==t′</a><a id="4644" class="Symbol">)</a> <a id="4646" href="SystemT.html#13338" class="InductiveConstructor">refl</a><a id="4650" class="Symbol">)</a> <a id="4652" class="Symbol">(</a><a id="4653" href="Soundness.html#4586" class="Bound">pf</a> <a id="4656" href="Soundness.html#4589" class="Bound">Γ′≤Γ</a> <a id="4661" href="Soundness.html#4594" class="Bound">sⓇa</a><a id="4664" class="Symbol">)</a>
</pre>
Additionally, because we have defined the relation so that its
implication holds for all extensions of a context, we can “weaken” the
logical relation <code>Γ ⊢ t : T Ⓡ a</code> for all <code>Γ′ ≤ Γ</code>,
having that <code>Γ′ ⊢ t : T Ⓡ a</code> holds as well
<pre class="Agda"><a id="Ⓡ-weaken"></a><a id="4907" href="Soundness.html#4907" class="Function">Ⓡ-weaken</a> <a id="4916" class="Symbol">:</a> <a id="4918" class="Symbol">∀</a> <a id="4920" class="Symbol">{</a><a id="4921" href="Soundness.html#4921" class="Bound">Γ′</a> <a id="4924" href="Soundness.html#4924" class="Bound">Γ</a> <a id="4926" class="Symbol">:</a> <a id="4928" href="SystemT.html#1272" class="Datatype">Γ</a><a id="4929" class="Symbol">}</a> <a id="4931" class="Symbol">{</a><a id="4932" href="Soundness.html#4932" class="Bound">T</a> <a id="4934" class="Symbol">:</a> <a id="4936" href="SystemT.html#561" class="Datatype">Type</a><a id="4940" class="Symbol">}</a> <a id="4942" class="Symbol">{</a><a id="4943" href="Soundness.html#4943" class="Bound">Γ′≤Γ</a> <a id="4948" class="Symbol">:</a> <a id="4950" href="Soundness.html#4921" class="Bound">Γ′</a> <a id="4953" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="4955" href="Soundness.html#4924" class="Bound">Γ</a><a id="4956" class="Symbol">}</a> <a id="4958" class="Symbol">{</a><a id="4959" href="Soundness.html#4959" class="Bound">t</a> <a id="4961" class="Symbol">:</a> <a id="4963" href="Soundness.html#4924" class="Bound">Γ</a> <a id="4965" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="4967" href="Soundness.html#4932" class="Bound">T</a><a id="4968" class="Symbol">}</a> <a id="4970" class="Symbol">{</a><a id="4971" href="Soundness.html#4971" class="Bound">a</a> <a id="4973" class="Symbol">:</a> <a id="4975" href="NbE.html#849" class="Field Operator">⟦</a> <a id="4977" href="Soundness.html#4932" class="Bound">T</a> <a id="4979" href="NbE.html#849" class="Field Operator">⟧</a><a id="4980" class="Symbol">}</a>
      <a id="4988" class="Symbol">→</a> <a id="4990" href="Soundness.html#4959" class="Bound">t</a> <a id="4992" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="4994" href="Soundness.html#4971" class="Bound">a</a>
      <a id="5002" class="Symbol">→</a> <a id="5004" href="Soundness.html#4943" class="Bound">Γ′≤Γ</a> <a id="5009" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="5012" href="Soundness.html#4959" class="Bound">t</a> <a id="5014" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="5016" href="Soundness.html#4971" class="Bound">a</a>
<a id="5018" href="Soundness.html#4907" class="Function">Ⓡ-weaken</a> <a id="5027" class="Symbol">{</a><a id="5028" class="Argument">T</a> <a id="5030" class="Symbol">=</a> <a id="5032" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="5035" class="Symbol">}</a> <a id="5037" class="Symbol">{</a><a id="5038" href="Soundness.html#5038" class="Bound">Γ′≤Γ</a><a id="5042" class="Symbol">}</a> <a id="5044" class="Symbol">{</a><a id="5045" href="Soundness.html#5045" class="Bound">t</a><a id="5046" class="Symbol">}</a> <a id="5048" href="Soundness.html#5048" class="Bound">pf</a> <a id="5051" href="Soundness.html#5051" class="Bound">Γ″≤Γ′</a>
  <a id="5059" class="Keyword">rewrite</a> <a id="5067" href="Lemmas.html#5530" class="Postulate">weaken-compose</a> <a id="5082" href="Soundness.html#5051" class="Bound">Γ″≤Γ′</a> <a id="5088" href="Soundness.html#5038" class="Bound">Γ′≤Γ</a> <a id="5093" href="Soundness.html#5045" class="Bound">t</a> <a id="5095" class="Symbol">=</a> <a id="5097" href="Soundness.html#5048" class="Bound">pf</a> <a id="5100" class="Symbol">(</a><a id="5101" href="Lemmas.html#1965" class="Function">≤-trans</a> <a id="5109" href="Soundness.html#5051" class="Bound">Γ″≤Γ′</a> <a id="5115" href="Soundness.html#5038" class="Bound">Γ′≤Γ</a><a id="5119" class="Symbol">)</a>
<a id="5121" href="Soundness.html#4907" class="Function">Ⓡ-weaken</a> <a id="5130" class="Symbol">{</a><a id="5131" class="Argument">T</a> <a id="5133" class="Symbol">=</a> <a id="5135" href="Soundness.html#5135" class="Bound">S</a> <a id="5137" href="SystemT.html#593" class="InductiveConstructor Operator">⇒</a> <a id="5139" href="Soundness.html#5139" class="Bound">T</a><a id="5140" class="Symbol">}</a> <a id="5142" class="Symbol">{</a><a id="5143" href="Soundness.html#5143" class="Bound">Γ′≤Γ</a><a id="5147" class="Symbol">}</a> <a id="5149" class="Symbol">{</a><a id="5150" href="Soundness.html#5150" class="Bound">t</a><a id="5151" class="Symbol">}</a> <a id="5153" href="Soundness.html#5153" class="Bound">pf</a> <a id="5156" href="Soundness.html#5156" class="Bound">Γ″≤Γ′</a> <a id="5162" href="Soundness.html#5162" class="Bound">sⓇa</a>
  <a id="5168" class="Keyword">rewrite</a> <a id="5176" href="Lemmas.html#5530" class="Postulate">weaken-compose</a> <a id="5191" href="Soundness.html#5156" class="Bound">Γ″≤Γ′</a> <a id="5197" href="Soundness.html#5143" class="Bound">Γ′≤Γ</a> <a id="5202" href="Soundness.html#5150" class="Bound">t</a> <a id="5204" class="Symbol">=</a> <a id="5206" href="Soundness.html#5153" class="Bound">pf</a> <a id="5209" class="Symbol">(</a><a id="5210" href="Lemmas.html#1965" class="Function">≤-trans</a> <a id="5218" href="Soundness.html#5156" class="Bound">Γ″≤Γ′</a> <a id="5224" href="Soundness.html#5143" class="Bound">Γ′≤Γ</a><a id="5228" class="Symbol">)</a> <a id="5230" href="Soundness.html#5162" class="Bound">sⓇa</a>
</pre>
<p>The Kripke logical relation is “sandwiched” between reflection and
reification – to arrive at the logical relation between a term and a
semantic object, the semantic object must be a reflection of a liftable
neutral that is definitionally equal to the term. Likewise, if a logical
relation holds between a term and a semantic object, then the term must
be definitionally equal to the reification of that semantic object.</p>
<p>This is intentional, as these results will be exactly what we will
need to prove the soundness of NbE. We formalize them with the following
implications, which we will prove mutually (as reflection and
reification are themselves defined mutually) by induction on types.</p>
<p>Our first implication is:</p>
<pre><code>(∀ Γ′ ≤ Γ. Γ′ ⊢ 𝓊 = 𝓊̂(Γ) : T) ⇒ Γ ⊢ 𝓊 : T Ⓡ ↑ᵀ 𝓊̂</code></pre>
which we can now formalize in Agda with our definitions
<pre class="Agda"><a id="==↑-Ⓡ"></a><a id="6080" href="Soundness.html#6080" class="Function">==↑-Ⓡ</a> <a id="6086" class="Symbol">:</a> <a id="6088" class="Symbol">∀</a> <a id="6090" class="Symbol">{</a><a id="6091" href="Soundness.html#6091" class="Bound">Γ</a> <a id="6093" class="Symbol">:</a> <a id="6095" href="SystemT.html#1272" class="Datatype">Γ</a><a id="6096" class="Symbol">}</a> <a id="6098" class="Symbol">{</a><a id="6099" href="Soundness.html#6099" class="Bound">T</a> <a id="6101" class="Symbol">:</a> <a id="6103" href="SystemT.html#561" class="Datatype">Type</a><a id="6107" class="Symbol">}</a> <a id="6109" class="Symbol">{</a><a id="6110" href="Soundness.html#6110" class="Bound">𝓊</a> <a id="6112" class="Symbol">:</a> <a id="6114" href="Soundness.html#6091" class="Bound">Γ</a> <a id="6116" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="6118" href="Soundness.html#6099" class="Bound">T</a><a id="6119" class="Symbol">}</a> <a id="6121" class="Symbol">{</a><a id="6122" href="Soundness.html#6122" class="Bound">𝓊̂</a> <a id="6125" class="Symbol">:</a> <a id="6127" href="NbE.html#7764" class="Function">Ne↑</a> <a id="6131" href="Soundness.html#6099" class="Bound">T</a><a id="6132" class="Symbol">}</a>
      <a id="6140" class="Symbol">→</a> <a id="6142" class="Symbol">(∀</a> <a id="6145" class="Symbol">{</a><a id="6146" href="Soundness.html#6146" class="Bound">Γ′</a> <a id="6149" class="Symbol">:</a> <a id="6151" href="SystemT.html#1272" class="Datatype">SystemT.Γ</a><a id="6160" class="Symbol">}</a>
         <a id="6171" class="Symbol">→</a> <a id="6173" class="Symbol">(</a><a id="6174" href="Soundness.html#6174" class="Bound">Γ′≤Γ</a> <a id="6179" class="Symbol">:</a> <a id="6181" href="Soundness.html#6146" class="Bound">Γ′</a> <a id="6184" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="6186" href="Soundness.html#6091" class="Bound">Γ</a><a id="6187" class="Symbol">)</a>
         <a id="6198" class="Symbol">→</a> <a id="6200" href="Soundness.html#6174" class="Bound">Γ′≤Γ</a> <a id="6205" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="6208" href="Soundness.html#6110" class="Bound">𝓊</a> <a id="6210" href="Soundness.html#1073" class="Function Operator">==↑</a> <a id="6214" href="Soundness.html#6122" class="Bound">𝓊̂</a><a id="6216" class="Symbol">)</a>
        <a id="6226" class="Comment">-------------------</a>
      <a id="6252" class="Symbol">→</a> <a id="6254" href="Soundness.html#6110" class="Bound">𝓊</a> <a id="6256" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="6258" class="Symbol">(</a><a id="6259" href="NbE.html#9074" class="Function">↑ᵀ</a> <a id="6262" href="Soundness.html#6122" class="Bound">𝓊̂</a><a id="6264" class="Symbol">)</a>
</pre>
<p>The second implication is:</p>
<pre><code>Γ ⊢ t : T Ⓡ a ⇒ ∀ Γ′ ≤ Γ. Γ′ ⊢ t = ↓ᵀ a Γ′ : T</code></pre>
<pre class="Agda"><a id="Ⓡ-==↓"></a><a id="6359" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="6365" class="Symbol">:</a> <a id="6367" class="Symbol">∀</a> <a id="6369" class="Symbol">{</a><a id="6370" href="Soundness.html#6370" class="Bound">Γ′</a> <a id="6373" href="Soundness.html#6373" class="Bound">Γ</a> <a id="6375" class="Symbol">:</a> <a id="6377" href="SystemT.html#1272" class="Datatype">Γ</a><a id="6378" class="Symbol">}</a> <a id="6380" class="Symbol">{</a><a id="6381" href="Soundness.html#6381" class="Bound">T</a> <a id="6383" class="Symbol">:</a> <a id="6385" href="SystemT.html#561" class="Datatype">Type</a><a id="6389" class="Symbol">}</a> <a id="6391" class="Symbol">{</a><a id="6392" href="Soundness.html#6392" class="Bound">t</a> <a id="6394" class="Symbol">:</a> <a id="6396" href="Soundness.html#6373" class="Bound">Γ</a> <a id="6398" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="6400" href="Soundness.html#6381" class="Bound">T</a><a id="6401" class="Symbol">}</a> <a id="6403" class="Symbol">{</a><a id="6404" href="Soundness.html#6404" class="Bound">a</a> <a id="6406" class="Symbol">:</a> <a id="6408" href="NbE.html#849" class="Field Operator">⟦</a> <a id="6410" href="Soundness.html#6381" class="Bound">T</a> <a id="6412" href="NbE.html#849" class="Field Operator">⟧</a><a id="6413" class="Symbol">}</a>
      <a id="6421" class="Symbol">→</a> <a id="6423" href="Soundness.html#6392" class="Bound">t</a> <a id="6425" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="6427" href="Soundness.html#6404" class="Bound">a</a>
        <a id="6437" class="Comment">---------------------</a>
      <a id="6465" class="Symbol">→</a> <a id="6467" class="Symbol">(</a><a id="6468" href="Soundness.html#6468" class="Bound">Γ′≤Γ</a> <a id="6473" class="Symbol">:</a> <a id="6475" href="Soundness.html#6370" class="Bound">Γ′</a> <a id="6478" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="6480" href="Soundness.html#6373" class="Bound">Γ</a><a id="6481" class="Symbol">)</a>
      <a id="6489" class="Symbol">→</a> <a id="6491" href="Soundness.html#6468" class="Bound">Γ′≤Γ</a> <a id="6496" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="6499" href="Soundness.html#6392" class="Bound">t</a> <a id="6501" href="SystemT.html#11908" class="Datatype Operator">==</a> <a id="6504" href="Soundness.html#1658" class="Function">↓ᵀᵧ</a> <a id="6508" href="Soundness.html#6404" class="Bound">a</a>
</pre>
A consequence of the first implication is that
<code>Γ , x:T ⊢ x Ⓡ ↑ᵀ (𝓍̂ Γ)</code>, which we define now as it will be
the lemma we will need for proving the second implication
<pre class="Agda"><a id="xⓇ↑ᵀ𝓍̂"></a><a id="6689" href="Soundness.html#6689" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="6696" class="Symbol">:</a> <a id="6698" class="Symbol">∀</a> <a id="6700" class="Symbol">{</a><a id="6701" href="Soundness.html#6701" class="Bound">Γ</a> <a id="6703" class="Symbol">:</a> <a id="6705" href="SystemT.html#1272" class="Datatype">Γ</a><a id="6706" class="Symbol">}</a> <a id="6708" class="Symbol">{</a><a id="6709" href="Soundness.html#6709" class="Bound">T</a> <a id="6711" class="Symbol">:</a> <a id="6713" href="SystemT.html#561" class="Datatype">Type</a><a id="6717" class="Symbol">}</a>
        <a id="6727" class="Comment">-------------------------</a>
      <a id="6759" class="Symbol">→</a> <a id="6761" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="6763" href="SystemT.html#2712" class="InductiveConstructor">`Z</a> <a id="6766" class="Symbol">{</a><a id="6767" href="Soundness.html#6701" class="Bound">Γ</a><a id="6768" class="Symbol">}</a> <a id="6770" class="Symbol">{</a><a id="6771" href="Soundness.html#6709" class="Bound">T</a><a id="6772" class="Symbol">}</a> <a id="6774" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="6776" href="NbE.html#9074" class="Function">↑ᵀ</a> <a id="6779" class="Symbol">(</a><a id="6780" href="NbE.html#11009" class="Function">𝓍̂</a> <a id="6783" href="Soundness.html#6709" class="Bound">T</a> <a id="6785" href="Soundness.html#6701" class="Bound">Γ</a><a id="6786" class="Symbol">)</a>
</pre>
To prove the first implication, first we show that it always holds for
liftable neutral terms of type nat. This is simply the given proof, so
this case follows immediately.
<pre class="Agda"><a id="6974" href="Soundness.html#6080" class="Function">==↑-Ⓡ</a> <a id="6980" class="Symbol">{</a><a id="6981" class="Argument">T</a> <a id="6983" class="Symbol">=</a> <a id="6985" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="6988" class="Symbol">}</a> <a id="6990" href="Soundness.html#6990" class="Bound">pf</a> <a id="6993" href="Soundness.html#6993" class="Bound">Γ′≤Γ</a> <a id="6998" class="Symbol">=</a> <a id="7000" href="Soundness.html#6990" class="Bound">pf</a> <a id="7003" href="Soundness.html#6993" class="Bound">Γ′≤Γ</a>
</pre>
<p>Now, for liftable neutral terms of type S → T, we prove that the
relation holds for <code>↑ᵀ (𝓊̂ · ↓ˢ a)</code></p>
<p>We prove the relation holds by using our induction hypothesis, so
that our new goal is to prove that</p>
<pre><code>Γ″ ⊢ 𝓊 s = (𝓊̂ · (↓ˢ a)) Γ″ : T</code></pre>
<p>for any Γ″ that is an extension of Γ′ (which itself extends Γ).</p>
<p>Note that <code>(𝓊̂ · (↓ˢ a)) Γ″</code> is equivalent to
<code>𝓊̂(Γ″) · (↓ˢ a)(Γ″)</code> (application of liftable neutrals is
overloaded.</p>
<p>First, we deconstruct <code>𝓊̂ (Γ″)</code>, using our given proof that
it’s definitionally equal to <code>Γ″ ⊢ 𝓊 : S → T</code> to both discard
the case where <code>𝓊̂ (Γ″)</code> is undefined and simplify our goal to
proving that:</p>
<pre><code>Γ″ ⊢ 𝓊 · s = 𝓊″ · ↓ˢ a Γ″ : T (𝓊″ is 𝓊̂ lifted to the context Γ″)</code></pre>
<p>We also use the other implication we will prove, alongside the fact
that <code>s Ⓡ a</code>, to have evidence that <code>Γ″ ⊢ s : S</code>
is definitionally equal to <code>↓ˢ a Γ″</code>.</p>
With these pieces in place, we can use equational reasoning for
definitional equality to prove the desired goal.
<pre class="Agda"><a id="7984" href="Soundness.html#6080" class="Function">==↑-Ⓡ</a> <a id="7990" class="Symbol">{</a><a id="7991" class="Argument">T</a> <a id="7993" class="Symbol">=</a> <a id="7995" class="Symbol">_</a> <a id="7997" href="SystemT.html#593" class="InductiveConstructor Operator">⇒</a> <a id="7999" class="Symbol">_}</a> <a id="8002" class="Symbol">{</a><a id="8003" href="Soundness.html#8003" class="Bound">𝓊</a><a id="8004" class="Symbol">}</a> <a id="8006" class="Symbol">{</a><a id="8007" href="Soundness.html#8007" class="Bound">𝓊̂</a><a id="8009" class="Symbol">}</a> <a id="8011" href="Soundness.html#8011" class="Bound">pf</a> <a id="8014" class="Symbol">{</a><a id="8015" href="Soundness.html#8015" class="Bound">Γ′</a><a id="8017" class="Symbol">}</a> <a id="8019" href="Soundness.html#8019" class="Bound">Γ′≤Γ</a> <a id="8024" class="Symbol">{</a><a id="8025" href="Soundness.html#8025" class="Bound">s</a><a id="8026" class="Symbol">}</a> <a id="8028" class="Symbol">{</a><a id="8029" href="Soundness.html#8029" class="Bound">a</a><a id="8030" class="Symbol">}</a> <a id="8032" href="Soundness.html#8032" class="Bound">sⓇa</a> <a id="8036" class="Symbol">=</a>
  <a id="8040" href="Soundness.html#6080" class="Function">==↑-Ⓡ</a> <a id="8046" href="Soundness.html#8074" class="Function">𝓊·s==𝓊̂·↓ˢa</a>
    <a id="8062" class="Keyword">where</a>
      <a id="8074" href="Soundness.html#8074" class="Function">𝓊·s==𝓊̂·↓ˢa</a> <a id="8086" class="Symbol">:</a> <a id="8088" class="Symbol">∀</a> <a id="8090" class="Symbol">{</a><a id="8091" href="Soundness.html#8091" class="Bound">Γ″</a> <a id="8094" class="Symbol">:</a> <a id="8096" href="SystemT.html#1272" class="Datatype">Γ</a><a id="8097" class="Symbol">}</a>
                 <a id="8116" class="Symbol">→</a> <a id="8118" class="Symbol">(</a><a id="8119" href="Soundness.html#8119" class="Bound">Γ″≤Γ′</a> <a id="8125" class="Symbol">:</a> <a id="8127" href="Soundness.html#8091" class="Bound">Γ″</a> <a id="8130" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="8132" href="Soundness.html#8015" class="Bound">Γ′</a><a id="8134" class="Symbol">)</a>
                 <a id="8153" class="Symbol">→</a> <a id="8155" href="Soundness.html#8119" class="Bound">Γ″≤Γ′</a> <a id="8161" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="8164" class="Symbol">(</a><a id="8165" href="Soundness.html#8019" class="Bound">Γ′≤Γ</a> <a id="8170" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="8173" href="Soundness.html#8003" class="Bound">𝓊</a><a id="8174" class="Symbol">)</a> <a id="8176" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="8178" href="Soundness.html#8025" class="Bound">s</a> <a id="8180" href="Soundness.html#1073" class="Function Operator">==↑</a> <a id="8184" href="Soundness.html#8007" class="Bound">𝓊̂</a> <a id="8187" href="NbE.html#7986" class="Function Operator">·↑</a> <a id="8190" class="Symbol">(</a><a id="8191" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="8194" href="Soundness.html#8029" class="Bound">a</a><a id="8195" class="Symbol">)</a>
      <a id="8203" href="Soundness.html#8074" class="Function">𝓊·s==𝓊̂·↓ˢa</a>  <a id="8216" class="Symbol">{</a><a id="8217" href="Soundness.html#8217" class="Bound">Γ″</a><a id="8219" class="Symbol">}</a> <a id="8221" href="Soundness.html#8221" class="Bound">Γ″≤Γ′</a>
        <a id="8235" class="Keyword">with</a> <a id="8240" href="Soundness.html#8007" class="Bound">𝓊̂</a> <a id="8243" href="Soundness.html#8217" class="Bound">Γ″</a>           <a id="8256" class="Symbol">|</a> <a id="8258" href="Soundness.html#8011" class="Bound">pf</a> <a id="8261" class="Symbol">(</a><a id="8262" href="Lemmas.html#1965" class="Function">≤-trans</a> <a id="8270" href="Soundness.html#8221" class="Bound">Γ″≤Γ′</a> <a id="8276" href="Soundness.html#8019" class="Bound">Γ′≤Γ</a><a id="8280" class="Symbol">)</a>
      <a id="8288" class="Symbol">...</a> <a id="8292" class="Symbol">|</a> <a id="8294" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="8299" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="8301" href="Soundness.html#8301" class="Bound">𝓊″</a> <a id="8304" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="8306" class="Symbol">_</a> <a id="8308" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="8310" class="Symbol">|</a> <a id="8312" href="Soundness.html#8312" class="Bound">𝓊==𝓊″</a>
        <a id="8326" class="Keyword">with</a> <a id="8331" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="8337" href="Soundness.html#8032" class="Bound">sⓇa</a> <a id="8341" class="Bound">Γ″≤Γ′</a>
      <a id="8353" class="Symbol">...</a> <a id="8357" class="Symbol">|</a> <a id="8359" href="Soundness.html#8359" class="Bound">s==↓ᵀᵧa</a> <a id="8367" class="Symbol">=</a>
        <a id="8377" href="SystemT.html#13905" class="Function Operator">begin</a>
          <a id="8393" class="Bound">Γ″≤Γ′</a> <a id="8399" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="8402" class="Symbol">(</a><a id="8403" href="Soundness.html#8019" class="Bound">Γ′≤Γ</a> <a id="8408" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="8411" href="Soundness.html#8003" class="Bound">𝓊</a><a id="8412" class="Symbol">)</a> <a id="8414" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="8416" href="Soundness.html#8025" class="Bound">s</a>
        <a id="8426" href="SystemT.html#14013" class="Function Operator">==⟨</a> <a id="8430" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a> <a id="8445" class="Symbol">(</a><a id="8446" href="Lemmas.html#268" class="Function">≡→==</a> <a id="8451" class="Symbol">(</a><a id="8452" href="Lemmas.html#5530" class="Postulate">weaken-compose</a> <a id="8467" class="Bound">Γ″≤Γ′</a> <a id="8473" href="Soundness.html#8019" class="Bound">Γ′≤Γ</a> <a id="8478" href="Soundness.html#8003" class="Bound">𝓊</a><a id="8479" class="Symbol">))</a> <a id="8482" href="SystemT.html#13338" class="InductiveConstructor">refl</a> <a id="8487" href="SystemT.html#14013" class="Function Operator">⟩</a>
          <a id="8499" class="Symbol">(</a><a id="8500" href="Soundness.html#8691" class="Function">Γ″≤Γ</a> <a id="8505" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="8508" href="Soundness.html#8003" class="Bound">𝓊</a><a id="8509" class="Symbol">)</a> <a id="8511" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="8513" class="Symbol">(</a><a id="8514" class="Bound">Γ″≤Γ′</a> <a id="8520" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="8523" href="Soundness.html#8025" class="Bound">s</a><a id="8524" class="Symbol">)</a>
        <a id="8534" href="SystemT.html#14013" class="Function Operator">==⟨</a> <a id="8538" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a> <a id="8553" class="Bound">𝓊==𝓊″</a> <a id="8559" href="SystemT.html#13338" class="InductiveConstructor">refl</a> <a id="8564" href="SystemT.html#14013" class="Function Operator">⟩</a>
          <a id="8576" class="Bound">𝓊″</a> <a id="8579" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="8581" class="Symbol">(</a><a id="8582" class="Bound">Γ″≤Γ′</a> <a id="8588" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="8591" href="Soundness.html#8025" class="Bound">s</a><a id="8592" class="Symbol">)</a>
        <a id="8602" href="SystemT.html#14013" class="Function Operator">==⟨</a> <a id="8606" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a> <a id="8621" href="SystemT.html#13338" class="InductiveConstructor">refl</a> <a id="8626" href="Soundness.html#8359" class="Bound">s==↓ᵀᵧa</a> <a id="8634" href="SystemT.html#14013" class="Function Operator">⟩</a>
          <a id="8646" class="Bound">𝓊″</a> <a id="8649" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="8651" href="Soundness.html#1658" class="Function">↓ᵀᵧ</a> <a id="8655" href="Soundness.html#8029" class="Bound">a</a>
        <a id="8665" href="SystemT.html#14184" class="Function Operator">∎</a>
        <a id="8675" class="Keyword">where</a>
          <a id="8691" href="Soundness.html#8691" class="Function">Γ″≤Γ</a> <a id="8696" class="Symbol">=</a> <a id="8698" href="Lemmas.html#1965" class="Function">≤-trans</a> <a id="8706" class="Bound">Γ″≤Γ′</a> <a id="8712" href="Soundness.html#8019" class="Bound">Γ′≤Γ</a>
</pre>
To prove the second implication, we proceed similarly and first prove it
for type nat. If the term is logically related to zero, the implication
holds immediately from our given proof
<pre class="Agda"><a id="8914" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="8920" class="Symbol">{</a><a id="8921" class="Argument">T</a> <a id="8923" class="Symbol">=</a> <a id="8925" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="8928" class="Symbol">}</a> <a id="8930" class="Symbol">{</a><a id="8931" class="Argument">a</a> <a id="8933" class="Symbol">=</a> <a id="8935" href="NbE.html#8617" class="InductiveConstructor">zero</a><a id="8939" class="Symbol">}</a> <a id="8941" href="Soundness.html#8941" class="Bound">pf</a> <a id="8944" href="Soundness.html#8944" class="Bound">Γ′≤Γ</a> <a id="8949" class="Keyword">with</a> <a id="8954" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="8957" class="Symbol">{</a><a id="8958" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="8961" class="Symbol">}</a> <a id="8963" href="NbE.html#8617" class="InductiveConstructor">zero</a>
<a id="8968" class="Symbol">...</a> <a id="8972" class="Symbol">|</a> <a id="8974" class="Symbol">_</a> <a id="8976" class="Symbol">=</a> <a id="8978" class="Bound">pf</a> <a id="8981" class="Bound">Γ′≤Γ</a>
</pre>
Otherwise, if the term is logically related to a successor of a natural,
our given proof similarly leads to the implication, though for this
case, we additionally need a lemma showing that if a term of type nat is
definitionally equal to an object a of type ℕ̂ (i.e. a natural with
embedded liftable neutrals), then it is definitionally equal to the
reification of the object a. We can prove this by induction on a.
<pre class="Agda"><a id="9414" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="9420" class="Symbol">{</a><a id="9421" href="Soundness.html#9421" class="Bound">Γ</a><a id="9422" class="Symbol">}</a> <a id="9424" class="Symbol">{</a><a id="9425" class="Argument">T</a> <a id="9427" class="Symbol">=</a> <a id="9429" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="9432" class="Symbol">}</a> <a id="9434" class="Symbol">{</a><a id="9435" href="Soundness.html#9435" class="Bound">t</a><a id="9436" class="Symbol">}</a> <a id="9438" class="Symbol">{</a><a id="9439" href="NbE.html#8629" class="InductiveConstructor">suc</a> <a id="9443" href="Soundness.html#9443" class="Bound">a</a><a id="9444" class="Symbol">}</a> <a id="9446" href="Soundness.html#9446" class="Bound">pf</a> <a id="9449" href="Soundness.html#9449" class="Bound">Γ′≤Γ</a>
  <a id="9456" class="Keyword">with</a> <a id="9461" href="Soundness.html#9446" class="Bound">pf</a> <a id="9464" href="Soundness.html#9449" class="Bound">Γ′≤Γ</a>
<a id="9469" class="Symbol">...</a> <a id="9473" class="Symbol">|</a> <a id="9475" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="9477" href="Soundness.html#9477" class="Bound">n</a> <a id="9479" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="9481" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="9483" href="Soundness.html#9483" class="Bound">t==sn</a> <a id="9489" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="9491" href="Soundness.html#9491" class="Bound">nⓇa</a> <a id="9495" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="9497" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
  <a id="9501" class="Keyword">with</a> <a id="9506" href="Soundness.html#9491" class="Bound">nⓇa</a> <a id="9510" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a>
<a id="9515" class="Symbol">...</a> <a id="9519" class="Symbol">|</a> <a id="9521" href="Soundness.html#9521" class="Bound">n==ℕ̂a</a> <a id="9528" class="Keyword">rewrite</a> <a id="9536" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="9550" class="Symbol">{</a><a id="9551" class="Argument">t</a> <a id="9553" class="Symbol">=</a> <a id="9555" class="Bound">n</a><a id="9556" class="Symbol">}</a> <a id="9558" class="Symbol">=</a>
  <a id="9562" href="SystemT.html#13905" class="Function Operator">begin</a>
    <a id="9572" class="Bound">Γ′≤Γ</a> <a id="9577" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="9580" class="Bound">t</a>
  <a id="9584" href="SystemT.html#14013" class="Function Operator">==⟨</a> <a id="9588" class="Bound">t==sn</a> <a id="9594" href="SystemT.html#14013" class="Function Operator">⟩</a>
    <a id="9600" href="SystemT.html#3396" class="InductiveConstructor">suc</a> <a id="9604" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="9606" class="Bound">n</a>
  <a id="9610" href="SystemT.html#14013" class="Function Operator">==⟨</a> <a id="9614" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a> <a id="9629" href="SystemT.html#13338" class="InductiveConstructor">refl</a> <a id="9634" class="Symbol">(</a><a id="9635" href="Soundness.html#9695" class="Function">==ℕ̂→==↓ᵀ</a> <a id="9645" class="Symbol">{</a><a id="9646" class="Argument">a</a> <a id="9648" class="Symbol">=</a> <a id="9650" class="Bound">a</a><a id="9651" class="Symbol">}</a> <a id="9653" href="Soundness.html#9521" class="Bound">n==ℕ̂a</a><a id="9659" class="Symbol">)</a> <a id="9661" href="SystemT.html#14013" class="Function Operator">⟩</a>
    <a id="9667" href="SystemT.html#3396" class="InductiveConstructor">suc</a> <a id="9671" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="9673" href="Soundness.html#1658" class="Function">↓ᵀᵧ</a> <a id="9677" class="Bound">a</a>
  <a id="9681" href="SystemT.html#14184" class="Function Operator">∎</a>
  <a id="9685" class="Keyword">where</a>
    <a id="9695" href="Soundness.html#9695" class="Function">==ℕ̂→==↓ᵀ</a> <a id="9705" class="Symbol">:</a> <a id="9707" class="Symbol">∀</a> <a id="9709" class="Symbol">{</a><a id="9710" href="Soundness.html#9710" class="Bound">Γ</a> <a id="9712" class="Symbol">:</a> <a id="9714" href="SystemT.html#1272" class="Datatype">SystemT.Γ</a><a id="9723" class="Symbol">}</a> <a id="9725" class="Symbol">{</a><a id="9726" href="Soundness.html#9726" class="Bound">n</a> <a id="9728" class="Symbol">:</a> <a id="9730" href="Soundness.html#9710" class="Bound">Γ</a> <a id="9732" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="9734" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="9737" class="Symbol">}</a> <a id="9739" class="Symbol">{</a><a id="9740" href="Soundness.html#9740" class="Bound">a</a> <a id="9742" class="Symbol">:</a> <a id="9744" href="NbE.html#849" class="Field Operator">⟦</a> <a id="9746" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="9750" href="NbE.html#849" class="Field Operator">⟧</a><a id="9751" class="Symbol">}</a>
             <a id="9766" class="Symbol">→</a> <a id="9768" href="Soundness.html#9726" class="Bound">n</a> <a id="9770" href="Soundness.html#2422" class="Function Operator">==ℕ̂</a> <a id="9775" href="Soundness.html#9740" class="Bound">a</a>
               <a id="9792" class="Comment">----------</a>
             <a id="9816" class="Symbol">→</a> <a id="9818" href="Soundness.html#9726" class="Bound">n</a> <a id="9820" href="SystemT.html#11908" class="Datatype Operator">==</a> <a id="9823" href="Soundness.html#1658" class="Function">↓ᵀᵧ</a> <a id="9827" href="Soundness.html#9740" class="Bound">a</a>
    <a id="9833" href="Soundness.html#9695" class="Function">==ℕ̂→==↓ᵀ</a> <a id="9843" class="Symbol">{</a><a id="9844" class="Argument">a</a> <a id="9846" class="Symbol">=</a> <a id="9848" href="NbE.html#8617" class="InductiveConstructor">zero</a><a id="9852" class="Symbol">}</a> <a id="9854" href="Soundness.html#9854" class="Bound">pf</a> <a id="9857" class="Keyword">with</a> <a id="9862" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="9865" class="Symbol">{</a><a id="9866" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="9869" class="Symbol">}</a> <a id="9871" href="NbE.html#8617" class="InductiveConstructor">zero</a>
    <a id="9880" class="Symbol">...</a> <a id="9884" class="Symbol">|</a> <a id="9886" class="Symbol">_</a> <a id="9888" class="Symbol">=</a> <a id="9890" class="Bound">pf</a>
    <a id="9897" href="Soundness.html#9695" class="Function">==ℕ̂→==↓ᵀ</a> <a id="9907" class="Symbol">{</a><a id="9908" href="Soundness.html#9908" class="Bound">Γ</a><a id="9909" class="Symbol">}</a> <a id="9911" class="Symbol">{</a><a id="9912" class="Argument">a</a> <a id="9914" class="Symbol">=</a> <a id="9916" href="NbE.html#8629" class="InductiveConstructor">suc</a> <a id="9920" href="Soundness.html#9920" class="Bound">a</a><a id="9921" class="Symbol">}</a> <a id="9923" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="9925" href="Soundness.html#9925" class="Bound">n</a> <a id="9927" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="9929" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="9931" href="Soundness.html#9931" class="Bound">m==sn</a> <a id="9937" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="9939" href="Soundness.html#9939" class="Bound">n==a</a> <a id="9944" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="9946" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
      <a id="9954" class="Keyword">with</a> <a id="9959" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="9962" class="Symbol">{</a><a id="9963" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="9966" class="Symbol">}</a> <a id="9968" class="Symbol">(</a><a id="9969" href="NbE.html#8629" class="InductiveConstructor">suc</a> <a id="9973" href="Soundness.html#9920" class="Bound">a</a><a id="9974" class="Symbol">)</a> <a id="9976" class="Symbol">|</a> <a id="9978" href="Soundness.html#9695" class="Function">==ℕ̂→==↓ᵀ</a> <a id="9988" class="Symbol">{</a><a id="9989" class="Argument">a</a> <a id="9991" class="Symbol">=</a> <a id="9993" href="Soundness.html#9920" class="Bound">a</a><a id="9994" class="Symbol">}</a> <a id="9996" class="Symbol">(</a><a id="9997" href="Soundness.html#9939" class="Bound">n==a</a> <a id="10002" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a><a id="10006" class="Symbol">)</a>
    <a id="10012" class="Symbol">...</a> <a id="10016" class="Symbol">|</a> <a id="10018" class="Symbol">_</a>                 <a id="10036" class="Symbol">|</a> <a id="10038" href="Soundness.html#10038" class="Bound">pf</a>
      <a id="10047" class="Keyword">rewrite</a> <a id="10055" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="10069" class="Symbol">{</a><a id="10070" class="Argument">t</a> <a id="10072" class="Symbol">=</a> <a id="10074" class="Bound">n</a><a id="10075" class="Symbol">}</a> <a id="10077" class="Symbol">=</a> <a id="10079" href="SystemT.html#13516" class="InductiveConstructor">trans</a> <a id="10085" class="Bound">m==sn</a> <a id="10091" class="Symbol">(</a><a id="10092" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a> <a id="10107" href="SystemT.html#13338" class="InductiveConstructor">refl</a> <a id="10112" href="Soundness.html#10038" class="Bound">pf</a><a id="10114" class="Symbol">)</a>
    <a id="10120" href="Soundness.html#9695" class="Function">==ℕ̂→==↓ᵀ</a> <a id="10130" class="Symbol">{</a><a id="10131" href="Soundness.html#10131" class="Bound">Γ</a><a id="10132" class="Symbol">}</a> <a id="10134" class="Symbol">{</a><a id="10135" href="Soundness.html#10135" class="Bound">t</a><a id="10136" class="Symbol">}</a> <a id="10138" class="Symbol">{</a><a id="10139" href="NbE.html#8645" class="InductiveConstructor">ne</a> <a id="10142" href="Soundness.html#10142" class="Bound">𝓊̂</a><a id="10144" class="Symbol">}</a> <a id="10146" href="Soundness.html#10146" class="Bound">pf</a>
      <a id="10155" class="Keyword">with</a> <a id="10160" href="Soundness.html#10142" class="Bound">𝓊̂</a> <a id="10163" href="Soundness.html#10131" class="Bound">Γ</a>           <a id="10175" class="Symbol">|</a> <a id="10177" href="Soundness.html#10146" class="Bound">pf</a>
    <a id="10184" class="Symbol">...</a> <a id="10188" class="Symbol">|</a> <a id="10190" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="10195" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="10197" href="Soundness.html#10197" class="Bound">𝓊</a> <a id="10199" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="10201" class="Symbol">_</a> <a id="10203" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="10205" class="Symbol">|</a> <a id="10207" href="Soundness.html#10207" class="Bound">t==𝓊</a> <a id="10212" class="Symbol">=</a> <a id="10214" href="Soundness.html#10207" class="Bound">t==𝓊</a>
</pre>
Lastly for type nat, if the term is logically related to an embedded
liftable neutral, the implication also holds immediately from our given
proof
<pre class="Agda"><a id="10378" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="10384" class="Symbol">{</a><a id="10385" href="Soundness.html#10385" class="Bound">Γ′</a><a id="10387" class="Symbol">}</a> <a id="10389" class="Symbol">{</a><a id="10390" class="Argument">T</a> <a id="10392" class="Symbol">=</a> <a id="10394" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="10397" class="Symbol">}</a> <a id="10399" class="Symbol">{</a><a id="10400" class="Argument">a</a> <a id="10402" class="Symbol">=</a> <a id="10404" href="NbE.html#8645" class="InductiveConstructor">ne</a> <a id="10407" href="Soundness.html#10407" class="Bound">𝓊̂</a><a id="10409" class="Symbol">}</a> <a id="10411" href="Soundness.html#10411" class="Bound">pf</a> <a id="10414" href="Soundness.html#10414" class="Bound">Γ′≤Γ</a>
  <a id="10421" class="Keyword">with</a> <a id="10426" href="Soundness.html#10407" class="Bound">𝓊̂</a> <a id="10429" href="Soundness.html#10385" class="Bound">Γ′</a>           <a id="10442" class="Symbol">|</a> <a id="10444" href="Soundness.html#10411" class="Bound">pf</a> <a id="10447" href="Soundness.html#10414" class="Bound">Γ′≤Γ</a>
<a id="10452" class="Symbol">...</a> <a id="10456" class="Symbol">|</a> <a id="10458" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="10463" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="10465" href="Soundness.html#10465" class="Bound">𝓊</a> <a id="10467" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="10469" class="Symbol">_</a> <a id="10471" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>  <a id="10474" class="Symbol">|</a> <a id="10476" href="Soundness.html#10476" class="Bound">t==𝓊</a>     <a id="10485" class="Symbol">=</a> <a id="10487" href="Soundness.html#10476" class="Bound">t==𝓊</a>
</pre>
<p>For our inductive step, we prove the implication for terms of type S
→ T. Our desired implication is now:</p>
<pre><code>Γ′ ⊢ t = ↓ᵀ f Γ′ : T</code></pre>
<p>which, by definition, expands to:</p>
<pre><code>Γ′ ⊢ t = λx. ↓ᵀ f a (Γ′ , x:S) : T (where a = ↑ᵀ 𝓍̂ˢ Γ′)</code></pre>
<p>We prove this by η expanding t to <code>λx. t x</code> and then using
the compatibility rule for abstractions of definitional equality to
simplify our goal to proving:</p>
<pre><code>Γ′ , x:S ⊢ t x = ↓ᵀ f a (Γ′, x:S)</code></pre>
<p>Note that our inductive hypothesis is:</p>
<pre><code>t x Ⓡ f a implies t x = ↓ᵀ f a</code></pre>
<p>This is exactly what we want to show, so now all we need is to prove
that <code>t x Ⓡ f a</code>.</p>
Luckily, our given proof holds that t and f are logically related, which
is equivalent to saying that if <code>x Ⓡ a</code> , then
<code>t x Ⓡ f a</code>, reducing what we have to prove only to
<code>x Ⓡ a</code>. We have been using “a” for simplicity, but
<code>a = ↑ᵀ 𝓍̂ˢ Γ′</code>, and we are mutually proving that
<code>x Ⓡ ↑ᵀ 𝓍̂</code>, so we use this lemma here to finish our proof.
<pre class="Agda"><a id="11429" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="11435" class="Symbol">{</a><a id="11436" href="Soundness.html#11436" class="Bound">Γ′</a><a id="11438" class="Symbol">}</a> <a id="11440" class="Symbol">{</a><a id="11441" class="Argument">T</a> <a id="11443" class="Symbol">=</a> <a id="11445" href="Soundness.html#11445" class="Bound">S</a> <a id="11447" href="SystemT.html#593" class="InductiveConstructor Operator">⇒</a> <a id="11449" class="Symbol">_}</a> <a id="11452" class="Symbol">{</a><a id="11453" href="Soundness.html#11453" class="Bound">t</a><a id="11454" class="Symbol">}</a> <a id="11456" class="Symbol">{</a><a id="11457" href="Soundness.html#11457" class="Bound">f</a><a id="11458" class="Symbol">}</a> <a id="11460" href="Soundness.html#11460" class="Bound">pf</a> <a id="11463" href="Soundness.html#11463" class="Bound">Γ′≤Γ</a> <a id="11468" class="Symbol">=</a>
  <a id="11472" href="SystemT.html#13905" class="Function Operator">begin</a>
    <a id="11482" href="Soundness.html#11463" class="Bound">Γ′≤Γ</a> <a id="11487" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="11490" href="Soundness.html#11453" class="Bound">t</a>
  <a id="11494" href="SystemT.html#14013" class="Function Operator">==⟨</a> <a id="11498" href="SystemT.html#12589" class="InductiveConstructor">η</a> <a id="11500" href="SystemT.html#14013" class="Function Operator">⟩</a>
    <a id="11506" href="SystemT.html#3588" class="InductiveConstructor Operator">ƛ</a> <a id="11508" class="Symbol">(</a><a id="11509" href="Soundness.html#11445" class="Bound">S</a> <a id="11511" href="SystemT.html#10919" class="Function Operator">↑⊢</a> <a id="11514" href="Soundness.html#11463" class="Bound">Γ′≤Γ</a> <a id="11519" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="11522" href="Soundness.html#11453" class="Bound">t</a><a id="11523" class="Symbol">)</a> <a id="11525" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="11527" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="11529" href="SystemT.html#2712" class="InductiveConstructor">`Z</a>
  <a id="11534" href="SystemT.html#14013" class="Function Operator">==⟨</a>
    <a id="11542" href="SystemT.html#12926" class="InductiveConstructor">abs-compatible</a> <a id="11557" class="Symbol">(</a>
      <a id="11565" href="SystemT.html#13905" class="Function Operator">begin</a>
        <a id="11579" class="Symbol">(</a><a id="11580" href="Soundness.html#11445" class="Bound">S</a> <a id="11582" href="SystemT.html#10919" class="Function Operator">↑⊢</a> <a id="11585" href="Soundness.html#11463" class="Bound">Γ′≤Γ</a> <a id="11590" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="11593" href="Soundness.html#11453" class="Bound">t</a><a id="11594" class="Symbol">)</a> <a id="11596" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="11598" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="11600" href="SystemT.html#2712" class="InductiveConstructor">`Z</a>
      <a id="11609" href="SystemT.html#14013" class="Function Operator">==⟨</a> <a id="11613" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a> <a id="11628" href="Soundness.html#11815" class="Function">subst-lemma</a> <a id="11640" href="SystemT.html#13338" class="InductiveConstructor">refl</a> <a id="11645" href="SystemT.html#14013" class="Function Operator">⟩</a>
        <a id="11655" class="Symbol">(</a><a id="11656" href="SystemT.html#2072" class="InductiveConstructor">≤-ext</a> <a id="11662" href="Soundness.html#11463" class="Bound">Γ′≤Γ</a> <a id="11667" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="11670" href="Soundness.html#11453" class="Bound">t</a><a id="11671" class="Symbol">)</a> <a id="11673" href="SystemT.html#9486" class="Function Operator">[</a> <a id="11675" href="SystemT.html#10665" class="Function">id</a> <a id="11678" href="SystemT.html#9486" class="Function Operator">]</a> <a id="11680" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="11682" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="11684" href="SystemT.html#2712" class="InductiveConstructor">`Z</a>
      <a id="11693" href="SystemT.html#14013" class="Function Operator">==⟨</a> <a id="11697" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="11703" class="Symbol">(</a><a id="11704" href="Soundness.html#11460" class="Bound">pf</a> <a id="11707" class="Symbol">(</a><a id="11708" href="SystemT.html#2072" class="InductiveConstructor">≤-ext</a> <a id="11714" href="Soundness.html#11463" class="Bound">Γ′≤Γ</a><a id="11718" class="Symbol">)</a> <a id="11720" href="Soundness.html#11934" class="Function">xⓇa</a><a id="11723" class="Symbol">)</a> <a id="11725" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a> <a id="11730" href="SystemT.html#14013" class="Function Operator">⟩</a>
        <a id="11740" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="11746" class="Symbol">(</a><a id="11747" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="11750" class="Symbol">(</a><a id="11751" href="Soundness.html#11457" class="Bound">f</a> <a id="11753" href="Soundness.html#11909" class="Function">a</a><a id="11754" class="Symbol">)</a> <a id="11756" class="Symbol">(</a><a id="11757" href="Soundness.html#11436" class="Bound">Γ′</a> <a id="11760" href="SystemT.html#1296" class="InductiveConstructor Operator">,</a> <a id="11762" href="Soundness.html#11445" class="Bound">S</a><a id="11763" class="Symbol">))</a>
      <a id="11772" href="SystemT.html#14184" class="Function Operator">∎</a>
  <a id="11776" class="Symbol">)</a><a id="11777" href="SystemT.html#14013" class="Function Operator">⟩</a>
    <a id="11783" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="11789" class="Symbol">(</a><a id="11790" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="11793" href="Soundness.html#11457" class="Bound">f</a> <a id="11795" href="Soundness.html#11436" class="Bound">Γ′</a><a id="11797" class="Symbol">)</a>
  <a id="11801" href="SystemT.html#14184" class="Function Operator">∎</a>
  <a id="11805" class="Keyword">where</a>
    <a id="11815" href="Soundness.html#11815" class="Function">subst-lemma</a> <a id="11827" class="Symbol">=</a>
      <a id="11835" href="Lemmas.html#268" class="Function">≡→==</a> <a id="11840" class="Symbol">(</a><a id="11841" href="Soundness.html#367" class="Function">≡-trans</a> <a id="11849" class="Symbol">(</a><a id="11850" href="Lemmas.html#6167" class="Function">incr-↑-≡</a> <a id="11859" class="Symbol">{</a><a id="11860" class="Argument">Γ′≤Γ</a> <a id="11865" class="Symbol">=</a> <a id="11867" href="Soundness.html#11463" class="Bound">Γ′≤Γ</a><a id="11871" class="Symbol">}</a> <a id="11873" class="Symbol">{</a><a id="11874" class="Argument">t</a> <a id="11876" class="Symbol">=</a> <a id="11878" href="Soundness.html#11453" class="Bound">t</a><a id="11879" class="Symbol">})</a> <a id="11882" class="Symbol">(</a><a id="11883" href="Soundness.html#351" class="Function">≡-sym</a> <a id="11889" href="Lemmas.html#4442" class="Function">[id]-identity</a><a id="11902" class="Symbol">))</a>
    <a id="11909" href="Soundness.html#11909" class="Function">a</a> <a id="11911" class="Symbol">=</a> <a id="11913" href="NbE.html#9074" class="Function">↑ᵀ</a> <a id="11916" class="Symbol">{</a><a id="11917" href="Soundness.html#11445" class="Bound">S</a><a id="11918" class="Symbol">}</a> <a id="11920" class="Symbol">(</a><a id="11921" href="NbE.html#11009" class="Function">𝓍̂</a> <a id="11924" href="Soundness.html#11445" class="Bound">S</a> <a id="11926" href="Soundness.html#11436" class="Bound">Γ′</a><a id="11928" class="Symbol">)</a>
    <a id="11934" href="Soundness.html#11934" class="Function">xⓇa</a> <a id="11938" class="Symbol">=</a> <a id="11940" href="Soundness.html#6689" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="11947" class="Symbol">{</a><a id="11948" href="Soundness.html#11436" class="Bound">Γ′</a><a id="11950" class="Symbol">}</a> <a id="11952" class="Symbol">{</a><a id="11953" href="Soundness.html#11445" class="Bound">S</a><a id="11954" class="Symbol">}</a>
</pre>
Using our first implication, we can quickly prove that
<code>Γ , x:T ⊢ x : T Ⓡ ↑ᵀ 𝓍̂</code>, as <code>Γ′ ⊢ x = 𝓍̂ Γ′ : T</code>
for all <code>Γ′ ≤ Γ , x:T</code>
<pre class="Agda"><a id="12098" href="Soundness.html#6689" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="12105" class="Symbol">{_}</a> <a id="12109" class="Symbol">{</a><a id="12110" href="Soundness.html#12110" class="Bound">T</a><a id="12111" class="Symbol">}</a> <a id="12113" class="Symbol">=</a> <a id="12115" href="Soundness.html#6080" class="Function">==↑-Ⓡ</a> <a id="12121" href="Soundness.html#12135" class="Function">x==𝓍̂</a> <a id="12127" class="Keyword">where</a>
  <a id="12135" href="Soundness.html#12135" class="Function">x==𝓍̂</a> <a id="12141" class="Symbol">:</a> <a id="12143" class="Symbol">∀</a> <a id="12145" class="Symbol">{</a><a id="12146" href="Soundness.html#12146" class="Bound">Γ</a> <a id="12148" href="Soundness.html#12148" class="Bound">Γ′</a> <a id="12151" class="Symbol">:</a> <a id="12153" href="SystemT.html#1272" class="Datatype">Γ</a><a id="12154" class="Symbol">}</a>
       <a id="12163" class="Symbol">→</a> <a id="12165" class="Symbol">(</a><a id="12166" href="Soundness.html#12166" class="Bound">Γ′≤Γ,T</a> <a id="12173" class="Symbol">:</a> <a id="12175" href="Soundness.html#12148" class="Bound">Γ′</a> <a id="12178" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="12180" class="Symbol">(</a><a id="12181" href="Soundness.html#12146" class="Bound">Γ</a> <a id="12183" href="SystemT.html#1296" class="InductiveConstructor Operator">,</a> <a id="12185" href="Soundness.html#12110" class="Bound">T</a><a id="12186" class="Symbol">))</a>
       <a id="12196" class="Symbol">→</a> <a id="12198" href="Soundness.html#12166" class="Bound">Γ′≤Γ,T</a> <a id="12205" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="12208" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="12210" href="SystemT.html#2712" class="InductiveConstructor">`Z</a> <a id="12213" href="Soundness.html#1073" class="Function Operator">==↑</a> <a id="12217" href="NbE.html#11009" class="Function">𝓍̂</a> <a id="12220" href="Soundness.html#12110" class="Bound">T</a> <a id="12222" href="Soundness.html#12146" class="Bound">Γ</a>
  <a id="12226" href="Soundness.html#12135" class="Function">x==𝓍̂</a> <a id="12232" class="Symbol">{</a><a id="12233" href="Soundness.html#12233" class="Bound">Γ</a><a id="12234" class="Symbol">}</a> <a id="12236" class="Symbol">{</a><a id="12237" href="Soundness.html#12237" class="Bound">Γ′</a><a id="12239" class="Symbol">}</a> <a id="12241" href="Soundness.html#12241" class="Bound">pf</a>
    <a id="12248" class="Keyword">with</a> <a id="12253" href="Soundness.html#12237" class="Bound">Γ′</a> <a id="12256" href="SystemT.html#2177" class="Function Operator">≤?</a> <a id="12259" class="Symbol">(</a><a id="12260" href="Soundness.html#12233" class="Bound">Γ</a> <a id="12262" href="SystemT.html#1296" class="InductiveConstructor Operator">,</a> <a id="12264" href="Soundness.html#12110" class="Bound">T</a><a id="12265" class="Symbol">)</a>
  <a id="12269" class="Symbol">...</a> <a id="12273" class="Symbol">|</a> <a id="12275" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="12278" href="Soundness.html#12278" class="Bound">¬pf</a> <a id="12282" class="Symbol">=</a> <a id="12284" href="Soundness.html#12278" class="Bound">¬pf</a> <a id="12288" class="Bound">pf</a>
  <a id="12293" class="Symbol">...</a> <a id="12297" class="Symbol">|</a> <a id="12299" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="12303" href="Soundness.html#12303" class="Bound">pf′</a>
    <a id="12311" class="Keyword">with</a> <a id="12316" href="NbE.html#11009" class="Function">𝓍̂</a> <a id="12319" href="Soundness.html#12110" class="Bound">T</a> <a id="12321" class="Bound">Γ</a> <a id="12323" class="Symbol">|</a> <a id="12325" href="Lemmas.html#1609" class="Function">≤-pf-irrelevance</a> <a id="12342" class="Bound">pf</a> <a id="12345" href="Soundness.html#12303" class="Bound">pf′</a>
  <a id="12351" class="Symbol">...</a> <a id="12355" class="Symbol">|</a> <a id="12357" class="Symbol">_</a>      <a id="12364" class="Symbol">|</a> <a id="12366" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
    <a id="12375" class="Keyword">with</a> <a id="12380" href="SystemT.html#8593" class="Function">≤ᵨ</a> <a id="12383" class="Bound">pf′</a>
  <a id="12389" class="Symbol">...|</a> <a id="12394" class="Symbol">_</a> <a id="12396" href="SystemT.html#6380" class="InductiveConstructor Operator">,</a> <a id="12398" class="Symbol">_</a>  <a id="12401" class="Symbol">=</a> <a id="12403" href="SystemT.html#13338" class="InductiveConstructor">refl</a>
</pre>
Before moving forward, we also want to show that rec Ⓡ ⟦rec⟧. This will
be necessary for proving soundness, as we will need proof that
<code>Γ ⊢ rec = ↓ᵀ ⟦rec⟧ Γ : (T ⇒ (nat ⇒ T ⇒ T) ⇒ nat ⇒ T)</code>
(i.e. proof that our interpretation of rec is sound) to prove the
soundness of NbE
<pre class="Agda"><a id="recⓇ⟦rec⟧"></a><a id="12694" href="Soundness.html#12694" class="Function">recⓇ⟦rec⟧</a> <a id="12704" class="Symbol">:</a> <a id="12706" class="Symbol">∀</a> <a id="12708" class="Symbol">{</a><a id="12709" href="Soundness.html#12709" class="Bound">Γ</a> <a id="12711" class="Symbol">:</a> <a id="12713" href="SystemT.html#1272" class="Datatype">Γ</a><a id="12714" class="Symbol">}</a> <a id="12716" class="Symbol">{</a><a id="12717" href="Soundness.html#12717" class="Bound">T</a> <a id="12719" class="Symbol">:</a> <a id="12721" href="SystemT.html#561" class="Datatype">Type</a><a id="12725" class="Symbol">}</a> <a id="12727" class="Symbol">→</a> <a id="12729" href="SystemT.html#3419" class="InductiveConstructor">rec</a> <a id="12733" class="Symbol">{</a><a id="12734" href="Soundness.html#12709" class="Bound">Γ</a><a id="12735" class="Symbol">}</a> <a id="12737" class="Symbol">{</a><a id="12738" href="Soundness.html#12717" class="Bound">T</a><a id="12739" class="Symbol">}</a> <a id="12741" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="12743" href="NbE.html#12473" class="Function">⟦rec⟧</a>
<a id="12749" href="Soundness.html#12694" class="Function">recⓇ⟦rec⟧</a> <a id="12759" href="Soundness.html#12759" class="Bound">Γ′≤Γ</a> <a id="12764" class="Symbol">{</a><a id="12765" href="Soundness.html#12765" class="Bound">z</a><a id="12766" class="Symbol">}</a> <a id="12768" href="Soundness.html#12768" class="Bound">pf</a> <a id="12771" href="Soundness.html#12771" class="Bound">Γ″≤Γ′</a> <a id="12777" href="Soundness.html#12777" class="Bound">pf′</a> <a id="12781" href="Soundness.html#12781" class="Bound">Γ‴≤Γ″</a> <a id="12787" class="Symbol">{</a><a id="12788" class="Argument">s</a> <a id="12790" class="Symbol">=</a> <a id="12792" href="Soundness.html#12792" class="Bound">n</a><a id="12793" class="Symbol">}</a> <a id="12795" class="Symbol">{</a><a id="12796" href="NbE.html#8617" class="InductiveConstructor">zero</a><a id="12800" class="Symbol">}</a> <a id="12802" href="Soundness.html#12802" class="Bound">pf″</a>
  <a id="12808" class="Keyword">with</a> <a id="12813" href="Soundness.html#12802" class="Bound">pf″</a> <a id="12817" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a>
<a id="12822" class="Symbol">...</a> <a id="12826" class="Symbol">|</a> <a id="12828" href="Soundness.html#12828" class="Bound">n==zero</a>
  <a id="12838" class="Keyword">rewrite</a> <a id="12846" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="12860" class="Symbol">{</a><a id="12861" class="Argument">t</a> <a id="12863" class="Symbol">=</a> <a id="12865" class="Bound">n</a><a id="12866" class="Symbol">}</a> <a id="12868" class="Symbol">=</a>
  <a id="12872" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="12883" class="Symbol">(</a><a id="12884" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a> <a id="12899" href="SystemT.html#13338" class="InductiveConstructor">refl</a> <a id="12904" class="Symbol">(</a><a id="12905" href="SystemT.html#13417" class="InductiveConstructor">sym</a> <a id="12909" href="Soundness.html#12828" class="Bound">n==zero</a><a id="12916" class="Symbol">))</a>
    <a id="12923" class="Symbol">(</a><a id="12924" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="12935" class="Symbol">(</a><a id="12936" href="SystemT.html#13417" class="InductiveConstructor">sym</a> <a id="12940" href="SystemT.html#11990" class="InductiveConstructor">β-rec-z</a><a id="12947" class="Symbol">)</a> <a id="12949" href="Soundness.html#13068" class="Function">zⓇa</a><a id="12952" class="Symbol">)</a>
    <a id="12958" class="Keyword">where</a>
      <a id="12970" href="Soundness.html#12970" class="Function">Γ‴≤Γ′</a> <a id="12976" class="Symbol">=</a> <a id="12978" href="Lemmas.html#1965" class="Function">≤-trans</a> <a id="12986" class="Bound">Γ‴≤Γ″</a> <a id="12992" class="Bound">Γ″≤Γ′</a>
      <a id="13004" href="Soundness.html#13004" class="Function">subst-lemma</a> <a id="13016" class="Symbol">=</a> <a id="13018" href="Lemmas.html#268" class="Function">≡→==</a> <a id="13023" class="Symbol">(</a><a id="13024" href="Soundness.html#351" class="Function">≡-sym</a> <a id="13030" class="Symbol">(</a><a id="13031" href="Lemmas.html#5530" class="Postulate">weaken-compose</a> <a id="13046" class="Bound">Γ‴≤Γ″</a> <a id="13052" class="Bound">Γ″≤Γ′</a> <a id="13058" class="Bound">z</a><a id="13059" class="Symbol">))</a>
      <a id="13068" href="Soundness.html#13068" class="Function">zⓇa</a> <a id="13072" class="Symbol">=</a> <a id="13074" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="13085" href="Soundness.html#13004" class="Function">subst-lemma</a> <a id="13097" class="Symbol">(</a><a id="13098" href="Soundness.html#4907" class="Function">Ⓡ-weaken</a> <a id="13107" class="Symbol">{</a><a id="13108" class="Argument">Γ′≤Γ</a> <a id="13113" class="Symbol">=</a> <a id="13115" href="Soundness.html#12970" class="Function">Γ‴≤Γ′</a><a id="13120" class="Symbol">}</a> <a id="13122" class="Bound">pf</a><a id="13124" class="Symbol">)</a>

<a id="13127" href="Soundness.html#12694" class="Function">recⓇ⟦rec⟧</a> <a id="13137" href="Soundness.html#13137" class="Bound">Γ′≤Γ</a> <a id="13142" class="Symbol">{</a><a id="13143" href="Soundness.html#13143" class="Bound">z</a><a id="13144" class="Symbol">}</a> <a id="13146" class="Symbol">{</a><a id="13147" href="Soundness.html#13147" class="Bound">az</a><a id="13149" class="Symbol">}</a> <a id="13151" href="Soundness.html#13151" class="Bound">pf</a> <a id="13154" href="Soundness.html#13154" class="Bound">Γ″≤Γ′</a> <a id="13160" class="Symbol">{</a><a id="13161" href="Soundness.html#13161" class="Bound">s</a><a id="13162" class="Symbol">}</a> <a id="13164" class="Symbol">{</a><a id="13165" href="Soundness.html#13165" class="Bound">aₛ</a><a id="13167" class="Symbol">}</a> <a id="13169" href="Soundness.html#13169" class="Bound">pf′</a> <a id="13173" href="Soundness.html#13173" class="Bound">Γ‴≤Γ″</a> <a id="13179" class="Symbol">{</a><a id="13180" href="Soundness.html#13180" class="Bound">m</a><a id="13181" class="Symbol">}</a> <a id="13183" class="Symbol">{</a><a id="13184" href="NbE.html#8629" class="InductiveConstructor">suc</a> <a id="13188" href="Soundness.html#13188" class="Bound">aₙ</a><a id="13190" class="Symbol">}</a> <a id="13192" href="Soundness.html#13192" class="Bound">pf″</a>
  <a id="13198" class="Keyword">with</a> <a id="13203" href="Soundness.html#13192" class="Bound">pf″</a> <a id="13207" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a>
<a id="13212" class="Symbol">...</a> <a id="13216" class="Symbol">|</a> <a id="13218" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="13220" href="Soundness.html#13220" class="Bound">n</a> <a id="13222" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="13224" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="13226" href="Soundness.html#13226" class="Bound">m==saₙ</a> <a id="13233" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="13235" href="Soundness.html#13235" class="Bound">nⓇaₙ</a> <a id="13240" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="13242" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
  <a id="13246" class="Keyword">rewrite</a> <a id="13254" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="13268" class="Symbol">{</a><a id="13269" class="Argument">t</a> <a id="13271" class="Symbol">=</a> <a id="13273" class="Bound">m</a><a id="13274" class="Symbol">}</a> <a id="13276" class="Symbol">=</a>
    <a id="13282" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="13293" class="Symbol">(</a><a id="13294" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a> <a id="13309" href="SystemT.html#13338" class="InductiveConstructor">refl</a> <a id="13314" class="Symbol">(</a><a id="13315" href="SystemT.html#13417" class="InductiveConstructor">sym</a> <a id="13319" href="Soundness.html#13226" class="Bound">m==saₙ</a><a id="13325" class="Symbol">))</a>
      <a id="13334" class="Symbol">(</a><a id="13335" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="13346" class="Symbol">(</a><a id="13347" href="SystemT.html#13417" class="InductiveConstructor">sym</a> <a id="13351" href="SystemT.html#12162" class="InductiveConstructor">β-rec-s</a><a id="13358" class="Symbol">)</a> <a id="13360" href="Soundness.html#13646" class="Function">s·n·recⓇaₛ·aₙ·⟦rec⟧</a><a id="13379" class="Symbol">)</a>
  <a id="13383" class="Keyword">where</a>
    <a id="13393" href="Soundness.html#13393" class="Function">subst-lemma₁</a> <a id="13406" class="Symbol">=</a> <a id="13408" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="13422" class="Symbol">{</a><a id="13423" class="Argument">t</a> <a id="13425" class="Symbol">=</a> <a id="13427" class="Bound">Γ‴≤Γ″</a> <a id="13433" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="13436" class="Bound">s</a><a id="13437" class="Symbol">}</a>
    <a id="13443" href="Soundness.html#13443" class="Function">subst-lemma₂</a> <a id="13456" class="Symbol">=</a> <a id="13458" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="13472" class="Symbol">{</a><a id="13473" class="Argument">t</a> <a id="13475" class="Symbol">=</a> <a id="13477" href="Soundness.html#13220" class="Bound">n</a><a id="13478" class="Symbol">}</a>

    <a id="13485" href="Soundness.html#13485" class="Function">rec·z·s·n</a> <a id="13495" class="Symbol">=</a> <a id="13497" class="Symbol">(</a><a id="13498" class="Bound">Γ‴≤Γ″</a> <a id="13504" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="13507" class="Symbol">(</a><a id="13508" class="Bound">Γ″≤Γ′</a> <a id="13514" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="13517" href="SystemT.html#3419" class="InductiveConstructor">rec</a> <a id="13521" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="13523" class="Bound">z</a><a id="13524" class="Symbol">)</a> <a id="13526" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="13528" class="Bound">s</a><a id="13529" class="Symbol">)</a> <a id="13531" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="13533" href="Soundness.html#13220" class="Bound">n</a>

    <a id="13540" href="Soundness.html#13540" class="Function">ih</a> <a id="13543" class="Symbol">:</a> <a id="13545" href="Soundness.html#13485" class="Function">rec·z·s·n</a> <a id="13555" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="13557" href="NbE.html#12473" class="Function">⟦rec⟧</a> <a id="13563" class="Bound">az</a> <a id="13566" class="Bound">aₛ</a> <a id="13569" class="Bound">aₙ</a>
    <a id="13576" href="Soundness.html#13540" class="Function">ih</a> <a id="13579" class="Symbol">=</a> <a id="13581" href="Soundness.html#12694" class="Function">recⓇ⟦rec⟧</a> <a id="13591" class="Bound">Γ′≤Γ</a> <a id="13596" class="Bound">pf</a> <a id="13599" class="Bound">Γ″≤Γ′</a> <a id="13605" class="Symbol">{</a><a id="13606" class="Argument">s</a> <a id="13608" class="Symbol">=</a> <a id="13610" class="Bound">s</a><a id="13611" class="Symbol">}</a> <a id="13613" class="Bound">pf′</a> <a id="13617" class="Bound">Γ‴≤Γ″</a> <a id="13623" class="Symbol">{</a><a id="13624" class="Argument">s</a> <a id="13626" class="Symbol">=</a> <a id="13628" href="Soundness.html#13220" class="Bound">n</a><a id="13629" class="Symbol">}</a> <a id="13631" class="Symbol">{</a><a id="13632" class="Bound">aₙ</a><a id="13634" class="Symbol">}</a> <a id="13636" href="Soundness.html#13235" class="Bound">nⓇaₙ</a>

    <a id="13646" href="Soundness.html#13646" class="Function">s·n·recⓇaₛ·aₙ·⟦rec⟧</a> <a id="13666" class="Symbol">:</a> <a id="13668" class="Symbol">(</a><a id="13669" class="Bound">Γ‴≤Γ″</a> <a id="13675" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="13678" class="Bound">s</a><a id="13679" class="Symbol">)</a> <a id="13681" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="13683" href="Soundness.html#13220" class="Bound">n</a> <a id="13685" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="13687" href="Soundness.html#13485" class="Function">rec·z·s·n</a> <a id="13697" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="13699" class="Bound">aₛ</a> <a id="13702" class="Bound">aₙ</a> <a id="13705" class="Symbol">(</a><a id="13706" href="NbE.html#12473" class="Function">⟦rec⟧</a> <a id="13712" class="Bound">az</a> <a id="13715" class="Bound">aₛ</a> <a id="13718" class="Bound">aₙ</a><a id="13720" class="Symbol">)</a>
    <a id="13726" href="Soundness.html#13646" class="Function">s·n·recⓇaₛ·aₙ·⟦rec⟧</a> <a id="13746" class="Keyword">with</a> <a id="13751" class="Bound">pf′</a> <a id="13755" class="Bound">Γ‴≤Γ″</a> <a id="13761" class="Symbol">{</a><a id="13762" href="Soundness.html#13220" class="Bound">n</a><a id="13763" class="Symbol">}</a> <a id="13765" href="Soundness.html#13235" class="Bound">nⓇaₙ</a> <a id="13770" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a> <a id="13775" href="Soundness.html#13540" class="Function">ih</a>
    <a id="13782" href="Soundness.html#13646" class="Function">...</a> <a id="13786" class="Symbol">|</a> <a id="13788" href="Soundness.html#13788" class="Bound">pf</a>
      <a id="13797" class="Keyword">rewrite</a> <a id="13805" href="Soundness.html#13393" class="Function">subst-lemma₁</a> <a id="13818" class="Symbol">|</a> <a id="13820" href="Soundness.html#13443" class="Function">subst-lemma₂</a> <a id="13833" class="Symbol">=</a> <a id="13835" href="Soundness.html#13788" class="Bound">pf</a>

<a id="13839" href="Soundness.html#12694" class="Function">recⓇ⟦rec⟧</a> <a id="13849" class="Symbol">{_}</a> <a id="13853" class="Symbol">{</a><a id="13854" href="Soundness.html#13854" class="Bound">T</a><a id="13855" class="Symbol">}</a> <a id="13857" href="Soundness.html#13857" class="Bound">Γ′≤Γ</a> <a id="13862" class="Symbol">{</a><a id="13863" href="Soundness.html#13863" class="Bound">z</a><a id="13864" class="Symbol">}</a> <a id="13866" class="Symbol">{</a><a id="13867" href="Soundness.html#13867" class="Bound">az</a><a id="13869" class="Symbol">}</a> <a id="13871" href="Soundness.html#13871" class="Bound">pf</a> <a id="13874" href="Soundness.html#13874" class="Bound">Γ″≤Γ′</a> <a id="13880" class="Symbol">{</a><a id="13881" href="Soundness.html#13881" class="Bound">s</a><a id="13882" class="Symbol">}</a> <a id="13884" class="Symbol">{</a><a id="13885" href="Soundness.html#13885" class="Bound">aₛ</a><a id="13887" class="Symbol">}</a> <a id="13889" href="Soundness.html#13889" class="Bound">pf′</a> <a id="13893" class="Symbol">{</a><a id="13894" href="Soundness.html#13894" class="Bound">Γ‴</a><a id="13896" class="Symbol">}</a> <a id="13898" href="Soundness.html#13898" class="Bound">Γ‴≤Γ″</a> <a id="13904" class="Symbol">{</a><a id="13905" href="Soundness.html#13905" class="Bound">n</a><a id="13906" class="Symbol">}</a> <a id="13908" class="Symbol">{</a><a id="13909" href="NbE.html#8645" class="InductiveConstructor">ne</a> <a id="13912" href="Soundness.html#13912" class="Bound">𝓊̂</a><a id="13914" class="Symbol">}</a> <a id="13916" href="Soundness.html#13916" class="Bound">pf″</a> <a id="13920" class="Symbol">=</a>
  <a id="13924" href="Soundness.html#6080" class="Function">==↑-Ⓡ</a> <a id="13930" href="Soundness.html#13951" class="Function">rec==↑rec↑</a> <a id="13941" class="Keyword">where</a>
    <a id="13951" href="Soundness.html#13951" class="Function">rec==↑rec↑</a> <a id="13962" class="Symbol">:</a> <a id="13964" class="Symbol">∀</a> <a id="13966" class="Symbol">{</a><a id="13967" href="Soundness.html#13967" class="Bound">Γ⁗</a> <a id="13970" class="Symbol">:</a> <a id="13972" href="SystemT.html#1272" class="Datatype">SystemT.Γ</a><a id="13981" class="Symbol">}</a>
      <a id="13989" class="Symbol">→</a> <a id="13991" class="Symbol">(</a><a id="13992" href="Soundness.html#13992" class="Bound">Γ⁗≤Γ‴</a> <a id="13998" class="Symbol">:</a> <a id="14000" href="Soundness.html#13967" class="Bound">Γ⁗</a> <a id="14003" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="14005" href="Soundness.html#13894" class="Bound">Γ‴</a><a id="14007" class="Symbol">)</a>
      <a id="14015" class="Symbol">→</a> <a id="14017" href="Soundness.html#13992" class="Bound">Γ⁗≤Γ‴</a> <a id="14023" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="14026" class="Symbol">(</a><a id="14027" href="Soundness.html#13898" class="Bound">Γ‴≤Γ″</a> <a id="14033" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="14036" class="Symbol">(</a><a id="14037" href="Soundness.html#13874" class="Bound">Γ″≤Γ′</a> <a id="14043" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="14046" href="SystemT.html#3419" class="InductiveConstructor">rec</a> <a id="14050" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="14052" href="Soundness.html#13863" class="Bound">z</a><a id="14053" class="Symbol">)</a> <a id="14055" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="14057" href="Soundness.html#13881" class="Bound">s</a><a id="14058" class="Symbol">)</a> <a id="14060" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="14062" href="Soundness.html#13905" class="Bound">n</a> <a id="14064" href="Soundness.html#1073" class="Function Operator">==↑</a> <a id="14068" href="NbE.html#12205" class="Function">rec↑</a> <a id="14073" class="Symbol">(</a><a id="14074" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="14077" href="Soundness.html#13867" class="Bound">az</a><a id="14079" class="Symbol">)</a> <a id="14081" class="Symbol">(</a><a id="14082" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="14085" href="Soundness.html#13885" class="Bound">aₛ</a><a id="14087" class="Symbol">)</a> <a id="14089" href="Soundness.html#13912" class="Bound">𝓊̂</a>
    <a id="14096" href="Soundness.html#13951" class="Function">rec==↑rec↑</a> <a id="14107" class="Symbol">{</a><a id="14108" href="Soundness.html#14108" class="Bound">Γ⁗</a><a id="14110" class="Symbol">}</a> <a id="14112" href="Soundness.html#14112" class="Bound">Γ⁗≤Γ‴</a>
      <a id="14124" class="Keyword">with</a> <a id="14129" href="Soundness.html#13912" class="Bound">𝓊̂</a> <a id="14132" href="Soundness.html#14108" class="Bound">Γ⁗</a>          <a id="14144" class="Symbol">|</a> <a id="14146" href="Soundness.html#13916" class="Bound">pf″</a> <a id="14150" href="Soundness.html#14112" class="Bound">Γ⁗≤Γ‴</a>
    <a id="14160" class="Symbol">...</a> <a id="14164" class="Symbol">|</a> <a id="14166" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="14171" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="14173" class="Symbol">_</a> <a id="14175" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="14177" class="Symbol">_</a> <a id="14179" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="14181" class="Symbol">|</a> <a id="14183" href="Soundness.html#14183" class="Bound">n==𝓊</a> <a id="14188" class="Symbol">=</a>
      <a id="14196" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a>
        <a id="14219" class="Symbol">(</a><a id="14220" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a>
          <a id="14245" class="Symbol">(</a><a id="14246" href="SystemT.html#13083" class="InductiveConstructor">app-compatible</a>
            <a id="14273" href="SystemT.html#13338" class="InductiveConstructor">refl</a>
            <a id="14290" class="Symbol">(</a><a id="14291" href="Soundness.html#15635" class="Function">z==↓ᵀaz</a><a id="14298" class="Symbol">))</a>
          <a id="14311" class="Symbol">(</a><a id="14312" href="SystemT.html#13516" class="InductiveConstructor">trans</a>
            <a id="14330" href="SystemT.html#12589" class="InductiveConstructor">η</a>
            <a id="14344" class="Symbol">(</a><a id="14345" href="SystemT.html#12926" class="InductiveConstructor">abs-compatible</a>
              <a id="14374" class="Symbol">(</a><a id="14375" href="SystemT.html#13516" class="InductiveConstructor">trans</a>
                <a id="14397" href="SystemT.html#12589" class="InductiveConstructor">η</a>
                <a id="14415" class="Symbol">(</a><a id="14416" href="SystemT.html#12926" class="InductiveConstructor">abs-compatible</a>  <a id="14432" href="Soundness.html#15137" class="Function">s·x₁·x₂==↓ᵀas·↑ᵀ𝓍̂₁·↑ᵀ𝓍̂₂</a><a id="14457" class="Symbol">)))))</a>
      <a id="14469" href="Soundness.html#14183" class="Bound">n==𝓊</a>
      <a id="14480" class="Keyword">where</a>
        <a id="14494" href="Soundness.html#14494" class="Function">Γ‴≤Γ′</a> <a id="14500" class="Symbol">=</a> <a id="14502" href="Lemmas.html#1965" class="Function">≤-trans</a> <a id="14510" href="Soundness.html#13898" class="Bound">Γ‴≤Γ″</a> <a id="14516" href="Soundness.html#13874" class="Bound">Γ″≤Γ′</a>
        <a id="14530" href="Soundness.html#14530" class="Function">Γ⁗≤Γ″</a> <a id="14536" class="Symbol">=</a> <a id="14538" href="Lemmas.html#1965" class="Function">≤-trans</a> <a id="14546" class="Bound">Γ⁗≤Γ‴</a> <a id="14552" href="Soundness.html#13898" class="Bound">Γ‴≤Γ″</a>
        <a id="14566" href="Soundness.html#14566" class="Function">Γ⁗,nat≤Γ⁗</a> <a id="14576" class="Symbol">=</a> <a id="14578" href="SystemT.html#2072" class="InductiveConstructor">≤-ext</a> <a id="14584" class="Symbol">{</a><a id="14585" class="Argument">T</a> <a id="14587" class="Symbol">=</a> <a id="14589" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="14592" class="Symbol">}</a> <a id="14594" href="Soundness.html#14530" class="Function">Γ⁗≤Γ″</a>
        <a id="14608" href="Soundness.html#14608" class="Function">Γ⁗,nat,T≤Γ⁗</a> <a id="14620" class="Symbol">=</a> <a id="14622" href="SystemT.html#2072" class="InductiveConstructor">≤-ext</a> <a id="14628" class="Symbol">{</a><a id="14629" class="Argument">T</a> <a id="14631" class="Symbol">=</a> <a id="14633" href="Soundness.html#13854" class="Bound">T</a><a id="14634" class="Symbol">}</a> <a id="14636" href="Soundness.html#14566" class="Function">Γ⁗,nat≤Γ⁗</a>
        <a id="14654" href="Soundness.html#14654" class="Function">Γ⁗,nat,T≤Γ⁗,nat</a> <a id="14670" class="Symbol">=</a> <a id="14672" href="SystemT.html#2072" class="InductiveConstructor">≤-ext</a> <a id="14678" class="Symbol">{</a><a id="14679" class="Argument">T</a> <a id="14681" class="Symbol">=</a> <a id="14683" href="Soundness.html#13854" class="Bound">T</a><a id="14684" class="Symbol">}</a> <a id="14686" class="Symbol">(</a><a id="14687" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a> <a id="14692" class="Symbol">{</a><a id="14693" class="Bound">Γ⁗</a> <a id="14696" href="SystemT.html#1296" class="InductiveConstructor Operator">,</a> <a id="14698" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="14701" class="Symbol">})</a>

        <a id="14713" href="Soundness.html#14713" class="Function">subst-lemma₁</a> <a id="14726" class="Symbol">=</a> <a id="14728" href="Soundness.html#351" class="Function">≡-sym</a> <a id="14734" class="Symbol">(</a><a id="14735" href="Lemmas.html#6167" class="Function">incr-↑-≡</a> <a id="14744" class="Symbol">{</a><a id="14745" class="Argument">Γ′≤Γ</a> <a id="14750" class="Symbol">=</a> <a id="14752" href="Soundness.html#14530" class="Function">Γ⁗≤Γ″</a><a id="14757" class="Symbol">}</a> <a id="14759" class="Symbol">{</a><a id="14760" class="Argument">S</a> <a id="14762" class="Symbol">=</a> <a id="14764" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="14767" class="Symbol">}</a> <a id="14769" class="Symbol">{</a><a id="14770" class="Argument">t</a> <a id="14772" class="Symbol">=</a> <a id="14774" href="Soundness.html#13881" class="Bound">s</a><a id="14775" class="Symbol">})</a>
        <a id="14786" href="Soundness.html#14786" class="Function">subst-lemma₂</a> <a id="14799" class="Symbol">=</a>
          <a id="14811" href="Soundness.html#351" class="Function">≡-sym</a> <a id="14817" class="Symbol">(</a><a id="14818" href="Lemmas.html#5530" class="Postulate">weaken-compose</a> <a id="14833" class="Bound">Γ⁗≤Γ‴</a> <a id="14839" href="Soundness.html#13898" class="Bound">Γ‴≤Γ″</a> <a id="14845" href="Soundness.html#13881" class="Bound">s</a><a id="14846" class="Symbol">)</a>
        <a id="14856" href="Soundness.html#14856" class="Function">subst-lemma₃</a> <a id="14869" class="Symbol">=</a> <a id="14871" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="14885" class="Symbol">{</a><a id="14886" class="Argument">t</a> <a id="14888" class="Symbol">=</a> <a id="14890" href="Soundness.html#13854" class="Bound">T</a> <a id="14892" href="SystemT.html#10919" class="Function Operator">↑⊢</a> <a id="14895" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="14899" href="SystemT.html#10919" class="Function Operator">↑⊢</a> <a id="14902" class="Bound">Γ⁗≤Γ‴</a> <a id="14908" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="14911" href="Soundness.html#13898" class="Bound">Γ‴≤Γ″</a> <a id="14917" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="14920" href="Soundness.html#13881" class="Bound">s</a><a id="14921" class="Symbol">}</a>

        <a id="14932" href="Soundness.html#14932" class="Function">𝓍̂₁</a> <a id="14936" class="Symbol">=</a> <a id="14938" href="NbE.html#11009" class="Function">𝓍̂</a> <a id="14941" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="14945" class="Bound">Γ⁗</a>
        <a id="14956" href="Soundness.html#14956" class="Function">𝓍̂₂</a> <a id="14960" class="Symbol">=</a> <a id="14962" href="NbE.html#11009" class="Function">𝓍̂</a> <a id="14965" href="Soundness.html#13854" class="Bound">T</a> <a id="14967" class="Symbol">(</a><a id="14968" class="Bound">Γ⁗</a> <a id="14971" href="SystemT.html#1296" class="InductiveConstructor Operator">,</a> <a id="14973" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="14976" class="Symbol">)</a>

        <a id="14987" href="Soundness.html#14987" class="Function">s·x₁·x₂Ⓡaₛ·↑ᵀ𝓍̂₁↑ᵀ𝓍̂₂</a> <a id="15009" class="Symbol">=</a>
          <a id="15021" href="Soundness.html#13889" class="Bound">pf′</a> <a id="15025" href="Soundness.html#14566" class="Function">Γ⁗,nat≤Γ⁗</a> <a id="15035" class="Symbol">{</a><a id="15036" class="Argument">s</a> <a id="15038" class="Symbol">=</a> <a id="15040" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="15042" href="SystemT.html#2712" class="InductiveConstructor">`Z</a><a id="15044" class="Symbol">}</a> <a id="15046" class="Symbol">{</a><a id="15047" class="Argument">a</a> <a id="15049" class="Symbol">=</a> <a id="15051" href="NbE.html#9074" class="Function">↑ᵀ</a> <a id="15054" class="Symbol">{</a><a id="15055" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="15058" class="Symbol">}</a> <a id="15060" class="Symbol">(</a><a id="15061" href="NbE.html#11009" class="Function">𝓍̂</a> <a id="15064" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="15068" class="Bound">Γ⁗</a><a id="15070" class="Symbol">)}</a> <a id="15073" class="Symbol">(</a><a id="15074" href="Soundness.html#6689" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="15081" class="Symbol">{</a><a id="15082" class="Bound">Γ⁗</a><a id="15084" class="Symbol">}</a> <a id="15086" class="Symbol">{</a><a id="15087" href="SystemT.html#580" class="InductiveConstructor">nat</a><a id="15090" class="Symbol">})</a>
            <a id="15105" href="Soundness.html#14654" class="Function">Γ⁗,nat,T≤Γ⁗,nat</a> <a id="15121" href="Soundness.html#6689" class="Function">xⓇ↑ᵀ𝓍̂</a>

        <a id="15137" href="Soundness.html#15137" class="Function">s·x₁·x₂==↓ᵀas·↑ᵀ𝓍̂₁·↑ᵀ𝓍̂₂</a> <a id="15163" class="Symbol">:</a>
          <a id="15175" class="Symbol">(</a><a id="15176" href="Soundness.html#13854" class="Bound">T</a> <a id="15178" href="SystemT.html#10919" class="Function Operator">↑⊢</a> <a id="15181" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="15185" href="SystemT.html#10919" class="Function Operator">↑⊢</a> <a id="15188" class="Bound">Γ⁗≤Γ‴</a> <a id="15194" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="15197" href="Soundness.html#13898" class="Bound">Γ‴≤Γ″</a> <a id="15203" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="15206" href="Soundness.html#13881" class="Bound">s</a><a id="15207" class="Symbol">)</a> <a id="15209" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="15211" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="15213" class="Symbol">(</a><a id="15214" href="SystemT.html#2777" class="InductiveConstructor Operator">`S</a> <a id="15217" href="SystemT.html#2712" class="InductiveConstructor">`Z</a><a id="15219" class="Symbol">)</a> <a id="15221" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="15223" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="15225" href="SystemT.html#2712" class="InductiveConstructor">`Z</a> <a id="15228" href="SystemT.html#11908" class="Datatype Operator">==</a>
            <a id="15243" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="15249" class="Symbol">(</a><a id="15250" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="15253" class="Symbol">(</a><a id="15254" href="Soundness.html#13885" class="Bound">aₛ</a> <a id="15257" class="Symbol">(</a><a id="15258" href="NbE.html#9074" class="Function">↑ᵀ</a> <a id="15261" href="Soundness.html#14932" class="Function">𝓍̂₁</a><a id="15264" class="Symbol">)</a> <a id="15266" class="Symbol">(</a><a id="15267" href="NbE.html#9074" class="Function">↑ᵀ</a> <a id="15270" href="Soundness.html#14956" class="Function">𝓍̂₂</a><a id="15273" class="Symbol">))</a> <a id="15276" class="Symbol">(</a><a id="15277" class="Bound">Γ⁗</a> <a id="15280" href="SystemT.html#1296" class="InductiveConstructor Operator">,</a> <a id="15282" href="SystemT.html#580" class="InductiveConstructor">nat</a> <a id="15286" href="SystemT.html#1296" class="InductiveConstructor Operator">,</a> <a id="15288" href="Soundness.html#13854" class="Bound">T</a><a id="15289" class="Symbol">))</a>
        <a id="15300" href="Soundness.html#15137" class="Function">s·x₁·x₂==↓ᵀas·↑ᵀ𝓍̂₁·↑ᵀ𝓍̂₂</a>
          <a id="15336" class="Keyword">with</a> <a id="15341" href="Soundness.html#14987" class="Function">s·x₁·x₂Ⓡaₛ·↑ᵀ𝓍̂₁↑ᵀ𝓍̂₂</a>
        <a id="15371" href="Soundness.html#15137" class="Function">...</a> <a id="15375" class="Symbol">|</a> <a id="15377" href="Soundness.html#15377" class="Bound">pf-Ⓡ</a>
          <a id="15392" class="Keyword">with</a> <a id="15397" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="15403" href="Soundness.html#15377" class="Bound">pf-Ⓡ</a> <a id="15408" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a>
        <a id="15421" class="Symbol">...</a> <a id="15425" class="Symbol">|</a> <a id="15427" href="Soundness.html#15427" class="Bound">pf-==↓</a>
          <a id="15444" class="Keyword">rewrite</a> <a id="15452" href="Soundness.html#14713" class="Function">subst-lemma₁</a> <a id="15465" class="Symbol">|</a> <a id="15467" href="Soundness.html#14786" class="Function">subst-lemma₂</a> <a id="15480" class="Symbol">|</a> <a id="15482" href="Soundness.html#14856" class="Function">subst-lemma₃</a> <a id="15495" class="Symbol">=</a> <a id="15497" href="Soundness.html#15427" class="Bound">pf-==↓</a>

        <a id="15513" href="Soundness.html#15513" class="Function">subst-lemma₄</a> <a id="15526" class="Symbol">=</a> <a id="15528" href="Soundness.html#351" class="Function">≡-sym</a> <a id="15534" class="Symbol">(</a><a id="15535" href="Lemmas.html#5530" class="Postulate">weaken-compose</a> <a id="15550" class="Bound">Γ⁗≤Γ‴</a> <a id="15556" href="Soundness.html#14494" class="Function">Γ‴≤Γ′</a> <a id="15562" href="Soundness.html#13863" class="Bound">z</a><a id="15563" class="Symbol">)</a>
        <a id="15573" href="Soundness.html#15573" class="Function">subst-lemma₅</a>  <a id="15587" class="Symbol">=</a> <a id="15589" href="Soundness.html#351" class="Function">≡-sym</a> <a id="15595" class="Symbol">(</a><a id="15596" href="Lemmas.html#5530" class="Postulate">weaken-compose</a> <a id="15611" href="Soundness.html#13898" class="Bound">Γ‴≤Γ″</a> <a id="15617" href="Soundness.html#13874" class="Bound">Γ″≤Γ′</a> <a id="15623" href="Soundness.html#13863" class="Bound">z</a><a id="15624" class="Symbol">)</a>

        <a id="15635" href="Soundness.html#15635" class="Function">z==↓ᵀaz</a> <a id="15643" class="Symbol">:</a> <a id="15645" class="Bound">Γ⁗≤Γ‴</a> <a id="15651" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="15654" href="Soundness.html#13898" class="Bound">Γ‴≤Γ″</a> <a id="15660" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="15663" href="Soundness.html#13874" class="Bound">Γ″≤Γ′</a> <a id="15669" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="15672" href="Soundness.html#13863" class="Bound">z</a> <a id="15674" href="SystemT.html#11908" class="Datatype Operator">==</a> <a id="15677" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="15683" class="Symbol">(</a><a id="15684" href="NbE.html#9180" class="Function">↓ᵀ</a> <a id="15687" href="Soundness.html#13867" class="Bound">az</a> <a id="15690" class="Bound">Γ⁗</a><a id="15692" class="Symbol">)</a>
        <a id="15702" href="Soundness.html#15635" class="Function">z==↓ᵀaz</a>
          <a id="15720" class="Keyword">with</a> <a id="15725" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="15731" class="Symbol">{</a><a id="15732" class="Bound">Γ⁗</a><a id="15734" class="Symbol">}</a> <a id="15736" href="Soundness.html#13871" class="Bound">pf</a> <a id="15739" class="Symbol">(</a><a id="15740" href="Lemmas.html#1965" class="Function">≤-trans</a> <a id="15748" class="Bound">Γ⁗≤Γ‴</a> <a id="15754" href="Soundness.html#14494" class="Function">Γ‴≤Γ′</a><a id="15759" class="Symbol">)</a>
        <a id="15769" href="Soundness.html#15635" class="Function">...</a> <a id="15773" class="Symbol">|</a> <a id="15775" href="Soundness.html#15775" class="Bound">pf</a>
          <a id="15788" class="Keyword">rewrite</a> <a id="15796" href="Soundness.html#15513" class="Function">subst-lemma₄</a> <a id="15809" class="Symbol">|</a> <a id="15811" href="Soundness.html#15573" class="Function">subst-lemma₅</a> <a id="15824" class="Symbol">=</a> <a id="15826" href="Soundness.html#15775" class="Bound">pf</a>
</pre>
<p>With that out of the way, having proved the lemma that
<code>Γ ⊢ t : T Ⓡ a ⇒ ∀ Γ′ ≤ Γ. Γ′ ⊢ t = ↓ᵀ a Γ : T</code>, we have: Γ ⊢
t : T Ⓡ a ⇒ Γ ⊢ t = ↓ᵀ a Γ : T which is what we wanted our logical
relation to imply, so that we can then show that
<code>Γ ⊢ t : T Ⓡ a</code> for <code>a = ⟦t⟧ (↑ Γ)</code></p>
For this, we will establish that <code>Γ ⊢ t : T Ⓡ ⟦t⟧ (↑ Γ)</code>
using the fundamental lemma of logical relations. First, we will need to
extend logical relations to include substitutions and environments. We
again use ∥Ⓡ∥ for the “parallel” in parallel substitutions, as Ⓡ is
already defined for terms and semantic objects
<pre class="Agda"><a id="_∥Ⓡ∥_"></a><a id="16432" href="Soundness.html#16432" class="Function Operator">_∥Ⓡ∥_</a> <a id="16438" class="Symbol">:</a> <a id="16440" class="Symbol">∀</a> <a id="16442" class="Symbol">{</a><a id="16443" href="Soundness.html#16443" class="Bound">Γ</a> <a id="16445" href="Soundness.html#16445" class="Bound">Δ</a> <a id="16447" class="Symbol">:</a> <a id="16449" href="SystemT.html#1272" class="Datatype">Γ</a><a id="16450" class="Symbol">}</a>
      <a id="16458" class="Symbol">→</a> <a id="16460" href="Soundness.html#16443" class="Bound">Γ</a> <a id="16462" href="SystemT.html#5683" class="Datatype Operator">⊩</a> <a id="16464" href="Soundness.html#16445" class="Bound">Δ</a>
      <a id="16472" class="Symbol">→</a> <a id="16474" href="NbE.html#849" class="Field Operator">⟦</a> <a id="16476" href="Soundness.html#16445" class="Bound">Δ</a> <a id="16478" href="NbE.html#849" class="Field Operator">⟧</a>
      <a id="16486" class="Symbol">→</a> <a id="16488" href="Agda.Primitive.html#326" class="Primitive">Set</a>
</pre>
<p>Similarly as for terms and values, a Kripe logical relation between a
parallel substitution and an environment is defined inductively, though
this time by induction on the rules for parallel substitutions instead
of by induction on types</p>
A substitution from the empty context is always logically related to an
empty environment
<pre class="Agda"><a id="16834" href="SystemT.html#5709" class="InductiveConstructor">∅</a> <a id="16836" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="16840" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a> <a id="16843" class="Symbol">=</a> <a id="16845" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
</pre>
An extension to a substition (σ , s / x) is logically related to an
environment (ρ , a) if σ is logically related to ρ and s is logically
related to a
<pre class="Agda"><a id="17011" class="Symbol">(</a><a id="17012" href="Soundness.html#17012" class="Bound">σ</a> <a id="17014" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="17016" href="Soundness.html#17016" class="Bound">s</a><a id="17017" class="Symbol">)</a> <a id="17019" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="17023" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="17025" href="Soundness.html#17025" class="Bound">ρ</a> <a id="17027" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="17029" href="Soundness.html#17029" class="Bound">a</a> <a id="17031" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="17033" class="Symbol">=</a> <a id="17035" href="Soundness.html#17012" class="Bound">σ</a> <a id="17037" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="17041" href="Soundness.html#17025" class="Bound">ρ</a> <a id="17043" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="17045" href="Soundness.html#17016" class="Bound">s</a> <a id="17047" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="17049" href="Soundness.html#17029" class="Bound">a</a>

<a id="17052" class="Keyword">infix</a> <a id="17058" class="Number">4</a> <a id="17060" href="Soundness.html#16432" class="Function Operator">_∥Ⓡ∥_</a>
</pre>
A consequence of how substitutions and their logical relation with
environments are defined is that we have that a logical relation for a
shifted substitution holds if the logical relation holds for the
original substitution (as the shifted terms will be irrelevant)
<pre class="Agda"><a id="∥Ⓡ∥-↑"></a><a id="17346" href="Soundness.html#17346" class="Function">∥Ⓡ∥-↑</a> <a id="17352" class="Symbol">:</a> <a id="17354" class="Symbol">∀</a> <a id="17356" class="Symbol">{</a><a id="17357" href="Soundness.html#17357" class="Bound">Γ</a> <a id="17359" href="Soundness.html#17359" class="Bound">Δ</a> <a id="17361" class="Symbol">:</a> <a id="17363" href="SystemT.html#1272" class="Datatype">Γ</a><a id="17364" class="Symbol">}</a> <a id="17366" class="Symbol">{</a><a id="17367" href="Soundness.html#17367" class="Bound">T</a> <a id="17369" class="Symbol">:</a> <a id="17371" href="SystemT.html#561" class="Datatype">Type</a><a id="17375" class="Symbol">}</a> <a id="17377" class="Symbol">{</a><a id="17378" href="Soundness.html#17378" class="Bound">σᵨ</a> <a id="17381" class="Symbol">:</a> <a id="17383" href="Soundness.html#17357" class="Bound">Γ</a> <a id="17385" href="SystemT.html#6327" class="Datatype Operator">⊩ᵨ</a> <a id="17388" href="Soundness.html#17359" class="Bound">Δ</a><a id="17389" class="Symbol">}</a> <a id="17391" class="Symbol">{</a><a id="17392" href="Soundness.html#17392" class="Bound">ρ</a> <a id="17394" class="Symbol">:</a> <a id="17396" href="NbE.html#849" class="Field Operator">⟦</a> <a id="17398" href="Soundness.html#17359" class="Bound">Δ</a> <a id="17400" href="NbE.html#849" class="Field Operator">⟧</a><a id="17401" class="Symbol">}</a>
      <a id="17409" class="Symbol">→</a> <a id="17411" href="SystemT.html#8816" class="Function">substᵨ</a> <a id="17418" href="Soundness.html#17378" class="Bound">σᵨ</a> <a id="17421" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="17425" href="Soundness.html#17392" class="Bound">ρ</a>
      <a id="17433" class="Symbol">→</a> <a id="17435" href="SystemT.html#8816" class="Function">substᵨ</a> <a id="17442" class="Symbol">(</a><a id="17443" href="SystemT.html#7258" class="Function Operator">_↑ᵨ</a> <a id="17447" class="Symbol">{</a><a id="17448" class="Argument">T</a> <a id="17450" class="Symbol">=</a> <a id="17452" href="Soundness.html#17367" class="Bound">T</a><a id="17453" class="Symbol">}</a> <a id="17455" href="Soundness.html#17378" class="Bound">σᵨ</a><a id="17457" class="Symbol">)</a> <a id="17459" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="17463" href="Soundness.html#17392" class="Bound">ρ</a>
<a id="17465" href="Soundness.html#17346" class="Function">∥Ⓡ∥-↑</a> <a id="17471" class="Symbol">{</a><a id="17472" class="Argument">σᵨ</a> <a id="17475" class="Symbol">=</a> <a id="17477" href="SystemT.html#6354" class="InductiveConstructor">∅</a><a id="17478" class="Symbol">}</a> <a id="17480" href="Soundness.html#17480" class="Bound">pf</a> <a id="17483" class="Symbol">=</a> <a id="17485" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
<a id="17488" href="Soundness.html#17346" class="Function">∥Ⓡ∥-↑</a> <a id="17494" class="Symbol">{</a><a id="17495" class="Argument">T</a> <a id="17497" class="Symbol">=</a> <a id="17499" href="Soundness.html#17499" class="Bound">T</a><a id="17500" class="Symbol">}</a> <a id="17502" class="Symbol">{</a><a id="17503" class="Argument">σᵨ</a> <a id="17506" class="Symbol">=</a> <a id="17508" class="Symbol">_</a> <a id="17510" href="SystemT.html#6380" class="InductiveConstructor Operator">,</a> <a id="17512" href="Soundness.html#17512" class="Bound">x</a><a id="17513" class="Symbol">}</a> <a id="17515" class="Symbol">{</a><a id="17516" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="17518" class="Symbol">_</a> <a id="17520" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="17522" href="Soundness.html#17522" class="Bound">a</a> <a id="17524" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a><a id="17525" class="Symbol">}</a> <a id="17527" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="17529" href="Soundness.html#17529" class="Bound">pf</a> <a id="17532" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="17534" href="Soundness.html#17534" class="Bound">xⓇa</a> <a id="17538" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="17540" class="Symbol">=</a> <a id="17542" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="17544" href="Soundness.html#17346" class="Function">∥Ⓡ∥-↑</a> <a id="17550" href="Soundness.html#17529" class="Bound">pf</a> <a id="17553" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="17555" href="Soundness.html#17701" class="Function">↑⊢xⓇa</a> <a id="17561" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
  <a id="17565" class="Keyword">where</a>
    <a id="17575" href="Soundness.html#17575" class="Function">subst-lemma₁</a> <a id="17588" class="Symbol">=</a> <a id="17590" href="Lemmas.html#2790" class="Function">shift-var</a> <a id="17600" class="Symbol">{</a><a id="17601" class="Argument">S</a> <a id="17603" class="Symbol">=</a> <a id="17605" href="Soundness.html#17499" class="Bound">T</a><a id="17606" class="Symbol">}</a> <a id="17608" class="Symbol">{</a><a id="17609" class="Argument">x</a> <a id="17611" class="Symbol">=</a> <a id="17613" href="Soundness.html#17512" class="Bound">x</a><a id="17614" class="Symbol">}</a> <a id="17616" class="Symbol">{</a><a id="17617" class="Argument">σᵨ</a> <a id="17620" class="Symbol">=</a> <a id="17622" href="SystemT.html#8284" class="Function">idᵨ</a><a id="17625" class="Symbol">}</a>
    <a id="17631" href="Soundness.html#17631" class="Function">subst-lemma₂</a> <a id="17644" class="Symbol">=</a> <a id="17646" href="Lemmas.html#3332" class="Function">rename-id</a> <a id="17656" class="Symbol">{</a><a id="17657" class="Argument">x</a> <a id="17659" class="Symbol">=</a> <a id="17661" href="Soundness.html#17512" class="Bound">x</a><a id="17662" class="Symbol">}</a>

    <a id="17669" href="Soundness.html#17669" class="Function">Γ,T≤Γ</a> <a id="17675" class="Symbol">=</a> <a id="17677" href="SystemT.html#2072" class="InductiveConstructor">≤-ext</a> <a id="17683" class="Symbol">{</a><a id="17684" class="Argument">T</a> <a id="17686" class="Symbol">=</a> <a id="17688" href="Soundness.html#17499" class="Bound">T</a><a id="17689" class="Symbol">}</a> <a id="17691" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a>

    <a id="17701" href="Soundness.html#17701" class="Function">↑⊢xⓇa</a> <a id="17707" class="Symbol">:</a> <a id="17709" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="17711" class="Symbol">(</a><a id="17712" href="SystemT.html#2777" class="InductiveConstructor Operator">`S</a> <a id="17715" href="Soundness.html#17512" class="Bound">x</a><a id="17716" class="Symbol">)</a> <a id="17718" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="17720" href="Soundness.html#17522" class="Bound">a</a>
    <a id="17726" href="Soundness.html#17701" class="Function">↑⊢xⓇa</a>
      <a id="17738" class="Keyword">with</a> <a id="17743" href="Soundness.html#4907" class="Function">Ⓡ-weaken</a> <a id="17752" class="Symbol">{</a><a id="17753" class="Argument">Γ′≤Γ</a> <a id="17758" class="Symbol">=</a> <a id="17760" href="Soundness.html#17669" class="Function">Γ,T≤Γ</a><a id="17765" class="Symbol">}</a> <a id="17767" class="Symbol">{</a><a id="17768" class="Argument">t</a> <a id="17770" class="Symbol">=</a> <a id="17772" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="17774" href="Soundness.html#17512" class="Bound">x</a><a id="17775" class="Symbol">}</a> <a id="17777" href="Soundness.html#17534" class="Bound">xⓇa</a>
    <a id="17785" href="Soundness.html#17701" class="Function">...</a> <a id="17789" class="Symbol">|</a> <a id="17791" href="Soundness.html#17791" class="Bound">pf</a>
      <a id="17800" class="Keyword">rewrite</a> <a id="17808" href="Soundness.html#17575" class="Function">subst-lemma₁</a> <a id="17821" class="Symbol">|</a> <a id="17823" href="Soundness.html#17631" class="Function">subst-lemma₂</a> <a id="17836" class="Symbol">=</a> <a id="17838" href="Soundness.html#17791" class="Bound">pf</a>
</pre>
A generalization of this is, similarly as for logical relations between
terms and semantic objects, that if a logical relation holds between a
substitution and an environment, it holds for any weakening of the
substitution (as weakening is really a series of shifts)
<pre class="Agda"><a id="∥Ⓡ∥-weaken"></a><a id="18121" href="Soundness.html#18121" class="Function">∥Ⓡ∥-weaken</a> <a id="18132" class="Symbol">:</a> <a id="18134" class="Symbol">∀</a> <a id="18136" class="Symbol">{</a><a id="18137" href="Soundness.html#18137" class="Bound">Γ′</a> <a id="18140" href="Soundness.html#18140" class="Bound">Γ</a> <a id="18142" href="Soundness.html#18142" class="Bound">Δ</a> <a id="18144" class="Symbol">:</a> <a id="18146" href="SystemT.html#1272" class="Datatype">Γ</a><a id="18147" class="Symbol">}</a> <a id="18149" class="Symbol">{</a><a id="18150" href="Soundness.html#18150" class="Bound">Γ′≤Γ</a> <a id="18155" class="Symbol">:</a> <a id="18157" href="Soundness.html#18137" class="Bound">Γ′</a> <a id="18160" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="18162" href="Soundness.html#18140" class="Bound">Γ</a><a id="18163" class="Symbol">}</a> <a id="18165" class="Symbol">{</a><a id="18166" href="Soundness.html#18166" class="Bound">σ</a> <a id="18168" class="Symbol">:</a> <a id="18170" href="Soundness.html#18140" class="Bound">Γ</a> <a id="18172" href="SystemT.html#5683" class="Datatype Operator">⊩</a> <a id="18174" href="Soundness.html#18142" class="Bound">Δ</a><a id="18175" class="Symbol">}</a> <a id="18177" class="Symbol">{</a><a id="18178" href="Soundness.html#18178" class="Bound">ρ</a> <a id="18180" class="Symbol">:</a> <a id="18182" href="NbE.html#849" class="Field Operator">⟦</a> <a id="18184" href="Soundness.html#18142" class="Bound">Δ</a> <a id="18186" href="NbE.html#849" class="Field Operator">⟧</a><a id="18187" class="Symbol">}</a>
        <a id="18197" class="Symbol">→</a> <a id="18199" href="Soundness.html#18166" class="Bound">σ</a> <a id="18201" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="18205" href="Soundness.html#18178" class="Bound">ρ</a>
        <a id="18215" class="Symbol">→</a> <a id="18217" href="Soundness.html#18166" class="Bound">σ</a> <a id="18219" href="SystemT.html#9891" class="Function Operator">∘</a> <a id="18221" class="Symbol">(</a><a id="18222" href="SystemT.html#10200" class="Function">weaken</a> <a id="18229" href="Soundness.html#18150" class="Bound">Γ′≤Γ</a><a id="18233" class="Symbol">)</a> <a id="18235" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="18239" href="Soundness.html#18178" class="Bound">ρ</a>
<a id="18241" href="Soundness.html#18121" class="Function">∥Ⓡ∥-weaken</a> <a id="18252" class="Symbol">{</a><a id="18253" class="Argument">σ</a> <a id="18255" class="Symbol">=</a> <a id="18257" href="SystemT.html#5709" class="InductiveConstructor">∅</a><a id="18258" class="Symbol">}</a> <a id="18260" href="Soundness.html#18260" class="Bound">x</a> <a id="18262" class="Symbol">=</a> <a id="18264" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
<a id="18267" href="Soundness.html#18121" class="Function">∥Ⓡ∥-weaken</a> <a id="18278" class="Symbol">{</a><a id="18279" class="Argument">Γ′≤Γ</a> <a id="18284" class="Symbol">=</a> <a id="18286" href="Soundness.html#18286" class="Bound">Γ′≤Γ</a><a id="18290" class="Symbol">}</a> <a id="18292" class="Symbol">{</a><a id="18293" href="Soundness.html#18293" class="Bound">σ</a> <a id="18295" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="18297" href="Soundness.html#18297" class="Bound">s</a><a id="18298" class="Symbol">}</a> <a id="18300" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="18302" href="Soundness.html#18302" class="Bound">σ∥Ⓡ∥ρ</a> <a id="18308" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="18310" href="Soundness.html#18310" class="Bound">sⓇa</a> <a id="18314" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="18316" class="Symbol">=</a>
  <a id="18320" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="18322" href="Soundness.html#18121" class="Function">∥Ⓡ∥-weaken</a> <a id="18333" class="Symbol">{</a><a id="18334" class="Argument">Γ′≤Γ</a> <a id="18339" class="Symbol">=</a> <a id="18341" href="Soundness.html#18286" class="Bound">Γ′≤Γ</a><a id="18345" class="Symbol">}</a> <a id="18347" href="Soundness.html#18302" class="Bound">σ∥Ⓡ∥ρ</a> <a id="18353" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="18355" href="Soundness.html#4907" class="Function">Ⓡ-weaken</a> <a id="18364" class="Symbol">{</a><a id="18365" class="Argument">Γ′≤Γ</a> <a id="18370" class="Symbol">=</a> <a id="18372" href="Soundness.html#18286" class="Bound">Γ′≤Γ</a><a id="18376" class="Symbol">}</a> <a id="18378" href="Soundness.html#18310" class="Bound">sⓇa</a> <a id="18382" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
</pre>
We are now ready to introduce the semantic typing judgement
<code>Γ ⊨ t : T</code>, which will be the what we will use to arrive at
<code>Γ ⊢ t : T Ⓡ ⟦ t ⟧ ↑Γ Γ</code>
<pre class="Agda"><a id="_⊨_"></a><a id="18543" href="Soundness.html#18543" class="Function Operator">_⊨_</a> <a id="18547" class="Symbol">:</a> <a id="18549" class="Symbol">∀</a> <a id="18551" class="Symbol">{</a><a id="18552" href="Soundness.html#18552" class="Bound">T</a> <a id="18554" class="Symbol">:</a> <a id="18556" href="SystemT.html#561" class="Datatype">Type</a><a id="18560" class="Symbol">}</a> <a id="18562" class="Symbol">→</a> <a id="18564" class="Symbol">(</a><a id="18565" href="Soundness.html#18565" class="Bound">Γ</a> <a id="18567" class="Symbol">:</a> <a id="18569" href="SystemT.html#1272" class="Datatype">Γ</a><a id="18570" class="Symbol">)</a> <a id="18572" class="Symbol">→</a> <a id="18574" href="Soundness.html#18565" class="Bound">Γ</a> <a id="18576" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="18578" href="Soundness.html#18552" class="Bound">T</a> <a id="18580" class="Symbol">→</a> <a id="18582" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="18586" href="Soundness.html#18543" class="Function Operator">_⊨_</a> <a id="18590" class="Symbol">{</a><a id="18591" href="Soundness.html#18591" class="Bound">T</a><a id="18592" class="Symbol">}</a> <a id="18594" href="Soundness.html#18594" class="Bound">Γ</a> <a id="18596" href="Soundness.html#18596" class="Bound">t</a> <a id="18598" class="Symbol">=</a>
  <a id="18602" class="Symbol">∀</a> <a id="18604" class="Symbol">{</a><a id="18605" href="Soundness.html#18605" class="Bound">Δ</a> <a id="18607" class="Symbol">:</a> <a id="18609" href="SystemT.html#1272" class="Datatype">SystemT.Γ</a><a id="18618" class="Symbol">}</a> <a id="18620" class="Symbol">{</a><a id="18621" href="Soundness.html#18621" class="Bound">σ</a> <a id="18623" class="Symbol">:</a> <a id="18625" href="Soundness.html#18605" class="Bound">Δ</a> <a id="18627" href="SystemT.html#5683" class="Datatype Operator">⊩</a> <a id="18629" href="Soundness.html#18594" class="Bound">Γ</a><a id="18630" class="Symbol">}</a> <a id="18632" class="Symbol">{</a><a id="18633" href="Soundness.html#18633" class="Bound">ρ</a> <a id="18635" class="Symbol">:</a> <a id="18637" href="NbE.html#849" class="Field Operator">⟦</a> <a id="18639" href="Soundness.html#18594" class="Bound">Γ</a> <a id="18641" href="NbE.html#849" class="Field Operator">⟧</a><a id="18642" class="Symbol">}</a>
  <a id="18646" class="Symbol">→</a> <a id="18648" href="Soundness.html#18621" class="Bound">σ</a> <a id="18650" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="18654" href="Soundness.html#18633" class="Bound">ρ</a>
    <a id="18660" class="Comment">-------</a>
  <a id="18670" class="Symbol">→</a> <a id="18672" href="Soundness.html#18596" class="Bound">t</a> <a id="18674" href="SystemT.html#9486" class="Function Operator">[</a> <a id="18676" href="Soundness.html#18621" class="Bound">σ</a> <a id="18678" href="SystemT.html#9486" class="Function Operator">]</a> <a id="18680" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="18682" href="NbE.html#12988" class="Function Operator">⟦⊢</a> <a id="18685" href="Soundness.html#18596" class="Bound">t</a> <a id="18687" href="NbE.html#12988" class="Function Operator">⟧</a> <a id="18689" href="Soundness.html#18633" class="Bound">ρ</a>
</pre>
By induction on the typing judgement <code>Γ ⊢ t : T</code>, we prove
the semantic typing judgement <code>Γ ⊨ t : T</code>, this is called the
fundamental lemma of logical relations
<pre class="Agda"><a id="fundamental-lemma"></a><a id="18864" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="18882" class="Symbol">:</a> <a id="18884" class="Symbol">∀</a> <a id="18886" class="Symbol">{</a><a id="18887" href="Soundness.html#18887" class="Bound">Γ</a> <a id="18889" class="Symbol">:</a> <a id="18891" href="SystemT.html#1272" class="Datatype">Γ</a><a id="18892" class="Symbol">}</a> <a id="18894" class="Symbol">{</a><a id="18895" href="Soundness.html#18895" class="Bound">T</a> <a id="18897" class="Symbol">:</a> <a id="18899" href="SystemT.html#561" class="Datatype">Type</a><a id="18903" class="Symbol">}</a> <a id="18905" class="Symbol">{</a><a id="18906" href="Soundness.html#18906" class="Bound">t</a> <a id="18908" class="Symbol">:</a> <a id="18910" href="Soundness.html#18887" class="Bound">Γ</a> <a id="18912" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="18914" href="Soundness.html#18895" class="Bound">T</a><a id="18915" class="Symbol">}</a>
                  <a id="18935" class="Symbol">→</a> <a id="18937" href="Soundness.html#18887" class="Bound">Γ</a> <a id="18939" href="Soundness.html#18543" class="Function Operator">⊨</a> <a id="18941" href="Soundness.html#18906" class="Bound">t</a>
<a id="18943" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="18961" class="Symbol">{</a><a id="18962" class="Argument">t</a> <a id="18964" class="Symbol">=</a> <a id="18966" href="SystemT.html#3378" class="InductiveConstructor">zero</a><a id="18970" class="Symbol">}</a> <a id="18972" href="Soundness.html#18972" class="Bound">σ∥Ⓡ∥ρ</a> <a id="18978" class="Symbol">_</a> <a id="18980" class="Symbol">=</a> <a id="18982" href="SystemT.html#13338" class="InductiveConstructor">refl</a>
<a id="18987" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="19005" class="Symbol">{</a><a id="19006" class="Argument">t</a> <a id="19008" class="Symbol">=</a> <a id="19010" href="SystemT.html#3396" class="InductiveConstructor">suc</a><a id="19013" class="Symbol">}</a> <a id="19015" href="Soundness.html#19015" class="Bound">σ∥Ⓡ∥ρ</a> <a id="19021" href="Soundness.html#19021" class="Bound">Δ′≤Δ</a> <a id="19026" class="Symbol">{</a><a id="19027" href="Soundness.html#19027" class="Bound">s</a><a id="19028" class="Symbol">}</a> <a id="19030" class="Symbol">{</a><a id="19031" href="Soundness.html#19031" class="Bound">a</a><a id="19032" class="Symbol">}</a> <a id="19034" href="Soundness.html#19034" class="Bound">pf</a> <a id="19037" class="Symbol">{</a><a id="19038" href="Soundness.html#19038" class="Bound">Δ″</a><a id="19040" class="Symbol">}</a> <a id="19042" href="Soundness.html#19042" class="Bound">Δ″≤Δ′</a> <a id="19048" class="Symbol">=</a>
  <a id="19052" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="19054" href="Soundness.html#19042" class="Bound">Δ″≤Δ′</a> <a id="19060" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="19063" href="Soundness.html#19027" class="Bound">s</a> <a id="19065" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="19067" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="19069" href="SystemT.html#13338" class="InductiveConstructor">refl</a> <a id="19074" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="19076" href="Soundness.html#19097" class="Function">s==a</a> <a id="19081" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="19083" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
  <a id="19087" class="Keyword">where</a>
    <a id="19097" href="Soundness.html#19097" class="Function">s==a</a> <a id="19102" class="Symbol">:</a> <a id="19104" class="Symbol">∀</a> <a id="19106" class="Symbol">{</a><a id="19107" href="Soundness.html#19107" class="Bound">Δ‴</a> <a id="19110" class="Symbol">:</a> <a id="19112" href="SystemT.html#1272" class="Datatype">Γ</a><a id="19113" class="Symbol">}</a> <a id="19115" class="Symbol">→</a> <a id="19117" class="Symbol">(</a><a id="19118" href="Soundness.html#19118" class="Bound">Δ‴≤Δ″</a> <a id="19124" class="Symbol">:</a> <a id="19126" href="Soundness.html#19107" class="Bound">Δ‴</a> <a id="19129" href="SystemT.html#2018" class="Datatype Operator">≤</a> <a id="19131" href="Soundness.html#19038" class="Bound">Δ″</a><a id="19133" class="Symbol">)</a> <a id="19135" class="Symbol">→</a> <a id="19137" href="Soundness.html#19118" class="Bound">Δ‴≤Δ″</a> <a id="19143" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="19146" href="Soundness.html#19042" class="Bound">Δ″≤Δ′</a> <a id="19152" href="SystemT.html#10408" class="Function Operator">≤⊢</a> <a id="19155" href="Soundness.html#19027" class="Bound">s</a> <a id="19157" href="Soundness.html#2422" class="Function Operator">==ℕ̂</a> <a id="19162" href="Soundness.html#19031" class="Bound">a</a>
    <a id="19168" href="Soundness.html#19097" class="Function">s==a</a> <a id="19173" href="Soundness.html#19173" class="Bound">Δ‴≤Δ″</a>
      <a id="19185" class="Keyword">with</a> <a id="19190" href="Soundness.html#19034" class="Bound">pf</a> <a id="19193" class="Symbol">(</a><a id="19194" href="Lemmas.html#1965" class="Function">≤-trans</a> <a id="19202" href="Soundness.html#19173" class="Bound">Δ‴≤Δ″</a> <a id="19208" href="Soundness.html#19042" class="Bound">Δ″≤Δ′</a><a id="19213" class="Symbol">)</a>
    <a id="19219" class="Symbol">...</a> <a id="19223" class="Symbol">|</a> <a id="19225" href="Soundness.html#19225" class="Bound">pf</a>
      <a id="19234" class="Keyword">rewrite</a> <a id="19242" href="Lemmas.html#5530" class="Postulate">weaken-compose</a> <a id="19257" class="Bound">Δ‴≤Δ″</a> <a id="19263" href="Soundness.html#19042" class="Bound">Δ″≤Δ′</a> <a id="19269" href="Soundness.html#19027" class="Bound">s</a> <a id="19271" class="Symbol">=</a> <a id="19273" href="Soundness.html#19225" class="Bound">pf</a>
<a id="19276" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="19294" class="Symbol">{</a><a id="19295" class="Argument">t</a> <a id="19297" class="Symbol">=</a> <a id="19299" href="SystemT.html#3419" class="InductiveConstructor">rec</a> <a id="19303" class="Symbol">{</a><a id="19304" href="Soundness.html#19304" class="Bound">T</a><a id="19305" class="Symbol">}}</a> <a id="19308" class="Symbol">_</a> <a id="19310" class="Symbol">=</a> <a id="19312" href="Soundness.html#12694" class="Function">recⓇ⟦rec⟧</a>
<a id="19322" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="19340" class="Symbol">{</a><a id="19341" class="Argument">t</a> <a id="19343" class="Symbol">=</a> <a id="19345" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="19347" href="SystemT.html#2712" class="InductiveConstructor">`Z</a><a id="19349" class="Symbol">}</a> <a id="19351" class="Symbol">{</a><a id="19352" class="Argument">σ</a> <a id="19354" class="Symbol">=</a> <a id="19356" class="Symbol">_</a> <a id="19358" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19360" class="Symbol">_</a> <a id="19362" class="Symbol">}</a> <a id="19364" class="Symbol">{</a><a id="19365" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="19367" class="Symbol">_</a> <a id="19369" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="19371" class="Symbol">_</a> <a id="19373" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a><a id="19374" class="Symbol">}</a> <a id="19376" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="19378" class="Symbol">_</a> <a id="19380" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="19382" href="Soundness.html#19382" class="Bound">xⓇa</a> <a id="19386" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="19388" class="Symbol">=</a> <a id="19390" href="Soundness.html#19382" class="Bound">xⓇa</a>
<a id="19394" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="19412" class="Symbol">{</a><a id="19413" class="Argument">t</a> <a id="19415" class="Symbol">=</a> <a id="19417" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="19419" class="Symbol">(</a><a id="19420" href="SystemT.html#2777" class="InductiveConstructor Operator">`S</a> <a id="19423" href="Soundness.html#19423" class="Bound">x</a><a id="19424" class="Symbol">)}</a> <a id="19427" class="Symbol">{</a><a id="19428" class="Argument">σ</a> <a id="19430" class="Symbol">=</a> <a id="19432" class="Symbol">_</a> <a id="19434" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19436" class="Symbol">_}</a> <a id="19439" class="Symbol">{</a><a id="19440" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="19442" class="Symbol">_</a> <a id="19444" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="19446" class="Symbol">_</a> <a id="19448" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a><a id="19449" class="Symbol">}</a> <a id="19451" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="19453" href="Soundness.html#19453" class="Bound">σ∥Ⓡ∥ρ</a> <a id="19459" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="19461" class="Symbol">_</a> <a id="19463" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a> <a id="19465" class="Symbol">=</a>
  <a id="19469" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="19487" class="Symbol">{</a><a id="19488" class="Argument">t</a> <a id="19490" class="Symbol">=</a> <a id="19492" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="19494" href="Soundness.html#19423" class="Bound">x</a><a id="19495" class="Symbol">}</a> <a id="19497" href="Soundness.html#19453" class="Bound">σ∥Ⓡ∥ρ</a>
<a id="19503" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="19521" class="Symbol">{</a><a id="19522" class="Argument">t</a> <a id="19524" class="Symbol">=</a> <a id="19526" href="SystemT.html#3588" class="InductiveConstructor Operator">ƛ</a> <a id="19528" href="Soundness.html#19528" class="Bound">t</a><a id="19529" class="Symbol">}</a> <a id="19531" class="Symbol">{</a><a id="19532" class="Argument">σ</a> <a id="19534" class="Symbol">=</a> <a id="19536" href="Soundness.html#19536" class="Bound">σ</a><a id="19537" class="Symbol">}</a> <a id="19539" class="Symbol">{</a><a id="19540" href="Soundness.html#19540" class="Bound">ρ</a><a id="19541" class="Symbol">}</a> <a id="19543" href="Soundness.html#19543" class="Bound">σ∥Ⓡ∥ρ</a> <a id="19549" href="Soundness.html#19549" class="Bound">Γ′≤Γ</a> <a id="19554" class="Symbol">{</a><a id="19555" href="Soundness.html#19555" class="Bound">s</a><a id="19556" class="Symbol">}</a> <a id="19558" class="Symbol">{</a><a id="19559" href="Soundness.html#19559" class="Bound">a</a><a id="19560" class="Symbol">}</a> <a id="19562" href="Soundness.html#19562" class="Bound">sⓇa</a> <a id="19566" class="Symbol">=</a>
  <a id="19570" href="Soundness.html#4025" class="Function">==-Ⓡ-trans</a> <a id="19581" class="Symbol">(</a><a id="19582" href="SystemT.html#13417" class="InductiveConstructor">sym</a> <a id="19586" href="SystemT.html#12380" class="InductiveConstructor">β-ƛ</a><a id="19589" class="Symbol">)</a> <a id="19591" href="Soundness.html#20229" class="Function">t[σ′][s/x]Ⓡ⟦t⟧⟨ρ,a⟩</a>
  <a id="19613" class="Keyword">where</a>
    <a id="19623" href="Soundness.html#19623" class="Function">subst-lemma₁</a> <a id="19636" class="Symbol">=</a>
      <a id="19644" href="Lemmas.html#5175" class="Postulate">subst-compose</a> <a id="19658" class="Symbol">{</a><a id="19659" class="Argument">τ</a> <a id="19661" class="Symbol">=</a> <a id="19663" href="SystemT.html#10665" class="Function">id</a> <a id="19666" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19668" href="Soundness.html#19555" class="Bound">s</a><a id="19669" class="Symbol">}</a> <a id="19671" class="Symbol">{</a><a id="19672" href="SystemT.html#10200" class="Function">weaken</a> <a id="19679" href="Soundness.html#19549" class="Bound">Γ′≤Γ</a> <a id="19684" href="SystemT.html#9227" class="Function Operator">↑</a> <a id="19686" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19688" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="19690" href="SystemT.html#2712" class="InductiveConstructor">`Z</a><a id="19692" class="Symbol">}</a> <a id="19694" class="Symbol">{</a><a id="19695" href="Soundness.html#19528" class="Bound">t</a> <a id="19697" href="SystemT.html#9486" class="Function Operator">[</a> <a id="19699" href="Soundness.html#19536" class="Bound">σ</a> <a id="19701" href="SystemT.html#9227" class="Function Operator">↑</a> <a id="19703" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19705" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="19707" href="SystemT.html#2712" class="InductiveConstructor">`Z</a> <a id="19710" href="SystemT.html#9486" class="Function Operator">]</a><a id="19711" class="Symbol">}</a>
    <a id="19717" href="Soundness.html#19717" class="Function">subst-lemma₂</a> <a id="19730" class="Symbol">=</a>
     <a id="19737" href="Lemmas.html#5175" class="Postulate">subst-compose</a> <a id="19751" class="Symbol">{</a><a id="19752" class="Argument">τ</a> <a id="19754" class="Symbol">=</a> <a id="19756" class="Symbol">((</a><a id="19758" href="SystemT.html#10200" class="Function">weaken</a> <a id="19765" href="Soundness.html#19549" class="Bound">Γ′≤Γ</a> <a id="19770" href="SystemT.html#9227" class="Function Operator">↑</a><a id="19771" class="Symbol">)</a> <a id="19773" href="SystemT.html#9891" class="Function Operator">∘</a> <a id="19775" class="Symbol">(</a><a id="19776" href="SystemT.html#10665" class="Function">id</a> <a id="19779" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19781" href="Soundness.html#19555" class="Bound">s</a><a id="19782" class="Symbol">))</a> <a id="19785" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19787" href="Soundness.html#19555" class="Bound">s</a><a id="19788" class="Symbol">}</a> <a id="19790" class="Symbol">{</a><a id="19791" href="Soundness.html#19536" class="Bound">σ</a> <a id="19793" href="SystemT.html#9227" class="Function Operator">↑</a> <a id="19795" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19797" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="19799" href="SystemT.html#2712" class="InductiveConstructor">`Z</a><a id="19801" class="Symbol">}</a> <a id="19803" class="Symbol">{</a><a id="19804" href="Soundness.html#19528" class="Bound">t</a><a id="19805" class="Symbol">}</a>

    <a id="19812" href="Soundness.html#19812" class="Function">t[σ′]</a> <a id="19818" class="Symbol">=</a> <a id="19820" href="Soundness.html#19528" class="Bound">t</a> <a id="19822" href="SystemT.html#9486" class="Function Operator">[</a> <a id="19824" href="Soundness.html#19536" class="Bound">σ</a> <a id="19826" href="SystemT.html#9227" class="Function Operator">↑</a> <a id="19828" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19830" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="19832" href="SystemT.html#2712" class="InductiveConstructor">`Z</a> <a id="19835" href="SystemT.html#9486" class="Function Operator">]</a> <a id="19837" href="SystemT.html#9486" class="Function Operator">[</a> <a id="19839" href="SystemT.html#10200" class="Function">weaken</a> <a id="19846" href="Soundness.html#19549" class="Bound">Γ′≤Γ</a> <a id="19851" href="SystemT.html#9227" class="Function Operator">↑</a> <a id="19853" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="19855" href="SystemT.html#3528" class="InductiveConstructor Operator">`</a> <a id="19857" href="SystemT.html#2712" class="InductiveConstructor">`Z</a> <a id="19860" href="SystemT.html#9486" class="Function Operator">]</a>

    <a id="19867" href="Soundness.html#19867" class="Function">subst-lemma₃</a> <a id="19880" class="Symbol">=</a> <a id="19882" href="Lemmas.html#5329" class="Postulate">subst-compose-↑</a> <a id="19898" class="Symbol">{</a><a id="19899" class="Argument">τ</a> <a id="19901" class="Symbol">=</a> <a id="19903" href="SystemT.html#10665" class="Function">id</a><a id="19905" class="Symbol">}</a> <a id="19907" class="Symbol">{</a><a id="19908" href="SystemT.html#10200" class="Function">weaken</a> <a id="19915" href="Soundness.html#19549" class="Bound">Γ′≤Γ</a><a id="19919" class="Symbol">}</a> <a id="19921" class="Symbol">{</a><a id="19922" href="Soundness.html#19555" class="Bound">s</a><a id="19923" class="Symbol">}</a>
    <a id="19929" href="Soundness.html#19929" class="Function">subst-lemma₄</a> <a id="19942" class="Symbol">=</a> <a id="19944" href="Lemmas.html#5329" class="Postulate">subst-compose-↑</a> <a id="19960" class="Symbol">{</a><a id="19961" class="Argument">τ</a> <a id="19963" class="Symbol">=</a> <a id="19965" href="SystemT.html#10200" class="Function">weaken</a> <a id="19972" href="Soundness.html#19549" class="Bound">Γ′≤Γ</a> <a id="19977" href="SystemT.html#9891" class="Function Operator">∘</a> <a id="19979" href="SystemT.html#10665" class="Function">id</a><a id="19981" class="Symbol">}</a> <a id="19983" class="Symbol">{</a><a id="19984" href="Soundness.html#19536" class="Bound">σ</a><a id="19985" class="Symbol">}</a> <a id="19987" class="Symbol">{</a><a id="19988" href="Soundness.html#19555" class="Bound">s</a><a id="19989" class="Symbol">}</a>
    <a id="19995" href="Soundness.html#19995" class="Function">subst-lemma₅</a> <a id="20008" class="Symbol">=</a> <a id="20010" href="Lemmas.html#4947" class="Function">id-compose-identity</a> <a id="20030" class="Symbol">{</a><a id="20031" class="Argument">σ</a> <a id="20033" class="Symbol">=</a> <a id="20035" href="SystemT.html#10200" class="Function">weaken</a> <a id="20042" href="Soundness.html#19549" class="Bound">Γ′≤Γ</a><a id="20046" class="Symbol">}</a>

    <a id="20053" href="Soundness.html#20053" class="Function">σ″</a> <a id="20056" class="Symbol">=</a> <a id="20058" class="Symbol">((</a><a id="20060" href="Soundness.html#19536" class="Bound">σ</a> <a id="20062" href="SystemT.html#9227" class="Function Operator">↑</a><a id="20063" class="Symbol">)</a> <a id="20065" href="SystemT.html#9891" class="Function Operator">∘</a> <a id="20067" class="Symbol">(((</a><a id="20070" href="SystemT.html#10200" class="Function">weaken</a> <a id="20077" href="Soundness.html#19549" class="Bound">Γ′≤Γ</a> <a id="20082" href="SystemT.html#9227" class="Function Operator">↑</a><a id="20083" class="Symbol">)</a> <a id="20085" href="SystemT.html#9891" class="Function Operator">∘</a> <a id="20087" class="Symbol">(</a><a id="20088" href="SystemT.html#10665" class="Function">id</a> <a id="20091" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="20093" href="Soundness.html#19555" class="Bound">s</a><a id="20094" class="Symbol">))</a> <a id="20097" href="SystemT.html#5730" class="InductiveConstructor Operator">,</a> <a id="20099" href="Soundness.html#19555" class="Bound">s</a><a id="20100" class="Symbol">))</a>

    <a id="20108" href="Soundness.html#20108" class="Function">σ″Ⓡρ</a> <a id="20113" class="Symbol">:</a> <a id="20115" href="Soundness.html#20053" class="Function">σ″</a>  <a id="20119" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="20123" href="Soundness.html#19540" class="Bound">ρ</a>
    <a id="20129" href="Soundness.html#20108" class="Function">σ″Ⓡρ</a> <a id="20134" class="Keyword">rewrite</a> <a id="20142" href="Soundness.html#19867" class="Function">subst-lemma₃</a> <a id="20155" class="Symbol">|</a> <a id="20157" href="Soundness.html#19929" class="Function">subst-lemma₄</a> <a id="20170" class="Symbol">|</a> <a id="20172" href="Soundness.html#19995" class="Function">subst-lemma₅</a> <a id="20185" class="Symbol">=</a>
      <a id="20193" href="Soundness.html#18121" class="Function">∥Ⓡ∥-weaken</a> <a id="20204" class="Symbol">{</a><a id="20205" class="Argument">Γ′≤Γ</a> <a id="20210" class="Symbol">=</a> <a id="20212" href="Soundness.html#19549" class="Bound">Γ′≤Γ</a><a id="20216" class="Symbol">}</a> <a id="20218" href="Soundness.html#19543" class="Bound">σ∥Ⓡ∥ρ</a>

    <a id="20229" href="Soundness.html#20229" class="Function">t[σ′][s/x]Ⓡ⟦t⟧⟨ρ,a⟩</a> <a id="20249" class="Symbol">:</a> <a id="20251" href="Soundness.html#19812" class="Function">t[σ′]</a> <a id="20257" href="SystemT.html#11243" class="Function Operator">[</a> <a id="20259" href="Soundness.html#19555" class="Bound">s</a> <a id="20261" href="SystemT.html#11243" class="Function Operator">/x]</a> <a id="20265" href="Soundness.html#3477" class="Function Operator">Ⓡ</a> <a id="20267" href="NbE.html#12988" class="Function Operator">⟦⊢</a> <a id="20270" href="Soundness.html#19528" class="Bound">t</a> <a id="20272" href="NbE.html#12988" class="Function Operator">⟧</a> <a id="20274" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="20276" href="Soundness.html#19540" class="Bound">ρ</a> <a id="20278" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="20280" href="Soundness.html#19559" class="Bound">a</a> <a id="20282" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
    <a id="20288" href="Soundness.html#20229" class="Function">t[σ′][s/x]Ⓡ⟦t⟧⟨ρ,a⟩</a> <a id="20308" class="Keyword">rewrite</a> <a id="20316" href="Soundness.html#19623" class="Function">subst-lemma₁</a> <a id="20329" class="Symbol">|</a> <a id="20331" href="Soundness.html#19717" class="Function">subst-lemma₂</a> <a id="20344" class="Symbol">=</a>
        <a id="20354" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="20372" class="Symbol">{</a><a id="20373" class="Argument">t</a> <a id="20375" class="Symbol">=</a> <a id="20377" href="Soundness.html#19528" class="Bound">t</a><a id="20378" class="Symbol">}</a> <a id="20380" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="20382" href="Soundness.html#20108" class="Function">σ″Ⓡρ</a> <a id="20387" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="20389" href="Soundness.html#19562" class="Bound">sⓇa</a> <a id="20393" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
<a id="20395" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="20413" class="Symbol">{</a><a id="20414" class="Argument">t</a> <a id="20416" class="Symbol">=</a> <a id="20418" href="Soundness.html#20418" class="Bound">r</a> <a id="20420" href="SystemT.html#3662" class="InductiveConstructor Operator">·</a> <a id="20422" href="Soundness.html#20422" class="Bound">s</a><a id="20423" class="Symbol">}</a> <a id="20425" class="Symbol">{</a><a id="20426" class="Argument">σ</a> <a id="20428" class="Symbol">=</a> <a id="20430" href="Soundness.html#20430" class="Bound">σ</a><a id="20431" class="Symbol">}</a> <a id="20433" href="Soundness.html#20433" class="Bound">σ∥Ⓡ∥ρ</a>
  <a id="20441" class="Keyword">with</a> <a id="20446" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="20464" class="Symbol">{</a><a id="20465" class="Argument">t</a> <a id="20467" class="Symbol">=</a> <a id="20469" href="Soundness.html#20418" class="Bound">r</a><a id="20470" class="Symbol">}</a> <a id="20472" href="Soundness.html#20433" class="Bound">σ∥Ⓡ∥ρ</a> <a id="20478" class="Symbol">|</a> <a id="20480" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="20498" class="Symbol">{</a><a id="20499" class="Argument">t</a> <a id="20501" class="Symbol">=</a> <a id="20503" href="Soundness.html#20422" class="Bound">s</a><a id="20504" class="Symbol">}</a> <a id="20506" href="Soundness.html#20433" class="Bound">σ∥Ⓡ∥ρ</a>
<a id="20512" class="Symbol">...</a> <a id="20516" class="Symbol">|</a> <a id="20518" href="Soundness.html#20518" class="Bound">Γ⊨r</a>                              <a id="20551" class="Symbol">|</a> <a id="20553" href="Soundness.html#20553" class="Bound">Γ⊨s</a>
  <a id="20559" class="Keyword">with</a> <a id="20564" href="Soundness.html#20518" class="Bound">Γ⊨r</a> <a id="20568" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a> <a id="20573" href="Soundness.html#20553" class="Bound">Γ⊨s</a>
<a id="20577" class="Symbol">...</a> <a id="20581" class="Symbol">|</a> <a id="20583" href="Soundness.html#20583" class="Bound">pf</a>
  <a id="20588" class="Keyword">rewrite</a> <a id="20596" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="20610" class="Symbol">{</a><a id="20611" class="Argument">t</a> <a id="20613" class="Symbol">=</a> <a id="20615" class="Bound">r</a> <a id="20617" href="SystemT.html#9486" class="Function Operator">[</a> <a id="20619" class="Bound">σ</a> <a id="20621" href="SystemT.html#9486" class="Function Operator">]</a><a id="20622" class="Symbol">}</a> <a id="20624" class="Symbol">=</a> <a id="20626" href="Soundness.html#20583" class="Bound">pf</a>
</pre>
<p>For the identity substitution we have that
<code>Γ ⊢ id : Γ Ⓡ ↑Γ</code> , which we prove by induction using our
lemma that <code>Γ,x:T ⊢ x : T Ⓡ ↑ᵀ (𝓍ᵀ Γ)</code> for every variable
that we are substituting for itself.</p>
<pre class="Agda"><a id="idⓇ↑Γ"></a><a id="20839" href="Soundness.html#20839" class="Function">idⓇ↑Γ</a> <a id="20845" class="Symbol">:</a> <a id="20847" class="Symbol">∀</a> <a id="20849" class="Symbol">{</a><a id="20850" href="Soundness.html#20850" class="Bound">Γ</a> <a id="20852" class="Symbol">:</a> <a id="20854" href="SystemT.html#1272" class="Datatype">Γ</a><a id="20855" class="Symbol">}</a>
       <a id="20864" class="Symbol">→</a> <a id="20866" href="SystemT.html#10665" class="Function">id</a> <a id="20869" href="Soundness.html#16432" class="Function Operator">∥Ⓡ∥</a> <a id="20873" class="Symbol">(</a><a id="20874" href="NbE.html#11918" class="Function">↑Γ</a> <a id="20877" href="Soundness.html#20850" class="Bound">Γ</a><a id="20878" class="Symbol">)</a>
<a id="20880" href="Soundness.html#20839" class="Function">idⓇ↑Γ</a> <a id="20886" class="Symbol">{</a><a id="20887" href="SystemT.html#1288" class="InductiveConstructor">∅</a><a id="20888" class="Symbol">}</a> <a id="20890" class="Symbol">=</a> <a id="20892" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
</pre>
For our inductive step, our IH will give us that
<code>Γ ⊢ id : Γ Ⓡ ↑Γ Γ</code>, but we want proof that
<code>Γ , x:T ⊢ id ↑ : Γ Ⓡ Γ</code> (because the identity substitution
is unwrapped to <code>(id ↑ , x / x)</code> for the
context<code>Γ , x:T</code>). Here, we use our lemma that if a logical
relation holds for a substitution and an environment it holds for a
shifting of the substition, allowing us to transform our IH into our
goal
<pre class="Agda"><a id="21304" href="Soundness.html#20839" class="Function">idⓇ↑Γ</a> <a id="21310" class="Symbol">{</a><a id="21311" href="Soundness.html#21311" class="Bound">Γ</a> <a id="21313" href="SystemT.html#1296" class="InductiveConstructor Operator">,</a> <a id="21315" href="Soundness.html#21315" class="Bound">T</a><a id="21316" class="Symbol">}</a> <a id="21318" class="Symbol">=</a> <a id="21320" href="Soundness.html#256" class="InductiveConstructor Operator">⟨</a> <a id="21322" href="Soundness.html#17346" class="Function">∥Ⓡ∥-↑</a> <a id="21328" class="Symbol">{</a><a id="21329" class="Argument">T</a> <a id="21331" class="Symbol">=</a> <a id="21333" href="Soundness.html#21315" class="Bound">T</a><a id="21334" class="Symbol">}</a> <a id="21336" href="Soundness.html#20839" class="Function">idⓇ↑Γ</a> <a id="21342" href="Soundness.html#256" class="InductiveConstructor Operator">,</a> <a id="21344" href="Soundness.html#6689" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="21351" href="Soundness.html#256" class="InductiveConstructor Operator">⟩</a>
</pre>
<p>With this fact, we arrive at the soundness of NbE. By the fundamental
lemma, given <code>Γ ⊢ id : Γ Ⓡ ↑Γ</code>, we have that
<code>Γ ⊢ t [ id ] Ⓡ ⟦ t ⟧ ↑Γ</code> – and
<code>t [ id ] ≡ t</code>.</p>
Using the lemma that logical relation implies definitional equality to
the reified semantic object, we arrive at
<code>Γ ⊢ t = ↓ᵀᵧ ⟦ t ⟧ ↑Γ : T</code>, which is what we want to show
(i.e. <code>Γ ⊢ t = nf(t) : T</code>)
<pre class="Agda"><a id="soundness"></a><a id="21729" href="Soundness.html#21729" class="Function">soundness</a> <a id="21739" class="Symbol">:</a> <a id="21741" class="Symbol">∀</a> <a id="21743" class="Symbol">{</a><a id="21744" href="Soundness.html#21744" class="Bound">Γ</a> <a id="21746" class="Symbol">:</a> <a id="21748" href="SystemT.html#1272" class="Datatype">Γ</a><a id="21749" class="Symbol">}</a> <a id="21751" class="Symbol">{</a><a id="21752" href="Soundness.html#21752" class="Bound">T</a> <a id="21754" class="Symbol">:</a> <a id="21756" href="SystemT.html#561" class="Datatype">Type</a><a id="21760" class="Symbol">}</a> <a id="21762" class="Symbol">{</a><a id="21763" href="Soundness.html#21763" class="Bound">t</a> <a id="21765" class="Symbol">:</a> <a id="21767" href="Soundness.html#21744" class="Bound">Γ</a> <a id="21769" href="SystemT.html#3345" class="Datatype Operator">⊢</a> <a id="21771" href="Soundness.html#21752" class="Bound">T</a><a id="21772" class="Symbol">}</a>
          <a id="21784" class="Symbol">→</a> <a id="21786" href="Soundness.html#21763" class="Bound">t</a> <a id="21788" href="SystemT.html#11908" class="Datatype Operator">==</a> <a id="21791" href="NbE.html#13351" class="Function">nf</a> <a id="21794" href="Soundness.html#21763" class="Bound">t</a>
<a id="21796" href="Soundness.html#21729" class="Function">soundness</a> <a id="21806" class="Symbol">{</a><a id="21807" href="Soundness.html#21807" class="Bound">Γ</a><a id="21808" class="Symbol">}</a> <a id="21810" class="Symbol">{</a><a id="21811" href="Soundness.html#21811" class="Bound">T</a><a id="21812" class="Symbol">}</a> <a id="21814" class="Symbol">{</a><a id="21815" href="Soundness.html#21815" class="Bound">t</a><a id="21816" class="Symbol">}</a>
  <a id="21820" class="Keyword">with</a> <a id="21825" href="Soundness.html#18864" class="Function">fundamental-lemma</a> <a id="21843" class="Symbol">{</a><a id="21844" class="Argument">t</a> <a id="21846" class="Symbol">=</a> <a id="21848" href="Soundness.html#21815" class="Bound">t</a><a id="21849" class="Symbol">}</a> <a id="21851" class="Symbol">(</a><a id="21852" href="Soundness.html#20839" class="Function">idⓇ↑Γ</a> <a id="21858" class="Symbol">{</a><a id="21859" href="Soundness.html#21807" class="Bound">Γ</a><a id="21860" class="Symbol">})</a>
<a id="21863" class="Symbol">...</a> <a id="21867" class="Symbol">|</a> <a id="21869" href="Soundness.html#21869" class="Bound">tⓇ⟦t⟧↑Γ</a>
  <a id="21879" class="Keyword">with</a> <a id="21884" href="Soundness.html#6359" class="Function">Ⓡ-==↓</a> <a id="21890" href="Soundness.html#21869" class="Bound">tⓇ⟦t⟧↑Γ</a> <a id="21898" href="SystemT.html#2044" class="InductiveConstructor">≤-id</a>
<a id="21903" class="Symbol">...</a> <a id="21907" class="Symbol">|</a> <a id="21909" href="Soundness.html#21909" class="Bound">t==↓ᵀᵧ⟦t⟧↑Γ</a>
  <a id="21923" class="Keyword">rewrite</a> <a id="21931" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="21945" class="Symbol">{</a><a id="21946" class="Argument">t</a> <a id="21948" class="Symbol">=</a> <a id="21950" class="Bound">t</a> <a id="21952" href="SystemT.html#9486" class="Function Operator">[</a> <a id="21954" href="SystemT.html#10665" class="Function">id</a> <a id="21957" href="SystemT.html#9486" class="Function Operator">]</a><a id="21958" class="Symbol">}</a> <a id="21960" class="Symbol">|</a> <a id="21962" href="Lemmas.html#4442" class="Function">[id]-identity</a> <a id="21976" class="Symbol">{</a><a id="21977" class="Argument">t</a> <a id="21979" class="Symbol">=</a> <a id="21981" class="Bound">t</a><a id="21982" class="Symbol">}</a> <a id="21984" class="Symbol">=</a> <a id="21986" href="Soundness.html#21909" class="Bound">t==↓ᵀᵧ⟦t⟧↑Γ</a>
</pre>
</body>
</html>
