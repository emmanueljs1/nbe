---
title: "Normalization by Evaluation"
author: Emmanuel Suárez Acevedo
---

This is a formalization of Chapter 2 of Andreas Abel's habilitation thesis, "Normalization by Evaluation: Dependent Types and Impredicativity". [@nbe].

We start off by defining the language that we will
use to showcase normalization by evaluation, System T,
as is done in Section 2.1.
<pre class="Agda"><a id="373" class="Keyword">import</a> <a id="380" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="418" class="Symbol">as</a> <a id="421" class="Module">Eq</a>
<a id="424" class="Keyword">open</a> <a id="429" class="Keyword">import</a> <a id="436" href="Data.Empty.html" class="Module">Data.Empty</a> <a id="447" class="Keyword">using</a> <a id="453" class="Symbol">(</a><a id="454" href="Data.Empty.html#526" class="Datatype">⊥</a><a id="455" class="Symbol">;</a> <a id="457" href="Data.Empty.html#628" class="Function">⊥-elim</a><a id="463" class="Symbol">)</a>
<a id="465" class="Keyword">open</a> <a id="470" class="Keyword">import</a> <a id="477" href="Data.Unit.html" class="Module">Data.Unit</a> <a id="487" class="Keyword">using</a> <a id="493" class="Symbol">(</a><a id="494" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a><a id="495" class="Symbol">;</a> <a id="497" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a><a id="499" class="Symbol">)</a>
<a id="501" class="Keyword">open</a> <a id="506" class="Keyword">import</a> <a id="513" href="Data.Sum.html" class="Module">Data.Sum</a> <a id="522" class="Keyword">using</a> <a id="528" class="Symbol">(</a><a id="529" href="Data.Sum.Base.html#734" class="Datatype Operator">_⊎_</a><a id="532" class="Symbol">;</a> <a id="534" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a><a id="538" class="Symbol">;</a> <a id="540" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a><a id="544" class="Symbol">)</a>
<a id="546" class="Keyword">open</a> <a id="551" class="Keyword">import</a> <a id="558" href="Data.Product.html" class="Module">Data.Product</a> <a id="571" class="Keyword">using</a> <a id="577" class="Symbol">(</a><a id="578" href="Data.Product.html#1167" class="Function Operator">_×_</a><a id="581" class="Symbol">;</a> <a id="583" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a><a id="588" class="Symbol">;</a> <a id="590" href="Data.Product.html#1369" class="Function">∃</a><a id="591" class="Symbol">;</a> <a id="593" href="Data.Product.html#1806" class="Function">∃-syntax</a><a id="601" class="Symbol">)</a> <a id="603" class="Keyword">renaming</a> <a id="612" class="Symbol">(</a><a id="613" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="617" class="Symbol">to</a> <a id="620" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="625" class="Symbol">)</a>
<a id="627" class="Keyword">open</a> <a id="632" class="Keyword">import</a> <a id="639" href="Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="656" class="Keyword">using</a> <a id="662" class="Symbol">(</a><a id="663" href="Relation.Nullary.html#1511" class="Record">Dec</a><a id="666" class="Symbol">;</a> <a id="668" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a><a id="671" class="Symbol">;</a> <a id="673" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a><a id="675" class="Symbol">;</a> <a id="677" href="Relation.Nullary.html#656" class="Function Operator">¬_</a><a id="679" class="Symbol">)</a>
<a id="681" class="Keyword">open</a> <a id="686" href="Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="689" class="Keyword">using</a> <a id="695" class="Symbol">(</a><a id="696" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="699" class="Symbol">;</a> <a id="701" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="705" class="Symbol">)</a>
<a id="707" class="Keyword">open</a> <a id="712" href="Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="715" class="Keyword">using</a> <a id="721" class="Symbol">(</a><a id="722" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="726" class="Symbol">;</a> <a id="728" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="731" class="Symbol">)</a> <a id="733" class="Keyword">renaming</a> <a id="742" class="Symbol">(</a><a id="743" href="Relation.Binary.PropositionalEquality.Core.html#1684" class="Function">sym</a> <a id="747" class="Symbol">to</a> <a id="750" class="Function">≡-sym</a><a id="755" class="Symbol">;</a> <a id="757" href="Relation.Binary.PropositionalEquality.Core.html#1729" class="Function">trans</a> <a id="763" class="Symbol">to</a> <a id="766" class="Function">≡-trans</a><a id="773" class="Symbol">)</a>

<a id="776" class="Keyword">module</a> <a id="783" href="NbE.html" class="Module">NbE</a> <a id="787" class="Keyword">where</a>
</pre>
It has natural numbers, higher-order functions, and
primitive recursion. We will define it with intrinsic
typing, and use a de Brujin index representation
for variables.

We start off with the types of tha language: naturals
and functions.
<pre class="Agda"><a id="1046" class="Keyword">data</a> <a id="Type"></a><a id="1051" href="NbE.html#1051" class="Datatype">Type</a> <a id="1056" class="Symbol">:</a> <a id="1058" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1062" class="Keyword">where</a>
  <a id="Type.nat"></a><a id="1070" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="1074" class="Symbol">:</a> <a id="1076" href="NbE.html#1051" class="Datatype">Type</a>
  <a id="Type._⇒_"></a><a id="1083" href="NbE.html#1083" class="InductiveConstructor Operator">_⇒_</a> <a id="1087" class="Symbol">:</a> <a id="1089" class="Symbol">∀</a> <a id="1091" class="Symbol">(</a><a id="1092" href="NbE.html#1092" class="Bound">S</a> <a id="1094" href="NbE.html#1094" class="Bound">T</a> <a id="1096" class="Symbol">:</a> <a id="1098" href="NbE.html#1051" class="Datatype">Type</a><a id="1102" class="Symbol">)</a> <a id="1104" class="Symbol">→</a> <a id="1106" href="NbE.html#1051" class="Datatype">Type</a>

<a id="1112" class="Keyword">infixr</a> <a id="1119" class="Number">7</a> <a id="1121" href="NbE.html#1083" class="InductiveConstructor Operator">_⇒_</a>

<a id="_≟Tp_"></a><a id="1126" href="NbE.html#1126" class="Function Operator">_≟Tp_</a> <a id="1132" class="Symbol">:</a> <a id="1134" class="Symbol">∀</a> <a id="1136" class="Symbol">(</a><a id="1137" href="NbE.html#1137" class="Bound">S</a> <a id="1139" href="NbE.html#1139" class="Bound">T</a> <a id="1141" class="Symbol">:</a> <a id="1143" href="NbE.html#1051" class="Datatype">Type</a><a id="1147" class="Symbol">)</a> <a id="1149" class="Symbol">→</a> <a id="1151" href="Relation.Nullary.html#1511" class="Record">Dec</a> <a id="1155" class="Symbol">(</a><a id="1156" href="NbE.html#1137" class="Bound">S</a> <a id="1158" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1160" href="NbE.html#1139" class="Bound">T</a><a id="1161" class="Symbol">)</a>
<a id="1163" href="NbE.html#1070" class="InductiveConstructor">nat</a>       <a id="1173" href="NbE.html#1126" class="Function Operator">≟Tp</a> <a id="1177" href="NbE.html#1070" class="InductiveConstructor">nat</a>                                  <a id="1214" class="Symbol">=</a> <a id="1216" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="1220" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="1225" href="NbE.html#1070" class="InductiveConstructor">nat</a>       <a id="1235" href="NbE.html#1126" class="Function Operator">≟Tp</a> <a id="1239" class="Symbol">(</a><a id="1240" href="NbE.html#1240" class="Bound">S</a> <a id="1242" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="1244" href="NbE.html#1244" class="Bound">T</a><a id="1245" class="Symbol">)</a>                              <a id="1276" class="Symbol">=</a> <a id="1278" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="1281" class="Symbol">λ()</a>
<a id="1285" class="Symbol">(</a><a id="1286" href="NbE.html#1286" class="Bound">S₁</a> <a id="1289" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="1291" href="NbE.html#1291" class="Bound">T₁</a><a id="1293" class="Symbol">)</a> <a id="1295" href="NbE.html#1126" class="Function Operator">≟Tp</a> <a id="1299" href="NbE.html#1070" class="InductiveConstructor">nat</a>                                  <a id="1336" class="Symbol">=</a> <a id="1338" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="1341" class="Symbol">λ()</a>
<a id="1345" class="Symbol">(</a><a id="1346" href="NbE.html#1346" class="Bound">S₁</a> <a id="1349" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="1351" href="NbE.html#1351" class="Bound">T₁</a><a id="1353" class="Symbol">)</a> <a id="1355" href="NbE.html#1126" class="Function Operator">≟Tp</a> <a id="1359" class="Symbol">(</a><a id="1360" href="NbE.html#1360" class="Bound">S₂</a> <a id="1363" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="1365" href="NbE.html#1365" class="Bound">T₂</a><a id="1367" class="Symbol">)</a> <a id="1369" class="Keyword">with</a> <a id="1374" href="NbE.html#1346" class="Bound">S₁</a> <a id="1377" href="NbE.html#1126" class="Function Operator">≟Tp</a> <a id="1381" href="NbE.html#1360" class="Bound">S₂</a> <a id="1384" class="Symbol">|</a> <a id="1386" href="NbE.html#1351" class="Bound">T₁</a> <a id="1389" href="NbE.html#1126" class="Function Operator">≟Tp</a> <a id="1393" href="NbE.html#1365" class="Bound">T₂</a>
<a id="1396" class="Symbol">...</a>                        <a id="1423" class="Symbol">|</a> <a id="1425" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="1428" href="NbE.html#1428" class="Bound">¬pf</a>    <a id="1435" class="Symbol">|</a> <a id="1437" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="1440" class="Symbol">_</a>      <a id="1447" class="Symbol">=</a> <a id="1449" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="1452" class="Symbol">λ{</a><a id="1454" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="1459" class="Symbol">→</a> <a id="1461" href="NbE.html#1428" class="Bound">¬pf</a> <a id="1465" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="1469" class="Symbol">}</a>
<a id="1471" class="Symbol">...</a>                        <a id="1498" class="Symbol">|</a> <a id="1500" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="1503" href="NbE.html#1503" class="Bound">¬pf</a>    <a id="1510" class="Symbol">|</a> <a id="1512" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="1516" class="Symbol">_</a>     <a id="1522" class="Symbol">=</a> <a id="1524" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="1527" class="Symbol">λ{</a><a id="1529" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="1534" class="Symbol">→</a> <a id="1536" href="NbE.html#1503" class="Bound">¬pf</a> <a id="1540" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="1544" class="Symbol">}</a>
<a id="1546" class="Symbol">...</a>                        <a id="1573" class="Symbol">|</a> <a id="1575" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="1579" class="Symbol">_</a>     <a id="1585" class="Symbol">|</a> <a id="1587" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="1590" href="NbE.html#1590" class="Bound">¬pf</a>    <a id="1597" class="Symbol">=</a> <a id="1599" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="1602" class="Symbol">λ{</a><a id="1604" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="1609" class="Symbol">→</a> <a id="1611" href="NbE.html#1590" class="Bound">¬pf</a> <a id="1615" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="1619" class="Symbol">}</a>
<a id="1621" class="Symbol">...</a>                        <a id="1648" class="Symbol">|</a> <a id="1650" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="1654" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>  <a id="1660" class="Symbol">|</a> <a id="1662" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="1666" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>  <a id="1672" class="Symbol">=</a> <a id="1674" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="1678" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
We continue with typing contexts, defined inductively
with the empty context, and extensions to contexts. As
we are using a de Brujin index representation, there
are no names when extending contexts (and really they
are just lists of types).
<pre class="Agda"><a id="1938" class="Keyword">data</a> <a id="Ctx"></a><a id="1943" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="1947" class="Symbol">:</a> <a id="1949" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1953" class="Keyword">where</a>
  <a id="Ctx.∅"></a><a id="1961" href="NbE.html#1961" class="InductiveConstructor">∅</a> <a id="1963" class="Symbol">:</a> <a id="1965" href="NbE.html#1943" class="Datatype">Ctx</a>
  <a id="Ctx._,_"></a><a id="1971" href="NbE.html#1971" class="InductiveConstructor Operator">_,_</a> <a id="1975" class="Symbol">:</a> <a id="1977" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="1981" class="Symbol">→</a> <a id="1983" href="NbE.html#1051" class="Datatype">Type</a> <a id="1988" class="Symbol">→</a> <a id="1990" href="NbE.html#1943" class="Datatype">Ctx</a>

<a id="1995" class="Keyword">infixl</a> <a id="2002" class="Number">5</a> <a id="2004" href="NbE.html#1971" class="InductiveConstructor Operator">_,_</a>

<a id="_≟Ctx_"></a><a id="2009" href="NbE.html#2009" class="Function Operator">_≟Ctx_</a> <a id="2016" class="Symbol">:</a> <a id="2018" class="Symbol">∀</a> <a id="2020" class="Symbol">(</a><a id="2021" href="NbE.html#2021" class="Bound">Γ′</a> <a id="2024" href="NbE.html#2024" class="Bound">Γ</a> <a id="2026" class="Symbol">:</a> <a id="2028" href="NbE.html#1943" class="Datatype">Ctx</a><a id="2031" class="Symbol">)</a> <a id="2033" class="Symbol">→</a> <a id="2035" href="Relation.Nullary.html#1511" class="Record">Dec</a> <a id="2039" class="Symbol">(</a><a id="2040" href="NbE.html#2021" class="Bound">Γ′</a> <a id="2043" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="2045" href="NbE.html#2024" class="Bound">Γ</a><a id="2046" class="Symbol">)</a>
<a id="2048" href="NbE.html#1961" class="InductiveConstructor">∅</a>       <a id="2056" href="NbE.html#2009" class="Function Operator">≟Ctx</a> <a id="2061" href="NbE.html#1961" class="InductiveConstructor">∅</a>                                  <a id="2096" class="Symbol">=</a> <a id="2098" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="2102" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="2107" href="NbE.html#1961" class="InductiveConstructor">∅</a>       <a id="2115" href="NbE.html#2009" class="Function Operator">≟Ctx</a> <a id="2120" class="Symbol">(_</a> <a id="2123" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="2125" class="Symbol">_)</a>                            <a id="2155" class="Symbol">=</a> <a id="2157" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="2160" class="Symbol">λ()</a>
<a id="2164" class="Symbol">(_</a> <a id="2167" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="2169" class="Symbol">_)</a> <a id="2172" href="NbE.html#2009" class="Function Operator">≟Ctx</a> <a id="2177" href="NbE.html#1961" class="InductiveConstructor">∅</a>                                  <a id="2212" class="Symbol">=</a> <a id="2214" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="2217" class="Symbol">λ()</a>
<a id="2221" class="Symbol">(</a><a id="2222" href="NbE.html#2222" class="Bound">Γ′</a> <a id="2225" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="2227" href="NbE.html#2227" class="Bound">S</a><a id="2228" class="Symbol">)</a> <a id="2230" href="NbE.html#2009" class="Function Operator">≟Ctx</a> <a id="2235" class="Symbol">(</a><a id="2236" href="NbE.html#2236" class="Bound">Γ</a> <a id="2238" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="2240" href="NbE.html#2240" class="Bound">T</a><a id="2241" class="Symbol">)</a> <a id="2243" class="Keyword">with</a> <a id="2248" href="NbE.html#2222" class="Bound">Γ′</a> <a id="2251" href="NbE.html#2009" class="Function Operator">≟Ctx</a> <a id="2256" href="NbE.html#2236" class="Bound">Γ</a> <a id="2258" class="Symbol">|</a> <a id="2260" href="NbE.html#2227" class="Bound">S</a> <a id="2262" href="NbE.html#1126" class="Function Operator">≟Tp</a> <a id="2266" href="NbE.html#2240" class="Bound">T</a>
<a id="2268" class="Symbol">...</a>                      <a id="2293" class="Symbol">|</a> <a id="2295" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="2298" href="NbE.html#2298" class="Bound">¬pf</a>    <a id="2305" class="Symbol">|</a> <a id="2307" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="2310" class="Symbol">_</a>     <a id="2316" class="Symbol">=</a> <a id="2318" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="2321" class="Symbol">λ{</a><a id="2323" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="2328" class="Symbol">→</a> <a id="2330" href="NbE.html#2298" class="Bound">¬pf</a> <a id="2334" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="2338" class="Symbol">}</a>
<a id="2340" class="Symbol">...</a>                      <a id="2365" class="Symbol">|</a> <a id="2367" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="2370" href="NbE.html#2370" class="Bound">¬pf</a>    <a id="2377" class="Symbol">|</a> <a id="2379" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="2383" class="Symbol">_</a>    <a id="2388" class="Symbol">=</a> <a id="2390" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="2393" class="Symbol">λ{</a><a id="2395" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="2400" class="Symbol">→</a> <a id="2402" href="NbE.html#2370" class="Bound">¬pf</a> <a id="2406" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="2410" class="Symbol">}</a>
<a id="2412" class="Symbol">...</a>                      <a id="2437" class="Symbol">|</a> <a id="2439" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="2443" class="Symbol">_</a>     <a id="2449" class="Symbol">|</a> <a id="2451" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="2454" href="NbE.html#2454" class="Bound">¬pf</a>   <a id="2460" class="Symbol">=</a> <a id="2462" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="2465" class="Symbol">λ{</a><a id="2467" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="2472" class="Symbol">→</a> <a id="2474" href="NbE.html#2454" class="Bound">¬pf</a> <a id="2478" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="2482" class="Symbol">}</a>
<a id="2484" class="Symbol">...</a>                      <a id="2509" class="Symbol">|</a> <a id="2511" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="2515" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>  <a id="2521" class="Symbol">|</a> <a id="2523" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="2527" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="2532" class="Symbol">=</a> <a id="2534" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="2538" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
We also define a relation detailing when one context is the
extension of another, this is introduced formally in a later
section but will be useful throughout. A context is an extension
of itself, and given that one context Γ′ extends another context
Γ, the first can be extended further and the relation will still hold.
<pre class="Agda"><a id="2878" class="Keyword">data</a> <a id="_≤_"></a><a id="2883" href="NbE.html#2883" class="Datatype Operator">_≤_</a> <a id="2887" class="Symbol">:</a> <a id="2889" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="2893" class="Symbol">→</a> <a id="2895" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="2899" class="Symbol">→</a> <a id="2901" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2905" class="Keyword">where</a>
  <a id="_≤_.≤-id"></a><a id="2913" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="2918" class="Symbol">:</a> <a id="2920" class="Symbol">∀</a> <a id="2922" class="Symbol">{</a><a id="2923" href="NbE.html#2923" class="Bound">Γ</a> <a id="2925" class="Symbol">:</a> <a id="2927" href="NbE.html#1943" class="Datatype">Ctx</a><a id="2930" class="Symbol">}</a> <a id="2932" class="Symbol">→</a> <a id="2934" href="NbE.html#2923" class="Bound">Γ</a> <a id="2936" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="2938" href="NbE.html#2923" class="Bound">Γ</a>

  <a id="_≤_.≤-ext"></a><a id="2943" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="2949" class="Symbol">:</a> <a id="2951" class="Symbol">∀</a> <a id="2953" class="Symbol">{</a><a id="2954" href="NbE.html#2954" class="Bound">Γ</a> <a id="2956" href="NbE.html#2956" class="Bound">Γ′</a> <a id="2959" class="Symbol">:</a> <a id="2961" href="NbE.html#1943" class="Datatype">Ctx</a><a id="2964" class="Symbol">}</a> <a id="2966" class="Symbol">{</a><a id="2967" href="NbE.html#2967" class="Bound">T</a> <a id="2969" class="Symbol">:</a> <a id="2971" href="NbE.html#1051" class="Datatype">Type</a><a id="2975" class="Symbol">}</a>
        <a id="2985" class="Symbol">→</a> <a id="2987" href="NbE.html#2956" class="Bound">Γ′</a> <a id="2990" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="2992" href="NbE.html#2954" class="Bound">Γ</a>
          <a id="3004" class="Comment">----------</a>
        <a id="3023" class="Symbol">→</a> <a id="3025" href="NbE.html#2956" class="Bound">Γ′</a> <a id="3028" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="3030" href="NbE.html#2967" class="Bound">T</a> <a id="3032" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="3034" href="NbE.html#2954" class="Bound">Γ</a>

<a id="3037" class="Keyword">infix</a> <a id="3043" class="Number">4</a> <a id="3045" href="NbE.html#2883" class="Datatype Operator">_≤_</a>

<a id="Γ≤∅"></a><a id="3050" href="NbE.html#3050" class="Function">Γ≤∅</a> <a id="3054" class="Symbol">:</a> <a id="3056" class="Symbol">∀</a> <a id="3058" class="Symbol">{</a><a id="3059" href="NbE.html#3059" class="Bound">Γ</a> <a id="3061" class="Symbol">:</a> <a id="3063" href="NbE.html#1943" class="Datatype">Ctx</a><a id="3066" class="Symbol">}</a> <a id="3068" class="Symbol">→</a> <a id="3070" href="NbE.html#3059" class="Bound">Γ</a> <a id="3072" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="3074" href="NbE.html#1961" class="InductiveConstructor">∅</a>
<a id="3076" href="NbE.html#3050" class="Function">Γ≤∅</a> <a id="3080" class="Symbol">{</a><a id="3081" href="NbE.html#1961" class="InductiveConstructor">∅</a><a id="3082" class="Symbol">}</a> <a id="3084" class="Symbol">=</a> <a id="3086" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
<a id="3091" href="NbE.html#3050" class="Function">Γ≤∅</a> <a id="3095" class="Symbol">{</a><a id="3096" href="NbE.html#3096" class="Bound">Γ</a> <a id="3098" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="3100" class="Symbol">_}</a> <a id="3103" class="Keyword">with</a> <a id="3108" href="NbE.html#3050" class="Function">Γ≤∅</a> <a id="3112" class="Symbol">{</a><a id="3113" href="NbE.html#3096" class="Bound">Γ</a><a id="3114" class="Symbol">}</a>
<a id="3116" class="Symbol">...</a>            <a id="3131" class="Symbol">|</a> <a id="3133" href="NbE.html#3133" class="Bound">pf</a>      <a id="3141" class="Symbol">=</a> <a id="3143" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="3149" href="NbE.html#3133" class="Bound">pf</a>

<a id="_≤?_"></a><a id="3153" href="NbE.html#3153" class="Function Operator">_≤?_</a> <a id="3158" class="Symbol">:</a> <a id="3160" class="Symbol">∀</a> <a id="3162" class="Symbol">(</a><a id="3163" href="NbE.html#3163" class="Bound">Γ′</a> <a id="3166" href="NbE.html#3166" class="Bound">Γ</a> <a id="3168" class="Symbol">:</a> <a id="3170" href="NbE.html#1943" class="Datatype">Ctx</a><a id="3173" class="Symbol">)</a> <a id="3175" class="Symbol">→</a> <a id="3177" href="Relation.Nullary.html#1511" class="Record">Dec</a> <a id="3181" class="Symbol">(</a><a id="3182" href="NbE.html#3163" class="Bound">Γ′</a> <a id="3185" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="3187" href="NbE.html#3166" class="Bound">Γ</a><a id="3188" class="Symbol">)</a>
<a id="3190" href="NbE.html#1961" class="InductiveConstructor">∅</a>        <a id="3199" href="NbE.html#3153" class="Function Operator">≤?</a> <a id="3202" href="NbE.html#1961" class="InductiveConstructor">∅</a>          <a id="3213" class="Symbol">=</a> <a id="3215" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="3219" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
<a id="3224" href="NbE.html#1961" class="InductiveConstructor">∅</a>        <a id="3233" href="NbE.html#3153" class="Function Operator">≤?</a> <a id="3236" class="Symbol">(_</a> <a id="3239" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="3241" class="Symbol">_)</a>    <a id="3247" class="Symbol">=</a> <a id="3249" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="3252" class="Symbol">λ()</a>
<a id="3256" class="Symbol">(_</a> <a id="3259" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="3261" class="Symbol">_)</a>  <a id="3265" href="NbE.html#3153" class="Function Operator">≤?</a> <a id="3268" href="NbE.html#1961" class="InductiveConstructor">∅</a>          <a id="3279" class="Symbol">=</a> <a id="3281" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="3285" href="NbE.html#3050" class="Function">Γ≤∅</a>
<a id="3289" class="Symbol">(</a><a id="3290" href="NbE.html#3290" class="Bound">Γ′</a> <a id="3293" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="3295" href="NbE.html#3295" class="Bound">T</a><a id="3296" class="Symbol">)</a> <a id="3298" href="NbE.html#3153" class="Function Operator">≤?</a> <a id="3301" href="NbE.html#3301" class="Bound">Γ</a><a id="3302" class="Symbol">@(_</a> <a id="3306" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="3308" class="Symbol">_)</a>
  <a id="3313" class="Keyword">with</a> <a id="3318" class="Symbol">(</a><a id="3319" href="NbE.html#3290" class="Bound">Γ′</a> <a id="3322" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="3324" href="NbE.html#3295" class="Bound">T</a><a id="3325" class="Symbol">)</a> <a id="3327" href="NbE.html#2009" class="Function Operator">≟Ctx</a> <a id="3332" href="NbE.html#3301" class="Bound">Γ</a>
<a id="3334" class="Symbol">...</a>  <a id="3339" class="Symbol">|</a> <a id="3341" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="3345" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>        <a id="3357" class="Symbol">=</a> <a id="3359" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="3363" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
<a id="3368" class="Symbol">...</a>  <a id="3373" class="Symbol">|</a> <a id="3375" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="3378" href="NbE.html#3378" class="Bound">Γ′≢Γ</a>
  <a id="3385" class="Keyword">with</a> <a id="3390" class="Bound">Γ′</a> <a id="3393" href="NbE.html#3153" class="Function Operator">≤?</a> <a id="3396" class="Bound">Γ</a>
<a id="3398" class="Symbol">...</a>  <a id="3403" class="Symbol">|</a> <a id="3405" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="3409" href="NbE.html#3409" class="Bound">pf</a>          <a id="3421" class="Symbol">=</a> <a id="3423" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="3427" class="Symbol">(</a><a id="3428" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="3434" href="NbE.html#3409" class="Bound">pf</a><a id="3436" class="Symbol">)</a>
<a id="3438" class="Symbol">...</a>  <a id="3443" class="Symbol">|</a> <a id="3445" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="3448" href="NbE.html#3448" class="Bound">¬pf</a>          <a id="3461" class="Symbol">=</a> <a id="3463" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="3466" class="Symbol">λ</a> <a id="3468" class="Keyword">where</a>
                           <a id="3501" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="3506" class="Symbol">→</a> <a id="3508" class="Bound">Γ′≢Γ</a> <a id="3513" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
                           <a id="3545" class="Symbol">(</a><a id="3546" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="3552" href="NbE.html#3552" class="Bound">pf</a><a id="3554" class="Symbol">)</a> <a id="3556" class="Symbol">→</a> <a id="3558" href="NbE.html#3448" class="Bound">¬pf</a> <a id="3562" href="NbE.html#3552" class="Bound">pf</a>
</pre>
We also introduce a lookup judgement for
contexts, which corresponds to a de Brujin
index.
<pre class="Agda"><a id="3669" class="Keyword">data</a> <a id="_∋_"></a><a id="3674" href="NbE.html#3674" class="Datatype Operator">_∋_</a> <a id="3678" class="Symbol">:</a> <a id="3680" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="3684" class="Symbol">→</a> <a id="3686" href="NbE.html#1051" class="Datatype">Type</a> <a id="3691" class="Symbol">→</a> <a id="3693" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="3697" class="Keyword">where</a>
  <a id="_∋_.`Z"></a><a id="3705" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="3708" class="Symbol">:</a> <a id="3710" class="Symbol">∀</a> <a id="3712" class="Symbol">{</a><a id="3713" href="NbE.html#3713" class="Bound">Γ</a> <a id="3715" class="Symbol">:</a> <a id="3717" href="NbE.html#1943" class="Datatype">Ctx</a><a id="3720" class="Symbol">}</a> <a id="3722" class="Symbol">{</a><a id="3723" href="NbE.html#3723" class="Bound">T</a> <a id="3725" class="Symbol">:</a> <a id="3727" href="NbE.html#1051" class="Datatype">Type</a><a id="3731" class="Symbol">}</a>
        <a id="3741" class="Comment">---------</a>
      <a id="3757" class="Symbol">→</a> <a id="3759" href="NbE.html#3713" class="Bound">Γ</a> <a id="3761" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="3763" href="NbE.html#3723" class="Bound">T</a> <a id="3765" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="3767" href="NbE.html#3723" class="Bound">T</a>

  <a id="_∋_.`S_"></a><a id="3772" href="NbE.html#3772" class="InductiveConstructor Operator">`S_</a> <a id="3776" class="Symbol">:</a> <a id="3778" class="Symbol">∀</a> <a id="3780" class="Symbol">{</a><a id="3781" href="NbE.html#3781" class="Bound">Γ</a> <a id="3783" class="Symbol">:</a> <a id="3785" href="NbE.html#1943" class="Datatype">Ctx</a><a id="3788" class="Symbol">}</a> <a id="3790" class="Symbol">{</a><a id="3791" href="NbE.html#3791" class="Bound">S</a> <a id="3793" href="NbE.html#3793" class="Bound">T</a> <a id="3795" class="Symbol">:</a> <a id="3797" href="NbE.html#1051" class="Datatype">Type</a><a id="3801" class="Symbol">}</a>
      <a id="3809" class="Symbol">→</a> <a id="3811" href="NbE.html#3781" class="Bound">Γ</a> <a id="3813" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="3815" href="NbE.html#3793" class="Bound">T</a>
        <a id="3825" class="Comment">---------</a>
      <a id="3841" class="Symbol">→</a> <a id="3843" href="NbE.html#3781" class="Bound">Γ</a> <a id="3845" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="3847" href="NbE.html#3791" class="Bound">S</a> <a id="3849" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="3851" href="NbE.html#3793" class="Bound">T</a>

<a id="3854" class="Keyword">infix</a> <a id="3860" class="Number">4</a> <a id="3862" href="NbE.html#3674" class="Datatype Operator">_∋_</a>
</pre>
Terms in our language are defined with an intrinsically
typed represenation, such that a term t of type Γ ⊢ T is
the term `Γ ⊢ t : T` itself. The language has the constants `zero`,
`suc` (as a curried constant),`rec` (a curried constant
as well), variables, abstractions, and application.

For clarity we will not use an intrinsically typed de Brujin
representation when talking about terms (e.g. the variable ` `Z
will be talked about as `Γ , x:T ⊢ x : T`)
<pre class="Agda"><a id="4337" class="Keyword">data</a> <a id="_⊢_"></a><a id="4342" href="NbE.html#4342" class="Datatype Operator">_⊢_</a> <a id="4346" class="Symbol">(</a><a id="4347" href="NbE.html#4347" class="Bound">Γ</a> <a id="4349" class="Symbol">:</a> <a id="4351" href="NbE.html#1943" class="Datatype">Ctx</a><a id="4354" class="Symbol">)</a> <a id="4356" class="Symbol">:</a> <a id="4358" href="NbE.html#1051" class="Datatype">Type</a> <a id="4363" class="Symbol">→</a> <a id="4365" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="4369" class="Keyword">where</a>
  <a id="_⊢_.zero"></a><a id="4377" href="NbE.html#4377" class="InductiveConstructor">zero</a> <a id="4382" class="Symbol">:</a> <a id="4384" href="NbE.html#4347" class="Bound">Γ</a> <a id="4386" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4388" href="NbE.html#1070" class="InductiveConstructor">nat</a>

  <a id="_⊢_.suc"></a><a id="4395" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="4399" class="Symbol">:</a> <a id="4401" href="NbE.html#4347" class="Bound">Γ</a> <a id="4403" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4405" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="4409" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="4411" href="NbE.html#1070" class="InductiveConstructor">nat</a>

  <a id="_⊢_.rec"></a><a id="4418" href="NbE.html#4418" class="InductiveConstructor">rec</a>  <a id="4423" class="Symbol">:</a> <a id="4425" class="Symbol">∀</a> <a id="4427" class="Symbol">{</a><a id="4428" href="NbE.html#4428" class="Bound">T</a> <a id="4430" class="Symbol">:</a> <a id="4432" href="NbE.html#1051" class="Datatype">Type</a><a id="4436" class="Symbol">}</a>
         <a id="4447" class="Comment">---------------------------------</a>
       <a id="4488" class="Symbol">→</a> <a id="4490" href="NbE.html#4347" class="Bound">Γ</a> <a id="4492" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4494" class="Symbol">(</a><a id="4495" href="NbE.html#4428" class="Bound">T</a> <a id="4497" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="4499" class="Symbol">(</a><a id="4500" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="4504" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="4506" href="NbE.html#4428" class="Bound">T</a> <a id="4508" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="4510" href="NbE.html#4428" class="Bound">T</a><a id="4511" class="Symbol">)</a> <a id="4513" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="4515" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="4519" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="4521" href="NbE.html#4428" class="Bound">T</a><a id="4522" class="Symbol">)</a>

  <a id="_⊢_.`_"></a><a id="4527" href="NbE.html#4527" class="InductiveConstructor Operator">`_</a> <a id="4530" class="Symbol">:</a> <a id="4532" class="Symbol">∀</a> <a id="4534" class="Symbol">{</a><a id="4535" href="NbE.html#4535" class="Bound">S</a> <a id="4537" class="Symbol">:</a> <a id="4539" href="NbE.html#1051" class="Datatype">Type</a><a id="4543" class="Symbol">}</a>
     <a id="4550" class="Symbol">→</a> <a id="4552" href="NbE.html#4347" class="Bound">Γ</a> <a id="4554" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="4556" href="NbE.html#4535" class="Bound">S</a>
       <a id="4565" class="Comment">-----</a>
     <a id="4576" class="Symbol">→</a> <a id="4578" href="NbE.html#4347" class="Bound">Γ</a> <a id="4580" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4582" href="NbE.html#4535" class="Bound">S</a>

  <a id="_⊢_.ƛ_"></a><a id="4587" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ_</a> <a id="4590" class="Symbol">:</a> <a id="4592" class="Symbol">∀</a> <a id="4594" class="Symbol">{</a><a id="4595" href="NbE.html#4595" class="Bound">S</a> <a id="4597" href="NbE.html#4597" class="Bound">T</a> <a id="4599" class="Symbol">:</a> <a id="4601" href="NbE.html#1051" class="Datatype">Type</a><a id="4605" class="Symbol">}</a>
     <a id="4612" class="Symbol">→</a> <a id="4614" href="NbE.html#4347" class="Bound">Γ</a> <a id="4616" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="4618" href="NbE.html#4595" class="Bound">S</a> <a id="4620" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4622" href="NbE.html#4597" class="Bound">T</a>
       <a id="4631" class="Comment">---------</a>
     <a id="4646" class="Symbol">→</a> <a id="4648" href="NbE.html#4347" class="Bound">Γ</a> <a id="4650" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4652" href="NbE.html#4595" class="Bound">S</a> <a id="4654" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="4656" href="NbE.html#4597" class="Bound">T</a>

  <a id="_⊢_._·_"></a><a id="4661" href="NbE.html#4661" class="InductiveConstructor Operator">_·_</a> <a id="4665" class="Symbol">:</a> <a id="4667" class="Symbol">∀</a> <a id="4669" class="Symbol">{</a><a id="4670" href="NbE.html#4670" class="Bound">S</a> <a id="4672" href="NbE.html#4672" class="Bound">T</a> <a id="4674" class="Symbol">:</a> <a id="4676" href="NbE.html#1051" class="Datatype">Type</a><a id="4680" class="Symbol">}</a>
      <a id="4688" class="Symbol">→</a> <a id="4690" href="NbE.html#4347" class="Bound">Γ</a> <a id="4692" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4694" href="NbE.html#4670" class="Bound">S</a> <a id="4696" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="4698" href="NbE.html#4672" class="Bound">T</a>
      <a id="4706" class="Symbol">→</a> <a id="4708" href="NbE.html#4347" class="Bound">Γ</a> <a id="4710" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4712" href="NbE.html#4670" class="Bound">S</a>
        <a id="4722" class="Comment">---------</a>
      <a id="4738" class="Symbol">→</a> <a id="4740" href="NbE.html#4347" class="Bound">Γ</a> <a id="4742" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4744" href="NbE.html#4672" class="Bound">T</a>

<a id="4747" class="Keyword">infix</a> <a id="4753" class="Number">4</a> <a id="4755" href="NbE.html#4342" class="Datatype Operator">_⊢_</a>
<a id="4759" class="Keyword">infix</a> <a id="4765" class="Number">5</a> <a id="4767" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ_</a>
<a id="4770" class="Keyword">infixl</a> <a id="4777" class="Number">7</a> <a id="4779" href="NbE.html#4661" class="InductiveConstructor Operator">_·_</a>
<a id="4783" class="Keyword">infix</a> <a id="4789" class="Number">9</a> <a id="4791" href="NbE.html#4527" class="InductiveConstructor Operator">`_</a>
</pre>
We can define some sample programs in the language
using these constructors:
<pre class="Agda"><a id="4884" class="Comment">-- λx. x</a>
<a id="ex0"></a><a id="4893" href="NbE.html#4893" class="Function">ex0</a> <a id="4897" class="Symbol">:</a> <a id="4899" class="Symbol">∀</a> <a id="4901" class="Symbol">{</a><a id="4902" href="NbE.html#4902" class="Bound">Γ</a> <a id="4904" class="Symbol">:</a> <a id="4906" href="NbE.html#1943" class="Datatype">Ctx</a><a id="4909" class="Symbol">}</a> <a id="4911" class="Symbol">{</a><a id="4912" href="NbE.html#4912" class="Bound">T</a> <a id="4914" class="Symbol">:</a> <a id="4916" href="NbE.html#1051" class="Datatype">Type</a><a id="4920" class="Symbol">}</a> <a id="4922" class="Symbol">→</a> <a id="4924" href="NbE.html#4902" class="Bound">Γ</a> <a id="4926" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="4928" href="NbE.html#4912" class="Bound">T</a> <a id="4930" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="4932" href="NbE.html#4912" class="Bound">T</a>
<a id="4934" href="NbE.html#4893" class="Function">ex0</a> <a id="4938" class="Symbol">=</a> <a id="4940" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="4942" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="4944" class="Symbol">(</a><a id="4945" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="4947" class="Symbol">)</a>

<a id="4950" class="Comment">-- (λx. x) zero</a>
<a id="ex1"></a><a id="4966" href="NbE.html#4966" class="Function">ex1</a> <a id="4970" class="Symbol">=</a> <a id="4972" href="NbE.html#4893" class="Function">ex0</a> <a id="4976" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="4978" href="NbE.html#4377" class="InductiveConstructor">zero</a> <a id="4983" class="Symbol">{</a><a id="4984" href="NbE.html#1961" class="InductiveConstructor">∅</a><a id="4985" class="Symbol">}</a>

<a id="4988" class="Comment">-- suc ((λx. x) zero)</a>
<a id="ex2"></a><a id="5010" href="NbE.html#5010" class="Function">ex2</a> <a id="5014" class="Symbol">=</a> <a id="5016" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="5020" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="5022" href="NbE.html#4966" class="Function">ex1</a>

<a id="5027" class="Comment">-- x:nat, y:nat ⊢ suc ((λz. suc y) x)</a>
<a id="ex3"></a><a id="5065" href="NbE.html#5065" class="Function">ex3</a> <a id="5069" class="Symbol">:</a> <a id="5071" href="NbE.html#1961" class="InductiveConstructor">∅</a> <a id="5073" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="5075" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="5079" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="5081" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="5085" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="5087" href="NbE.html#1070" class="InductiveConstructor">nat</a>
<a id="5091" href="NbE.html#5065" class="Function">ex3</a> <a id="5095" class="Symbol">=</a> <a id="5097" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="5101" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="5103" class="Symbol">((</a><a id="5105" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="5107" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="5111" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="5113" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="5115" class="Symbol">(</a><a id="5116" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="5119" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="5121" class="Symbol">))</a> <a id="5124" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="5126" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="5128" class="Symbol">(</a><a id="5129" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="5132" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="5134" class="Symbol">))</a>
</pre>
Now that we have defined our language, we are almost ready
to start describing an algorithm for normalization by
evaluation. However, to prove the soundness of this algorithm,
we will need to define two more basic language constructs:
substitutions and equality.

We expect the following soundness properties for a
normalization algorithm nf(t) that produces a normal form
for a typed term `Γ ⊢ t : T`:

  - `Γ ⊢ nf(t) : T` (well-typedness of normal form)
  - `⟦ nf(t) ⟧ = ⟦ t ⟧` (preservation of meaning)
  - `nf(nf(t)) = nf(t)` (idempotency)

For preservation of meaning, our interpretations of
functional terms are functions, whose equality is
undecidable. However, in STLC, we have that two terms
are βη-equivalent iff their interpretationss are equal.
So, we wish to define an extension of βη-equivalence
for System T s.t. it implies equal interpretations
(thus making the proposition `⟦ nf(t) ⟧ = ⟦ t ⟧` decidable).

To define our extension of βη-equivalence, we begin by
defining substitution (which we will use to define β-reductions
and η-expansions).

Substitution for System T is defined using the rules for
parallel substitution and the rule for the application
of a substitution as they are introduced in section 2.6.

A parallel substitution `Γ ⊢ σ : Δ` provides a well-typed term in Γ
to substitute for each variable in the context Δ.

We use ⊩ instead of ⊢ since that is already reserved
for typing judgements (and keep using ∥ for the "parallel"
in "parallel substitutions" for operationsions related
to this type).
<pre class="Agda"><a id="6683" class="Keyword">data</a> <a id="Sub"></a><a id="6688" href="NbE.html#6688" class="Datatype">Sub</a> <a id="6692" class="Symbol">:</a> <a id="6694" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="6698" class="Symbol">→</a> <a id="6700" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="6704" class="Symbol">→</a> <a id="6706" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="6710" class="Keyword">where</a>
  <a id="Sub.∅"></a><a id="6718" href="NbE.html#6718" class="InductiveConstructor">∅</a> <a id="6720" class="Symbol">:</a> <a id="6722" class="Symbol">∀</a> <a id="6724" class="Symbol">{</a><a id="6725" href="NbE.html#6725" class="Bound">Γ</a><a id="6726" class="Symbol">}</a> <a id="6728" class="Symbol">→</a> <a id="6730" href="NbE.html#6688" class="Datatype">Sub</a> <a id="6734" href="NbE.html#6725" class="Bound">Γ</a> <a id="6736" href="NbE.html#1961" class="InductiveConstructor">∅</a>

  <a id="Sub._,_"></a><a id="6741" href="NbE.html#6741" class="InductiveConstructor Operator">_,_</a> <a id="6745" class="Symbol">:</a> <a id="6747" class="Symbol">∀</a> <a id="6749" class="Symbol">{</a><a id="6750" href="NbE.html#6750" class="Bound">Γ</a> <a id="6752" href="NbE.html#6752" class="Bound">Δ</a> <a id="6754" class="Symbol">:</a> <a id="6756" href="NbE.html#1943" class="Datatype">Ctx</a><a id="6759" class="Symbol">}</a> <a id="6761" class="Symbol">{</a><a id="6762" href="NbE.html#6762" class="Bound">S</a> <a id="6764" class="Symbol">:</a> <a id="6766" href="NbE.html#1051" class="Datatype">Type</a><a id="6770" class="Symbol">}</a>
        <a id="6780" class="Symbol">→</a> <a id="6782" href="NbE.html#6688" class="Datatype">Sub</a> <a id="6786" href="NbE.html#6750" class="Bound">Γ</a> <a id="6788" href="NbE.html#6752" class="Bound">Δ</a>
        <a id="6798" class="Symbol">→</a> <a id="6800" href="NbE.html#6750" class="Bound">Γ</a> <a id="6802" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="6804" href="NbE.html#6762" class="Bound">S</a>
          <a id="6816" class="Comment">---------</a>
        <a id="6834" class="Symbol">→</a> <a id="6836" href="NbE.html#6688" class="Datatype">Sub</a> <a id="6840" href="NbE.html#6750" class="Bound">Γ</a> <a id="6842" class="Symbol">(</a><a id="6843" href="NbE.html#6752" class="Bound">Δ</a> <a id="6845" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="6847" href="NbE.html#6762" class="Bound">S</a><a id="6848" class="Symbol">)</a>
</pre>
Before defining the application of a substitution
`Γ ⊢ t [ σ ] : `T, we introduce renaming.

Renaming is a specialized substitution where
we can only substitute variables with other
variables (i.e. a renaming `Γ ⊢ σᵣ : Δ` provides
a variable in Γ to replace for every variable in Δ).

It is necessary to first to define renaming substitutions
so that termination is guaranteed for our operations.
<pre class="Agda"><a id="7260" class="Keyword">data</a> <a id="Ren"></a><a id="7265" href="NbE.html#7265" class="Datatype">Ren</a> <a id="7269" class="Symbol">:</a> <a id="7271" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="7275" class="Symbol">→</a> <a id="7277" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="7281" class="Symbol">→</a> <a id="7283" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="7287" class="Keyword">where</a>
  <a id="Ren.∅"></a><a id="7295" href="NbE.html#7295" class="InductiveConstructor">∅</a> <a id="7297" class="Symbol">:</a> <a id="7299" class="Symbol">∀</a> <a id="7301" class="Symbol">{</a><a id="7302" href="NbE.html#7302" class="Bound">Γ</a> <a id="7304" class="Symbol">:</a> <a id="7306" href="NbE.html#1943" class="Datatype">Ctx</a><a id="7309" class="Symbol">}</a> <a id="7311" class="Symbol">→</a> <a id="7313" href="NbE.html#7265" class="Datatype">Ren</a> <a id="7317" href="NbE.html#7302" class="Bound">Γ</a> <a id="7319" href="NbE.html#1961" class="InductiveConstructor">∅</a>

  <a id="Ren._,_"></a><a id="7324" href="NbE.html#7324" class="InductiveConstructor Operator">_,_</a> <a id="7328" class="Symbol">:</a> <a id="7330" class="Symbol">∀</a> <a id="7332" class="Symbol">{</a><a id="7333" href="NbE.html#7333" class="Bound">Γ</a> <a id="7335" href="NbE.html#7335" class="Bound">Δ</a> <a id="7337" class="Symbol">:</a> <a id="7339" href="NbE.html#1943" class="Datatype">Ctx</a><a id="7342" class="Symbol">}</a> <a id="7344" class="Symbol">{</a><a id="7345" href="NbE.html#7345" class="Bound">S</a> <a id="7347" class="Symbol">:</a> <a id="7349" href="NbE.html#1051" class="Datatype">Type</a><a id="7353" class="Symbol">}</a>
      <a id="7361" class="Symbol">→</a> <a id="7363" href="NbE.html#7265" class="Datatype">Ren</a> <a id="7367" href="NbE.html#7333" class="Bound">Γ</a> <a id="7369" href="NbE.html#7335" class="Bound">Δ</a>
      <a id="7377" class="Symbol">→</a> <a id="7379" href="NbE.html#7333" class="Bound">Γ</a> <a id="7381" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="7383" href="NbE.html#7345" class="Bound">S</a>
        <a id="7393" class="Comment">-------------</a>
      <a id="7413" class="Symbol">→</a> <a id="7415" href="NbE.html#7265" class="Datatype">Ren</a> <a id="7419" href="NbE.html#7333" class="Bound">Γ</a> <a id="7421" class="Symbol">(</a><a id="7422" href="NbE.html#7335" class="Bound">Δ</a> <a id="7424" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="7426" href="NbE.html#7345" class="Bound">S</a><a id="7427" class="Symbol">)</a>
</pre>
We can use a renaming substitution to convert
lookup judgements (i.e. rename variables). In fact, this
is the operation that we need to define separately to
guarantee termination of the application of a substitution.
<pre class="Agda"><a id="rename"></a><a id="7659" href="NbE.html#7659" class="Function">rename</a> <a id="7666" class="Symbol">:</a> <a id="7668" class="Symbol">∀</a> <a id="7670" class="Symbol">{</a><a id="7671" href="NbE.html#7671" class="Bound">Γ</a> <a id="7673" href="NbE.html#7673" class="Bound">Δ</a> <a id="7675" class="Symbol">:</a> <a id="7677" href="NbE.html#1943" class="Datatype">Ctx</a><a id="7680" class="Symbol">}</a> <a id="7682" class="Symbol">{</a><a id="7683" href="NbE.html#7683" class="Bound">T</a> <a id="7685" class="Symbol">:</a> <a id="7687" href="NbE.html#1051" class="Datatype">Type</a><a id="7691" class="Symbol">}</a>
       <a id="7700" class="Symbol">→</a> <a id="7702" href="NbE.html#7673" class="Bound">Δ</a> <a id="7704" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="7706" href="NbE.html#7683" class="Bound">T</a>
       <a id="7715" class="Symbol">→</a> <a id="7717" href="NbE.html#7265" class="Datatype">Ren</a> <a id="7721" href="NbE.html#7671" class="Bound">Γ</a> <a id="7723" href="NbE.html#7673" class="Bound">Δ</a>
         <a id="7734" class="Comment">-------</a>
       <a id="7749" class="Symbol">→</a> <a id="7751" href="NbE.html#7671" class="Bound">Γ</a> <a id="7753" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="7755" href="NbE.html#7683" class="Bound">T</a>
<a id="7757" href="NbE.html#7659" class="Function">rename</a> <a id="7764" href="NbE.html#3705" class="InductiveConstructor">`Z</a>     <a id="7771" class="Symbol">(</a><a id="7772" href="NbE.html#7772" class="Bound">ρ</a> <a id="7774" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="7776" href="NbE.html#7776" class="Bound">x</a><a id="7777" class="Symbol">)</a> <a id="7779" class="Symbol">=</a> <a id="7781" href="NbE.html#7776" class="Bound">x</a>
<a id="7783" href="NbE.html#7659" class="Function">rename</a> <a id="7790" class="Symbol">(</a><a id="7791" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="7794" href="NbE.html#7794" class="Bound">x</a><a id="7795" class="Symbol">)</a> <a id="7797" class="Symbol">(</a><a id="7798" href="NbE.html#7798" class="Bound">ρ</a> <a id="7800" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="7802" class="Symbol">_)</a> <a id="7805" class="Symbol">=</a> <a id="7807" href="NbE.html#7659" class="Function">rename</a> <a id="7814" href="NbE.html#7794" class="Bound">x</a> <a id="7816" href="NbE.html#7798" class="Bound">ρ</a>
</pre>
We define parallel substitutions and renaming substitutions
with the previous rules so that we can define a shifting operation
over them. Shifting a renaming substitution shifts all indices
in the renaming by one -- in other words, given a renaming between Γ
and Δ, we can create a renaming between Γ , T and Δ.

We will use this to extend a renaming under a binder.
<pre class="Agda"><a id="_↑ᵣ"></a><a id="8198" href="NbE.html#8198" class="Function Operator">_↑ᵣ</a> <a id="8202" class="Symbol">:</a> <a id="8204" class="Symbol">∀</a> <a id="8206" class="Symbol">{</a><a id="8207" href="NbE.html#8207" class="Bound">Γ</a> <a id="8209" href="NbE.html#8209" class="Bound">Δ</a> <a id="8211" class="Symbol">:</a> <a id="8213" href="NbE.html#1943" class="Datatype">Ctx</a><a id="8216" class="Symbol">}</a> <a id="8218" class="Symbol">{</a><a id="8219" href="NbE.html#8219" class="Bound">T</a> <a id="8221" class="Symbol">:</a> <a id="8223" href="NbE.html#1051" class="Datatype">Type</a><a id="8227" class="Symbol">}</a>
    <a id="8233" class="Symbol">→</a> <a id="8235" href="NbE.html#7265" class="Datatype">Ren</a> <a id="8239" href="NbE.html#8207" class="Bound">Γ</a> <a id="8241" href="NbE.html#8209" class="Bound">Δ</a>
      <a id="8249" class="Comment">-------------</a>
    <a id="8267" class="Symbol">→</a> <a id="8269" href="NbE.html#7265" class="Datatype">Ren</a> <a id="8273" class="Symbol">(</a><a id="8274" href="NbE.html#8207" class="Bound">Γ</a> <a id="8276" class="InductiveConstructor Operator">,</a> <a id="8278" href="NbE.html#8219" class="Bound">T</a><a id="8279" class="Symbol">)</a> <a id="8281" href="NbE.html#8209" class="Bound">Δ</a>
<a id="8283" href="NbE.html#7295" class="InductiveConstructor">∅</a> <a id="8285" href="NbE.html#8198" class="Function Operator">↑ᵣ</a>       <a id="8294" class="Symbol">=</a> <a id="8296" href="NbE.html#7295" class="InductiveConstructor">∅</a>
<a id="8298" class="Symbol">(</a><a id="8299" href="NbE.html#8299" class="Bound">σᵣ</a> <a id="8302" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="8304" href="NbE.html#8304" class="Bound">x</a><a id="8305" class="Symbol">)</a> <a id="8307" href="NbE.html#8198" class="Function Operator">↑ᵣ</a> <a id="8310" class="Symbol">=</a> <a id="8312" href="NbE.html#8299" class="Bound">σᵣ</a> <a id="8315" href="NbE.html#8198" class="Function Operator">↑ᵣ</a> <a id="8318" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="8320" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="8323" href="NbE.html#8304" class="Bound">x</a>

<a id="8326" class="Keyword">infix</a> <a id="8332" class="Number">6</a> <a id="8334" href="NbE.html#8198" class="Function Operator">_↑ᵣ</a>
</pre>
With this operation in place, we can define the application of a renaming
substitution to rebase a term from a context Δ to a context Γ, this is done
by using the renaming substitution to replace all variables used in the term by
their corresponding variables in Γ
<pre class="Agda"><a id="_[_]ᵣ"></a><a id="8616" href="NbE.html#8616" class="Function Operator">_[_]ᵣ</a> <a id="8622" class="Symbol">:</a> <a id="8624" class="Symbol">∀</a> <a id="8626" class="Symbol">{</a><a id="8627" href="NbE.html#8627" class="Bound">Γ</a> <a id="8629" href="NbE.html#8629" class="Bound">Δ</a> <a id="8631" class="Symbol">:</a> <a id="8633" href="NbE.html#1943" class="Datatype">Ctx</a><a id="8636" class="Symbol">}</a> <a id="8638" class="Symbol">{</a><a id="8639" href="NbE.html#8639" class="Bound">T</a> <a id="8641" class="Symbol">:</a> <a id="8643" href="NbE.html#1051" class="Datatype">Type</a><a id="8647" class="Symbol">}</a>
        <a id="8657" class="Symbol">→</a> <a id="8659" href="NbE.html#8629" class="Bound">Δ</a> <a id="8661" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="8663" href="NbE.html#8639" class="Bound">T</a>
        <a id="8673" class="Symbol">→</a> <a id="8675" href="NbE.html#7265" class="Datatype">Ren</a> <a id="8679" href="NbE.html#8627" class="Bound">Γ</a> <a id="8681" href="NbE.html#8629" class="Bound">Δ</a>
          <a id="8693" class="Comment">-------</a>
        <a id="8709" class="Symbol">→</a> <a id="8711" href="NbE.html#8627" class="Bound">Γ</a> <a id="8713" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="8715" href="NbE.html#8639" class="Bound">T</a>
<a id="8717" href="NbE.html#4377" class="InductiveConstructor">zero</a> <a id="8722" href="NbE.html#8616" class="Function Operator">[</a> <a id="8724" class="Symbol">_</a> <a id="8726" href="NbE.html#8616" class="Function Operator">]ᵣ</a> <a id="8729" class="Symbol">=</a> <a id="8731" href="NbE.html#4377" class="InductiveConstructor">zero</a>
<a id="8736" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="8740" href="NbE.html#8616" class="Function Operator">[</a> <a id="8742" class="Symbol">_</a> <a id="8744" href="NbE.html#8616" class="Function Operator">]ᵣ</a> <a id="8747" class="Symbol">=</a> <a id="8749" href="NbE.html#4395" class="InductiveConstructor">suc</a>
<a id="8753" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="8757" href="NbE.html#8616" class="Function Operator">[</a> <a id="8759" class="Symbol">_</a> <a id="8761" href="NbE.html#8616" class="Function Operator">]ᵣ</a> <a id="8764" class="Symbol">=</a> <a id="8766" href="NbE.html#4418" class="InductiveConstructor">rec</a>
<a id="8770" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="8772" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="8775" href="NbE.html#8616" class="Function Operator">[</a> <a id="8777" class="Symbol">_</a> <a id="8779" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="8781" href="NbE.html#8781" class="Bound">x</a> <a id="8783" href="NbE.html#8616" class="Function Operator">]ᵣ</a> <a id="8786" class="Symbol">=</a> <a id="8788" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="8790" href="NbE.html#8781" class="Bound">x</a>
<a id="8792" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="8794" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="8797" href="NbE.html#8797" class="Bound">x</a> <a id="8799" href="NbE.html#8616" class="Function Operator">[</a> <a id="8801" href="NbE.html#8801" class="Bound">σᵣ</a> <a id="8804" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="8806" class="Symbol">_</a> <a id="8808" href="NbE.html#8616" class="Function Operator">]ᵣ</a> <a id="8811" class="Symbol">=</a> <a id="8813" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="8815" href="NbE.html#8797" class="Bound">x</a> <a id="8817" href="NbE.html#8616" class="Function Operator">[</a> <a id="8819" href="NbE.html#8801" class="Bound">σᵣ</a> <a id="8822" href="NbE.html#8616" class="Function Operator">]ᵣ</a>
<a id="8825" class="Symbol">(</a><a id="8826" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="8828" href="NbE.html#8828" class="Bound">t</a><a id="8829" class="Symbol">)</a> <a id="8831" href="NbE.html#8616" class="Function Operator">[</a> <a id="8833" href="NbE.html#8833" class="Bound">σᵣ</a> <a id="8836" href="NbE.html#8616" class="Function Operator">]ᵣ</a> <a id="8839" class="Symbol">=</a> <a id="8841" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="8843" href="NbE.html#8828" class="Bound">t</a> <a id="8845" href="NbE.html#8616" class="Function Operator">[</a> <a id="8847" href="NbE.html#8833" class="Bound">σᵣ</a> <a id="8850" href="NbE.html#8198" class="Function Operator">↑ᵣ</a> <a id="8853" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="8855" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="8858" href="NbE.html#8616" class="Function Operator">]ᵣ</a>
<a id="8861" class="Symbol">(</a><a id="8862" href="NbE.html#8862" class="Bound">r</a> <a id="8864" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="8866" href="NbE.html#8866" class="Bound">s</a><a id="8867" class="Symbol">)</a> <a id="8869" href="NbE.html#8616" class="Function Operator">[</a> <a id="8871" href="NbE.html#8871" class="Bound">σᵣ</a> <a id="8874" href="NbE.html#8616" class="Function Operator">]ᵣ</a> <a id="8877" class="Symbol">=</a> <a id="8879" href="NbE.html#8862" class="Bound">r</a> <a id="8881" href="NbE.html#8616" class="Function Operator">[</a> <a id="8883" href="NbE.html#8871" class="Bound">σᵣ</a> <a id="8886" href="NbE.html#8616" class="Function Operator">]ᵣ</a> <a id="8889" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="8891" href="NbE.html#8866" class="Bound">s</a> <a id="8893" href="NbE.html#8616" class="Function Operator">[</a> <a id="8895" href="NbE.html#8871" class="Bound">σᵣ</a> <a id="8898" href="NbE.html#8616" class="Function Operator">]ᵣ</a>

<a id="8902" class="Keyword">infix</a> <a id="8908" class="Number">8</a> <a id="8910" href="NbE.html#8616" class="Function Operator">_[_]ᵣ</a>
</pre>
We also define a few "primitive" renamings that will be convenient for general
substitutions:

The identity and incrementing renaming, defined mutually. The identity
renaming leaves all variables unchanged, while the incrementing renaming
increments all variables (which are really just indices) by 1

<pre class="Agda"><a id="9231" class="Keyword">mutual</a>
  <a id="ren-id"></a><a id="9240" href="NbE.html#9240" class="Function">ren-id</a> <a id="9247" class="Symbol">:</a> <a id="9249" class="Symbol">∀</a> <a id="9251" class="Symbol">{</a><a id="9252" href="NbE.html#9252" class="Bound">Γ</a> <a id="9254" class="Symbol">:</a> <a id="9256" href="NbE.html#1943" class="Datatype">Ctx</a><a id="9259" class="Symbol">}</a> <a id="9261" class="Symbol">→</a> <a id="9263" href="NbE.html#7265" class="Datatype">Ren</a> <a id="9267" href="NbE.html#9252" class="Bound">Γ</a> <a id="9269" href="NbE.html#9252" class="Bound">Γ</a>
  <a id="9273" href="NbE.html#9240" class="Function">ren-id</a> <a id="9280" class="Symbol">{</a><a id="9281" href="NbE.html#1961" class="InductiveConstructor">∅</a><a id="9282" class="Symbol">}</a> <a id="9284" class="Symbol">=</a> <a id="9286" href="NbE.html#7295" class="InductiveConstructor">∅</a>
  <a id="9290" href="NbE.html#9240" class="Function">ren-id</a> <a id="9297" class="Symbol">{</a><a id="9298" href="NbE.html#9298" class="Bound">Γ</a> <a id="9300" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="9302" href="NbE.html#9302" class="Bound">T</a><a id="9303" class="Symbol">}</a> <a id="9305" class="Symbol">=</a> <a id="9307" href="NbE.html#9324" class="Function">ren-incr</a> <a id="9316" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="9318" href="NbE.html#3705" class="InductiveConstructor">`Z</a>

  <a id="ren-incr"></a><a id="9324" href="NbE.html#9324" class="Function">ren-incr</a> <a id="9333" class="Symbol">:</a> <a id="9335" class="Symbol">∀</a> <a id="9337" class="Symbol">{</a><a id="9338" href="NbE.html#9338" class="Bound">Γ</a> <a id="9340" class="Symbol">:</a> <a id="9342" href="NbE.html#1943" class="Datatype">Ctx</a><a id="9345" class="Symbol">}</a> <a id="9347" class="Symbol">{</a><a id="9348" href="NbE.html#9348" class="Bound">T</a> <a id="9350" class="Symbol">:</a> <a id="9352" href="NbE.html#1051" class="Datatype">Type</a><a id="9356" class="Symbol">}</a> <a id="9358" class="Symbol">→</a> <a id="9360" href="NbE.html#7265" class="Datatype">Ren</a> <a id="9364" class="Symbol">(</a><a id="9365" href="NbE.html#9338" class="Bound">Γ</a> <a id="9367" class="InductiveConstructor Operator">,</a> <a id="9369" href="NbE.html#9348" class="Bound">T</a><a id="9370" class="Symbol">)</a> <a id="9372" href="NbE.html#9338" class="Bound">Γ</a>
  <a id="9376" href="NbE.html#9324" class="Function">ren-incr</a> <a id="9385" class="Symbol">=</a> <a id="9387" href="NbE.html#9240" class="Function">ren-id</a> <a id="9394" href="NbE.html#8198" class="Function Operator">↑ᵣ</a>
</pre>
A renaming between a context Γ′ and Γ,
where Γ′ is an extension of Γ. This renaming
is really a series of shifts based on
how many extensions to Γ the context Γ′
contains.

<pre class="Agda"><a id="ren-≤"></a><a id="9583" href="NbE.html#9583" class="Function">ren-≤</a> <a id="9589" class="Symbol">:</a> <a id="9591" class="Symbol">∀</a> <a id="9593" class="Symbol">{</a><a id="9594" href="NbE.html#9594" class="Bound">Γ′</a> <a id="9597" href="NbE.html#9597" class="Bound">Γ</a> <a id="9599" class="Symbol">:</a> <a id="9601" href="NbE.html#1943" class="Datatype">Ctx</a><a id="9604" class="Symbol">}</a> <a id="9606" class="Symbol">→</a> <a id="9608" href="NbE.html#9594" class="Bound">Γ′</a> <a id="9611" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="9613" href="NbE.html#9597" class="Bound">Γ</a> <a id="9615" class="Symbol">→</a> <a id="9617" href="NbE.html#7265" class="Datatype">Ren</a> <a id="9621" href="NbE.html#9594" class="Bound">Γ′</a> <a id="9624" href="NbE.html#9597" class="Bound">Γ</a>
<a id="9626" href="NbE.html#9583" class="Function">ren-≤</a> <a id="9632" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="9637" class="Symbol">=</a> <a id="9639" href="NbE.html#9240" class="Function">ren-id</a>
<a id="9646" href="NbE.html#9583" class="Function">ren-≤</a> <a id="9652" class="Symbol">(</a><a id="9653" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="9659" href="NbE.html#9659" class="Bound">pf</a><a id="9661" class="Symbol">)</a> <a id="9663" class="Symbol">=</a> <a id="9665" class="Symbol">(</a><a id="9666" href="NbE.html#9583" class="Function">ren-≤</a> <a id="9672" href="NbE.html#9659" class="Bound">pf</a><a id="9674" class="Symbol">)</a> <a id="9676" href="NbE.html#8198" class="Function Operator">↑ᵣ</a>
</pre>
Since a renaming is really just a specialized substitution,
we can transform any renaming substitution into a parallel
substitution
<pre class="Agda"><a id="subst-ren"></a><a id="9824" href="NbE.html#9824" class="Function">subst-ren</a> <a id="9834" class="Symbol">:</a> <a id="9836" class="Symbol">∀</a> <a id="9838" class="Symbol">{</a><a id="9839" href="NbE.html#9839" class="Bound">Γ</a> <a id="9841" href="NbE.html#9841" class="Bound">Δ</a> <a id="9843" class="Symbol">:</a> <a id="9845" href="NbE.html#1943" class="Datatype">Ctx</a><a id="9848" class="Symbol">}</a> <a id="9850" class="Symbol">→</a> <a id="9852" href="NbE.html#7265" class="Datatype">Ren</a> <a id="9856" href="NbE.html#9839" class="Bound">Γ</a> <a id="9858" href="NbE.html#9841" class="Bound">Δ</a> <a id="9860" class="Symbol">→</a> <a id="9862" href="NbE.html#6688" class="Datatype">Sub</a> <a id="9866" href="NbE.html#9839" class="Bound">Γ</a> <a id="9868" href="NbE.html#9841" class="Bound">Δ</a>
<a id="9870" href="NbE.html#9824" class="Function">subst-ren</a> <a id="9880" href="NbE.html#7295" class="InductiveConstructor">∅</a> <a id="9882" class="Symbol">=</a> <a id="9884" href="NbE.html#6718" class="InductiveConstructor">∅</a>
<a id="9886" href="NbE.html#9824" class="Function">subst-ren</a> <a id="9896" class="Symbol">(</a><a id="9897" href="NbE.html#9897" class="Bound">σᵣ</a> <a id="9900" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="9902" href="NbE.html#9902" class="Bound">x</a><a id="9903" class="Symbol">)</a> <a id="9905" class="Symbol">=</a> <a id="9907" href="NbE.html#9824" class="Function">subst-ren</a> <a id="9917" href="NbE.html#9897" class="Bound">σᵣ</a> <a id="9920" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="9922" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="9924" href="NbE.html#9902" class="Bound">x</a>
</pre>
We can now use our renaming substitutions to build out
parallel substitutions and their operations, such that
their operations are guaranteed to terminate.

Similarly as for renaming substitutions, we define a shifting
operation for parallel substitutions, to be used for extending
a substitution under a binder.
<pre class="Agda"><a id="_↑"></a><a id="10252" href="NbE.html#10252" class="Function Operator">_↑</a> <a id="10255" class="Symbol">:</a> <a id="10257" class="Symbol">∀</a> <a id="10259" class="Symbol">{</a><a id="10260" href="NbE.html#10260" class="Bound">Γ</a> <a id="10262" href="NbE.html#10262" class="Bound">Δ</a> <a id="10264" class="Symbol">:</a> <a id="10266" href="NbE.html#1943" class="Datatype">Ctx</a><a id="10269" class="Symbol">}</a> <a id="10271" class="Symbol">{</a><a id="10272" href="NbE.html#10272" class="Bound">T</a> <a id="10274" class="Symbol">:</a> <a id="10276" href="NbE.html#1051" class="Datatype">Type</a><a id="10280" class="Symbol">}</a>
      <a id="10288" class="Symbol">→</a> <a id="10290" href="NbE.html#6688" class="Datatype">Sub</a> <a id="10294" href="NbE.html#10260" class="Bound">Γ</a> <a id="10296" href="NbE.html#10262" class="Bound">Δ</a>
        <a id="10306" class="Comment">-------------</a>
      <a id="10326" class="Symbol">→</a> <a id="10328" href="NbE.html#6688" class="Datatype">Sub</a> <a id="10332" class="Symbol">(</a><a id="10333" href="NbE.html#10260" class="Bound">Γ</a> <a id="10335" class="InductiveConstructor Operator">,</a> <a id="10337" href="NbE.html#10272" class="Bound">T</a><a id="10338" class="Symbol">)</a> <a id="10340" href="NbE.html#10262" class="Bound">Δ</a>
<a id="10342" href="NbE.html#6718" class="InductiveConstructor">∅</a> <a id="10344" href="NbE.html#10252" class="Function Operator">↑</a>       <a id="10352" class="Symbol">=</a> <a id="10354" href="NbE.html#6718" class="InductiveConstructor">∅</a>
<a id="10356" class="Symbol">(</a><a id="10357" href="NbE.html#10357" class="Bound">σ</a> <a id="10359" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="10361" href="NbE.html#10361" class="Bound">s</a><a id="10362" class="Symbol">)</a> <a id="10364" href="NbE.html#10252" class="Function Operator">↑</a> <a id="10366" class="Symbol">=</a> <a id="10368" href="NbE.html#10357" class="Bound">σ</a> <a id="10370" href="NbE.html#10252" class="Function Operator">↑</a> <a id="10372" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="10374" href="NbE.html#10361" class="Bound">s</a> <a id="10376" href="NbE.html#8616" class="Function Operator">[</a> <a id="10378" href="NbE.html#9324" class="Function">ren-incr</a> <a id="10387" href="NbE.html#8616" class="Function Operator">]ᵣ</a>

<a id="10391" class="Keyword">infix</a> <a id="10397" class="Number">6</a> <a id="10399" href="NbE.html#10252" class="Function Operator">_↑</a>
</pre>
Now, we can define the application of a parallel substitution
`Γ ⊢ σ : Δ` to a term `Δ ⊢ t : T` (e.g. `t [ σ ]`)
<pre class="Agda"><a id="_[_]"></a><a id="10528" href="NbE.html#10528" class="Function Operator">_[_]</a> <a id="10533" class="Symbol">:</a> <a id="10535" class="Symbol">∀</a> <a id="10537" class="Symbol">{</a><a id="10538" href="NbE.html#10538" class="Bound">Γ</a> <a id="10540" href="NbE.html#10540" class="Bound">Δ</a> <a id="10542" class="Symbol">:</a> <a id="10544" href="NbE.html#1943" class="Datatype">Ctx</a><a id="10547" class="Symbol">}</a> <a id="10549" class="Symbol">{</a><a id="10550" href="NbE.html#10550" class="Bound">T</a> <a id="10552" class="Symbol">:</a> <a id="10554" href="NbE.html#1051" class="Datatype">Type</a><a id="10558" class="Symbol">}</a>
     <a id="10565" class="Symbol">→</a> <a id="10567" href="NbE.html#10540" class="Bound">Δ</a> <a id="10569" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="10571" href="NbE.html#10550" class="Bound">T</a>
     <a id="10578" class="Symbol">→</a> <a id="10580" href="NbE.html#6688" class="Datatype">Sub</a> <a id="10584" href="NbE.html#10538" class="Bound">Γ</a> <a id="10586" href="NbE.html#10540" class="Bound">Δ</a>
       <a id="10595" class="Comment">-------</a>
     <a id="10608" class="Symbol">→</a> <a id="10610" href="NbE.html#10538" class="Bound">Γ</a> <a id="10612" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="10614" href="NbE.html#10550" class="Bound">T</a>
<a id="10616" href="NbE.html#4377" class="InductiveConstructor">zero</a> <a id="10621" href="NbE.html#10528" class="Function Operator">[</a> <a id="10623" class="Symbol">_</a> <a id="10625" href="NbE.html#10528" class="Function Operator">]</a> <a id="10627" class="Symbol">=</a> <a id="10629" href="NbE.html#4377" class="InductiveConstructor">zero</a>
<a id="10634" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="10638" href="NbE.html#10528" class="Function Operator">[</a> <a id="10640" class="Symbol">_</a> <a id="10642" href="NbE.html#10528" class="Function Operator">]</a> <a id="10644" class="Symbol">=</a> <a id="10646" href="NbE.html#4395" class="InductiveConstructor">suc</a>
<a id="10650" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="10654" href="NbE.html#10528" class="Function Operator">[</a> <a id="10656" class="Symbol">_</a> <a id="10658" href="NbE.html#10528" class="Function Operator">]</a> <a id="10660" class="Symbol">=</a> <a id="10662" href="NbE.html#4418" class="InductiveConstructor">rec</a>
<a id="10666" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="10668" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="10671" href="NbE.html#10528" class="Function Operator">[</a> <a id="10673" class="Symbol">_</a> <a id="10675" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="10677" href="NbE.html#10677" class="Bound">x</a> <a id="10679" href="NbE.html#10528" class="Function Operator">]</a> <a id="10681" class="Symbol">=</a> <a id="10683" href="NbE.html#10677" class="Bound">x</a>
<a id="10685" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="10687" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="10690" href="NbE.html#10690" class="Bound">x</a> <a id="10692" href="NbE.html#10528" class="Function Operator">[</a> <a id="10694" href="NbE.html#10694" class="Bound">σ</a> <a id="10696" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="10698" class="Symbol">_</a> <a id="10700" href="NbE.html#10528" class="Function Operator">]</a> <a id="10702" class="Symbol">=</a> <a id="10704" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="10706" href="NbE.html#10690" class="Bound">x</a> <a id="10708" href="NbE.html#10528" class="Function Operator">[</a> <a id="10710" href="NbE.html#10694" class="Bound">σ</a> <a id="10712" href="NbE.html#10528" class="Function Operator">]</a>
<a id="10714" class="Symbol">(</a><a id="10715" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="10717" href="NbE.html#10717" class="Bound">t</a><a id="10718" class="Symbol">)</a> <a id="10720" href="NbE.html#10528" class="Function Operator">[</a> <a id="10722" href="NbE.html#10722" class="Bound">σ</a> <a id="10724" href="NbE.html#10528" class="Function Operator">]</a> <a id="10726" class="Symbol">=</a> <a id="10728" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="10730" class="Symbol">(</a><a id="10731" href="NbE.html#10717" class="Bound">t</a> <a id="10733" href="NbE.html#10528" class="Function Operator">[</a> <a id="10735" href="NbE.html#10722" class="Bound">σ</a> <a id="10737" href="NbE.html#10252" class="Function Operator">↑</a> <a id="10739" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="10741" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="10743" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="10746" href="NbE.html#10528" class="Function Operator">]</a><a id="10747" class="Symbol">)</a>
<a id="10749" class="Symbol">(</a><a id="10750" href="NbE.html#10750" class="Bound">r</a> <a id="10752" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="10754" href="NbE.html#10754" class="Bound">s</a><a id="10755" class="Symbol">)</a> <a id="10757" href="NbE.html#10528" class="Function Operator">[</a> <a id="10759" href="NbE.html#10759" class="Bound">σ</a> <a id="10761" href="NbE.html#10528" class="Function Operator">]</a> <a id="10763" class="Symbol">=</a> <a id="10765" href="NbE.html#10750" class="Bound">r</a> <a id="10767" href="NbE.html#10528" class="Function Operator">[</a> <a id="10769" href="NbE.html#10759" class="Bound">σ</a> <a id="10771" href="NbE.html#10528" class="Function Operator">]</a> <a id="10773" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="10775" href="NbE.html#10754" class="Bound">s</a> <a id="10777" href="NbE.html#10528" class="Function Operator">[</a> <a id="10779" href="NbE.html#10759" class="Bound">σ</a> <a id="10781" href="NbE.html#10528" class="Function Operator">]</a>

<a id="10784" class="Keyword">infix</a> <a id="10790" class="Number">8</a> <a id="10792" href="NbE.html#10528" class="Function Operator">_[_]</a>
</pre>
Substitutions can also be composed, by applying
a substitution `Γ₁ ⊢ τ : Ctx₂` to every term in a
substitution `Γ₂ ⊢ σ : Ctx₃`
<pre class="Agda"><a id="_∘_"></a><a id="10937" href="NbE.html#10937" class="Function Operator">_∘_</a> <a id="10941" class="Symbol">:</a> <a id="10943" class="Symbol">∀</a> <a id="10945" class="Symbol">{</a><a id="10946" href="NbE.html#10946" class="Bound">Γ₁</a> <a id="10949" href="NbE.html#10949" class="Bound">Γ₂</a> <a id="10952" href="NbE.html#10952" class="Bound">Γ₃</a> <a id="10955" class="Symbol">:</a> <a id="10957" href="NbE.html#1943" class="Datatype">Ctx</a><a id="10960" class="Symbol">}</a> <a id="10962" class="Symbol">→</a> <a id="10964" href="NbE.html#6688" class="Datatype">Sub</a> <a id="10968" href="NbE.html#10949" class="Bound">Γ₂</a> <a id="10971" href="NbE.html#10952" class="Bound">Γ₃</a> <a id="10974" class="Symbol">→</a> <a id="10976" href="NbE.html#6688" class="Datatype">Sub</a> <a id="10980" href="NbE.html#10946" class="Bound">Γ₁</a> <a id="10983" href="NbE.html#10949" class="Bound">Γ₂</a> <a id="10986" class="Symbol">→</a> <a id="10988" href="NbE.html#6688" class="Datatype">Sub</a> <a id="10992" href="NbE.html#10946" class="Bound">Γ₁</a> <a id="10995" href="NbE.html#10952" class="Bound">Γ₃</a>
<a id="10998" href="NbE.html#6718" class="InductiveConstructor">∅</a>       <a id="11006" href="NbE.html#10937" class="Function Operator">∘</a> <a id="11008" class="Symbol">_</a> <a id="11010" class="Symbol">=</a> <a id="11012" href="NbE.html#6718" class="InductiveConstructor">∅</a>
<a id="11014" class="Symbol">(</a><a id="11015" href="NbE.html#11015" class="Bound">σ</a> <a id="11017" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="11019" href="NbE.html#11019" class="Bound">s</a><a id="11020" class="Symbol">)</a> <a id="11022" href="NbE.html#10937" class="Function Operator">∘</a> <a id="11024" href="NbE.html#11024" class="Bound">τ</a> <a id="11026" class="Symbol">=</a> <a id="11028" class="Symbol">(</a><a id="11029" href="NbE.html#11015" class="Bound">σ</a> <a id="11031" href="NbE.html#10937" class="Function Operator">∘</a> <a id="11033" href="NbE.html#11024" class="Bound">τ</a><a id="11034" class="Symbol">)</a> <a id="11036" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="11038" href="NbE.html#11019" class="Bound">s</a> <a id="11040" href="NbE.html#10528" class="Function Operator">[</a> <a id="11042" href="NbE.html#11024" class="Bound">τ</a> <a id="11044" href="NbE.html#10528" class="Function Operator">]</a>
</pre>
We will want a weakening substitution, that allows us
to weaken a well typed term in Γ to a context Γ′ that
extends Γ.

Really, this substitution is the renaming substitution
between extended contexts
<pre class="Agda"><a id="weaken"></a><a id="11260" href="NbE.html#11260" class="Function">weaken</a> <a id="11267" class="Symbol">:</a> <a id="11269" class="Symbol">∀</a> <a id="11271" class="Symbol">{</a><a id="11272" href="NbE.html#11272" class="Bound">Γ′</a> <a id="11275" href="NbE.html#11275" class="Bound">Γ</a> <a id="11277" class="Symbol">:</a> <a id="11279" href="NbE.html#1943" class="Datatype">Ctx</a><a id="11282" class="Symbol">}</a>
       <a id="11291" class="Symbol">→</a> <a id="11293" href="NbE.html#11272" class="Bound">Γ′</a> <a id="11296" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="11298" href="NbE.html#11275" class="Bound">Γ</a>
         <a id="11309" class="Comment">--------</a>
       <a id="11325" class="Symbol">→</a> <a id="11327" href="NbE.html#6688" class="Datatype">Sub</a> <a id="11331" href="NbE.html#11272" class="Bound">Γ′</a> <a id="11334" href="NbE.html#11275" class="Bound">Γ</a>
<a id="11336" href="NbE.html#11260" class="Function">weaken</a> <a id="11343" href="NbE.html#11343" class="Bound">pf</a> <a id="11346" class="Symbol">=</a> <a id="11348" href="NbE.html#9824" class="Function">subst-ren</a> <a id="11358" class="Symbol">(</a><a id="11359" href="NbE.html#9583" class="Function">ren-≤</a> <a id="11365" href="NbE.html#11343" class="Bound">pf</a><a id="11367" class="Symbol">)</a>
</pre>
For convenience, we will also want some shorthand for
applying a weakening substitution to a term
<pre class="Agda"><a id="_≤⊢_"></a><a id="11480" href="NbE.html#11480" class="Function Operator">_≤⊢_</a> <a id="11485" class="Symbol">:</a> <a id="11487" class="Symbol">∀</a> <a id="11489" class="Symbol">{</a><a id="11490" href="NbE.html#11490" class="Bound">Γ′</a> <a id="11493" href="NbE.html#11493" class="Bound">Γ</a> <a id="11495" class="Symbol">:</a> <a id="11497" href="NbE.html#1943" class="Datatype">Ctx</a><a id="11500" class="Symbol">}</a> <a id="11502" class="Symbol">{</a><a id="11503" href="NbE.html#11503" class="Bound">T</a> <a id="11505" class="Symbol">:</a> <a id="11507" href="NbE.html#1051" class="Datatype">Type</a><a id="11511" class="Symbol">}</a> <a id="11513" class="Symbol">→</a> <a id="11515" href="NbE.html#11490" class="Bound">Γ′</a> <a id="11518" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="11520" href="NbE.html#11493" class="Bound">Γ</a> <a id="11522" class="Symbol">→</a> <a id="11524" href="NbE.html#11493" class="Bound">Γ</a> <a id="11526" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="11528" href="NbE.html#11503" class="Bound">T</a> <a id="11530" class="Symbol">→</a> <a id="11532" href="NbE.html#11490" class="Bound">Γ′</a> <a id="11535" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="11537" href="NbE.html#11503" class="Bound">T</a>
<a id="11539" href="NbE.html#11539" class="Bound">pf</a> <a id="11542" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="11545" href="NbE.html#11545" class="Bound">t</a> <a id="11547" class="Symbol">=</a> <a id="11549" href="NbE.html#11545" class="Bound">t</a> <a id="11551" href="NbE.html#10528" class="Function Operator">[</a> <a id="11553" href="NbE.html#11260" class="Function">weaken</a> <a id="11560" href="NbE.html#11539" class="Bound">pf</a> <a id="11563" href="NbE.html#10528" class="Function Operator">]</a>

<a id="11566" class="Keyword">infixr</a> <a id="11573" class="Number">5</a> <a id="11575" href="NbE.html#11480" class="Function Operator">_≤⊢_</a>
</pre>
Additionally, we define an identity and incrementing
parallel substitution, which are simply the identity and
incrementing renaming substitutions
<pre class="Agda"><a id="subst-id"></a><a id="11739" href="NbE.html#11739" class="Function">subst-id</a> <a id="11748" class="Symbol">:</a> <a id="11750" class="Symbol">∀</a> <a id="11752" class="Symbol">{</a><a id="11753" href="NbE.html#11753" class="Bound">Γ</a> <a id="11755" class="Symbol">:</a> <a id="11757" href="NbE.html#1943" class="Datatype">Ctx</a><a id="11760" class="Symbol">}</a> <a id="11762" class="Symbol">→</a> <a id="11764" href="NbE.html#6688" class="Datatype">Sub</a> <a id="11768" href="NbE.html#11753" class="Bound">Γ</a> <a id="11770" href="NbE.html#11753" class="Bound">Γ</a>
<a id="11772" href="NbE.html#11739" class="Function">subst-id</a> <a id="11781" class="Symbol">=</a> <a id="11783" href="NbE.html#9824" class="Function">subst-ren</a> <a id="11793" href="NbE.html#9240" class="Function">ren-id</a>

<a id="subst-incr"></a><a id="11801" href="NbE.html#11801" class="Function">subst-incr</a> <a id="11812" class="Symbol">:</a> <a id="11814" class="Symbol">∀</a> <a id="11816" class="Symbol">{</a><a id="11817" href="NbE.html#11817" class="Bound">Γ</a> <a id="11819" class="Symbol">:</a> <a id="11821" href="NbE.html#1943" class="Datatype">Ctx</a><a id="11824" class="Symbol">}</a> <a id="11826" class="Symbol">{</a><a id="11827" href="NbE.html#11827" class="Bound">T</a> <a id="11829" class="Symbol">:</a> <a id="11831" href="NbE.html#1051" class="Datatype">Type</a><a id="11835" class="Symbol">}</a> <a id="11837" class="Symbol">→</a> <a id="11839" href="NbE.html#6688" class="Datatype">Sub</a> <a id="11843" class="Symbol">(</a><a id="11844" href="NbE.html#11817" class="Bound">Γ</a> <a id="11846" class="InductiveConstructor Operator">,</a> <a id="11848" href="NbE.html#11827" class="Bound">T</a><a id="11849" class="Symbol">)</a> <a id="11851" href="NbE.html#11817" class="Bound">Γ</a>
<a id="11853" href="NbE.html#11801" class="Function">subst-incr</a> <a id="11864" class="Symbol">=</a> <a id="11866" href="NbE.html#9824" class="Function">subst-ren</a> <a id="11876" href="NbE.html#9324" class="Function">ren-incr</a>
</pre>
The incrementing substitution will be used to establish
η-equivalence, we will also benfit from some shorthand for
its application to a term
<pre class="Agda"><a id="_↑⊢_"></a><a id="12039" href="NbE.html#12039" class="Function Operator">_↑⊢_</a> <a id="12044" class="Symbol">:</a> <a id="12046" class="Symbol">∀</a> <a id="12048" class="Symbol">{</a><a id="12049" href="NbE.html#12049" class="Bound">Γ</a> <a id="12051" class="Symbol">:</a> <a id="12053" href="NbE.html#1943" class="Datatype">Ctx</a><a id="12056" class="Symbol">}</a> <a id="12058" class="Symbol">{</a><a id="12059" href="NbE.html#12059" class="Bound">T</a> <a id="12061" class="Symbol">:</a> <a id="12063" href="NbE.html#1051" class="Datatype">Type</a><a id="12067" class="Symbol">}</a> <a id="12069" class="Symbol">→</a> <a id="12071" class="Symbol">(</a><a id="12072" href="NbE.html#12072" class="Bound">S</a> <a id="12074" class="Symbol">:</a> <a id="12076" href="NbE.html#1051" class="Datatype">Type</a><a id="12080" class="Symbol">)</a> <a id="12082" class="Symbol">→</a> <a id="12084" href="NbE.html#12049" class="Bound">Γ</a> <a id="12086" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="12088" href="NbE.html#12059" class="Bound">T</a> <a id="12090" class="Symbol">→</a> <a id="12092" href="NbE.html#12049" class="Bound">Γ</a> <a id="12094" class="InductiveConstructor Operator">,</a> <a id="12096" href="NbE.html#12072" class="Bound">S</a> <a id="12098" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="12100" href="NbE.html#12059" class="Bound">T</a>
<a id="12102" class="Symbol">_</a> <a id="12104" href="NbE.html#12039" class="Function Operator">↑⊢</a> <a id="12107" href="NbE.html#12107" class="Bound">t</a> <a id="12109" class="Symbol">=</a> <a id="12111" href="NbE.html#12107" class="Bound">t</a> <a id="12113" href="NbE.html#10528" class="Function Operator">[</a> <a id="12115" href="NbE.html#11801" class="Function">subst-incr</a> <a id="12126" href="NbE.html#10528" class="Function Operator">]</a>

<a id="12129" class="Keyword">infixr</a> <a id="12136" class="Number">5</a> <a id="12138" href="NbE.html#12039" class="Function Operator">_↑⊢_</a>
</pre>
To establish β-equivalence, we define an operation for
substituting the first free variable in a term `Γ , x:S ⊢ t : T`
with a term `Γ ⊢ s : S` (i.e. `t [ s / x ]`), which is really
shorthand for `t [ id , s / x ]`
<pre class="Agda"><a id="_[_/x]"></a><a id="12371" href="NbE.html#12371" class="Function Operator">_[_/x]</a> <a id="12378" class="Symbol">:</a> <a id="12380" class="Symbol">∀</a> <a id="12382" class="Symbol">{</a><a id="12383" href="NbE.html#12383" class="Bound">Γ</a> <a id="12385" class="Symbol">:</a> <a id="12387" href="NbE.html#1943" class="Datatype">Ctx</a><a id="12390" class="Symbol">}</a> <a id="12392" class="Symbol">{</a><a id="12393" href="NbE.html#12393" class="Bound">S</a> <a id="12395" href="NbE.html#12395" class="Bound">T</a> <a id="12397" class="Symbol">:</a> <a id="12399" href="NbE.html#1051" class="Datatype">Type</a><a id="12403" class="Symbol">}</a>
  <a id="12407" class="Symbol">→</a> <a id="12409" href="NbE.html#12383" class="Bound">Γ</a> <a id="12411" class="InductiveConstructor Operator">,</a> <a id="12413" href="NbE.html#12395" class="Bound">T</a> <a id="12415" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="12417" href="NbE.html#12393" class="Bound">S</a>
  <a id="12421" class="Symbol">→</a> <a id="12423" href="NbE.html#12383" class="Bound">Γ</a> <a id="12425" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="12427" href="NbE.html#12395" class="Bound">T</a>
    <a id="12433" class="Comment">---------</a>
  <a id="12445" class="Symbol">→</a> <a id="12447" href="NbE.html#12383" class="Bound">Γ</a> <a id="12449" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="12451" href="NbE.html#12393" class="Bound">S</a>
<a id="12453" href="NbE.html#12453" class="Bound">s</a> <a id="12455" href="NbE.html#12371" class="Function Operator">[</a> <a id="12457" href="NbE.html#12457" class="Bound">t</a> <a id="12459" href="NbE.html#12371" class="Function Operator">/x]</a> <a id="12463" class="Symbol">=</a>  <a id="12466" href="NbE.html#12453" class="Bound">s</a> <a id="12468" href="NbE.html#10528" class="Function Operator">[</a> <a id="12470" href="NbE.html#11739" class="Function">subst-id</a> <a id="12479" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="12481" href="NbE.html#12457" class="Bound">t</a> <a id="12483" href="NbE.html#10528" class="Function Operator">]</a>

<a id="12486" class="Keyword">infix</a> <a id="12492" class="Number">8</a> <a id="12494" href="NbE.html#12371" class="Function Operator">_[_/x]</a>
</pre>
With these defined, we can introduce a new relation between two
terms: definitional equality. In the thesis, this is
written as `Γ ⊢ t = t′ : T`, we will use t == t′ in Agda

The relation is written such that the definitional equality
of two terms implies the equality of their interpretations
(`Γ ⊢ t = t′ : T` iff `⟦ t ⟧ = ⟦ t′ ⟧`); it is the extension of
Βη-equivalence for System T suggested earlier

We will use this relation to prove the soundness property
of preservation of meaning for NbE (i.e. `⟦ nf(t) ⟧ = ⟦ t ⟧`)
<pre class="Agda"><a id="13039" class="Keyword">data</a> <a id="_==_"></a><a id="13044" href="NbE.html#13044" class="Datatype Operator">_==_</a> <a id="13049" class="Symbol">:</a> <a id="13051" class="Symbol">∀</a> <a id="13053" class="Symbol">{</a><a id="13054" href="NbE.html#13054" class="Bound">Γ</a> <a id="13056" class="Symbol">:</a> <a id="13058" href="NbE.html#1943" class="Datatype">Ctx</a><a id="13061" class="Symbol">}</a> <a id="13063" class="Symbol">{</a><a id="13064" href="NbE.html#13064" class="Bound">T</a> <a id="13066" class="Symbol">:</a> <a id="13068" href="NbE.html#1051" class="Datatype">Type</a><a id="13072" class="Symbol">}</a> <a id="13074" class="Symbol">→</a> <a id="13076" href="NbE.html#13054" class="Bound">Γ</a> <a id="13078" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13080" href="NbE.html#13064" class="Bound">T</a> <a id="13082" class="Symbol">→</a> <a id="13084" href="NbE.html#13054" class="Bound">Γ</a> <a id="13086" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13088" href="NbE.html#13064" class="Bound">T</a> <a id="13090" class="Symbol">→</a> <a id="13092" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="13096" class="Keyword">where</a>

  <a id="13105" class="Comment">-- Computation rules</a>
  <a id="_==_.β-rec-z"></a><a id="13128" href="NbE.html#13128" class="InductiveConstructor">β-rec-z</a> <a id="13136" class="Symbol">:</a> <a id="13138" class="Symbol">∀</a> <a id="13140" class="Symbol">{</a><a id="13141" href="NbE.html#13141" class="Bound">Γ</a> <a id="13143" class="Symbol">:</a> <a id="13145" href="NbE.html#1943" class="Datatype">Ctx</a><a id="13148" class="Symbol">}</a> <a id="13150" class="Symbol">{</a><a id="13151" href="NbE.html#13151" class="Bound">T</a> <a id="13153" class="Symbol">:</a> <a id="13155" href="NbE.html#1051" class="Datatype">Type</a><a id="13159" class="Symbol">}</a>
              <a id="13175" class="Symbol">{</a><a id="13176" href="NbE.html#13176" class="Bound">z</a> <a id="13178" class="Symbol">:</a> <a id="13180" href="NbE.html#13141" class="Bound">Γ</a> <a id="13182" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13184" href="NbE.html#13151" class="Bound">T</a><a id="13185" class="Symbol">}</a>
              <a id="13201" class="Symbol">{</a><a id="13202" href="NbE.html#13202" class="Bound">s</a> <a id="13204" class="Symbol">:</a> <a id="13206" href="NbE.html#13141" class="Bound">Γ</a> <a id="13208" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13210" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="13214" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="13216" href="NbE.html#13151" class="Bound">T</a> <a id="13218" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="13220" href="NbE.html#13151" class="Bound">T</a><a id="13221" class="Symbol">}</a>
              <a id="13237" class="Comment">-----------------------</a>
            <a id="13273" class="Symbol">→</a> <a id="13275" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="13279" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13281" href="NbE.html#13176" class="Bound">z</a> <a id="13283" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13285" href="NbE.html#13202" class="Bound">s</a> <a id="13287" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13289" href="NbE.html#4377" class="InductiveConstructor">zero</a> <a id="13294" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="13297" href="NbE.html#13176" class="Bound">z</a>

  <a id="_==_.β-rec-s"></a><a id="13302" href="NbE.html#13302" class="InductiveConstructor">β-rec-s</a> <a id="13310" class="Symbol">:</a> <a id="13312" class="Symbol">∀</a> <a id="13314" class="Symbol">{</a><a id="13315" href="NbE.html#13315" class="Bound">Γ</a> <a id="13317" class="Symbol">:</a> <a id="13319" href="NbE.html#1943" class="Datatype">Ctx</a><a id="13322" class="Symbol">}</a> <a id="13324" class="Symbol">{</a><a id="13325" href="NbE.html#13325" class="Bound">T</a> <a id="13327" class="Symbol">:</a> <a id="13329" href="NbE.html#1051" class="Datatype">Type</a><a id="13333" class="Symbol">}</a>
      <a id="13341" class="Symbol">{</a><a id="13342" href="NbE.html#13342" class="Bound">z</a> <a id="13344" class="Symbol">:</a> <a id="13346" href="NbE.html#13315" class="Bound">Γ</a> <a id="13348" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13350" href="NbE.html#13325" class="Bound">T</a><a id="13351" class="Symbol">}</a>
      <a id="13359" class="Symbol">{</a><a id="13360" href="NbE.html#13360" class="Bound">s</a> <a id="13362" class="Symbol">:</a> <a id="13364" href="NbE.html#13315" class="Bound">Γ</a> <a id="13366" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13368" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="13372" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="13374" href="NbE.html#13325" class="Bound">T</a> <a id="13376" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="13378" href="NbE.html#13325" class="Bound">T</a><a id="13379" class="Symbol">}</a>
      <a id="13387" class="Symbol">{</a><a id="13388" href="NbE.html#13388" class="Bound">n</a> <a id="13390" class="Symbol">:</a> <a id="13392" href="NbE.html#13315" class="Bound">Γ</a> <a id="13394" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13396" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="13399" class="Symbol">}</a>
      <a id="13407" class="Comment">----------------------------------------------------</a>
    <a id="13464" class="Symbol">→</a> <a id="13466" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="13470" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13472" href="NbE.html#13342" class="Bound">z</a> <a id="13474" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13476" href="NbE.html#13360" class="Bound">s</a> <a id="13478" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13480" class="Symbol">(</a><a id="13481" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="13485" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13487" href="NbE.html#13388" class="Bound">n</a><a id="13488" class="Symbol">)</a> <a id="13490" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="13493" href="NbE.html#13360" class="Bound">s</a> <a id="13495" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13497" href="NbE.html#13388" class="Bound">n</a> <a id="13499" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13501" class="Symbol">(</a><a id="13502" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="13506" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13508" href="NbE.html#13342" class="Bound">z</a> <a id="13510" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13512" href="NbE.html#13360" class="Bound">s</a> <a id="13514" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13516" href="NbE.html#13388" class="Bound">n</a><a id="13517" class="Symbol">)</a>

  <a id="_==_.β-ƛ"></a><a id="13522" href="NbE.html#13522" class="InductiveConstructor">β-ƛ</a> <a id="13526" class="Symbol">:</a> <a id="13528" class="Symbol">∀</a> <a id="13530" class="Symbol">{</a><a id="13531" href="NbE.html#13531" class="Bound">Γ</a> <a id="13533" class="Symbol">:</a> <a id="13535" href="NbE.html#1943" class="Datatype">Ctx</a><a id="13538" class="Symbol">}</a> <a id="13540" class="Symbol">{</a><a id="13541" href="NbE.html#13541" class="Bound">S</a> <a id="13543" href="NbE.html#13543" class="Bound">T</a> <a id="13545" class="Symbol">:</a> <a id="13547" href="NbE.html#1051" class="Datatype">Type</a><a id="13551" class="Symbol">}</a>
          <a id="13563" class="Symbol">{</a><a id="13564" href="NbE.html#13564" class="Bound">t</a> <a id="13566" class="Symbol">:</a> <a id="13568" href="NbE.html#13531" class="Bound">Γ</a> <a id="13570" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="13572" href="NbE.html#13541" class="Bound">S</a> <a id="13574" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13576" href="NbE.html#13543" class="Bound">T</a><a id="13577" class="Symbol">}</a>
          <a id="13589" class="Symbol">{</a><a id="13590" href="NbE.html#13590" class="Bound">s</a> <a id="13592" class="Symbol">:</a> <a id="13594" href="NbE.html#13531" class="Bound">Γ</a> <a id="13596" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13598" href="NbE.html#13541" class="Bound">S</a><a id="13599" class="Symbol">}</a>
          <a id="13611" class="Comment">----------------------</a>
        <a id="13642" class="Symbol">→</a> <a id="13644" class="Symbol">(</a><a id="13645" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="13647" href="NbE.html#13564" class="Bound">t</a><a id="13648" class="Symbol">)</a> <a id="13650" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13652" href="NbE.html#13590" class="Bound">s</a> <a id="13654" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="13657" href="NbE.html#13564" class="Bound">t</a> <a id="13659" href="NbE.html#12371" class="Function Operator">[</a> <a id="13661" href="NbE.html#13590" class="Bound">s</a> <a id="13663" href="NbE.html#12371" class="Function Operator">/x]</a>

  <a id="13670" class="Comment">-- Function extensionality, i.e. Γ ⊢ t = Γ ⊢ λx. t x : S ⇒ T</a>
  <a id="_==_.η"></a><a id="13733" href="NbE.html#13733" class="InductiveConstructor">η</a> <a id="13735" class="Symbol">:</a> <a id="13737" class="Symbol">∀</a> <a id="13739" class="Symbol">{</a><a id="13740" href="NbE.html#13740" class="Bound">Γ</a> <a id="13742" class="Symbol">:</a> <a id="13744" href="NbE.html#1943" class="Datatype">Ctx</a><a id="13747" class="Symbol">}</a> <a id="13749" class="Symbol">{</a><a id="13750" href="NbE.html#13750" class="Bound">S</a> <a id="13752" href="NbE.html#13752" class="Bound">T</a> <a id="13754" class="Symbol">:</a> <a id="13756" href="NbE.html#1051" class="Datatype">Type</a><a id="13760" class="Symbol">}</a>
        <a id="13770" class="Symbol">{</a><a id="13771" href="NbE.html#13771" class="Bound">t</a> <a id="13773" class="Symbol">:</a> <a id="13775" href="NbE.html#13740" class="Bound">Γ</a> <a id="13777" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="13779" href="NbE.html#13750" class="Bound">S</a> <a id="13781" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="13783" href="NbE.html#13752" class="Bound">T</a><a id="13784" class="Symbol">}</a>
        <a id="13794" class="Comment">----------------------</a>
      <a id="13823" class="Symbol">→</a> <a id="13825" href="NbE.html#13771" class="Bound">t</a> <a id="13827" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="13830" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="13832" class="Symbol">(</a><a id="13833" href="NbE.html#13750" class="Bound">S</a> <a id="13835" href="NbE.html#12039" class="Function Operator">↑⊢</a> <a id="13838" href="NbE.html#13771" class="Bound">t</a><a id="13839" class="Symbol">)</a> <a id="13841" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="13843" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="13845" href="NbE.html#3705" class="InductiveConstructor">`Z</a>

  <a id="13851" class="Comment">-- Compatibility rules</a>
  <a id="13876" class="Comment">--</a>
  <a id="13881" class="Comment">-- Note that we do not need a rule for constants and variables as</a>
  <a id="13949" class="Comment">-- is given in the thesis as we are using an intrinsically typed</a>
  <a id="14016" class="Comment">-- representation, so refl catches all of these cases</a>
  <a id="_==_.abs-compatible"></a><a id="14072" href="NbE.html#14072" class="InductiveConstructor">abs-compatible</a> <a id="14087" class="Symbol">:</a> <a id="14089" class="Symbol">∀</a> <a id="14091" class="Symbol">{</a><a id="14092" href="NbE.html#14092" class="Bound">Γ</a> <a id="14094" class="Symbol">:</a> <a id="14096" href="NbE.html#1943" class="Datatype">Ctx</a><a id="14099" class="Symbol">}</a> <a id="14101" class="Symbol">{</a><a id="14102" href="NbE.html#14102" class="Bound">S</a> <a id="14104" href="NbE.html#14104" class="Bound">T</a> <a id="14106" class="Symbol">:</a> <a id="14108" href="NbE.html#1051" class="Datatype">Type</a><a id="14112" class="Symbol">}</a> <a id="14114" class="Symbol">{</a><a id="14115" href="NbE.html#14115" class="Bound">t</a> <a id="14117" href="NbE.html#14117" class="Bound">t′</a> <a id="14120" class="Symbol">:</a> <a id="14122" href="NbE.html#14092" class="Bound">Γ</a> <a id="14124" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="14126" href="NbE.html#14102" class="Bound">S</a> <a id="14128" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="14130" href="NbE.html#14104" class="Bound">T</a><a id="14131" class="Symbol">}</a>
                   <a id="14152" class="Symbol">→</a> <a id="14154" href="NbE.html#14115" class="Bound">t</a> <a id="14156" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14159" href="NbE.html#14117" class="Bound">t′</a>
                     <a id="14183" class="Comment">-----------</a>
                   <a id="14214" class="Symbol">→</a> <a id="14216" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="14218" href="NbE.html#14115" class="Bound">t</a> <a id="14220" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14223" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="14225" href="NbE.html#14117" class="Bound">t′</a>

  <a id="_==_.app-compatible"></a><a id="14231" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="14246" class="Symbol">:</a> <a id="14248" class="Symbol">∀</a> <a id="14250" class="Symbol">{</a><a id="14251" href="NbE.html#14251" class="Bound">Γ</a> <a id="14253" class="Symbol">:</a> <a id="14255" href="NbE.html#1943" class="Datatype">Ctx</a><a id="14258" class="Symbol">}</a> <a id="14260" class="Symbol">{</a><a id="14261" href="NbE.html#14261" class="Bound">S</a> <a id="14263" href="NbE.html#14263" class="Bound">T</a> <a id="14265" class="Symbol">:</a> <a id="14267" href="NbE.html#1051" class="Datatype">Type</a><a id="14271" class="Symbol">}</a>
                     <a id="14294" class="Symbol">{</a><a id="14295" href="NbE.html#14295" class="Bound">r</a> <a id="14297" href="NbE.html#14297" class="Bound">r′</a> <a id="14300" class="Symbol">:</a> <a id="14302" href="NbE.html#14251" class="Bound">Γ</a> <a id="14304" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="14306" href="NbE.html#14261" class="Bound">S</a> <a id="14308" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="14310" href="NbE.html#14263" class="Bound">T</a><a id="14311" class="Symbol">}</a> <a id="14313" class="Symbol">{</a><a id="14314" href="NbE.html#14314" class="Bound">s</a> <a id="14316" href="NbE.html#14316" class="Bound">s′</a> <a id="14319" class="Symbol">:</a> <a id="14321" href="NbE.html#14251" class="Bound">Γ</a> <a id="14323" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="14325" href="NbE.html#14261" class="Bound">S</a><a id="14326" class="Symbol">}</a>
                   <a id="14347" class="Symbol">→</a> <a id="14349" href="NbE.html#14295" class="Bound">r</a> <a id="14351" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14354" href="NbE.html#14297" class="Bound">r′</a>
                   <a id="14376" class="Symbol">→</a> <a id="14378" href="NbE.html#14314" class="Bound">s</a> <a id="14380" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14383" href="NbE.html#14316" class="Bound">s′</a>
                     <a id="14407" class="Comment">----------------</a>
                   <a id="14443" class="Symbol">→</a> <a id="14445" href="NbE.html#14295" class="Bound">r</a> <a id="14447" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="14449" href="NbE.html#14314" class="Bound">s</a> <a id="14451" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14454" href="NbE.html#14297" class="Bound">r′</a> <a id="14457" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="14459" href="NbE.html#14316" class="Bound">s′</a>

  <a id="14465" class="Comment">-- Equivalence rules</a>
  <a id="_==_.refl"></a><a id="14488" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="14493" class="Symbol">:</a> <a id="14495" class="Symbol">∀</a> <a id="14497" class="Symbol">{</a><a id="14498" href="NbE.html#14498" class="Bound">Γ</a> <a id="14500" class="Symbol">:</a> <a id="14502" href="NbE.html#1943" class="Datatype">Ctx</a><a id="14505" class="Symbol">}</a> <a id="14507" class="Symbol">{</a><a id="14508" href="NbE.html#14508" class="Bound">T</a> <a id="14510" class="Symbol">:</a> <a id="14512" href="NbE.html#1051" class="Datatype">Type</a><a id="14516" class="Symbol">}</a> <a id="14518" class="Symbol">{</a><a id="14519" href="NbE.html#14519" class="Bound">t</a> <a id="14521" class="Symbol">:</a> <a id="14523" href="NbE.html#14498" class="Bound">Γ</a> <a id="14525" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="14527" href="NbE.html#14508" class="Bound">T</a><a id="14528" class="Symbol">}</a>
           <a id="14541" class="Comment">------</a>
         <a id="14557" class="Symbol">→</a> <a id="14559" href="NbE.html#14519" class="Bound">t</a> <a id="14561" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14564" href="NbE.html#14519" class="Bound">t</a>

  <a id="_==_.sym"></a><a id="14569" href="NbE.html#14569" class="InductiveConstructor">sym</a> <a id="14573" class="Symbol">:</a> <a id="14575" class="Symbol">∀</a> <a id="14577" class="Symbol">{</a><a id="14578" href="NbE.html#14578" class="Bound">Γ</a> <a id="14580" class="Symbol">:</a> <a id="14582" href="NbE.html#1943" class="Datatype">Ctx</a><a id="14585" class="Symbol">}</a> <a id="14587" class="Symbol">{</a><a id="14588" href="NbE.html#14588" class="Bound">T</a> <a id="14590" class="Symbol">:</a> <a id="14592" href="NbE.html#1051" class="Datatype">Type</a><a id="14596" class="Symbol">}</a> <a id="14598" class="Symbol">{</a><a id="14599" href="NbE.html#14599" class="Bound">t</a> <a id="14601" href="NbE.html#14601" class="Bound">t′</a> <a id="14604" class="Symbol">:</a> <a id="14606" href="NbE.html#14578" class="Bound">Γ</a> <a id="14608" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="14610" href="NbE.html#14588" class="Bound">T</a><a id="14611" class="Symbol">}</a>
        <a id="14621" class="Symbol">→</a> <a id="14623" href="NbE.html#14599" class="Bound">t</a> <a id="14625" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14628" href="NbE.html#14601" class="Bound">t′</a>
          <a id="14641" class="Comment">-------</a>
        <a id="14657" class="Symbol">→</a> <a id="14659" href="NbE.html#14601" class="Bound">t′</a> <a id="14662" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14665" href="NbE.html#14599" class="Bound">t</a>

  <a id="_==_.trans"></a><a id="14670" href="NbE.html#14670" class="InductiveConstructor">trans</a> <a id="14676" class="Symbol">:</a> <a id="14678" class="Symbol">∀</a> <a id="14680" class="Symbol">{</a><a id="14681" href="NbE.html#14681" class="Bound">Γ</a> <a id="14683" class="Symbol">:</a> <a id="14685" href="NbE.html#1943" class="Datatype">Ctx</a><a id="14688" class="Symbol">}</a> <a id="14690" class="Symbol">{</a><a id="14691" href="NbE.html#14691" class="Bound">T</a> <a id="14693" class="Symbol">:</a> <a id="14695" href="NbE.html#1051" class="Datatype">Type</a><a id="14699" class="Symbol">}</a> <a id="14701" class="Symbol">{</a><a id="14702" href="NbE.html#14702" class="Bound">t₁</a> <a id="14705" href="NbE.html#14705" class="Bound">t₂</a> <a id="14708" href="NbE.html#14708" class="Bound">t₃</a> <a id="14711" class="Symbol">:</a> <a id="14713" href="NbE.html#14681" class="Bound">Γ</a> <a id="14715" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="14717" href="NbE.html#14691" class="Bound">T</a><a id="14718" class="Symbol">}</a>
          <a id="14730" class="Symbol">→</a> <a id="14732" href="NbE.html#14702" class="Bound">t₁</a> <a id="14735" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14738" href="NbE.html#14705" class="Bound">t₂</a>
          <a id="14751" class="Symbol">→</a> <a id="14753" href="NbE.html#14705" class="Bound">t₂</a> <a id="14756" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14759" href="NbE.html#14708" class="Bound">t₃</a>
            <a id="14774" class="Comment">--------</a>
          <a id="14793" class="Symbol">→</a> <a id="14795" href="NbE.html#14702" class="Bound">t₁</a> <a id="14798" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="14801" href="NbE.html#14708" class="Bound">t₃</a>

<a id="14805" class="Keyword">infix</a> <a id="14811" class="Number">3</a> <a id="14813" href="NbE.html#13044" class="Datatype Operator">_==_</a>
</pre>
For the clarity of some of our proofs, it will also be helpful to
have the ability to use equational reasoning with respect to
definitional equality.
<pre class="Agda"><a id="14981" class="Keyword">module</a> <a id="==-Reasoning"></a><a id="14988" href="NbE.html#14988" class="Module">==-Reasoning</a> <a id="15001" class="Keyword">where</a>
  <a id="15009" class="Keyword">infix</a>  <a id="15016" class="Number">1</a> <a id="15018" href="NbE.html#15061" class="Function Operator">begin_</a>
  <a id="15027" class="Keyword">infixr</a> <a id="15034" class="Number">2</a> <a id="15036" href="NbE.html#15171" class="Function Operator">_==⟨_⟩_</a>
  <a id="15046" class="Keyword">infix</a>  <a id="15053" class="Number">3</a> <a id="15055" href="NbE.html#15344" class="Function Operator">_∎</a>

  <a id="==-Reasoning.begin_"></a><a id="15061" href="NbE.html#15061" class="Function Operator">begin_</a> <a id="15068" class="Symbol">:</a> <a id="15070" class="Symbol">∀</a> <a id="15072" class="Symbol">{</a><a id="15073" href="NbE.html#15073" class="Bound">Γ</a> <a id="15075" class="Symbol">:</a> <a id="15077" href="NbE.html#1943" class="Datatype">Ctx</a><a id="15080" class="Symbol">}</a> <a id="15082" class="Symbol">{</a><a id="15083" href="NbE.html#15083" class="Bound">T</a> <a id="15085" class="Symbol">:</a> <a id="15087" href="NbE.html#1051" class="Datatype">Type</a><a id="15091" class="Symbol">}</a> <a id="15093" class="Symbol">{</a><a id="15094" href="NbE.html#15094" class="Bound">t</a> <a id="15096" href="NbE.html#15096" class="Bound">t′</a> <a id="15099" class="Symbol">:</a> <a id="15101" href="NbE.html#15073" class="Bound">Γ</a> <a id="15103" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="15105" href="NbE.html#15083" class="Bound">T</a><a id="15106" class="Symbol">}</a>
    <a id="15112" class="Symbol">→</a> <a id="15114" href="NbE.html#15094" class="Bound">t</a> <a id="15116" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="15119" href="NbE.html#15096" class="Bound">t′</a>
      <a id="15128" class="Comment">---------</a>
    <a id="15142" class="Symbol">→</a> <a id="15144" href="NbE.html#15094" class="Bound">t</a> <a id="15146" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="15149" href="NbE.html#15096" class="Bound">t′</a>
  <a id="15154" href="NbE.html#15061" class="Function Operator">begin</a> <a id="15160" href="NbE.html#15160" class="Bound">pf</a> <a id="15163" class="Symbol">=</a> <a id="15165" href="NbE.html#15160" class="Bound">pf</a>

  <a id="==-Reasoning._==⟨_⟩_"></a><a id="15171" href="NbE.html#15171" class="Function Operator">_==⟨_⟩_</a> <a id="15179" class="Symbol">:</a> <a id="15181" class="Symbol">∀</a> <a id="15183" class="Symbol">{</a><a id="15184" href="NbE.html#15184" class="Bound">Γ</a> <a id="15186" class="Symbol">:</a> <a id="15188" href="NbE.html#1943" class="Datatype">Ctx</a><a id="15191" class="Symbol">}</a> <a id="15193" class="Symbol">{</a><a id="15194" href="NbE.html#15194" class="Bound">T</a> <a id="15196" class="Symbol">:</a> <a id="15198" href="NbE.html#1051" class="Datatype">Type</a><a id="15202" class="Symbol">}</a> <a id="15204" class="Symbol">{</a><a id="15205" href="NbE.html#15205" class="Bound">t₂</a> <a id="15208" href="NbE.html#15208" class="Bound">t₃</a> <a id="15211" class="Symbol">:</a> <a id="15213" href="NbE.html#15184" class="Bound">Γ</a> <a id="15215" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="15217" href="NbE.html#15194" class="Bound">T</a><a id="15218" class="Symbol">}</a>
    <a id="15224" class="Symbol">→</a> <a id="15226" class="Symbol">(</a><a id="15227" href="NbE.html#15227" class="Bound">t₁</a> <a id="15230" class="Symbol">:</a> <a id="15232" href="NbE.html#15184" class="Bound">Γ</a> <a id="15234" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="15236" href="NbE.html#15194" class="Bound">T</a><a id="15237" class="Symbol">)</a>
    <a id="15243" class="Symbol">→</a> <a id="15245" href="NbE.html#15227" class="Bound">t₁</a> <a id="15248" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="15251" href="NbE.html#15205" class="Bound">t₂</a>
    <a id="15258" class="Symbol">→</a> <a id="15260" href="NbE.html#15205" class="Bound">t₂</a> <a id="15263" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="15266" href="NbE.html#15208" class="Bound">t₃</a>
      <a id="15275" class="Comment">-----</a>
    <a id="15285" class="Symbol">→</a> <a id="15287" href="NbE.html#15227" class="Bound">t₁</a> <a id="15290" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="15293" href="NbE.html#15208" class="Bound">t₃</a>
  <a id="15298" href="NbE.html#15298" class="Bound">t₁</a> <a id="15301" href="NbE.html#15171" class="Function Operator">==⟨</a> <a id="15305" href="NbE.html#15305" class="Bound">t₁≡t₂</a> <a id="15311" href="NbE.html#15171" class="Function Operator">⟩</a> <a id="15313" href="NbE.html#15313" class="Bound">t₂≡t₃</a>  <a id="15320" class="Symbol">=</a>  <a id="15323" href="NbE.html#14670" class="InductiveConstructor">trans</a> <a id="15329" href="NbE.html#15305" class="Bound">t₁≡t₂</a> <a id="15335" href="NbE.html#15313" class="Bound">t₂≡t₃</a>

  <a id="==-Reasoning._∎"></a><a id="15344" href="NbE.html#15344" class="Function Operator">_∎</a> <a id="15347" class="Symbol">:</a> <a id="15349" class="Symbol">∀</a> <a id="15351" class="Symbol">{</a><a id="15352" href="NbE.html#15352" class="Bound">Γ</a> <a id="15354" class="Symbol">:</a> <a id="15356" href="NbE.html#1943" class="Datatype">Ctx</a><a id="15359" class="Symbol">}</a> <a id="15361" class="Symbol">{</a><a id="15362" href="NbE.html#15362" class="Bound">T</a> <a id="15364" class="Symbol">:</a> <a id="15366" href="NbE.html#1051" class="Datatype">Type</a><a id="15370" class="Symbol">}</a> <a id="15372" class="Symbol">→</a> <a id="15374" class="Symbol">(</a><a id="15375" href="NbE.html#15375" class="Bound">t</a> <a id="15377" class="Symbol">:</a> <a id="15379" href="NbE.html#15352" class="Bound">Γ</a> <a id="15381" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="15383" href="NbE.html#15362" class="Bound">T</a><a id="15384" class="Symbol">)</a>
      <a id="15392" class="Comment">-----</a>
    <a id="15402" class="Symbol">→</a> <a id="15404" href="NbE.html#15375" class="Bound">t</a> <a id="15406" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="15409" href="NbE.html#15375" class="Bound">t</a>
  <a id="15413" href="NbE.html#15413" class="Bound">t</a> <a id="15415" href="NbE.html#15344" class="Function Operator">∎</a>  <a id="15418" class="Symbol">=</a>  <a id="15421" href="NbE.html#14488" class="InductiveConstructor">refl</a>

<a id="15427" class="Keyword">open</a> <a id="15432" href="NbE.html#14988" class="Module">==-Reasoning</a> <a id="15445" class="Keyword">public</a>
</pre>
Now, we are ready to start defining the algorithm for normalization by
evaluation. Normalization by evaluation is the process of obtaining the normal
form of a term by evaluating it in a meta language (in our case, Agda).

Evaluating terms in System T in our meta language will require defining the interpretations of its types, contexts, and terms.

We use the following record to represent interpretations of types and contexts in System T, indicated by ⟦_⟧.
<pre class="Agda"><a id="15926" class="Keyword">record</a> <a id="Interpretation"></a><a id="15933" href="NbE.html#15933" class="Record">Interpretation</a> <a id="15948" class="Symbol">(</a><a id="15949" href="NbE.html#15949" class="Bound">D</a> <a id="15951" class="Symbol">:</a> <a id="15953" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="15956" class="Symbol">)</a> <a id="15958" class="Symbol">:</a> <a id="15960" href="Agda.Primitive.html#326" class="Primitive">Set₁</a> <a id="15965" class="Keyword">where</a>
  <a id="15973" class="Keyword">field</a>
    <a id="Interpretation.⟦_⟧"></a><a id="15983" href="NbE.html#15983" class="Field Operator">⟦_⟧</a> <a id="15987" class="Symbol">:</a> <a id="15989" href="NbE.html#15949" class="Bound">D</a> <a id="15991" class="Symbol">→</a> <a id="15993" href="Agda.Primitive.html#326" class="Primitive">Set</a>

<a id="15998" class="Keyword">open</a> <a id="16003" href="NbE.html#15933" class="Module">Interpretation</a> <a id="16018" class="Symbol">{{...}}</a> <a id="16026" class="Keyword">public</a>
</pre>
The thesis first introduces a more traditional interpretation of these,
but these definitions will need to be updated in our final implementation
of the NbE algorithm.

For types, we can interpret naturals in System T as ℕ, and functions in
System T as Agda functions, defined inductively on their types.

    ⟦ nat ⟧ = ℕ
    ⟦ S ⇒ T ⟧ = ⟦ S ⟧ → ⟦ T ⟧

An empty context is interpreted as the unit type, and an extension to
a context is defined inductively, with the extension itself being the
interpretation of the type the context is extended with.

    ⟦ ∅ ⟧ = ⊤
    ⟦ Γ , S ⟧ = ⟦ Γ ⟧ × ⟦ S ⟧

From now on, we will use the metavariable ρ is used to represent elements of ⟦ Γ ⟧ for a context Γ.

The interpretation of a variable expects the interpretation
of a context, and is essentially a lookup:

    ⟦ Γ ∋ x:T ⟧ (ρ ∈ ⟦Γ⟧) ∈ ⟦ T ⟧
    ⟦ Γ , T ∋ x:T ⟧ (ρ , a) = a
    ⟦ Γ , y:S ∋ x:T ⟧ (ρ , _) = ⟦ Γ ∋ x:T ⟧ ρ

The interpretation of a typed term expects the interpretation
of a context as well. It is more involed, so we only include
the rule for variables and abstractions:

    ⟦ Γ ⊢ t : T ⟧ (ρ ∈ ⟦Γ⟧) = ⟦ T ⟧
    ⟦ Γ ⊢ x : T ⟧ ρ = ⟦ Γ ∋ x:T ⟧ ρ
    ⟦ Γ ⊢ λx . t : S ⇒ T ⟧ ρ  a  = ⟦ Γ , x:S ⊢ t : T ⟧ (ρ , a)

As our final definition of interpretation will change, this is
only a rough sketch, but gives an idea of how we can evaluate terms
in Agda. For now, we only include the concrete interpretation of
a context Γ (generalized over any interpretation of types), as it will
remain unchanged.

<pre class="Agda"><a id="17547" class="Keyword">instance</a>
    <a id="17560" class="Comment">-- We only include the concrete interpretation of a</a>
    <a id="17616" class="Comment">-- context Γ, generalized over any interpretation of</a>
    <a id="17673" class="Comment">-- types, to be used with the actual interpretation</a>
    <a id="17729" class="Comment">-- defined later</a>
    <a id="⟦Γ⟧"></a><a id="17750" href="NbE.html#17750" class="Function">⟦Γ⟧</a> <a id="17754" class="Symbol">:</a> <a id="17756" class="Symbol">{{</a><a id="17758" href="NbE.html#17758" class="Bound">_</a> <a id="17760" class="Symbol">:</a> <a id="17762" href="NbE.html#15933" class="Record">Interpretation</a> <a id="17777" href="NbE.html#1051" class="Datatype">Type</a><a id="17781" class="Symbol">}}</a> <a id="17784" class="Symbol">→</a> <a id="17786" href="NbE.html#15933" class="Record">Interpretation</a> <a id="17801" href="NbE.html#1943" class="Datatype">Ctx</a>
    <a id="17809" href="NbE.html#15983" class="Field Operator">Interpretation.⟦</a> <a id="17826" href="NbE.html#17750" class="Function">⟦Γ⟧</a> <a id="17830" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="17832" href="NbE.html#1961" class="InductiveConstructor">∅</a> <a id="17834" class="Symbol">=</a> <a id="17836" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
    <a id="17842" href="NbE.html#15983" class="Field Operator">Interpretation.⟦</a> <a id="17859" href="NbE.html#17750" class="Function">⟦Γ⟧</a> <a id="17863" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="17865" class="Symbol">(</a><a id="17866" href="NbE.html#17866" class="Bound">Γ</a> <a id="17868" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="17870" href="NbE.html#17870" class="Bound">T</a><a id="17871" class="Symbol">)</a> <a id="17873" class="Symbol">=</a> <a id="17875" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="17877" href="NbE.html#17866" class="Bound">Γ</a> <a id="17879" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="17881" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="17883" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="17885" href="NbE.html#17870" class="Bound">T</a> <a id="17887" href="NbE.html#15983" class="Field Operator">⟧</a>
</pre>
To motivate our algorithm, first we recognize that normalization by evaluation is,
intuitively, the evaulation of an expression with unknowns (e.g. variables) to
another, possibly simplified, expression with unknowns.

Because of this, we arrive at the first change to our interpretation of terms.
The interpretation of the base type nat is now terms of type nat in their
normal form -- after all, a variable of type nat is "blocked" and cannot be
evaluated any further. In other words, we now have:

    ⟦ nat ⟧ = terms of type nat in their normal form

From now on, normalized terms with unknowns will be referred to as neutral terms
(indicated by the metavariable 𝓊 for "unknown"), and normalized terms in general
will be referred to as normal terms (indicated by the metavariable 𝓋 for "value").

Additionally, while evaluation gives us the ability to normalize terms,
it also transforms them into our meta language. We want a way to return
to System T, which will be a function we will refer to as reification.
We will refer to its opposite, e.g. the transformation of a term in System T
into our meta language, as reflection.

The normal form of a typed term t in context Γ will be obtained by using
reflection and reification together. The following steps make up a sketch
of the algorithm:

  1) reflect the variables of the context Γ
     (all of which are neutral terms)
  2) interpret the value of the term using the environment
     of reflected variables
  3) "reify" the interpreted value of the term (i.e. returning
     it to a term in normal form)

Before we can actually define the algorithm, we need to formally introduce
normal and neutral terms in Agda, which we define mutually. The constructors
for these represent the different types of normal terms, and they are parametrized
by the terms themselves.

<pre class="Agda"><a id="19729" class="Comment">-- Neutral terms</a>
<a id="19746" class="Keyword">data</a> <a id="Ne"></a><a id="19751" href="NbE.html#19751" class="Datatype">Ne</a> <a id="19754" class="Symbol">(</a><a id="19755" href="NbE.html#19755" class="Bound">T</a> <a id="19757" class="Symbol">:</a> <a id="19759" href="NbE.html#1051" class="Datatype">Type</a><a id="19763" class="Symbol">)</a> <a id="19765" class="Symbol">(</a><a id="19766" href="NbE.html#19766" class="Bound">Γ</a> <a id="19768" class="Symbol">:</a> <a id="19770" href="NbE.html#1943" class="Datatype">Ctx</a><a id="19773" class="Symbol">)</a> <a id="19775" class="Symbol">:</a> <a id="19777" href="NbE.html#19766" class="Bound">Γ</a> <a id="19779" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="19781" href="NbE.html#19755" class="Bound">T</a> <a id="19783" class="Symbol">→</a> <a id="19785" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="19789" class="Comment">-- Normal Terms</a>
<a id="19805" class="Keyword">data</a> <a id="Nf"></a><a id="19810" href="NbE.html#19810" class="Datatype">Nf</a> <a id="19813" class="Symbol">:</a> <a id="19815" class="Symbol">(</a><a id="19816" href="NbE.html#19816" class="Bound">T</a> <a id="19818" class="Symbol">:</a> <a id="19820" href="NbE.html#1051" class="Datatype">Type</a><a id="19824" class="Symbol">)</a> <a id="19826" class="Symbol">→</a> <a id="19828" class="Symbol">(</a><a id="19829" href="NbE.html#19829" class="Bound">Γ</a> <a id="19831" class="Symbol">:</a> <a id="19833" href="NbE.html#1943" class="Datatype">Ctx</a><a id="19836" class="Symbol">)</a> <a id="19838" class="Symbol">→</a> <a id="19840" href="NbE.html#19829" class="Bound">Γ</a> <a id="19842" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="19844" href="NbE.html#19816" class="Bound">T</a> <a id="19846" class="Symbol">→</a> <a id="19848" href="Agda.Primitive.html#326" class="Primitive">Set</a>
</pre>
Neutral terms are normal terms in their blocked form. Variables are the "base
case" for blocked terms. Application on an unknown function to a normal term is
also blocked, as is recursion on an unknown natural.
blocked terms.
<pre class="Agda"><a id="20091" class="Keyword">data</a> <a id="20096" href="NbE.html#19751" class="Datatype">Ne</a> <a id="20099" href="NbE.html#20099" class="Bound">T</a> <a id="20101" href="NbE.html#20101" class="Bound">Γ</a> <a id="20103" class="Keyword">where</a>
  <a id="Ne.ne-var"></a><a id="20111" href="NbE.html#20111" class="InductiveConstructor">ne-var</a> <a id="20118" class="Symbol">:</a> <a id="20120" class="Symbol">(</a><a id="20121" href="NbE.html#20121" class="Bound">x</a> <a id="20123" class="Symbol">:</a> <a id="20125" href="NbE.html#20101" class="Bound">Γ</a> <a id="20127" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="20129" href="NbE.html#20099" class="Bound">T</a><a id="20130" class="Symbol">)</a>
           <a id="20143" class="Comment">------------</a>
         <a id="20165" class="Symbol">→</a> <a id="20167" href="NbE.html#19751" class="Datatype">Ne</a> <a id="20170" href="NbE.html#20099" class="Bound">T</a> <a id="20172" href="NbE.html#20101" class="Bound">Γ</a> <a id="20174" class="Symbol">(</a><a id="20175" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="20177" href="NbE.html#20121" class="Bound">x</a><a id="20178" class="Symbol">)</a>

  <a id="Ne.ne-app"></a><a id="20183" href="NbE.html#20183" class="InductiveConstructor">ne-app</a> <a id="20190" class="Symbol">:</a> <a id="20192" class="Symbol">∀</a> <a id="20194" class="Symbol">{</a><a id="20195" href="NbE.html#20195" class="Bound">S</a> <a id="20197" class="Symbol">:</a> <a id="20199" href="NbE.html#1051" class="Datatype">Type</a><a id="20203" class="Symbol">}</a> <a id="20205" class="Symbol">{</a><a id="20206" href="NbE.html#20206" class="Bound">𝓊</a> <a id="20208" class="Symbol">:</a> <a id="20210" href="NbE.html#20101" class="Bound">Γ</a> <a id="20212" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="20214" href="NbE.html#20195" class="Bound">S</a> <a id="20216" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="20218" href="NbE.html#20099" class="Bound">T</a><a id="20219" class="Symbol">}</a> <a id="20221" class="Symbol">{</a><a id="20222" href="NbE.html#20222" class="Bound">𝓋</a> <a id="20224" class="Symbol">:</a> <a id="20226" href="NbE.html#20101" class="Bound">Γ</a> <a id="20228" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="20230" href="NbE.html#20195" class="Bound">S</a><a id="20231" class="Symbol">}</a>
         <a id="20242" class="Symbol">→</a> <a id="20244" href="NbE.html#19751" class="Datatype">Ne</a> <a id="20247" class="Symbol">(</a><a id="20248" href="NbE.html#20195" class="Bound">S</a> <a id="20250" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="20252" href="NbE.html#20099" class="Bound">T</a><a id="20253" class="Symbol">)</a> <a id="20255" href="NbE.html#20101" class="Bound">Γ</a> <a id="20257" href="NbE.html#20206" class="Bound">𝓊</a>
         <a id="20268" class="Symbol">→</a> <a id="20270" href="NbE.html#19810" class="Datatype">Nf</a> <a id="20273" href="NbE.html#20195" class="Bound">S</a> <a id="20275" href="NbE.html#20101" class="Bound">Γ</a> <a id="20277" href="NbE.html#20222" class="Bound">𝓋</a>
           <a id="20290" class="Comment">--------------</a>
         <a id="20314" class="Symbol">→</a> <a id="20316" href="NbE.html#19751" class="Datatype">Ne</a> <a id="20319" href="NbE.html#20099" class="Bound">T</a> <a id="20321" href="NbE.html#20101" class="Bound">Γ</a> <a id="20323" class="Symbol">(</a><a id="20324" href="NbE.html#20206" class="Bound">𝓊</a> <a id="20326" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="20328" href="NbE.html#20222" class="Bound">𝓋</a><a id="20329" class="Symbol">)</a>

  <a id="Ne.ne-rec"></a><a id="20334" href="NbE.html#20334" class="InductiveConstructor">ne-rec</a> <a id="20341" class="Symbol">:</a> <a id="20343" class="Symbol">{</a><a id="20344" href="NbE.html#20344" class="Bound">𝓋z</a> <a id="20347" class="Symbol">:</a> <a id="20349" href="NbE.html#20101" class="Bound">Γ</a> <a id="20351" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="20353" href="NbE.html#20099" class="Bound">T</a><a id="20354" class="Symbol">}</a> <a id="20356" class="Symbol">{</a><a id="20357" href="NbE.html#20357" class="Bound">𝓋s</a> <a id="20360" class="Symbol">:</a> <a id="20362" href="NbE.html#20101" class="Bound">Γ</a> <a id="20364" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="20366" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="20370" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="20372" href="NbE.html#20099" class="Bound">T</a> <a id="20374" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="20376" href="NbE.html#20099" class="Bound">T</a><a id="20377" class="Symbol">}</a> <a id="20379" class="Symbol">{</a><a id="20380" href="NbE.html#20380" class="Bound">𝓊</a> <a id="20382" class="Symbol">:</a> <a id="20384" href="NbE.html#20101" class="Bound">Γ</a> <a id="20386" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="20388" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="20391" class="Symbol">}</a>
         <a id="20402" class="Symbol">→</a> <a id="20404" href="NbE.html#19810" class="Datatype">Nf</a> <a id="20407" href="NbE.html#20099" class="Bound">T</a> <a id="20409" href="NbE.html#20101" class="Bound">Γ</a> <a id="20411" href="NbE.html#20344" class="Bound">𝓋z</a>
         <a id="20423" class="Symbol">→</a> <a id="20425" href="NbE.html#19810" class="Datatype">Nf</a> <a id="20428" class="Symbol">(</a><a id="20429" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="20433" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="20435" href="NbE.html#20099" class="Bound">T</a> <a id="20437" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="20439" href="NbE.html#20099" class="Bound">T</a><a id="20440" class="Symbol">)</a> <a id="20442" href="NbE.html#20101" class="Bound">Γ</a> <a id="20444" href="NbE.html#20357" class="Bound">𝓋s</a>
         <a id="20456" class="Symbol">→</a> <a id="20458" href="NbE.html#19751" class="Datatype">Ne</a> <a id="20461" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="20465" href="NbE.html#20101" class="Bound">Γ</a> <a id="20467" href="NbE.html#20380" class="Bound">𝓊</a>
           <a id="20480" class="Comment">--------------------------</a>
         <a id="20516" class="Symbol">→</a> <a id="20518" href="NbE.html#19751" class="Datatype">Ne</a> <a id="20521" href="NbE.html#20099" class="Bound">T</a> <a id="20523" href="NbE.html#20101" class="Bound">Γ</a> <a id="20525" class="Symbol">(</a><a id="20526" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="20530" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="20532" href="NbE.html#20344" class="Bound">𝓋z</a> <a id="20535" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="20537" href="NbE.html#20357" class="Bound">𝓋s</a> <a id="20540" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="20542" href="NbE.html#20380" class="Bound">𝓊</a><a id="20543" class="Symbol">)</a>
</pre>
Normal terms are terms in their normal form. `zero`, and `suc` applied to a
normal term are normalized naturals. An abstraction whose body is normalized
is itself normalized, as is any neutral term.
<pre class="Agda"><a id="20757" class="Keyword">data</a> <a id="20762" href="NbE.html#19810" class="Datatype">Nf</a> <a id="20765" class="Keyword">where</a>
  <a id="Nf.nf-zero"></a><a id="20773" href="NbE.html#20773" class="InductiveConstructor">nf-zero</a> <a id="20781" class="Symbol">:</a> <a id="20783" class="Symbol">∀</a> <a id="20785" class="Symbol">{</a><a id="20786" href="NbE.html#20786" class="Bound">Γ</a> <a id="20788" class="Symbol">:</a> <a id="20790" href="NbE.html#1943" class="Datatype">Ctx</a><a id="20793" class="Symbol">}</a> <a id="20795" class="Symbol">→</a> <a id="20797" href="NbE.html#19810" class="Datatype">Nf</a> <a id="20800" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="20804" href="NbE.html#20786" class="Bound">Γ</a> <a id="20806" href="NbE.html#4377" class="InductiveConstructor">zero</a>

  <a id="Nf.nf-suc"></a><a id="20814" href="NbE.html#20814" class="InductiveConstructor">nf-suc</a> <a id="20821" class="Symbol">:</a> <a id="20823" class="Symbol">∀</a> <a id="20825" class="Symbol">{</a><a id="20826" href="NbE.html#20826" class="Bound">Γ</a> <a id="20828" class="Symbol">:</a> <a id="20830" href="NbE.html#1943" class="Datatype">Ctx</a><a id="20833" class="Symbol">}</a> <a id="20835" class="Symbol">{</a><a id="20836" href="NbE.html#20836" class="Bound">𝓋</a> <a id="20838" class="Symbol">:</a> <a id="20840" href="NbE.html#20826" class="Bound">Γ</a> <a id="20842" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="20844" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="20847" class="Symbol">}</a>
         <a id="20858" class="Symbol">→</a> <a id="20860" href="NbE.html#19810" class="Datatype">Nf</a> <a id="20863" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="20867" href="NbE.html#20826" class="Bound">Γ</a> <a id="20869" href="NbE.html#20836" class="Bound">𝓋</a>
           <a id="20882" class="Comment">------------------</a>
         <a id="20910" class="Symbol">→</a> <a id="20912" href="NbE.html#19810" class="Datatype">Nf</a> <a id="20915" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="20919" href="NbE.html#20826" class="Bound">Γ</a> <a id="20921" class="Symbol">(</a><a id="20922" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="20926" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="20928" href="NbE.html#20836" class="Bound">𝓋</a><a id="20929" class="Symbol">)</a>

  <a id="Nf.nf-abs"></a><a id="20934" href="NbE.html#20934" class="InductiveConstructor">nf-abs</a> <a id="20941" class="Symbol">:</a> <a id="20943" class="Symbol">∀</a> <a id="20945" class="Symbol">{</a><a id="20946" href="NbE.html#20946" class="Bound">S</a> <a id="20948" href="NbE.html#20948" class="Bound">T</a> <a id="20950" class="Symbol">:</a> <a id="20952" href="NbE.html#1051" class="Datatype">Type</a><a id="20956" class="Symbol">}</a> <a id="20958" class="Symbol">{</a><a id="20959" href="NbE.html#20959" class="Bound">Γ</a> <a id="20961" class="Symbol">:</a> <a id="20963" href="NbE.html#1943" class="Datatype">Ctx</a><a id="20966" class="Symbol">}</a> <a id="20968" class="Symbol">{</a><a id="20969" href="NbE.html#20969" class="Bound">𝓋</a> <a id="20971" class="Symbol">:</a> <a id="20973" href="NbE.html#20959" class="Bound">Γ</a> <a id="20975" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="20977" href="NbE.html#20946" class="Bound">S</a> <a id="20979" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="20981" href="NbE.html#20948" class="Bound">T</a><a id="20982" class="Symbol">}</a>
         <a id="20993" class="Symbol">→</a> <a id="20995" href="NbE.html#19810" class="Datatype">Nf</a> <a id="20998" href="NbE.html#20948" class="Bound">T</a> <a id="21000" class="Symbol">(</a><a id="21001" href="NbE.html#20959" class="Bound">Γ</a> <a id="21003" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="21005" href="NbE.html#20946" class="Bound">S</a><a id="21006" class="Symbol">)</a> <a id="21008" href="NbE.html#20969" class="Bound">𝓋</a>
           <a id="21021" class="Comment">------------------</a>
         <a id="21049" class="Symbol">→</a> <a id="21051" href="NbE.html#19810" class="Datatype">Nf</a> <a id="21054" class="Symbol">(</a><a id="21055" href="NbE.html#20946" class="Bound">S</a> <a id="21057" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="21059" href="NbE.html#20948" class="Bound">T</a><a id="21060" class="Symbol">)</a> <a id="21062" href="NbE.html#20959" class="Bound">Γ</a> <a id="21064" class="Symbol">(</a><a id="21065" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="21067" href="NbE.html#20969" class="Bound">𝓋</a><a id="21068" class="Symbol">)</a>

  <a id="Nf.nf-neutral"></a><a id="21073" href="NbE.html#21073" class="InductiveConstructor">nf-neutral</a> <a id="21084" class="Symbol">:</a> <a id="21086" class="Symbol">∀</a> <a id="21088" class="Symbol">{</a><a id="21089" href="NbE.html#21089" class="Bound">T</a> <a id="21091" class="Symbol">:</a> <a id="21093" href="NbE.html#1051" class="Datatype">Type</a><a id="21097" class="Symbol">}</a> <a id="21099" class="Symbol">{</a><a id="21100" href="NbE.html#21100" class="Bound">Γ</a> <a id="21102" class="Symbol">:</a> <a id="21104" href="NbE.html#1943" class="Datatype">Ctx</a><a id="21107" class="Symbol">}</a> <a id="21109" class="Symbol">{</a><a id="21110" href="NbE.html#21110" class="Bound">𝓊</a> <a id="21112" class="Symbol">:</a> <a id="21114" href="NbE.html#21100" class="Bound">Γ</a> <a id="21116" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="21118" href="NbE.html#21089" class="Bound">T</a><a id="21119" class="Symbol">}</a>
             <a id="21134" class="Symbol">→</a> <a id="21136" href="NbE.html#19751" class="Datatype">Ne</a> <a id="21139" href="NbE.html#21089" class="Bound">T</a> <a id="21141" href="NbE.html#21100" class="Bound">Γ</a> <a id="21143" href="NbE.html#21110" class="Bound">𝓊</a>
               <a id="21160" class="Comment">--------</a>
             <a id="21182" class="Symbol">→</a> <a id="21184" href="NbE.html#19810" class="Datatype">Nf</a> <a id="21187" href="NbE.html#21089" class="Bound">T</a> <a id="21189" href="NbE.html#21100" class="Bound">Γ</a> <a id="21191" href="NbE.html#21110" class="Bound">𝓊</a>
</pre>
With these defined, we can give a more formal (but still not final) sketch
of our algorithm:

    ⟦ nat ⟧ = Nf nat

    ↑ᵀ ∈ Ne T → ⟦ T ⟧
    ↑ⁿᵃᵗ 𝓊 = 𝓊
    ↑ˢ⃗ᵗ 𝓊 (a ∈ ⟦ S ⟧) = ↑ᵀ (𝓊 𝓋) , 𝓋 = ↓ˢ a
    
    ↓ᵀ ∈ ⟦ T ⟧ → Nf T
    ↓ⁿᵃᵗ 𝓋 = 𝓋
    ↓ˢ⃗ᵗ f = λx. ↓ᵀ (f(a)) , where a = ↑ᵀ x and x is "fresh"
    
    ↑ᶜᵗˣ ∈ ⟦ Γ ⟧
    ↑∅ = tt
    ↑ᶜᵗˣ,x:S = ↑ᶜᵗˣ , ↑ˢ x
    
    nf(t) = ↓ᵀ (⟦ t ⟧ ↑ᶜᵗˣ)

The algorithm takes a term, evaluates it in an environment of reflected
variables, and then reifies it back to System T. However, this sketch
has an immediate issue to figure out -- how to determine the freshness
condition for the variable x used when reifying at function type.

As we are using de Brujin indices, this has a simple solution: just extend
the context. However, there is no context anywhere in our definition
of reification, so what context do we extend with the fresh variable?
This is actually intentional, because of an issue that is more subtle:
after we reflect the variable, it may later be reified in a different
context than it was created.

To address this, we introduce liftable terms. These are terms that are
generalized over contexts, and can be applied to any context Γ.

An effect of this is that it could be that the resulting term is not
well defined. In fact, it will be the case that liftable neutral terms can
only be applied to extensions of the context under which they were created.
Because of this, liftable neutrals will need to return a placeholder value (tt)
for some contexts.

We append the up arrow ↑ for the liftable version of a System T construct, and
use 𝓋̂ and 𝓊̂ as the metavariables for liftable normal terms and neutral terms
respectively.
<pre class="Agda"><a id="22895" class="Comment">-- Liftable neutral term</a>
<a id="Ne↑"></a><a id="22920" href="NbE.html#22920" class="Function">Ne↑</a> <a id="22924" class="Symbol">:</a> <a id="22926" href="NbE.html#1051" class="Datatype">Type</a> <a id="22931" class="Symbol">→</a> <a id="22933" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="22937" href="NbE.html#22920" class="Function">Ne↑</a> <a id="22941" href="NbE.html#22941" class="Bound">T</a> <a id="22943" class="Symbol">=</a> <a id="22945" class="Symbol">∀</a> <a id="22947" class="Symbol">(</a><a id="22948" href="NbE.html#22948" class="Bound">Γ</a> <a id="22950" class="Symbol">:</a> <a id="22952" href="NbE.html#1943" class="Datatype">Ctx</a><a id="22955" class="Symbol">)</a> <a id="22957" class="Symbol">→</a> <a id="22959" href="Data.Product.html#1806" class="Function">∃[</a> <a id="22962" href="NbE.html#22962" class="Bound">t</a> <a id="22964" href="Data.Product.html#1806" class="Function">]</a> <a id="22966" href="NbE.html#19751" class="Datatype">Ne</a> <a id="22969" href="NbE.html#22941" class="Bound">T</a> <a id="22971" href="NbE.html#22948" class="Bound">Γ</a> <a id="22973" href="NbE.html#22962" class="Bound">t</a> <a id="22975" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="22977" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>

<a id="22980" class="Comment">-- Liftable normal term</a>
<a id="Nf↑"></a><a id="23004" href="NbE.html#23004" class="Function">Nf↑</a> <a id="23008" class="Symbol">:</a> <a id="23010" href="NbE.html#1051" class="Datatype">Type</a> <a id="23015" class="Symbol">→</a> <a id="23017" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="23021" href="NbE.html#23004" class="Function">Nf↑</a> <a id="23025" href="NbE.html#23025" class="Bound">T</a> <a id="23027" class="Symbol">=</a> <a id="23029" class="Symbol">∀</a> <a id="23031" class="Symbol">(</a><a id="23032" href="NbE.html#23032" class="Bound">Γ</a> <a id="23034" class="Symbol">:</a> <a id="23036" href="NbE.html#1943" class="Datatype">Ctx</a><a id="23039" class="Symbol">)</a> <a id="23041" class="Symbol">→</a> <a id="23043" href="Data.Product.html#1806" class="Function">∃[</a> <a id="23046" href="NbE.html#23046" class="Bound">t</a> <a id="23048" href="Data.Product.html#1806" class="Function">]</a> <a id="23050" href="NbE.html#19810" class="Datatype">Nf</a> <a id="23053" href="NbE.html#23025" class="Bound">T</a> <a id="23055" href="NbE.html#23032" class="Bound">Γ</a> <a id="23057" href="NbE.html#23046" class="Bound">t</a>
</pre>
Application of liftable terms is overloaded, i.e. (𝓊̂ 𝓋̂)(Γ) = 𝓊̂(Γ)𝓋̂(Γ)
<pre class="Agda"><a id="_·↑_"></a><a id="23146" href="NbE.html#23146" class="Function Operator">_·↑_</a> <a id="23151" class="Symbol">:</a> <a id="23153" class="Symbol">∀</a> <a id="23155" class="Symbol">{</a><a id="23156" href="NbE.html#23156" class="Bound">S</a> <a id="23158" href="NbE.html#23158" class="Bound">T</a> <a id="23160" class="Symbol">:</a> <a id="23162" href="NbE.html#1051" class="Datatype">Type</a><a id="23166" class="Symbol">}</a> <a id="23168" class="Symbol">→</a> <a id="23170" href="NbE.html#22920" class="Function">Ne↑</a> <a id="23174" class="Symbol">(</a><a id="23175" href="NbE.html#23156" class="Bound">S</a> <a id="23177" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="23179" href="NbE.html#23158" class="Bound">T</a><a id="23180" class="Symbol">)</a> <a id="23182" class="Symbol">→</a>  <a id="23185" href="NbE.html#23004" class="Function">Nf↑</a> <a id="23189" href="NbE.html#23156" class="Bound">S</a> <a id="23191" class="Symbol">→</a> <a id="23193" href="NbE.html#22920" class="Function">Ne↑</a> <a id="23197" href="NbE.html#23158" class="Bound">T</a>
<a id="23199" class="Symbol">(</a><a id="23200" href="NbE.html#23200" class="Bound">𝓊̂</a> <a id="23203" href="NbE.html#23146" class="Function Operator">·↑</a> <a id="23206" href="NbE.html#23206" class="Bound">𝓋̂</a><a id="23208" class="Symbol">)</a> <a id="23210" href="NbE.html#23210" class="Bound">Γ</a> <a id="23212" class="Keyword">with</a> <a id="23217" href="NbE.html#23200" class="Bound">𝓊̂</a> <a id="23220" href="NbE.html#23210" class="Bound">Γ</a>               <a id="23236" class="Symbol">|</a>          <a id="23247" href="NbE.html#23206" class="Bound">𝓋̂</a> <a id="23250" href="NbE.html#23210" class="Bound">Γ</a>
<a id="23252" class="Symbol">...</a>           <a id="23266" class="Symbol">|</a> <a id="23268" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="23273" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="23275" href="NbE.html#23275" class="Bound">𝓊</a> <a id="23277" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="23279" href="NbE.html#23279" class="Bound">pf-𝓊</a> <a id="23284" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="23286" class="Symbol">|</a> <a id="23288" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="23290" href="NbE.html#23290" class="Bound">𝓋</a> <a id="23292" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="23294" href="NbE.html#23294" class="Bound">pf-𝓋</a> <a id="23299" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="23301" class="Symbol">=</a>
      <a id="23309" class="Comment">-- Note that we need to provide proof</a>
      <a id="23353" class="Comment">-- that our resulting lifted term is</a>
      <a id="23396" class="Comment">-- a neutral term as well</a>
      <a id="23428" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="23433" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="23435" href="NbE.html#23275" class="Bound">𝓊</a> <a id="23437" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="23439" href="NbE.html#23290" class="Bound">𝓋</a> <a id="23441" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="23443" href="NbE.html#20183" class="InductiveConstructor">ne-app</a> <a id="23450" href="NbE.html#23279" class="Bound">pf-𝓊</a> <a id="23455" href="NbE.html#23294" class="Bound">pf-𝓋</a> <a id="23460" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
<a id="23462" class="Symbol">...</a>           <a id="23476" class="Symbol">|</a> <a id="23478" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="23483" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>           <a id="23496" class="Symbol">|</a> <a id="23498" class="Symbol">_</a>            <a id="23511" class="Symbol">=</a> <a id="23513" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="23518" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
</pre>
Since normalization by evaluation will need to be
over liftable terms, the concrete interpretation of
the base type nat will in the end be naturals with embedded liftable
neutrals, which we can now finally define in Agda, along with the
interpretation of types.
<pre class="Agda"><a id="23796" class="Keyword">data</a> <a id="ℕ̂"></a><a id="23801" href="NbE.html#23801" class="Datatype">ℕ̂</a> <a id="23804" class="Symbol">:</a> <a id="23806" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="23810" class="Keyword">where</a>
  <a id="ℕ̂.zero"></a><a id="23818" href="NbE.html#23818" class="InductiveConstructor">zero</a> <a id="23823" class="Symbol">:</a> <a id="23825" href="NbE.html#23801" class="Datatype">ℕ̂</a>
  <a id="ℕ̂.suc"></a><a id="23830" href="NbE.html#23830" class="InductiveConstructor">suc</a> <a id="23834" class="Symbol">:</a> <a id="23836" href="NbE.html#23801" class="Datatype">ℕ̂</a> <a id="23839" class="Symbol">→</a> <a id="23841" href="NbE.html#23801" class="Datatype">ℕ̂</a>
  <a id="ℕ̂.ne"></a><a id="23846" href="NbE.html#23846" class="InductiveConstructor">ne</a> <a id="23849" class="Symbol">:</a> <a id="23851" href="NbE.html#22920" class="Function">Ne↑</a> <a id="23855" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="23859" class="Symbol">→</a> <a id="23861" href="NbE.html#23801" class="Datatype">ℕ̂</a>

<a id="23865" class="Keyword">instance</a>
  <a id="⟦Type⟧"></a><a id="23876" href="NbE.html#23876" class="Function">⟦Type⟧</a> <a id="23883" class="Symbol">:</a> <a id="23885" href="NbE.html#15933" class="Record">Interpretation</a> <a id="23900" href="NbE.html#1051" class="Datatype">Type</a>
  <a id="23907" href="NbE.html#15983" class="Field Operator">Interpretation.⟦</a> <a id="23924" href="NbE.html#23876" class="Function">⟦Type⟧</a> <a id="23931" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="23933" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="23937" class="Symbol">=</a> <a id="23939" href="NbE.html#23801" class="Datatype">ℕ̂</a>
  <a id="23944" href="NbE.html#15983" class="Field Operator">Interpretation.⟦</a> <a id="23961" href="NbE.html#23876" class="Function">⟦Type⟧</a> <a id="23968" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="23970" class="Symbol">(</a><a id="23971" href="NbE.html#23971" class="Bound">S</a> <a id="23973" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="23975" href="NbE.html#23975" class="Bound">T</a><a id="23976" class="Symbol">)</a> <a id="23978" class="Symbol">=</a> <a id="23980" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="23982" href="NbE.html#23971" class="Bound">S</a> <a id="23984" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="23986" class="Symbol">→</a> <a id="23988" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="23990" href="NbE.html#23975" class="Bound">T</a> <a id="23992" href="NbE.html#15983" class="Field Operator">⟧</a>
</pre>
With this, we begin the most important part
of normalization by evaluation, the reflection
and reification functions. These are mutually
recursive, and will be defined inductively
on the type T

<pre class="Agda"><a id="24202" class="Comment">-- Reflection of neutral terms of type T into</a>
<a id="24248" class="Comment">-- semantic objects in ⟦T⟧</a>
<a id="↑ᵀ"></a><a id="24275" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="24278" class="Symbol">:</a> <a id="24280" class="Symbol">{</a><a id="24281" href="NbE.html#24281" class="Bound">T</a> <a id="24283" class="Symbol">:</a> <a id="24285" href="NbE.html#1051" class="Datatype">Type</a><a id="24289" class="Symbol">}</a> <a id="24291" class="Symbol">→</a> <a id="24293" href="NbE.html#22920" class="Function">Ne↑</a> <a id="24297" href="NbE.html#24281" class="Bound">T</a> <a id="24299" class="Symbol">→</a> <a id="24301" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="24303" href="NbE.html#24281" class="Bound">T</a> <a id="24305" href="NbE.html#15983" class="Field Operator">⟧</a>

<a id="24308" class="Comment">-- Reification of semantic objects in ⟦T⟧ into</a>
<a id="24355" class="Comment">-- normal terms of type T</a>
<a id="↓ᵀ"></a><a id="24381" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="24384" class="Symbol">:</a> <a id="24386" class="Symbol">{</a><a id="24387" href="NbE.html#24387" class="Bound">T</a> <a id="24389" class="Symbol">:</a> <a id="24391" href="NbE.html#1051" class="Datatype">Type</a><a id="24395" class="Symbol">}</a> <a id="24397" class="Symbol">→</a> <a id="24399" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="24401" href="NbE.html#24387" class="Bound">T</a> <a id="24403" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="24405" class="Symbol">→</a> <a id="24407" href="NbE.html#23004" class="Function">Nf↑</a> <a id="24411" href="NbE.html#24387" class="Bound">T</a>
</pre>
As was the case in the sketch of the algorithm, the reflection
of a liftable neutral of type nat into the metalanguage (i.e. into
a term ℕ̂) is just the liftable neutral itself, embedded with the
ne constructor.
<pre class="Agda"><a id="24638" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="24641" class="Symbol">{</a><a id="24642" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="24645" class="Symbol">}</a> <a id="24647" href="NbE.html#24647" class="Bound">𝓊̂</a> <a id="24650" class="Symbol">=</a> <a id="24652" href="NbE.html#23846" class="InductiveConstructor">ne</a> <a id="24655" href="NbE.html#24647" class="Bound">𝓊̂</a>
</pre>
As for the reflection of neutral terms of type S ⇒ T into ⟦S⟧ → ⟦T⟧,
we reify a semantic object in ⟦S⟧ and then reflect the neutral term
resulting from the application of the reified object to the original
neutral term. Here, we use the liftable application operation we
defined earlier.
<pre class="Agda"><a id="24959" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="24962" class="Symbol">{</a><a id="24963" href="NbE.html#24963" class="Bound">S</a> <a id="24965" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="24967" href="NbE.html#24967" class="Bound">T</a><a id="24968" class="Symbol">}</a> <a id="24970" href="NbE.html#24970" class="Bound">𝓊̂</a> <a id="24973" href="NbE.html#24973" class="Bound">a</a> <a id="24975" class="Symbol">=</a> <a id="24977" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="24980" class="Symbol">(</a><a id="24981" href="NbE.html#24970" class="Bound">𝓊̂</a> <a id="24984" href="NbE.html#23146" class="Function Operator">·↑</a> <a id="24987" href="NbE.html#24997" class="Function">𝓋̂</a><a id="24989" class="Symbol">)</a> <a id="24991" class="Keyword">where</a> <a id="24997" href="NbE.html#24997" class="Function">𝓋̂</a> <a id="25000" class="Symbol">=</a> <a id="25002" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="25005" href="NbE.html#24973" class="Bound">a</a>
</pre>
For the reification of semantic objects of type ⟦nat⟧,
which are our naturals with embedded liftable neutrals (ℕ̂),
we define the following helper function.
<pre class="Agda"><a id="↓ℕ̂"></a><a id="25177" href="NbE.html#25177" class="Function">↓ℕ̂</a> <a id="25181" class="Symbol">:</a> <a id="25183" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="25185" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="25189" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="25191" class="Symbol">→</a> <a id="25193" href="NbE.html#23004" class="Function">Nf↑</a> <a id="25197" href="NbE.html#1070" class="InductiveConstructor">nat</a>
<a id="25201" href="NbE.html#25177" class="Function">↓ℕ̂</a> <a id="25205" href="NbE.html#23818" class="InductiveConstructor">zero</a> <a id="25210" class="Symbol">=</a> <a id="25212" class="Symbol">(λ</a> <a id="25215" href="NbE.html#25215" class="Bound">_</a> <a id="25217" class="Symbol">→</a> <a id="25219" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="25221" href="NbE.html#4377" class="InductiveConstructor">zero</a> <a id="25226" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="25228" href="NbE.html#20773" class="InductiveConstructor">nf-zero</a> <a id="25236" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a><a id="25237" class="Symbol">)</a>
</pre>
For the successor case, we reify the successor into a liftable
successor function (suc↑) applied to the reification of the argument
to the successor function
<pre class="Agda"><a id="25410" href="NbE.html#25177" class="Function">↓ℕ̂</a> <a id="25414" class="Symbol">(</a><a id="25415" href="NbE.html#23830" class="InductiveConstructor">suc</a> <a id="25419" href="NbE.html#25419" class="Bound">n</a><a id="25420" class="Symbol">)</a> <a id="25422" class="Symbol">=</a> <a id="25424" href="NbE.html#25445" class="Function">suc↑</a> <a id="25429" class="Symbol">(</a><a id="25430" href="NbE.html#25177" class="Function">↓ℕ̂</a> <a id="25434" href="NbE.html#25419" class="Bound">n</a><a id="25435" class="Symbol">)</a> <a id="25437" class="Keyword">where</a>
  <a id="25445" href="NbE.html#25445" class="Function">suc↑</a> <a id="25450" class="Symbol">:</a> <a id="25452" href="NbE.html#23004" class="Function">Nf↑</a> <a id="25456" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="25460" class="Symbol">→</a> <a id="25462" href="NbE.html#23004" class="Function">Nf↑</a> <a id="25466" href="NbE.html#1070" class="InductiveConstructor">nat</a>
  <a id="25472" href="NbE.html#25445" class="Function">suc↑</a> <a id="25477" href="NbE.html#25477" class="Bound">𝓋̂</a> <a id="25480" href="NbE.html#25480" class="Bound">Γ</a> <a id="25482" class="Symbol">=</a>
    <a id="25488" class="Keyword">let</a> <a id="25492" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="25494" href="NbE.html#25494" class="Bound">𝓋</a> <a id="25496" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="25498" href="NbE.html#25498" class="Bound">pf</a> <a id="25501" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="25503" class="Symbol">=</a> <a id="25505" href="NbE.html#25477" class="Bound">𝓋̂</a> <a id="25508" href="NbE.html#25480" class="Bound">Γ</a> <a id="25510" class="Keyword">in</a>
    <a id="25517" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="25519" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="25523" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="25525" href="NbE.html#25494" class="Bound">𝓋</a> <a id="25527" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="25529" href="NbE.html#20814" class="InductiveConstructor">nf-suc</a> <a id="25536" href="NbE.html#25498" class="Bound">pf</a> <a id="25539" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
</pre>
In the case of an embedded liftable neutral, we use `zero` as a
fallback if the liftable neutral is undefined at the context.
Our proof of soundness later will be proof that this fallback is not
necessary in our algorithm.
<pre class="Agda"><a id="25777" href="NbE.html#25177" class="Function">↓ℕ̂</a> <a id="25781" class="Symbol">(</a><a id="25782" href="NbE.html#23846" class="InductiveConstructor">ne</a> <a id="25785" href="NbE.html#25785" class="Bound">𝓊̂</a><a id="25787" class="Symbol">)</a> <a id="25789" href="NbE.html#25789" class="Bound">Γ</a> <a id="25791" class="Keyword">with</a> <a id="25796" href="NbE.html#25785" class="Bound">𝓊̂</a> <a id="25799" href="NbE.html#25789" class="Bound">Γ</a>
<a id="25801" class="Symbol">...</a>            <a id="25816" class="Symbol">|</a> <a id="25818" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="25823" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="25825" href="NbE.html#25825" class="Bound">𝓊</a> <a id="25827" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="25829" href="NbE.html#25829" class="Bound">pf</a> <a id="25832" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="25834" class="Symbol">=</a> <a id="25836" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="25838" href="NbE.html#25825" class="Bound">𝓊</a> <a id="25840" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="25842" href="NbE.html#21073" class="InductiveConstructor">nf-neutral</a> <a id="25853" href="NbE.html#25829" class="Bound">pf</a> <a id="25856" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
<a id="25858" class="Symbol">...</a>            <a id="25873" class="Symbol">|</a> <a id="25875" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="25880" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>         <a id="25891" class="Symbol">=</a> <a id="25893" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="25895" href="NbE.html#4377" class="InductiveConstructor">zero</a> <a id="25900" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="25902" href="NbE.html#20773" class="InductiveConstructor">nf-zero</a> <a id="25910" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
</pre>
For reification at function type, we will need the following
function which creates a "fresh" variable for a context Γ.
Really, this is just the de Brujin index 0 for a context `Γ , x:S`.
This will be a liftable variable that can be used in a context
that is an extension of `Γ , x:S` (and is undefined otherwise).
<pre class="Agda"><a id="𝓍̂"></a><a id="26236" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="26239" class="Symbol">:</a> <a id="26241" class="Symbol">(</a><a id="26242" href="NbE.html#26242" class="Bound">S</a> <a id="26244" class="Symbol">:</a> <a id="26246" href="NbE.html#1051" class="Datatype">Type</a><a id="26250" class="Symbol">)</a> <a id="26252" class="Symbol">→</a> <a id="26254" href="NbE.html#1943" class="Datatype">Ctx</a> <a id="26258" class="Symbol">→</a> <a id="26260" href="NbE.html#22920" class="Function">Ne↑</a> <a id="26264" href="NbE.html#26242" class="Bound">S</a>
<a id="26266" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="26269" href="NbE.html#26269" class="Bound">S</a> <a id="26271" href="NbE.html#26271" class="Bound">Γ</a> <a id="26273" href="NbE.html#26273" class="Bound">Γ′</a>
  <a id="26278" class="Keyword">with</a> <a id="26283" href="NbE.html#26273" class="Bound">Γ′</a> <a id="26286" href="NbE.html#3153" class="Function Operator">≤?</a> <a id="26289" class="Symbol">(</a><a id="26290" href="NbE.html#26271" class="Bound">Γ</a> <a id="26292" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="26294" href="NbE.html#26269" class="Bound">S</a><a id="26295" class="Symbol">)</a>
<a id="26297" class="Symbol">...</a>  <a id="26302" class="Symbol">|</a> <a id="26304" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="26307" class="Symbol">_</a>          <a id="26318" class="Symbol">=</a> <a id="26320" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="26325" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
<a id="26328" class="Symbol">...</a>  <a id="26333" class="Symbol">|</a> <a id="26335" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="26339" href="NbE.html#26339" class="Bound">pf</a>
  <a id="26344" class="Comment">-- The variable x in the extended context Γ′ can</a>
  <a id="26395" class="Comment">-- be accessed through the renaming between Γ′ and</a>
  <a id="26448" class="Comment">-- Γ , S</a>
  <a id="26459" class="Keyword">with</a> <a id="26464" href="NbE.html#9583" class="Function">ren-≤</a> <a id="26470" href="NbE.html#26339" class="Bound">pf</a>
<a id="26473" class="Symbol">...</a>  <a id="26478" class="Symbol">|</a> <a id="26480" class="Symbol">_</a> <a id="26482" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="26484" href="NbE.html#26484" class="Bound">x</a>         <a id="26494" class="Symbol">=</a> <a id="26496" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="26501" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="26503" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="26505" href="NbE.html#26484" class="Bound">x</a> <a id="26507" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="26509" href="NbE.html#20111" class="InductiveConstructor">ne-var</a> <a id="26516" href="NbE.html#26484" class="Bound">x</a> <a id="26518" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
</pre>
For our reification function, we reuse ↓ℕ̂ at type nat.
<pre class="Agda"><a id="26589" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="26592" class="Symbol">{</a><a id="26593" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="26596" class="Symbol">}</a> <a id="26598" class="Symbol">=</a> <a id="26600" href="NbE.html#25177" class="Function">↓ℕ̂</a>
</pre>
For the eification of semantic objects of type ⟦S → T⟧ (which are functions
of type ⟦S⟧ → ⟦T⟧), the resulting normal term is an abstraction over the
reification of the function applied to the reflection of the bound variable,
for which we use 𝓍̂
 <pre class="Agda"><a id="26864" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="26867" class="Symbol">{</a><a id="26868" href="NbE.html#26868" class="Bound">S</a> <a id="26870" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="26872" href="NbE.html#26872" class="Bound">T</a><a id="26873" class="Symbol">}</a> <a id="26875" href="NbE.html#26875" class="Bound">f</a> <a id="26877" href="NbE.html#26877" class="Bound">Γ</a> <a id="26879" class="Symbol">=</a>
  <a id="26883" class="Keyword">let</a> <a id="26887" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="26889" href="NbE.html#26889" class="Bound">𝓋</a> <a id="26891" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="26893" href="NbE.html#26893" class="Bound">pf</a> <a id="26896" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="26898" class="Symbol">=</a> <a id="26900" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="26903" class="Symbol">(</a><a id="26904" href="NbE.html#26875" class="Bound">f</a> <a id="26906" href="NbE.html#26950" class="Function">a</a><a id="26907" class="Symbol">)</a> <a id="26909" class="Symbol">(</a><a id="26910" href="NbE.html#26877" class="Bound">Γ</a> <a id="26912" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="26914" href="NbE.html#26868" class="Bound">S</a><a id="26915" class="Symbol">)</a> <a id="26917" class="Keyword">in</a>
  <a id="26922" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="26924" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="26926" href="NbE.html#26889" class="Bound">𝓋</a> <a id="26928" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="26930" href="NbE.html#20934" class="InductiveConstructor">nf-abs</a> <a id="26937" href="NbE.html#26893" class="Bound">pf</a> <a id="26940" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
  <a id="26944" class="Keyword">where</a> <a id="26950" href="NbE.html#26950" class="Function">a</a> <a id="26952" class="Symbol">=</a> <a id="26954" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="26957" class="Symbol">(</a><a id="26958" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="26961" href="NbE.html#26868" class="Bound">S</a> <a id="26963" href="NbE.html#26877" class="Bound">Γ</a><a id="26964" class="Symbol">)</a>
</pre>
With these two functions in place, we can define the reflection of a context
Γ into an environment. This will be the reflected environment over which a typed
term in the context Γ will be evaluated.
<pre class="Agda"><a id="↑ᶜᵗˣ"></a><a id="27178" href="NbE.html#27178" class="Function">↑ᶜᵗˣ</a> <a id="27183" class="Symbol">:</a> <a id="27185" class="Symbol">∀</a> <a id="27187" class="Symbol">(</a><a id="27188" href="NbE.html#27188" class="Bound">Γ</a> <a id="27190" class="Symbol">:</a> <a id="27192" href="NbE.html#1943" class="Datatype">Ctx</a><a id="27195" class="Symbol">)</a> <a id="27197" class="Symbol">→</a> <a id="27199" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="27201" href="NbE.html#27188" class="Bound">Γ</a> <a id="27203" href="NbE.html#15983" class="Field Operator">⟧</a>
<a id="27205" href="NbE.html#27178" class="Function">↑ᶜᵗˣ</a> <a id="27210" href="NbE.html#1961" class="InductiveConstructor">∅</a>       <a id="27218" class="Symbol">=</a> <a id="27220" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
<a id="27223" href="NbE.html#27178" class="Function">↑ᶜᵗˣ</a> <a id="27228" class="Symbol">(</a><a id="27229" href="NbE.html#27229" class="Bound">Γ</a> <a id="27231" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="27233" href="NbE.html#27233" class="Bound">T</a><a id="27234" class="Symbol">)</a> <a id="27236" class="Symbol">=</a> <a id="27238" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="27240" href="NbE.html#27178" class="Function">↑ᶜᵗˣ</a> <a id="27245" href="NbE.html#27229" class="Bound">Γ</a>  <a id="27248" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="27250" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="27253" class="Symbol">(</a><a id="27254" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="27257" href="NbE.html#27233" class="Bound">T</a> <a id="27259" href="NbE.html#27229" class="Bound">Γ</a><a id="27260" class="Symbol">)</a> <a id="27262" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
</pre>
We also need to use reflection and reification to
define the interpretation of primitive recursion in
System T, which must work with liftable neutrals (as
our interpretation of nat now has them embedded)
<pre class="Agda"><a id="rec↑"></a><a id="27481" href="NbE.html#27481" class="Function">rec↑</a> <a id="27486" class="Symbol">:</a> <a id="27488" class="Symbol">∀</a> <a id="27490" class="Symbol">{</a><a id="27491" href="NbE.html#27491" class="Bound">T</a> <a id="27493" class="Symbol">:</a> <a id="27495" href="NbE.html#1051" class="Datatype">Type</a><a id="27499" class="Symbol">}</a> <a id="27501" class="Symbol">→</a> <a id="27503" href="NbE.html#23004" class="Function">Nf↑</a> <a id="27507" href="NbE.html#27491" class="Bound">T</a> <a id="27509" class="Symbol">→</a> <a id="27511" href="NbE.html#23004" class="Function">Nf↑</a> <a id="27515" class="Symbol">(</a><a id="27516" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="27520" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="27522" href="NbE.html#27491" class="Bound">T</a> <a id="27524" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="27526" href="NbE.html#27491" class="Bound">T</a><a id="27527" class="Symbol">)</a> <a id="27529" class="Symbol">→</a> <a id="27531" href="NbE.html#22920" class="Function">Ne↑</a> <a id="27535" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="27539" class="Symbol">→</a> <a id="27541" href="NbE.html#22920" class="Function">Ne↑</a> <a id="27545" href="NbE.html#27491" class="Bound">T</a>
<a id="27547" href="NbE.html#27481" class="Function">rec↑</a> <a id="27552" href="NbE.html#27552" class="Bound">𝓋̂z</a> <a id="27556" href="NbE.html#27556" class="Bound">𝓋̂s</a> <a id="27560" href="NbE.html#27560" class="Bound">𝓊̂</a> <a id="27563" href="NbE.html#27563" class="Bound">Γ</a> <a id="27565" class="Keyword">with</a> <a id="27570" href="NbE.html#27560" class="Bound">𝓊̂</a> <a id="27573" href="NbE.html#27563" class="Bound">Γ</a>
<a id="27575" class="Symbol">...</a> <a id="27579" class="Symbol">|</a> <a id="27581" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="27586" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a> <a id="27589" class="Symbol">=</a> <a id="27591" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="27596" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
<a id="27599" class="Symbol">...</a> <a id="27603" class="Symbol">|</a> <a id="27605" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="27610" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="27612" href="NbE.html#27612" class="Bound">𝓊</a> <a id="27614" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="27616" href="NbE.html#27616" class="Bound">pf-𝓊</a> <a id="27621" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="27623" class="Symbol">=</a>
  <a id="27627" class="Keyword">let</a> <a id="27631" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="27633" href="NbE.html#27633" class="Bound">𝓋z</a> <a id="27636" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="27638" href="NbE.html#27638" class="Bound">pf-𝓋z</a> <a id="27644" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="27646" class="Symbol">=</a> <a id="27648" class="Bound">𝓋̂z</a> <a id="27652" class="Bound">Γ</a> <a id="27654" class="Keyword">in</a>
  <a id="27659" class="Keyword">let</a> <a id="27663" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="27665" href="NbE.html#27665" class="Bound">𝓋s</a> <a id="27668" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="27670" href="NbE.html#27670" class="Bound">pf-𝓋s</a> <a id="27676" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="27678" class="Symbol">=</a> <a id="27680" class="Bound">𝓋̂s</a> <a id="27684" class="Bound">Γ</a> <a id="27686" class="Keyword">in</a>
  <a id="27691" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="27696" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="27698" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="27702" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="27704" href="NbE.html#27633" class="Bound">𝓋z</a> <a id="27707" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="27709" href="NbE.html#27665" class="Bound">𝓋s</a> <a id="27712" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="27714" href="NbE.html#27612" class="Bound">𝓊</a> <a id="27716" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="27718" href="NbE.html#20334" class="InductiveConstructor">ne-rec</a> <a id="27725" href="NbE.html#27638" class="Bound">pf-𝓋z</a> <a id="27731" href="NbE.html#27670" class="Bound">pf-𝓋s</a> <a id="27737" href="NbE.html#27616" class="Bound">pf-𝓊</a> <a id="27742" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>

<a id="⟦rec⟧"></a><a id="27745" href="NbE.html#27745" class="Function">⟦rec⟧</a> <a id="27751" class="Symbol">:</a> <a id="27753" class="Symbol">∀</a> <a id="27755" class="Symbol">{</a><a id="27756" href="NbE.html#27756" class="Bound">T</a> <a id="27758" class="Symbol">:</a> <a id="27760" href="NbE.html#1051" class="Datatype">Type</a><a id="27764" class="Symbol">}</a> <a id="27766" class="Symbol">→</a> <a id="27768" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="27770" href="NbE.html#27756" class="Bound">T</a> <a id="27772" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="27774" class="Symbol">(</a><a id="27775" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="27779" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="27781" href="NbE.html#27756" class="Bound">T</a> <a id="27783" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="27785" href="NbE.html#27756" class="Bound">T</a><a id="27786" class="Symbol">)</a> <a id="27788" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="27790" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="27794" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="27796" href="NbE.html#27756" class="Bound">T</a> <a id="27798" href="NbE.html#15983" class="Field Operator">⟧</a>
<a id="27800" href="NbE.html#27745" class="Function">⟦rec⟧</a> <a id="27806" href="NbE.html#27806" class="Bound">z</a> <a id="27808" href="NbE.html#27808" class="Bound">s</a> <a id="27810" href="NbE.html#23818" class="InductiveConstructor">zero</a>       <a id="27821" class="Symbol">=</a> <a id="27823" href="NbE.html#27806" class="Bound">z</a>
<a id="27825" href="NbE.html#27745" class="Function">⟦rec⟧</a> <a id="27831" href="NbE.html#27831" class="Bound">z</a> <a id="27833" href="NbE.html#27833" class="Bound">s</a> <a id="27835" class="Symbol">(</a><a id="27836" href="NbE.html#23830" class="InductiveConstructor">suc</a> <a id="27840" href="NbE.html#27840" class="Bound">n</a><a id="27841" class="Symbol">)</a>    <a id="27846" class="Symbol">=</a> <a id="27848" href="NbE.html#27833" class="Bound">s</a> <a id="27850" href="NbE.html#27840" class="Bound">n</a> <a id="27852" class="Symbol">(</a><a id="27853" href="NbE.html#27745" class="Function">⟦rec⟧</a> <a id="27859" href="NbE.html#27831" class="Bound">z</a> <a id="27861" href="NbE.html#27833" class="Bound">s</a> <a id="27863" href="NbE.html#27840" class="Bound">n</a><a id="27864" class="Symbol">)</a>
<a id="27866" href="NbE.html#27745" class="Function">⟦rec⟧</a> <a id="27872" class="Symbol">{</a><a id="27873" href="NbE.html#27873" class="Bound">T</a><a id="27874" class="Symbol">}</a> <a id="27876" href="NbE.html#27876" class="Bound">z</a> <a id="27878" href="NbE.html#27878" class="Bound">s</a> <a id="27880" class="Symbol">(</a><a id="27881" href="NbE.html#23846" class="InductiveConstructor">ne</a> <a id="27884" href="NbE.html#27884" class="Bound">𝓊̂</a><a id="27886" class="Symbol">)</a> <a id="27888" class="Symbol">=</a>
  <a id="27892" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="27895" class="Symbol">(</a><a id="27896" href="NbE.html#27481" class="Function">rec↑</a> <a id="27901" href="NbE.html#27919" class="Function">𝓋̂z</a> <a id="27905" href="NbE.html#27932" class="Function">𝓋̂s</a> <a id="27909" href="NbE.html#27884" class="Bound">𝓊̂</a><a id="27911" class="Symbol">)</a> <a id="27913" class="Keyword">where</a> <a id="27919" href="NbE.html#27919" class="Function">𝓋̂z</a> <a id="27923" class="Symbol">=</a> <a id="27925" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="27928" href="NbE.html#27876" class="Bound">z</a> <a id="27930" class="Symbol">;</a> <a id="27932" href="NbE.html#27932" class="Function">𝓋̂s</a> <a id="27936" class="Symbol">=</a> <a id="27938" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="27941" href="NbE.html#27878" class="Bound">s</a>
</pre>
Now that we have a concrete interpretation of types,
and an interpretation for primitive recursion,
we can define the corresponding interpretations of
the lookup and typing judgements.
<pre class="Agda"><a id="⟦_∋Γ⟧"></a><a id="28141" href="NbE.html#28141" class="Function Operator">⟦_∋Γ⟧</a> <a id="28147" class="Symbol">:</a> <a id="28149" class="Symbol">∀</a> <a id="28151" class="Symbol">{</a><a id="28152" href="NbE.html#28152" class="Bound">Γ</a> <a id="28154" class="Symbol">:</a> <a id="28156" href="NbE.html#1943" class="Datatype">Ctx</a><a id="28159" class="Symbol">}</a> <a id="28161" class="Symbol">{</a><a id="28162" href="NbE.html#28162" class="Bound">T</a> <a id="28164" class="Symbol">:</a> <a id="28166" href="NbE.html#1051" class="Datatype">Type</a><a id="28170" class="Symbol">}</a> <a id="28172" class="Symbol">→</a> <a id="28174" href="NbE.html#28152" class="Bound">Γ</a> <a id="28176" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="28178" href="NbE.html#28162" class="Bound">T</a> <a id="28180" class="Symbol">→</a> <a id="28182" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="28184" href="NbE.html#28152" class="Bound">Γ</a> <a id="28186" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="28188" class="Symbol">→</a> <a id="28190" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="28192" href="NbE.html#28162" class="Bound">T</a> <a id="28194" href="NbE.html#15983" class="Field Operator">⟧</a>
<a id="28196" href="NbE.html#28141" class="Function Operator">⟦_∋Γ⟧</a> <a id="28202" class="Symbol">{</a><a id="28203" href="NbE.html#28203" class="Bound">Γ</a> <a id="28205" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="28207" href="NbE.html#28207" class="Bound">T</a><a id="28208" class="Symbol">}</a> <a id="28210" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="28213" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="28215" class="Symbol">_</a> <a id="28217" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="28219" href="NbE.html#28219" class="Bound">a</a> <a id="28221" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>     <a id="28227" class="Symbol">=</a> <a id="28229" href="NbE.html#28219" class="Bound">a</a>
<a id="28231" href="NbE.html#28141" class="Function Operator">⟦_∋Γ⟧</a> <a id="28237" class="Symbol">{</a><a id="28238" href="NbE.html#28238" class="Bound">Γ</a> <a id="28240" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="28242" href="NbE.html#28242" class="Bound">T</a><a id="28243" class="Symbol">}</a> <a id="28245" class="Symbol">(</a><a id="28246" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="28249" href="NbE.html#28249" class="Bound">x</a><a id="28250" class="Symbol">)</a> <a id="28252" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="28254" href="NbE.html#28254" class="Bound">ρ</a> <a id="28256" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="28258" class="Symbol">_</a> <a id="28260" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="28262" class="Symbol">=</a> <a id="28264" href="NbE.html#28141" class="Function Operator">⟦</a> <a id="28266" href="NbE.html#28249" class="Bound">x</a> <a id="28268" href="NbE.html#28141" class="Function Operator">∋Γ⟧</a> <a id="28272" href="NbE.html#28254" class="Bound">ρ</a>

<a id="⟦⊢_⟧"></a><a id="28275" href="NbE.html#28275" class="Function Operator">⟦⊢_⟧</a> <a id="28280" class="Symbol">:</a> <a id="28282" class="Symbol">∀</a> <a id="28284" class="Symbol">{</a><a id="28285" href="NbE.html#28285" class="Bound">Γ</a> <a id="28287" class="Symbol">:</a> <a id="28289" href="NbE.html#1943" class="Datatype">Ctx</a><a id="28292" class="Symbol">}</a> <a id="28294" class="Symbol">{</a><a id="28295" href="NbE.html#28295" class="Bound">T</a> <a id="28297" class="Symbol">:</a> <a id="28299" href="NbE.html#1051" class="Datatype">Type</a><a id="28303" class="Symbol">}</a> <a id="28305" class="Symbol">→</a> <a id="28307" href="NbE.html#28285" class="Bound">Γ</a> <a id="28309" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="28311" href="NbE.html#28295" class="Bound">T</a> <a id="28313" class="Symbol">→</a> <a id="28315" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="28317" href="NbE.html#28285" class="Bound">Γ</a> <a id="28319" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="28321" class="Symbol">→</a> <a id="28323" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="28325" href="NbE.html#28295" class="Bound">T</a> <a id="28327" href="NbE.html#15983" class="Field Operator">⟧</a>
<a id="28329" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28332" href="NbE.html#4377" class="InductiveConstructor">zero</a> <a id="28337" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="28339" class="Symbol">_</a>  <a id="28342" class="Symbol">=</a> <a id="28344" href="NbE.html#23818" class="InductiveConstructor">zero</a>
<a id="28349" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28352" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="28356" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="28358" class="Symbol">_</a>   <a id="28362" class="Symbol">=</a> <a id="28364" href="NbE.html#23830" class="InductiveConstructor">suc</a>
<a id="28368" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28371" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="28375" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="28377" class="Symbol">_</a>   <a id="28381" class="Symbol">=</a> <a id="28383" href="NbE.html#27745" class="Function">⟦rec⟧</a>
<a id="28389" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28392" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="28394" href="NbE.html#28394" class="Bound">x</a> <a id="28396" href="NbE.html#28275" class="Function Operator">⟧</a>     <a id="28402" class="Symbol">=</a> <a id="28404" href="NbE.html#28141" class="Function Operator">⟦</a> <a id="28406" href="NbE.html#28394" class="Bound">x</a> <a id="28408" href="NbE.html#28141" class="Function Operator">∋Γ⟧</a>
<a id="28412" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28415" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="28417" href="NbE.html#28417" class="Bound">t</a> <a id="28419" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="28421" href="NbE.html#28421" class="Bound">ρ</a> <a id="28423" href="NbE.html#28423" class="Bound">a</a> <a id="28425" class="Symbol">=</a> <a id="28427" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28430" href="NbE.html#28417" class="Bound">t</a> <a id="28432" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="28434" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="28436" href="NbE.html#28421" class="Bound">ρ</a> <a id="28438" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="28440" href="NbE.html#28423" class="Bound">a</a> <a id="28442" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
<a id="28444" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28447" href="NbE.html#28447" class="Bound">r</a> <a id="28449" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="28451" href="NbE.html#28451" class="Bound">s</a> <a id="28453" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="28455" href="NbE.html#28455" class="Bound">ρ</a> <a id="28457" class="Symbol">=</a> <a id="28459" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28462" href="NbE.html#28447" class="Bound">r</a> <a id="28464" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="28466" href="NbE.html#28455" class="Bound">ρ</a> <a id="28468" class="Symbol">(</a><a id="28469" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28472" href="NbE.html#28451" class="Bound">s</a> <a id="28474" href="NbE.html#28275" class="Function Operator">⟧</a>  <a id="28477" href="NbE.html#28455" class="Bound">ρ</a><a id="28478" class="Symbol">)</a>
</pre>
Finally, the algorithm for normalization by evaluation is as follows
<pre class="Agda"><a id="nbe"></a><a id="28562" href="NbE.html#28562" class="Function">nbe</a> <a id="28566" class="Symbol">:</a> <a id="28568" class="Symbol">∀</a> <a id="28570" class="Symbol">{</a><a id="28571" href="NbE.html#28571" class="Bound">Γ</a> <a id="28573" class="Symbol">:</a> <a id="28575" href="NbE.html#1943" class="Datatype">Ctx</a><a id="28578" class="Symbol">}</a> <a id="28580" class="Symbol">{</a><a id="28581" href="NbE.html#28581" class="Bound">T</a> <a id="28583" class="Symbol">:</a> <a id="28585" href="NbE.html#1051" class="Datatype">Type</a><a id="28589" class="Symbol">}</a> <a id="28591" class="Symbol">→</a> <a id="28593" href="NbE.html#28571" class="Bound">Γ</a> <a id="28595" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="28597" href="NbE.html#28581" class="Bound">T</a> <a id="28599" class="Symbol">→</a> <a id="28601" href="Data.Product.html#1806" class="Function">∃[</a> <a id="28604" href="NbE.html#28604" class="Bound">t</a> <a id="28606" href="Data.Product.html#1806" class="Function">]</a> <a id="28608" href="NbE.html#19810" class="Datatype">Nf</a> <a id="28611" href="NbE.html#28581" class="Bound">T</a> <a id="28613" href="NbE.html#28571" class="Bound">Γ</a> <a id="28615" href="NbE.html#28604" class="Bound">t</a>
<a id="28617" href="NbE.html#28562" class="Function">nbe</a> <a id="28621" class="Symbol">{</a><a id="28622" href="NbE.html#28622" class="Bound">Γ</a><a id="28623" class="Symbol">}</a> <a id="28625" href="NbE.html#28625" class="Bound">t</a> <a id="28627" class="Symbol">=</a> <a id="28629" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="28632" class="Symbol">(</a><a id="28633" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="28636" href="NbE.html#28625" class="Bound">t</a> <a id="28638" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="28640" class="Symbol">(</a><a id="28641" href="NbE.html#27178" class="Function">↑ᶜᵗˣ</a> <a id="28646" href="NbE.html#28622" class="Bound">Γ</a><a id="28647" class="Symbol">))</a> <a id="28650" href="NbE.html#28622" class="Bound">Γ</a>

<a id="nf"></a><a id="28653" href="NbE.html#28653" class="Function">nf</a> <a id="28656" class="Symbol">:</a> <a id="28658" class="Symbol">∀</a> <a id="28660" class="Symbol">{</a><a id="28661" href="NbE.html#28661" class="Bound">Γ</a> <a id="28663" class="Symbol">:</a> <a id="28665" href="NbE.html#1943" class="Datatype">Ctx</a><a id="28668" class="Symbol">}</a> <a id="28670" class="Symbol">{</a><a id="28671" href="NbE.html#28671" class="Bound">T</a> <a id="28673" class="Symbol">:</a> <a id="28675" href="NbE.html#1051" class="Datatype">Type</a><a id="28679" class="Symbol">}</a> <a id="28681" class="Symbol">→</a> <a id="28683" href="NbE.html#28661" class="Bound">Γ</a> <a id="28685" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="28687" href="NbE.html#28671" class="Bound">T</a> <a id="28689" class="Symbol">→</a> <a id="28691" href="NbE.html#28661" class="Bound">Γ</a> <a id="28693" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="28695" href="NbE.html#28671" class="Bound">T</a>
<a id="28697" href="NbE.html#28653" class="Function">nf</a> <a id="28700" href="NbE.html#28700" class="Bound">t</a> <a id="28702" class="Symbol">=</a> <a id="28704" class="Keyword">let</a> <a id="28708" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="28710" href="NbE.html#28710" class="Bound">t′</a> <a id="28713" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="28715" class="Symbol">_</a> <a id="28717" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="28719" class="Symbol">=</a> <a id="28721" href="NbE.html#28562" class="Function">nbe</a> <a id="28725" href="NbE.html#28700" class="Bound">t</a> <a id="28727" class="Keyword">in</a> <a id="28730" href="NbE.html#28710" class="Bound">t′</a>
</pre>
And here we have some examples of the algorithm in action, reusing our
examples from [SystemT](./SystemT.lagda.md)

<pre class="Agda"><a id="28862" class="Comment">-- normal form of (λx. x) zero is zero</a>
<a id="nf-ex1"></a><a id="28901" href="NbE.html#28901" class="Function">nf-ex1</a> <a id="28908" class="Symbol">:</a> <a id="28910" href="NbE.html#28653" class="Function">nf</a> <a id="28913" href="NbE.html#4966" class="Function">ex1</a> <a id="28917" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="28919" class="InductiveConstructor">zero</a>
<a id="28924" href="NbE.html#28901" class="Function">nf-ex1</a> <a id="28931" class="Keyword">with</a> <a id="28936" href="NbE.html#4966" class="Function">ex1</a>
<a id="28940" href="NbE.html#28901" class="Function">...</a>       <a id="28950" class="Symbol">|</a> <a id="28952" class="Symbol">_</a>   <a id="28956" class="Symbol">=</a> <a id="28958" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="28964" class="Comment">-- normal form of suc ((λx. x) zero) is suc zero</a>
<a id="nf-ex2"></a><a id="29013" href="NbE.html#29013" class="Function">nf-ex2</a> <a id="29020" class="Symbol">:</a> <a id="29022" href="NbE.html#28653" class="Function">nf</a> <a id="29025" href="NbE.html#5010" class="Function">ex2</a> <a id="29029" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="29031" class="Symbol">(</a><a id="29032" class="InductiveConstructor">suc</a> <a id="29036" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="29038" class="InductiveConstructor">zero</a><a id="29042" class="Symbol">)</a>
<a id="29044" href="NbE.html#29013" class="Function">nf-ex2</a> <a id="29051" class="Keyword">with</a> <a id="29056" href="NbE.html#5010" class="Function">ex2</a>
<a id="29060" href="NbE.html#29013" class="Function">...</a>       <a id="29070" class="Symbol">|</a> <a id="29072" class="Symbol">_</a>   <a id="29076" class="Symbol">=</a> <a id="29078" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="29084" class="Comment">-- normal form of x:nat, y:nat ⊢ suc ((λz. suc y) x)</a>
<a id="29137" class="Comment">-- is x:nat, y:nat ⊢ suc (suc y)</a>
<a id="nf-ex3"></a><a id="29170" href="NbE.html#29170" class="Function">nf-ex3</a> <a id="29177" class="Symbol">:</a> <a id="29179" href="NbE.html#28653" class="Function">nf</a> <a id="29182" href="NbE.html#5065" class="Function">ex3</a> <a id="29186" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="29188" class="Symbol">(</a><a id="29189" class="InductiveConstructor">suc</a> <a id="29193" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="29195" class="Symbol">(</a><a id="29196" class="InductiveConstructor">suc</a> <a id="29200" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="29202" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="29204" class="Symbol">(</a><a id="29205" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="29207" class="Symbol">)))</a>
<a id="29211" href="NbE.html#29170" class="Function">nf-ex3</a> <a id="29218" class="Keyword">with</a> <a id="29223" href="NbE.html#5065" class="Function">ex3</a>
<a id="29227" href="NbE.html#29170" class="Function">...</a>       <a id="29237" class="Symbol">|</a> <a id="29239" class="Symbol">_</a>   <a id="29243" class="Symbol">=</a> <a id="29245" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
As for the soundness properties we want from this algorithm:
  - `Γ ⊢ nf(t) : T` (well-typedness)
      We are using an intrinsically typed
      representation of terms, so this property is
      given to us automatically

  - `⟦ nf(t) ⟧ = ⟦ t ⟧` (preservation of meaning)
      We will prove this in the following section
      using definitional equality

  - `nf(nf(t)) = nf(t)` (idempotency)
      This follows directly from the preservation of
      meaning and completeness properties of the algorithm:

      By the soundness property of preservation of meaning,
      we have `Γ ⊢ nf t = t : T`, which implies `nf (nf t) = nf(t)`
      by completeness

For proving the completeness property of NbE,
our goal is to prove that two programs with the
same meaning (i.e. definitionally equal) have the
same normal form:

    Γ ⊢ t = t′ : T implies nf(t) = nf(t′)

We can prove this using some equational reasoning
paired with the definitional equality of two
terms impliying they are semantically equal
(included as a postulate for now)

<pre class="Agda"><a id="30305" class="Keyword">postulate</a>
  <a id="==→⟦≡⟧"></a><a id="30317" href="NbE.html#30317" class="Postulate">==→⟦≡⟧</a> <a id="30324" class="Symbol">:</a> <a id="30326" class="Symbol">∀</a> <a id="30328" class="Symbol">{</a><a id="30329" href="NbE.html#30329" class="Bound">Γ</a> <a id="30331" class="Symbol">:</a> <a id="30333" href="NbE.html#1943" class="Datatype">Ctx</a><a id="30336" class="Symbol">}</a> <a id="30338" class="Symbol">{</a><a id="30339" href="NbE.html#30339" class="Bound">T</a> <a id="30341" class="Symbol">:</a> <a id="30343" href="NbE.html#1051" class="Datatype">Type</a><a id="30347" class="Symbol">}</a> <a id="30349" class="Symbol">{</a><a id="30350" href="NbE.html#30350" class="Bound">t</a> <a id="30352" href="NbE.html#30352" class="Bound">t′</a> <a id="30355" class="Symbol">:</a> <a id="30357" href="NbE.html#30329" class="Bound">Γ</a> <a id="30359" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="30361" href="NbE.html#30339" class="Bound">T</a><a id="30362" class="Symbol">}</a> <a id="30364" class="Symbol">{</a><a id="30365" href="NbE.html#30365" class="Bound">ρ</a> <a id="30367" class="Symbol">:</a> <a id="30369" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="30371" href="NbE.html#30329" class="Bound">Γ</a> <a id="30373" href="NbE.html#15983" class="Field Operator">⟧</a><a id="30374" class="Symbol">}</a>
         <a id="30385" class="Symbol">→</a> <a id="30387" href="NbE.html#30350" class="Bound">t</a> <a id="30389" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="30392" href="NbE.html#30352" class="Bound">t′</a>
         <a id="30404" class="Symbol">→</a> <a id="30406" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="30409" href="NbE.html#30350" class="Bound">t</a> <a id="30411" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="30413" href="NbE.html#30365" class="Bound">ρ</a> <a id="30415" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="30417" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="30420" href="NbE.html#30352" class="Bound">t′</a> <a id="30423" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="30425" href="NbE.html#30365" class="Bound">ρ</a>

<a id="completeness"></a><a id="30428" href="NbE.html#30428" class="Function">completeness</a> <a id="30441" class="Symbol">:</a> <a id="30443" class="Symbol">∀</a> <a id="30445" class="Symbol">{</a><a id="30446" href="NbE.html#30446" class="Bound">Γ</a> <a id="30448" class="Symbol">:</a> <a id="30450" href="NbE.html#1943" class="Datatype">Ctx</a><a id="30453" class="Symbol">}</a> <a id="30455" class="Symbol">{</a><a id="30456" href="NbE.html#30456" class="Bound">T</a> <a id="30458" class="Symbol">:</a> <a id="30460" href="NbE.html#1051" class="Datatype">Type</a><a id="30464" class="Symbol">}</a> <a id="30466" class="Symbol">{</a><a id="30467" href="NbE.html#30467" class="Bound">t</a> <a id="30469" href="NbE.html#30469" class="Bound">t′</a> <a id="30472" class="Symbol">:</a> <a id="30474" href="NbE.html#30446" class="Bound">Γ</a> <a id="30476" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="30478" href="NbE.html#30456" class="Bound">T</a><a id="30479" class="Symbol">}</a>
             <a id="30494" class="Symbol">→</a> <a id="30496" href="NbE.html#30467" class="Bound">t</a> <a id="30498" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="30501" href="NbE.html#30469" class="Bound">t′</a>
             <a id="30517" class="Symbol">→</a> <a id="30519" href="NbE.html#28653" class="Function">nf</a> <a id="30522" href="NbE.html#30467" class="Bound">t</a> <a id="30524" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="30526" href="NbE.html#28653" class="Function">nf</a> <a id="30529" href="NbE.html#30469" class="Bound">t′</a>
<a id="30532" href="NbE.html#30428" class="Function">completeness</a> <a id="30545" class="Symbol">{</a><a id="30546" href="NbE.html#30546" class="Bound">Γ</a><a id="30547" class="Symbol">}</a> <a id="30549" href="NbE.html#30549" class="Bound">t==t′</a> <a id="30555" class="Keyword">rewrite</a> <a id="30563" href="NbE.html#30317" class="Postulate">==→⟦≡⟧</a> <a id="30570" class="Symbol">{</a><a id="30571" class="Argument">ρ</a> <a id="30573" class="Symbol">=</a> <a id="30575" href="NbE.html#27178" class="Function">↑ᶜᵗˣ</a> <a id="30580" href="NbE.html#30546" class="Bound">Γ</a><a id="30581" class="Symbol">}</a> <a id="30583" href="NbE.html#30549" class="Bound">t==t′</a> <a id="30589" class="Symbol">=</a> <a id="30591" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
<!--

<pre class="Agda"><a id="30615" class="Comment">-- Equivalent terms are definitionally equal</a>
<a id="≡→=="></a><a id="30660" href="NbE.html#30660" class="Function">≡→==</a> <a id="30665" class="Symbol">:</a> <a id="30667" class="Symbol">∀</a> <a id="30669" class="Symbol">{</a><a id="30670" href="NbE.html#30670" class="Bound">Γ</a> <a id="30672" class="Symbol">:</a> <a id="30674" href="NbE.html#1943" class="Datatype">Ctx</a><a id="30677" class="Symbol">}</a> <a id="30679" class="Symbol">{</a><a id="30680" href="NbE.html#30680" class="Bound">T</a> <a id="30682" class="Symbol">:</a> <a id="30684" href="NbE.html#1051" class="Datatype">Type</a><a id="30688" class="Symbol">}</a> <a id="30690" class="Symbol">{</a><a id="30691" href="NbE.html#30691" class="Bound">t</a> <a id="30693" href="NbE.html#30693" class="Bound">t′</a> <a id="30696" class="Symbol">:</a> <a id="30698" href="NbE.html#30670" class="Bound">Γ</a> <a id="30700" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="30702" href="NbE.html#30680" class="Bound">T</a><a id="30703" class="Symbol">}</a>
     <a id="30710" class="Symbol">→</a> <a id="30712" href="NbE.html#30691" class="Bound">t</a> <a id="30714" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="30716" href="NbE.html#30693" class="Bound">t′</a>
       <a id="30726" class="Comment">-------</a>
     <a id="30739" class="Symbol">→</a> <a id="30741" href="NbE.html#30691" class="Bound">t</a> <a id="30743" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="30746" href="NbE.html#30693" class="Bound">t′</a>
<a id="30749" href="NbE.html#30660" class="Function">≡→==</a> <a id="30754" href="NbE.html#30754" class="Bound">pf</a> <a id="30757" class="Keyword">rewrite</a> <a id="30765" href="NbE.html#30754" class="Bound">pf</a> <a id="30768" class="Symbol">=</a> <a id="30770" href="NbE.html#14488" class="InductiveConstructor">refl</a>

<a id="30776" class="Comment">-- A few properties about the ≤ relation,</a>
<a id="30818" class="Comment">-- which are all required to prove irrelevance</a>
<a id="30865" class="Comment">-- of proof for the relation</a>

<a id="invert-≤"></a><a id="30895" href="NbE.html#30895" class="Function">invert-≤</a> <a id="30904" class="Symbol">:</a> <a id="30906" class="Symbol">∀</a> <a id="30908" class="Symbol">{</a><a id="30909" href="NbE.html#30909" class="Bound">Γ</a> <a id="30911" href="NbE.html#30911" class="Bound">Γ′</a> <a id="30914" class="Symbol">:</a> <a id="30916" href="NbE.html#1943" class="Datatype">Ctx</a><a id="30919" class="Symbol">}</a> <a id="30921" class="Symbol">{</a><a id="30922" href="NbE.html#30922" class="Bound">T</a> <a id="30924" class="Symbol">:</a> <a id="30926" href="NbE.html#1051" class="Datatype">Type</a><a id="30930" class="Symbol">}</a>
         <a id="30941" class="Symbol">→</a> <a id="30943" href="NbE.html#30911" class="Bound">Γ′</a> <a id="30946" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="30948" href="NbE.html#30909" class="Bound">Γ</a> <a id="30950" class="InductiveConstructor Operator">,</a> <a id="30952" href="NbE.html#30922" class="Bound">T</a>
           <a id="30965" class="Comment">----------</a>
         <a id="30985" class="Symbol">→</a> <a id="30987" href="NbE.html#30911" class="Bound">Γ′</a> <a id="30990" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="30992" href="NbE.html#30909" class="Bound">Γ</a>
<a id="30994" href="NbE.html#30895" class="Function">invert-≤</a> <a id="31003" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="31008" class="Symbol">=</a> <a id="31010" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31016" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
<a id="31021" href="NbE.html#30895" class="Function">invert-≤</a> <a id="31030" class="Symbol">(</a><a id="31031" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31037" href="NbE.html#31037" class="Bound">x</a><a id="31038" class="Symbol">)</a> <a id="31040" class="Symbol">=</a> <a id="31042" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31048" class="Symbol">(</a><a id="31049" href="NbE.html#30895" class="Function">invert-≤</a> <a id="31058" href="NbE.html#31037" class="Bound">x</a><a id="31059" class="Symbol">)</a>

<a id="≤-ext-uniq-T"></a><a id="31062" href="NbE.html#31062" class="Function">≤-ext-uniq-T</a> <a id="31075" class="Symbol">:</a> <a id="31077" class="Symbol">∀</a> <a id="31079" class="Symbol">{</a><a id="31080" href="NbE.html#31080" class="Bound">Γ</a> <a id="31082" href="NbE.html#31082" class="Bound">Γ′</a> <a id="31085" class="Symbol">:</a> <a id="31087" href="NbE.html#1943" class="Datatype">Ctx</a><a id="31090" class="Symbol">}</a> <a id="31092" class="Symbol">{</a><a id="31093" href="NbE.html#31093" class="Bound">S</a> <a id="31095" href="NbE.html#31095" class="Bound">T</a> <a id="31097" class="Symbol">:</a> <a id="31099" href="NbE.html#1051" class="Datatype">Type</a><a id="31103" class="Symbol">}</a>
           <a id="31116" class="Symbol">→</a> <a id="31118" href="NbE.html#31082" class="Bound">Γ′</a> <a id="31121" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="31123" href="NbE.html#31080" class="Bound">Γ</a> <a id="31125" class="InductiveConstructor Operator">,</a> <a id="31127" href="NbE.html#31095" class="Bound">T</a>
           <a id="31140" class="Symbol">→</a> <a id="31142" href="NbE.html#31082" class="Bound">Γ′</a> <a id="31145" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="31147" href="NbE.html#31080" class="Bound">Γ</a> <a id="31149" class="InductiveConstructor Operator">,</a> <a id="31151" href="NbE.html#31093" class="Bound">S</a>
             <a id="31166" class="Comment">----------</a>
           <a id="31188" class="Symbol">→</a> <a id="31190" href="NbE.html#31095" class="Bound">T</a> <a id="31192" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="31194" href="NbE.html#31093" class="Bound">S</a>

<a id="≤-antisym"></a><a id="31197" href="NbE.html#31197" class="Function">≤-antisym</a> <a id="31207" class="Symbol">:</a> <a id="31209" class="Symbol">∀</a> <a id="31211" class="Symbol">{</a><a id="31212" href="NbE.html#31212" class="Bound">Γ</a> <a id="31214" href="NbE.html#31214" class="Bound">Γ′</a> <a id="31217" class="Symbol">:</a> <a id="31219" href="NbE.html#1943" class="Datatype">Ctx</a><a id="31222" class="Symbol">}</a>
          <a id="31234" class="Symbol">→</a> <a id="31236" href="NbE.html#31212" class="Bound">Γ</a> <a id="31238" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="31240" href="NbE.html#31214" class="Bound">Γ′</a>
          <a id="31253" class="Symbol">→</a> <a id="31255" href="NbE.html#31214" class="Bound">Γ′</a> <a id="31258" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="31260" href="NbE.html#31212" class="Bound">Γ</a>
            <a id="31274" class="Comment">------</a>
          <a id="31291" class="Symbol">→</a> <a id="31293" href="NbE.html#31212" class="Bound">Γ</a> <a id="31295" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="31297" href="NbE.html#31214" class="Bound">Γ′</a>

<a id="Γ≰Γ,T"></a><a id="31301" href="NbE.html#31301" class="Function">Γ≰Γ,T</a> <a id="31307" class="Symbol">:</a> <a id="31309" class="Symbol">∀</a> <a id="31311" class="Symbol">{</a><a id="31312" href="NbE.html#31312" class="Bound">Γ</a> <a id="31314" class="Symbol">:</a> <a id="31316" href="NbE.html#1943" class="Datatype">Ctx</a><a id="31319" class="Symbol">}</a> <a id="31321" class="Symbol">{</a><a id="31322" href="NbE.html#31322" class="Bound">T</a> <a id="31324" class="Symbol">:</a> <a id="31326" href="NbE.html#1051" class="Datatype">Type</a><a id="31330" class="Symbol">}</a> <a id="31332" class="Symbol">→</a> <a id="31334" href="Relation.Nullary.html#656" class="Function Operator">¬</a> <a id="31336" class="Symbol">(</a><a id="31337" href="NbE.html#31312" class="Bound">Γ</a> <a id="31339" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="31341" href="NbE.html#31312" class="Bound">Γ</a> <a id="31343" class="InductiveConstructor Operator">,</a> <a id="31345" href="NbE.html#31322" class="Bound">T</a><a id="31346" class="Symbol">)</a>

<a id="31349" href="NbE.html#31062" class="Function">≤-ext-uniq-T</a> <a id="31362" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="31367" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="31372" class="Symbol">=</a> <a id="31374" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="31379" href="NbE.html#31062" class="Function">≤-ext-uniq-T</a> <a id="31392" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="31397" class="Symbol">(</a><a id="31398" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31404" href="NbE.html#31404" class="Bound">c</a><a id="31405" class="Symbol">)</a> <a id="31407" class="Symbol">=</a> <a id="31409" href="Data.Empty.html#628" class="Function">⊥-elim</a> <a id="31416" class="Symbol">(</a><a id="31417" href="NbE.html#31301" class="Function">Γ≰Γ,T</a> <a id="31423" href="NbE.html#31404" class="Bound">c</a><a id="31424" class="Symbol">)</a>
<a id="31426" href="NbE.html#31062" class="Function">≤-ext-uniq-T</a> <a id="31439" class="Symbol">(</a><a id="31440" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31446" href="NbE.html#31446" class="Bound">c</a><a id="31447" class="Symbol">)</a> <a id="31449" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="31454" class="Symbol">=</a> <a id="31456" href="Data.Empty.html#628" class="Function">⊥-elim</a> <a id="31463" class="Symbol">(</a><a id="31464" href="NbE.html#31301" class="Function">Γ≰Γ,T</a> <a id="31470" href="NbE.html#31446" class="Bound">c</a><a id="31471" class="Symbol">)</a>
<a id="31473" href="NbE.html#31062" class="Function">≤-ext-uniq-T</a> <a id="31486" class="Symbol">(</a><a id="31487" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31493" href="NbE.html#31493" class="Bound">p₁</a><a id="31495" class="Symbol">)</a> <a id="31497" class="Symbol">(</a><a id="31498" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31504" href="NbE.html#31504" class="Bound">p₂</a><a id="31506" class="Symbol">)</a>
  <a id="31510" class="Keyword">rewrite</a> <a id="31518" href="NbE.html#31062" class="Function">≤-ext-uniq-T</a> <a id="31531" href="NbE.html#31493" class="Bound">p₁</a> <a id="31534" href="NbE.html#31504" class="Bound">p₂</a> <a id="31537" class="Symbol">=</a> <a id="31539" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="31545" href="NbE.html#31197" class="Function">≤-antisym</a> <a id="31555" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="31560" href="NbE.html#31560" class="Bound">Γ′≤Γ</a> <a id="31565" class="Symbol">=</a> <a id="31567" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="31572" href="NbE.html#31197" class="Function">≤-antisym</a> <a id="31582" class="Symbol">(</a><a id="31583" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31589" href="NbE.html#31589" class="Bound">Γ≤Γ′</a><a id="31593" class="Symbol">)</a> <a id="31595" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="31600" class="Symbol">=</a> <a id="31602" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="31607" href="NbE.html#31197" class="Function">≤-antisym</a> <a id="31617" class="Symbol">(</a><a id="31618" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31624" class="Symbol">{</a><a id="31625" class="Argument">T</a> <a id="31627" class="Symbol">=</a> <a id="31629" href="NbE.html#31629" class="Bound">T₁</a><a id="31631" class="Symbol">}</a> <a id="31633" href="NbE.html#31633" class="Bound">p₁</a><a id="31635" class="Symbol">)</a> <a id="31637" class="Symbol">(</a><a id="31638" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31644" class="Symbol">{</a><a id="31645" class="Argument">T</a> <a id="31647" class="Symbol">=</a> <a id="31649" href="NbE.html#31649" class="Bound">T₂</a><a id="31651" class="Symbol">}</a> <a id="31653" href="NbE.html#31653" class="Bound">p₂</a><a id="31655" class="Symbol">)</a>
  <a id="31659" class="Keyword">with</a> <a id="31664" href="NbE.html#30895" class="Function">invert-≤</a> <a id="31673" href="NbE.html#31633" class="Bound">p₁</a> <a id="31676" class="Symbol">|</a> <a id="31678" href="NbE.html#30895" class="Function">invert-≤</a> <a id="31687" href="NbE.html#31653" class="Bound">p₂</a>
<a id="31690" class="Symbol">...</a> <a id="31694" class="Symbol">|</a> <a id="31696" href="NbE.html#31696" class="Bound">≤→</a>         <a id="31707" class="Symbol">|</a> <a id="31709" href="NbE.html#31709" class="Bound">≤←</a>
  <a id="31714" class="Keyword">with</a> <a id="31719" href="NbE.html#31197" class="Function">≤-antisym</a> <a id="31729" href="NbE.html#31696" class="Bound">≤→</a> <a id="31732" href="NbE.html#31709" class="Bound">≤←</a>
<a id="31735" class="Symbol">...</a> <a id="31739" class="Symbol">|</a> <a id="31741" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
  <a id="31748" class="Keyword">rewrite</a> <a id="31756" href="NbE.html#31062" class="Function">≤-ext-uniq-T</a> <a id="31769" class="Bound">p₁</a> <a id="31772" class="Bound">p₂</a> <a id="31775" class="Symbol">=</a> <a id="31777" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="31783" href="NbE.html#31301" class="Function">Γ≰Γ,T</a> <a id="31789" class="Symbol">{</a><a id="31790" href="NbE.html#31790" class="Bound">Γ</a><a id="31791" class="Symbol">}</a> <a id="31793" class="Symbol">{</a><a id="31794" href="NbE.html#31794" class="Bound">T</a><a id="31795" class="Symbol">}</a> <a id="31797" href="NbE.html#31797" class="Bound">Γ≤Γ,T</a> <a id="31803" class="Keyword">with</a> <a id="31808" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="31814" class="Symbol">{</a><a id="31815" class="Argument">T</a> <a id="31817" class="Symbol">=</a> <a id="31819" href="NbE.html#31794" class="Bound">T</a><a id="31820" class="Symbol">}</a> <a id="31822" class="Symbol">(</a><a id="31823" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="31828" class="Symbol">{</a><a id="31829" href="NbE.html#31790" class="Bound">Γ</a><a id="31830" class="Symbol">})</a>
<a id="31833" class="Symbol">...</a> <a id="31837" class="Symbol">|</a> <a id="31839" href="NbE.html#31839" class="Bound">Γ,T≤Γ</a>
  <a id="31847" class="Keyword">with</a> <a id="31852" href="NbE.html#31197" class="Function">≤-antisym</a> <a id="31862" class="Bound">Γ≤Γ,T</a> <a id="31868" href="NbE.html#31839" class="Bound">Γ,T≤Γ</a>
<a id="31874" class="Symbol">...</a> <a id="31878" class="Symbol">|</a> <a id="31880" class="Symbol">()</a>

<a id="31884" class="Comment">-- Proof of context extension is irrelevant, and any</a>
<a id="31937" class="Comment">-- two proofs that a context is an extension of another</a>
<a id="31993" class="Comment">-- are equivalent</a>
<a id="≤-pf-irrelevance"></a><a id="32011" href="NbE.html#32011" class="Function">≤-pf-irrelevance</a> <a id="32028" class="Symbol">:</a> <a id="32030" class="Symbol">∀</a> <a id="32032" class="Symbol">{</a><a id="32033" href="NbE.html#32033" class="Bound">Γ′</a> <a id="32036" href="NbE.html#32036" class="Bound">Γ</a> <a id="32038" class="Symbol">:</a> <a id="32040" href="NbE.html#1943" class="Datatype">Ctx</a><a id="32043" class="Symbol">}</a>
       <a id="32052" class="Symbol">→</a> <a id="32054" class="Symbol">(</a><a id="32055" href="NbE.html#32055" class="Bound">pf₁</a> <a id="32059" class="Symbol">:</a> <a id="32061" href="NbE.html#32033" class="Bound">Γ′</a> <a id="32064" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="32066" href="NbE.html#32036" class="Bound">Γ</a><a id="32067" class="Symbol">)</a>
       <a id="32076" class="Symbol">→</a> <a id="32078" class="Symbol">(</a><a id="32079" href="NbE.html#32079" class="Bound">pf₂</a> <a id="32083" class="Symbol">:</a> <a id="32085" href="NbE.html#32033" class="Bound">Γ′</a> <a id="32088" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="32090" href="NbE.html#32036" class="Bound">Γ</a><a id="32091" class="Symbol">)</a>
       <a id="32100" class="Symbol">→</a> <a id="32102" href="NbE.html#32055" class="Bound">pf₁</a> <a id="32106" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="32108" href="NbE.html#32079" class="Bound">pf₂</a>
<a id="32112" href="NbE.html#32011" class="Function">≤-pf-irrelevance</a> <a id="32129" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="32134" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="32139" class="Symbol">=</a> <a id="32141" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="32146" href="NbE.html#32011" class="Function">≤-pf-irrelevance</a> <a id="32163" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="32168" class="Symbol">(</a><a id="32169" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32175" href="NbE.html#32175" class="Bound">pf</a><a id="32177" class="Symbol">)</a> <a id="32179" class="Symbol">=</a> <a id="32181" href="Data.Empty.html#628" class="Function">⊥-elim</a> <a id="32188" class="Symbol">(</a><a id="32189" href="NbE.html#31301" class="Function">Γ≰Γ,T</a> <a id="32195" href="NbE.html#32175" class="Bound">pf</a><a id="32197" class="Symbol">)</a>
<a id="32199" href="NbE.html#32011" class="Function">≤-pf-irrelevance</a> <a id="32216" class="Symbol">(</a><a id="32217" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32223" href="NbE.html#32223" class="Bound">pf</a><a id="32225" class="Symbol">)</a> <a id="32227" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="32232" class="Symbol">=</a> <a id="32234" href="Data.Empty.html#628" class="Function">⊥-elim</a> <a id="32241" class="Symbol">(</a><a id="32242" href="NbE.html#31301" class="Function">Γ≰Γ,T</a> <a id="32248" href="NbE.html#32223" class="Bound">pf</a><a id="32250" class="Symbol">)</a>
<a id="32252" href="NbE.html#32011" class="Function">≤-pf-irrelevance</a> <a id="32269" class="Symbol">(</a><a id="32270" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32276" href="NbE.html#32276" class="Bound">pf₁</a><a id="32279" class="Symbol">)</a> <a id="32281" class="Symbol">(</a><a id="32282" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32288" href="NbE.html#32288" class="Bound">pf₂</a><a id="32291" class="Symbol">)</a> <a id="32293" class="Keyword">rewrite</a> <a id="32301" href="NbE.html#32011" class="Function">≤-pf-irrelevance</a> <a id="32318" href="NbE.html#32276" class="Bound">pf₁</a> <a id="32322" href="NbE.html#32288" class="Bound">pf₂</a> <a id="32326" class="Symbol">=</a> <a id="32328" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="32334" class="Comment">-- Context extension is transitive</a>
<a id="≤-trans"></a><a id="32369" href="NbE.html#32369" class="Function">≤-trans</a> <a id="32377" class="Symbol">:</a> <a id="32379" class="Symbol">∀</a> <a id="32381" class="Symbol">{</a><a id="32382" href="NbE.html#32382" class="Bound">Γ₃</a> <a id="32385" href="NbE.html#32385" class="Bound">Γ₂</a> <a id="32388" href="NbE.html#32388" class="Bound">Γ₁</a> <a id="32391" class="Symbol">:</a> <a id="32393" href="NbE.html#1943" class="Datatype">Ctx</a><a id="32396" class="Symbol">}</a>
        <a id="32406" class="Symbol">→</a> <a id="32408" href="NbE.html#32382" class="Bound">Γ₃</a> <a id="32411" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="32413" href="NbE.html#32385" class="Bound">Γ₂</a>
        <a id="32424" class="Symbol">→</a> <a id="32426" href="NbE.html#32385" class="Bound">Γ₂</a> <a id="32429" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="32431" href="NbE.html#32388" class="Bound">Γ₁</a>
          <a id="32444" class="Comment">-------</a>
        <a id="32460" class="Symbol">→</a> <a id="32462" href="NbE.html#32382" class="Bound">Γ₃</a> <a id="32465" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="32467" href="NbE.html#32388" class="Bound">Γ₁</a>
<a id="32470" href="NbE.html#32369" class="Function">≤-trans</a> <a id="32478" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="32483" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="32488" class="Symbol">=</a> <a id="32490" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
<a id="32495" href="NbE.html#32369" class="Function">≤-trans</a> <a id="32503" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="32508" class="Symbol">(</a><a id="32509" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32515" href="NbE.html#32515" class="Bound">pf</a><a id="32517" class="Symbol">)</a> <a id="32519" class="Symbol">=</a> <a id="32521" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32527" href="NbE.html#32515" class="Bound">pf</a>
<a id="32530" href="NbE.html#32369" class="Function">≤-trans</a> <a id="32538" class="Symbol">(</a><a id="32539" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32545" href="NbE.html#32545" class="Bound">pf</a><a id="32547" class="Symbol">)</a> <a id="32549" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="32554" class="Symbol">=</a> <a id="32556" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32562" href="NbE.html#32545" class="Bound">pf</a>
<a id="32565" href="NbE.html#32369" class="Function">≤-trans</a> <a id="32573" class="Symbol">(</a><a id="32574" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32580" href="NbE.html#32580" class="Bound">pf₁</a><a id="32583" class="Symbol">)</a> <a id="32585" class="Symbol">(</a><a id="32586" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32592" href="NbE.html#32592" class="Bound">pf₂</a><a id="32595" class="Symbol">)</a> <a id="32597" class="Symbol">=</a> <a id="32599" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32605" class="Symbol">(</a><a id="32606" href="NbE.html#32369" class="Function">≤-trans</a> <a id="32614" href="NbE.html#32580" class="Bound">pf₁</a> <a id="32618" class="Symbol">(</a><a id="32619" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="32625" href="NbE.html#32592" class="Bound">pf₂</a><a id="32628" class="Symbol">))</a>

<a id="32632" class="Comment">-- Substitution / renaming lemmas</a>

<a id="32667" class="Comment">-- Renaming a lookup judgement is equivalent to applying the</a>
<a id="32728" class="Comment">-- renaming to a variable with that lookup judgement</a>
<a id="rename≡[x]ᵣ"></a><a id="32781" href="NbE.html#32781" class="Function">rename≡[x]ᵣ</a> <a id="32793" class="Symbol">:</a> <a id="32795" class="Symbol">∀</a> <a id="32797" class="Symbol">{</a><a id="32798" href="NbE.html#32798" class="Bound">Γ</a> <a id="32800" href="NbE.html#32800" class="Bound">Δ</a> <a id="32802" class="Symbol">:</a> <a id="32804" href="NbE.html#1943" class="Datatype">Ctx</a><a id="32807" class="Symbol">}</a> <a id="32809" class="Symbol">{</a><a id="32810" href="NbE.html#32810" class="Bound">T</a> <a id="32812" class="Symbol">:</a> <a id="32814" href="NbE.html#1051" class="Datatype">Type</a><a id="32818" class="Symbol">}</a> <a id="32820" class="Symbol">{</a><a id="32821" href="NbE.html#32821" class="Bound">x</a> <a id="32823" class="Symbol">:</a> <a id="32825" href="NbE.html#32800" class="Bound">Δ</a> <a id="32827" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="32829" href="NbE.html#32810" class="Bound">T</a><a id="32830" class="Symbol">}</a> <a id="32832" class="Symbol">{</a><a id="32833" href="NbE.html#32833" class="Bound">σᵣ</a> <a id="32836" class="Symbol">:</a> <a id="32838" href="NbE.html#7265" class="Datatype">Ren</a> <a id="32842" href="NbE.html#32798" class="Bound">Γ</a> <a id="32844" href="NbE.html#32800" class="Bound">Δ</a><a id="32845" class="Symbol">}</a>
            <a id="32859" class="Symbol">→</a> <a id="32861" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="32863" class="Symbol">(</a><a id="32864" href="NbE.html#7659" class="Function">rename</a> <a id="32871" href="NbE.html#32821" class="Bound">x</a> <a id="32873" href="NbE.html#32833" class="Bound">σᵣ</a><a id="32875" class="Symbol">)</a> <a id="32877" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="32879" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="32881" href="NbE.html#32821" class="Bound">x</a> <a id="32883" href="NbE.html#8616" class="Function Operator">[</a> <a id="32885" href="NbE.html#32833" class="Bound">σᵣ</a> <a id="32888" href="NbE.html#8616" class="Function Operator">]ᵣ</a>
<a id="32891" href="NbE.html#32781" class="Function">rename≡[x]ᵣ</a> <a id="32903" class="Symbol">{</a><a id="32904" class="Argument">x</a> <a id="32906" class="Symbol">=</a> <a id="32908" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="32910" class="Symbol">}</a> <a id="32912" class="Symbol">{</a><a id="32913" href="NbE.html#32913" class="Bound">σᵣ</a> <a id="32916" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="32918" href="NbE.html#32918" class="Bound">y</a><a id="32919" class="Symbol">}</a> <a id="32921" class="Symbol">=</a> <a id="32923" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="32928" href="NbE.html#32781" class="Function">rename≡[x]ᵣ</a> <a id="32940" class="Symbol">{</a><a id="32941" class="Argument">x</a> <a id="32943" class="Symbol">=</a> <a id="32945" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="32948" href="NbE.html#32948" class="Bound">x</a><a id="32949" class="Symbol">}</a> <a id="32951" class="Symbol">{</a><a id="32952" href="NbE.html#32952" class="Bound">σᵣ</a> <a id="32955" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="32957" href="NbE.html#32957" class="Bound">y</a><a id="32958" class="Symbol">}</a> <a id="32960" class="Symbol">=</a> <a id="32962" href="NbE.html#32781" class="Function">rename≡[x]ᵣ</a> <a id="32974" class="Symbol">{</a><a id="32975" class="Argument">x</a> <a id="32977" class="Symbol">=</a> <a id="32979" href="NbE.html#32948" class="Bound">x</a><a id="32980" class="Symbol">}</a> <a id="32982" class="Symbol">{</a><a id="32983" href="NbE.html#32952" class="Bound">σᵣ</a><a id="32985" class="Symbol">}</a>

<a id="32988" class="Comment">-- Applying a shifted renaming to a variable is equivalent</a>
<a id="33047" class="Comment">-- to incrementing the original renaming of the variable&#39;s</a>
<a id="33106" class="Comment">-- lookup judgemnet:</a>
<a id="33127" class="Comment">--   ` x [ σ ↑ ] ≡ `S (rename x σ) (where σ is a renaming substitution)</a>
<a id="shift-var"></a><a id="33199" href="NbE.html#33199" class="Function">shift-var</a> <a id="33209" class="Symbol">:</a> <a id="33211" class="Symbol">∀</a> <a id="33213" class="Symbol">{</a><a id="33214" href="NbE.html#33214" class="Bound">Γ</a> <a id="33216" href="NbE.html#33216" class="Bound">Δ</a> <a id="33218" class="Symbol">:</a> <a id="33220" href="NbE.html#1943" class="Datatype">Ctx</a><a id="33223" class="Symbol">}</a> <a id="33225" class="Symbol">{</a><a id="33226" href="NbE.html#33226" class="Bound">S</a> <a id="33228" href="NbE.html#33228" class="Bound">T</a> <a id="33230" class="Symbol">:</a> <a id="33232" href="NbE.html#1051" class="Datatype">Type</a><a id="33236" class="Symbol">}</a> <a id="33238" class="Symbol">{</a><a id="33239" href="NbE.html#33239" class="Bound">x</a> <a id="33241" class="Symbol">:</a> <a id="33243" href="NbE.html#33214" class="Bound">Γ</a> <a id="33245" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="33247" href="NbE.html#33228" class="Bound">T</a><a id="33248" class="Symbol">}</a> <a id="33250" class="Symbol">{</a><a id="33251" href="NbE.html#33251" class="Bound">σᵣ</a> <a id="33254" class="Symbol">:</a> <a id="33256" href="NbE.html#7265" class="Datatype">Ren</a> <a id="33260" href="NbE.html#33216" class="Bound">Δ</a> <a id="33262" href="NbE.html#33214" class="Bound">Γ</a><a id="33263" class="Symbol">}</a>
          <a id="33275" class="Symbol">→</a> <a id="33277" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="33279" href="NbE.html#33239" class="Bound">x</a> <a id="33281" href="NbE.html#10528" class="Function Operator">[</a> <a id="33283" href="NbE.html#9824" class="Function">subst-ren</a> <a id="33293" class="Symbol">(</a><a id="33294" href="NbE.html#8198" class="Function Operator">_↑ᵣ</a> <a id="33298" class="Symbol">{</a><a id="33299" class="Argument">T</a> <a id="33301" class="Symbol">=</a> <a id="33303" href="NbE.html#33226" class="Bound">S</a><a id="33304" class="Symbol">}</a> <a id="33306" href="NbE.html#33251" class="Bound">σᵣ</a><a id="33308" class="Symbol">)</a> <a id="33310" href="NbE.html#10528" class="Function Operator">]</a> <a id="33312" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="33314" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="33316" class="Symbol">(</a><a id="33317" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="33320" class="Symbol">(</a><a id="33321" href="NbE.html#7659" class="Function">rename</a> <a id="33328" href="NbE.html#33239" class="Bound">x</a> <a id="33330" href="NbE.html#33251" class="Bound">σᵣ</a><a id="33332" class="Symbol">))</a>
<a id="33335" href="NbE.html#33199" class="Function">shift-var</a> <a id="33345" class="Symbol">{</a><a id="33346" class="Argument">x</a> <a id="33348" class="Symbol">=</a> <a id="33350" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="33352" class="Symbol">}</a> <a id="33354" class="Symbol">{_</a> <a id="33357" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="33359" class="Symbol">_}</a> <a id="33362" class="Symbol">=</a> <a id="33364" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="33369" href="NbE.html#33199" class="Function">shift-var</a> <a id="33379" class="Symbol">{</a><a id="33380" class="Argument">x</a> <a id="33382" class="Symbol">=</a> <a id="33384" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="33387" href="NbE.html#33387" class="Bound">x</a><a id="33388" class="Symbol">}</a> <a id="33390" class="Symbol">{</a><a id="33391" href="NbE.html#33391" class="Bound">σᵣ</a> <a id="33394" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="33396" class="Symbol">_}</a> <a id="33399" class="Symbol">=</a> <a id="33401" href="NbE.html#33199" class="Function">shift-var</a> <a id="33411" class="Symbol">{</a><a id="33412" class="Argument">x</a> <a id="33414" class="Symbol">=</a> <a id="33416" href="NbE.html#33387" class="Bound">x</a><a id="33417" class="Symbol">}</a> <a id="33419" class="Symbol">{</a><a id="33420" href="NbE.html#33391" class="Bound">σᵣ</a><a id="33422" class="Symbol">}</a>

<a id="33425" class="Comment">-- Specialized version of the previous lemma</a>
<a id="shift-rename"></a><a id="33470" href="NbE.html#33470" class="Function">shift-rename</a> <a id="33483" class="Symbol">:</a> <a id="33485" class="Symbol">∀</a> <a id="33487" class="Symbol">{</a><a id="33488" href="NbE.html#33488" class="Bound">Γ</a> <a id="33490" href="NbE.html#33490" class="Bound">Δ</a> <a id="33492" class="Symbol">:</a> <a id="33494" href="NbE.html#1943" class="Datatype">Ctx</a><a id="33497" class="Symbol">}</a> <a id="33499" class="Symbol">{</a><a id="33500" href="NbE.html#33500" class="Bound">S</a> <a id="33502" href="NbE.html#33502" class="Bound">T</a> <a id="33504" class="Symbol">:</a> <a id="33506" href="NbE.html#1051" class="Datatype">Type</a><a id="33510" class="Symbol">}</a> <a id="33512" class="Symbol">{</a><a id="33513" href="NbE.html#33513" class="Bound">x</a> <a id="33515" class="Symbol">:</a> <a id="33517" href="NbE.html#33488" class="Bound">Γ</a> <a id="33519" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="33521" href="NbE.html#33502" class="Bound">T</a><a id="33522" class="Symbol">}</a> <a id="33524" class="Symbol">{</a><a id="33525" href="NbE.html#33525" class="Bound">σᵣ</a> <a id="33528" class="Symbol">:</a> <a id="33530" href="NbE.html#7265" class="Datatype">Ren</a> <a id="33534" href="NbE.html#33490" class="Bound">Δ</a> <a id="33536" href="NbE.html#33488" class="Bound">Γ</a><a id="33537" class="Symbol">}</a>
            <a id="33551" class="Symbol">→</a> <a id="33553" href="NbE.html#7659" class="Function">rename</a> <a id="33560" href="NbE.html#33513" class="Bound">x</a> <a id="33562" class="Symbol">(</a><a id="33563" href="NbE.html#8198" class="Function Operator">_↑ᵣ</a> <a id="33567" class="Symbol">{</a><a id="33568" class="Argument">T</a> <a id="33570" class="Symbol">=</a> <a id="33572" href="NbE.html#33500" class="Bound">S</a><a id="33573" class="Symbol">}</a> <a id="33575" href="NbE.html#33525" class="Bound">σᵣ</a><a id="33577" class="Symbol">)</a> <a id="33579" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="33581" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="33584" class="Symbol">(</a><a id="33585" href="NbE.html#7659" class="Function">rename</a> <a id="33592" href="NbE.html#33513" class="Bound">x</a> <a id="33594" href="NbE.html#33525" class="Bound">σᵣ</a><a id="33596" class="Symbol">)</a>
<a id="33598" href="NbE.html#33470" class="Function">shift-rename</a> <a id="33611" class="Symbol">{</a><a id="33612" class="Argument">x</a> <a id="33614" class="Symbol">=</a> <a id="33616" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="33618" class="Symbol">}</a> <a id="33620" class="Symbol">{_</a> <a id="33623" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="33625" class="Symbol">_}</a> <a id="33628" class="Symbol">=</a> <a id="33630" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="33635" href="NbE.html#33470" class="Function">shift-rename</a> <a id="33648" class="Symbol">{</a><a id="33649" class="Argument">x</a> <a id="33651" class="Symbol">=</a> <a id="33653" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="33656" href="NbE.html#33656" class="Bound">x</a><a id="33657" class="Symbol">}</a> <a id="33659" class="Symbol">{</a><a id="33660" href="NbE.html#33660" class="Bound">σᵣ</a> <a id="33663" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="33665" class="Symbol">_}</a> <a id="33668" class="Symbol">=</a> <a id="33670" href="NbE.html#33470" class="Function">shift-rename</a> <a id="33683" class="Symbol">{</a><a id="33684" class="Argument">x</a> <a id="33686" class="Symbol">=</a> <a id="33688" href="NbE.html#33656" class="Bound">x</a><a id="33689" class="Symbol">}</a> <a id="33691" class="Symbol">{</a><a id="33692" href="NbE.html#33660" class="Bound">σᵣ</a><a id="33694" class="Symbol">}</a>

<a id="33697" class="Comment">-- Renaming with the identity renaming has no effect</a>
<a id="rename-id"></a><a id="33750" href="NbE.html#33750" class="Function">rename-id</a> <a id="33760" class="Symbol">:</a> <a id="33762" class="Symbol">∀</a> <a id="33764" class="Symbol">{</a><a id="33765" href="NbE.html#33765" class="Bound">Γ</a> <a id="33767" class="Symbol">:</a> <a id="33769" href="NbE.html#1943" class="Datatype">Ctx</a><a id="33772" class="Symbol">}</a> <a id="33774" class="Symbol">{</a><a id="33775" href="NbE.html#33775" class="Bound">T</a> <a id="33777" class="Symbol">:</a> <a id="33779" href="NbE.html#1051" class="Datatype">Type</a><a id="33783" class="Symbol">}</a> <a id="33785" class="Symbol">{</a><a id="33786" href="NbE.html#33786" class="Bound">x</a> <a id="33788" class="Symbol">:</a> <a id="33790" href="NbE.html#33765" class="Bound">Γ</a> <a id="33792" href="NbE.html#3674" class="Datatype Operator">∋</a> <a id="33794" href="NbE.html#33775" class="Bound">T</a><a id="33795" class="Symbol">}</a>
          <a id="33807" class="Symbol">→</a> <a id="33809" href="NbE.html#7659" class="Function">rename</a> <a id="33816" href="NbE.html#33786" class="Bound">x</a> <a id="33818" href="NbE.html#9240" class="Function">ren-id</a> <a id="33825" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="33827" href="NbE.html#33786" class="Bound">x</a>
<a id="33829" href="NbE.html#33750" class="Function">rename-id</a> <a id="33839" class="Symbol">{</a><a id="33840" class="Argument">x</a> <a id="33842" class="Symbol">=</a> <a id="33844" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="33846" class="Symbol">}</a> <a id="33848" class="Symbol">=</a> <a id="33850" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="33855" href="NbE.html#33750" class="Function">rename-id</a> <a id="33865" class="Symbol">{</a><a id="33866" class="Argument">x</a> <a id="33868" class="Symbol">=</a> <a id="33870" class="Symbol">(</a><a id="33871" href="NbE.html#3772" class="InductiveConstructor Operator">`S_</a> <a id="33875" class="Symbol">{_}</a> <a id="33879" class="Symbol">{</a><a id="33880" href="NbE.html#33880" class="Bound">S</a><a id="33881" class="Symbol">}</a> <a id="33883" href="NbE.html#33883" class="Bound">x</a><a id="33884" class="Symbol">)}</a>
  <a id="33889" class="Keyword">rewrite</a> <a id="33897" href="NbE.html#33470" class="Function">shift-rename</a> <a id="33910" class="Symbol">{</a><a id="33911" class="Argument">S</a> <a id="33913" class="Symbol">=</a> <a id="33915" href="NbE.html#33880" class="Bound">S</a><a id="33916" class="Symbol">}</a> <a id="33918" class="Symbol">{</a><a id="33919" class="Argument">x</a> <a id="33921" class="Symbol">=</a> <a id="33923" href="NbE.html#33883" class="Bound">x</a><a id="33924" class="Symbol">}</a> <a id="33926" class="Symbol">{</a><a id="33927" class="Argument">σᵣ</a> <a id="33930" class="Symbol">=</a> <a id="33932" href="NbE.html#9240" class="Function">ren-id</a><a id="33938" class="Symbol">}</a> <a id="33940" class="Symbol">|</a> <a id="33942" href="NbE.html#33750" class="Function">rename-id</a> <a id="33952" class="Symbol">{</a><a id="33953" class="Argument">x</a> <a id="33955" class="Symbol">=</a> <a id="33957" href="NbE.html#33883" class="Bound">x</a><a id="33958" class="Symbol">}</a> <a id="33960" class="Symbol">=</a> <a id="33962" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="33968" class="Comment">-- Shifting is commutative between renaming/substitution: a shifted</a>
<a id="34036" class="Comment">-- renaming substitution is equivalent to a substitution created from</a>
<a id="34106" class="Comment">-- a shifted renaming</a>
<a id="shift-rename-subst"></a><a id="34128" href="NbE.html#34128" class="Function">shift-rename-subst</a> <a id="34147" class="Symbol">:</a> <a id="34149" class="Symbol">∀</a> <a id="34151" class="Symbol">{</a><a id="34152" href="NbE.html#34152" class="Bound">Γ</a> <a id="34154" href="NbE.html#34154" class="Bound">Δ</a> <a id="34156" class="Symbol">:</a> <a id="34158" href="NbE.html#1943" class="Datatype">Ctx</a><a id="34161" class="Symbol">}</a> <a id="34163" class="Symbol">{</a><a id="34164" href="NbE.html#34164" class="Bound">T</a> <a id="34166" class="Symbol">:</a> <a id="34168" href="NbE.html#1051" class="Datatype">Type</a><a id="34172" class="Symbol">}</a> <a id="34174" class="Symbol">{</a><a id="34175" href="NbE.html#34175" class="Bound">σᵣ</a> <a id="34178" class="Symbol">:</a> <a id="34180" href="NbE.html#7265" class="Datatype">Ren</a> <a id="34184" href="NbE.html#34152" class="Bound">Γ</a> <a id="34186" href="NbE.html#34154" class="Bound">Δ</a><a id="34187" class="Symbol">}</a>
                   <a id="34208" class="Symbol">→</a> <a id="34210" href="NbE.html#9824" class="Function">subst-ren</a> <a id="34220" class="Symbol">(</a><a id="34221" href="NbE.html#8198" class="Function Operator">_↑ᵣ</a> <a id="34225" class="Symbol">{</a><a id="34226" class="Argument">T</a> <a id="34228" class="Symbol">=</a> <a id="34230" href="NbE.html#34164" class="Bound">T</a><a id="34231" class="Symbol">}</a> <a id="34233" href="NbE.html#34175" class="Bound">σᵣ</a><a id="34235" class="Symbol">)</a> <a id="34237" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="34239" href="NbE.html#10252" class="Function Operator">_↑</a> <a id="34242" class="Symbol">{</a><a id="34243" class="Argument">T</a> <a id="34245" class="Symbol">=</a> <a id="34247" href="NbE.html#34164" class="Bound">T</a><a id="34248" class="Symbol">}</a> <a id="34250" class="Symbol">(</a><a id="34251" href="NbE.html#9824" class="Function">subst-ren</a> <a id="34261" href="NbE.html#34175" class="Bound">σᵣ</a><a id="34263" class="Symbol">)</a>
<a id="34265" href="NbE.html#34128" class="Function">shift-rename-subst</a> <a id="34284" class="Symbol">{</a><a id="34285" class="Argument">σᵣ</a> <a id="34288" class="Symbol">=</a> <a id="34290" href="NbE.html#7295" class="InductiveConstructor">∅</a><a id="34291" class="Symbol">}</a> <a id="34293" class="Symbol">=</a> <a id="34295" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="34300" href="NbE.html#34128" class="Function">shift-rename-subst</a> <a id="34319" class="Symbol">{</a><a id="34320" class="Argument">T</a> <a id="34322" class="Symbol">=</a> <a id="34324" href="NbE.html#34324" class="Bound">T</a><a id="34325" class="Symbol">}</a> <a id="34327" class="Symbol">{</a><a id="34328" class="Argument">σᵣ</a> <a id="34331" class="Symbol">=</a> <a id="34333" href="NbE.html#7324" class="InductiveConstructor Operator">_,_</a> <a id="34337" class="Symbol">{</a><a id="34338" class="Argument">S</a> <a id="34340" class="Symbol">=</a> <a id="34342" href="NbE.html#34342" class="Bound">S</a><a id="34343" class="Symbol">}</a> <a id="34345" href="NbE.html#34345" class="Bound">σᵣ</a> <a id="34348" href="NbE.html#34348" class="Bound">x</a><a id="34349" class="Symbol">}</a>
  <a id="34353" class="Keyword">rewrite</a> <a id="34361" href="NbE.html#34128" class="Function">shift-rename-subst</a> <a id="34380" class="Symbol">{</a><a id="34381" class="Argument">T</a> <a id="34383" class="Symbol">=</a> <a id="34385" href="NbE.html#34324" class="Bound">T</a><a id="34386" class="Symbol">}</a> <a id="34388" class="Symbol">{</a><a id="34389" class="Argument">σᵣ</a> <a id="34392" class="Symbol">=</a> <a id="34394" href="NbE.html#34345" class="Bound">σᵣ</a><a id="34396" class="Symbol">}</a>
        <a id="34406" class="Symbol">|</a> <a id="34408" href="NbE.html#750" class="Function">≡-sym</a> <a id="34414" class="Symbol">(</a><a id="34415" href="NbE.html#32781" class="Function">rename≡[x]ᵣ</a> <a id="34427" class="Symbol">{</a><a id="34428" class="Argument">x</a> <a id="34430" class="Symbol">=</a> <a id="34432" href="NbE.html#34348" class="Bound">x</a><a id="34433" class="Symbol">}</a> <a id="34435" class="Symbol">{</a><a id="34436" class="Argument">σᵣ</a> <a id="34439" class="Symbol">=</a> <a id="34441" href="NbE.html#8198" class="Function Operator">_↑ᵣ</a> <a id="34445" class="Symbol">{</a><a id="34446" class="Argument">T</a> <a id="34448" class="Symbol">=</a> <a id="34450" href="NbE.html#34324" class="Bound">T</a><a id="34451" class="Symbol">}</a> <a id="34453" href="NbE.html#9240" class="Function">ren-id</a><a id="34459" class="Symbol">})</a>
        <a id="34470" class="Symbol">|</a> <a id="34472" href="NbE.html#33470" class="Function">shift-rename</a> <a id="34485" class="Symbol">{</a><a id="34486" class="Argument">S</a> <a id="34488" class="Symbol">=</a> <a id="34490" href="NbE.html#34324" class="Bound">T</a><a id="34491" class="Symbol">}</a> <a id="34493" class="Symbol">{</a><a id="34494" class="Argument">x</a> <a id="34496" class="Symbol">=</a> <a id="34498" href="NbE.html#34348" class="Bound">x</a><a id="34499" class="Symbol">}</a> <a id="34501" class="Symbol">{</a><a id="34502" class="Argument">σᵣ</a> <a id="34505" class="Symbol">=</a> <a id="34507" href="NbE.html#9240" class="Function">ren-id</a><a id="34513" class="Symbol">}</a>
        <a id="34523" class="Symbol">|</a> <a id="34525" href="NbE.html#33750" class="Function">rename-id</a> <a id="34535" class="Symbol">{</a><a id="34536" class="Argument">x</a> <a id="34538" class="Symbol">=</a> <a id="34540" href="NbE.html#34348" class="Bound">x</a><a id="34541" class="Symbol">}</a>                                 <a id="34575" class="Symbol">=</a> <a id="34577" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="34583" class="Comment">-- Lemma for expanding an identity substitution once</a>
<a id="id≡↑id,x"></a><a id="34636" href="NbE.html#34636" class="Function">id≡↑id,x</a> <a id="34645" class="Symbol">:</a> <a id="34647" class="Symbol">∀</a> <a id="34649" class="Symbol">{</a><a id="34650" href="NbE.html#34650" class="Bound">Γ</a> <a id="34652" class="Symbol">:</a> <a id="34654" href="NbE.html#1943" class="Datatype">Ctx</a><a id="34657" class="Symbol">}</a> <a id="34659" class="Symbol">{</a><a id="34660" href="NbE.html#34660" class="Bound">T</a> <a id="34662" class="Symbol">:</a> <a id="34664" href="NbE.html#1051" class="Datatype">Type</a><a id="34668" class="Symbol">}</a> <a id="34670" class="Symbol">→</a> <a id="34672" href="NbE.html#11739" class="Function">subst-id</a> <a id="34681" class="Symbol">{</a><a id="34682" href="NbE.html#34650" class="Bound">Γ</a> <a id="34684" class="InductiveConstructor Operator">,</a> <a id="34686" href="NbE.html#34660" class="Bound">T</a><a id="34687" class="Symbol">}</a> <a id="34689" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="34691" class="Symbol">(</a><a id="34692" href="NbE.html#10252" class="Function Operator">_↑</a> <a id="34695" class="Symbol">{</a><a id="34696" class="Argument">T</a> <a id="34698" class="Symbol">=</a> <a id="34700" href="NbE.html#34660" class="Bound">T</a><a id="34701" class="Symbol">}</a> <a id="34703" href="NbE.html#11739" class="Function">subst-id</a> <a id="34712" class="InductiveConstructor Operator">,</a> <a id="34714" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="34716" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="34718" class="Symbol">)</a>
<a id="34720" href="NbE.html#34636" class="Function">id≡↑id,x</a> <a id="34729" class="Symbol">{</a><a id="34730" href="NbE.html#1961" class="InductiveConstructor">∅</a><a id="34731" class="Symbol">}</a> <a id="34733" class="Symbol">=</a> <a id="34735" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="34740" href="NbE.html#34636" class="Function">id≡↑id,x</a> <a id="34749" class="Symbol">{</a><a id="34750" href="NbE.html#34750" class="Bound">Γ</a> <a id="34752" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="34754" href="NbE.html#34754" class="Bound">T</a><a id="34755" class="Symbol">}</a> <a id="34757" class="Symbol">{</a><a id="34758" href="NbE.html#34758" class="Bound">S</a><a id="34759" class="Symbol">}</a>
  <a id="34763" class="Keyword">rewrite</a> <a id="34771" href="NbE.html#34636" class="Function">id≡↑id,x</a> <a id="34780" class="Symbol">{</a><a id="34781" href="NbE.html#34750" class="Bound">Γ</a><a id="34782" class="Symbol">}</a> <a id="34784" class="Symbol">{</a><a id="34785" href="NbE.html#34754" class="Bound">T</a><a id="34786" class="Symbol">}</a>
        <a id="34796" class="Symbol">|</a> <a id="34798" href="NbE.html#34128" class="Function">shift-rename-subst</a> <a id="34817" class="Symbol">{</a><a id="34818" href="NbE.html#34750" class="Bound">Γ</a> <a id="34820" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="34822" href="NbE.html#34754" class="Bound">T</a><a id="34823" class="Symbol">}</a> <a id="34825" class="Symbol">{</a><a id="34826" href="NbE.html#34750" class="Bound">Γ</a><a id="34827" class="Symbol">}</a> <a id="34829" class="Symbol">{</a><a id="34830" href="NbE.html#34758" class="Bound">S</a><a id="34831" class="Symbol">}</a> <a id="34833" class="Symbol">{</a><a id="34834" class="Argument">σᵣ</a> <a id="34837" class="Symbol">=</a> <a id="34839" href="NbE.html#9240" class="Function">ren-id</a> <a id="34846" href="NbE.html#8198" class="Function Operator">↑ᵣ</a><a id="34848" class="Symbol">}</a> <a id="34850" class="Symbol">=</a> <a id="34852" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="34858" class="Comment">-- The identity substititon has no effect</a>
<a id="[id]-identity"></a><a id="34900" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="34914" class="Symbol">:</a> <a id="34916" class="Symbol">∀</a> <a id="34918" class="Symbol">{</a><a id="34919" href="NbE.html#34919" class="Bound">Γ</a> <a id="34921" class="Symbol">:</a> <a id="34923" href="NbE.html#1943" class="Datatype">Ctx</a><a id="34926" class="Symbol">}</a> <a id="34928" class="Symbol">{</a><a id="34929" href="NbE.html#34929" class="Bound">T</a> <a id="34931" class="Symbol">:</a> <a id="34933" href="NbE.html#1051" class="Datatype">Type</a><a id="34937" class="Symbol">}</a> <a id="34939" class="Symbol">{</a><a id="34940" href="NbE.html#34940" class="Bound">t</a> <a id="34942" class="Symbol">:</a> <a id="34944" href="NbE.html#34919" class="Bound">Γ</a> <a id="34946" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="34948" href="NbE.html#34929" class="Bound">T</a><a id="34949" class="Symbol">}</a>
              <a id="34965" class="Symbol">→</a> <a id="34967" href="NbE.html#34940" class="Bound">t</a> <a id="34969" href="NbE.html#10528" class="Function Operator">[</a> <a id="34971" href="NbE.html#11739" class="Function">subst-id</a> <a id="34980" href="NbE.html#10528" class="Function Operator">]</a> <a id="34982" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="34984" href="NbE.html#34940" class="Bound">t</a>
<a id="34986" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35000" class="Symbol">{</a><a id="35001" class="Argument">t</a> <a id="35003" class="Symbol">=</a> <a id="35005" href="NbE.html#4377" class="InductiveConstructor">zero</a><a id="35009" class="Symbol">}</a> <a id="35011" class="Symbol">=</a> <a id="35013" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="35018" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35032" class="Symbol">{</a><a id="35033" class="Argument">t</a> <a id="35035" class="Symbol">=</a> <a id="35037" href="NbE.html#4395" class="InductiveConstructor">suc</a><a id="35040" class="Symbol">}</a> <a id="35042" class="Symbol">=</a> <a id="35044" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="35049" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35063" class="Symbol">{</a><a id="35064" class="Argument">t</a> <a id="35066" class="Symbol">=</a> <a id="35068" href="NbE.html#4418" class="InductiveConstructor">rec</a><a id="35071" class="Symbol">}</a> <a id="35073" class="Symbol">=</a> <a id="35075" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="35080" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35094" class="Symbol">{</a><a id="35095" class="Argument">t</a> <a id="35097" class="Symbol">=</a> <a id="35099" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="35101" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="35103" class="Symbol">}</a> <a id="35105" class="Symbol">=</a> <a id="35107" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="35112" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35126" class="Symbol">{</a><a id="35127" class="Argument">t</a> <a id="35129" class="Symbol">=</a> <a id="35131" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="35133" class="Symbol">(</a><a id="35134" href="NbE.html#3772" class="InductiveConstructor Operator">`S_</a> <a id="35138" class="Symbol">{_}</a> <a id="35142" class="Symbol">{</a><a id="35143" href="NbE.html#35143" class="Bound">S</a><a id="35144" class="Symbol">}</a> <a id="35146" href="NbE.html#35146" class="Bound">x</a><a id="35147" class="Symbol">)}</a>
  <a id="35152" class="Keyword">rewrite</a> <a id="35160" href="NbE.html#33199" class="Function">shift-var</a> <a id="35170" class="Symbol">{</a><a id="35171" class="Argument">S</a> <a id="35173" class="Symbol">=</a> <a id="35175" href="NbE.html#35143" class="Bound">S</a><a id="35176" class="Symbol">}</a> <a id="35178" class="Symbol">{</a><a id="35179" class="Argument">x</a> <a id="35181" class="Symbol">=</a> <a id="35183" href="NbE.html#35146" class="Bound">x</a><a id="35184" class="Symbol">}</a> <a id="35186" class="Symbol">{</a><a id="35187" class="Argument">σᵣ</a> <a id="35190" class="Symbol">=</a> <a id="35192" href="NbE.html#9240" class="Function">ren-id</a><a id="35198" class="Symbol">}</a> <a id="35200" class="Symbol">|</a> <a id="35202" href="NbE.html#33750" class="Function">rename-id</a> <a id="35212" class="Symbol">{</a><a id="35213" class="Argument">x</a> <a id="35215" class="Symbol">=</a> <a id="35217" href="NbE.html#35146" class="Bound">x</a><a id="35218" class="Symbol">}</a> <a id="35220" class="Symbol">=</a> <a id="35222" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="35227" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35241" class="Symbol">{</a><a id="35242" href="NbE.html#35242" class="Bound">Γ</a><a id="35243" class="Symbol">}</a> <a id="35245" class="Symbol">{</a><a id="35246" href="NbE.html#35246" class="Bound">T</a><a id="35247" class="Symbol">}</a> <a id="35249" class="Symbol">{</a><a id="35250" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ_</a> <a id="35253" class="Symbol">{</a><a id="35254" href="NbE.html#35254" class="Bound">S</a><a id="35255" class="Symbol">}</a> <a id="35257" href="NbE.html#35257" class="Bound">t</a><a id="35258" class="Symbol">}</a>
  <a id="35262" class="Keyword">rewrite</a> <a id="35270" href="NbE.html#750" class="Function">≡-sym</a> <a id="35276" class="Symbol">(</a><a id="35277" href="NbE.html#34636" class="Function">id≡↑id,x</a> <a id="35286" class="Symbol">{</a><a id="35287" href="NbE.html#35242" class="Bound">Γ</a><a id="35288" class="Symbol">}</a> <a id="35290" class="Symbol">{</a><a id="35291" href="NbE.html#35254" class="Bound">S</a><a id="35292" class="Symbol">})</a> <a id="35295" class="Symbol">|</a> <a id="35297" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35311" class="Symbol">{</a><a id="35312" class="Argument">t</a> <a id="35314" class="Symbol">=</a> <a id="35316" href="NbE.html#35257" class="Bound">t</a><a id="35317" class="Symbol">}</a> <a id="35319" class="Symbol">=</a> <a id="35321" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="35326" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35340" class="Symbol">{</a><a id="35341" class="Argument">t</a> <a id="35343" class="Symbol">=</a> <a id="35345" href="NbE.html#35345" class="Bound">r</a> <a id="35347" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="35349" href="NbE.html#35349" class="Bound">s</a><a id="35350" class="Symbol">}</a>
  <a id="35354" class="Keyword">rewrite</a> <a id="35362" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35376" class="Symbol">{</a><a id="35377" class="Argument">t</a> <a id="35379" class="Symbol">=</a> <a id="35381" href="NbE.html#35345" class="Bound">r</a><a id="35382" class="Symbol">}</a> <a id="35384" class="Symbol">|</a> <a id="35386" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35400" class="Symbol">{</a><a id="35401" class="Argument">t</a> <a id="35403" class="Symbol">=</a> <a id="35405" href="NbE.html#35349" class="Bound">s</a><a id="35406" class="Symbol">}</a> <a id="35408" class="Symbol">=</a> <a id="35410" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="id-compose-identity"></a><a id="35416" href="NbE.html#35416" class="Function">id-compose-identity</a> <a id="35436" class="Symbol">:</a> <a id="35438" class="Symbol">∀</a> <a id="35440" class="Symbol">{</a><a id="35441" href="NbE.html#35441" class="Bound">Γ</a> <a id="35443" href="NbE.html#35443" class="Bound">Δ</a> <a id="35445" class="Symbol">:</a> <a id="35447" href="NbE.html#1943" class="Datatype">Ctx</a><a id="35450" class="Symbol">}</a> <a id="35452" class="Symbol">{</a><a id="35453" href="NbE.html#35453" class="Bound">σ</a> <a id="35455" class="Symbol">:</a> <a id="35457" href="NbE.html#6688" class="Datatype">Sub</a> <a id="35461" href="NbE.html#35441" class="Bound">Γ</a> <a id="35463" href="NbE.html#35443" class="Bound">Δ</a><a id="35464" class="Symbol">}</a>
                    <a id="35486" class="Symbol">→</a> <a id="35488" href="NbE.html#35453" class="Bound">σ</a> <a id="35490" href="NbE.html#10937" class="Function Operator">∘</a> <a id="35492" href="NbE.html#11739" class="Function">subst-id</a> <a id="35501" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="35503" href="NbE.html#35453" class="Bound">σ</a>
<a id="35505" href="NbE.html#35416" class="Function">id-compose-identity</a> <a id="35525" class="Symbol">{</a><a id="35526" class="Argument">σ</a> <a id="35528" class="Symbol">=</a> <a id="35530" href="NbE.html#6718" class="InductiveConstructor">∅</a><a id="35531" class="Symbol">}</a> <a id="35533" class="Symbol">=</a> <a id="35535" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="35540" href="NbE.html#35416" class="Function">id-compose-identity</a> <a id="35560" class="Symbol">{</a><a id="35561" class="Argument">σ</a> <a id="35563" class="Symbol">=</a> <a id="35565" href="NbE.html#35565" class="Bound">σ</a> <a id="35567" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="35569" href="NbE.html#35569" class="Bound">s</a><a id="35570" class="Symbol">}</a>
  <a id="35574" class="Keyword">rewrite</a> <a id="35582" href="NbE.html#35416" class="Function">id-compose-identity</a> <a id="35602" class="Symbol">{</a><a id="35603" class="Argument">σ</a> <a id="35605" class="Symbol">=</a> <a id="35607" href="NbE.html#35565" class="Bound">σ</a><a id="35608" class="Symbol">}</a> <a id="35610" class="Symbol">|</a> <a id="35612" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="35626" class="Symbol">{</a><a id="35627" class="Argument">t</a> <a id="35629" class="Symbol">=</a> <a id="35631" href="NbE.html#35569" class="Bound">s</a><a id="35632" class="Symbol">}</a> <a id="35634" class="Symbol">=</a> <a id="35636" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="35642" class="Keyword">postulate</a>
  <a id="subst-compose"></a><a id="35654" href="NbE.html#35654" class="Postulate">subst-compose</a> <a id="35668" class="Symbol">:</a> <a id="35670" class="Symbol">∀</a> <a id="35672" class="Symbol">{</a><a id="35673" href="NbE.html#35673" class="Bound">Γ₁</a> <a id="35676" href="NbE.html#35676" class="Bound">Γ₂</a> <a id="35679" href="NbE.html#35679" class="Bound">Γ₃</a> <a id="35682" class="Symbol">:</a> <a id="35684" href="NbE.html#1943" class="Datatype">Ctx</a><a id="35687" class="Symbol">}</a> <a id="35689" class="Symbol">{</a><a id="35690" href="NbE.html#35690" class="Bound">T</a> <a id="35692" class="Symbol">:</a> <a id="35694" href="NbE.html#1051" class="Datatype">Type</a><a id="35698" class="Symbol">}</a> <a id="35700" class="Symbol">{</a><a id="35701" href="NbE.html#35701" class="Bound">τ</a> <a id="35703" class="Symbol">:</a> <a id="35705" href="NbE.html#6688" class="Datatype">Sub</a> <a id="35709" href="NbE.html#35673" class="Bound">Γ₁</a> <a id="35712" href="NbE.html#35676" class="Bound">Γ₂</a><a id="35714" class="Symbol">}</a> <a id="35716" class="Symbol">{</a><a id="35717" href="NbE.html#35717" class="Bound">σ</a> <a id="35719" class="Symbol">:</a> <a id="35721" href="NbE.html#6688" class="Datatype">Sub</a> <a id="35725" href="NbE.html#35676" class="Bound">Γ₂</a> <a id="35728" href="NbE.html#35679" class="Bound">Γ₃</a><a id="35730" class="Symbol">}</a>
                    <a id="35752" class="Symbol">{</a><a id="35753" href="NbE.html#35753" class="Bound">t</a> <a id="35755" class="Symbol">:</a> <a id="35757" href="NbE.html#35679" class="Bound">Γ₃</a> <a id="35760" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="35762" href="NbE.html#35690" class="Bound">T</a><a id="35763" class="Symbol">}</a>
                <a id="35781" class="Symbol">→</a> <a id="35783" href="NbE.html#35753" class="Bound">t</a> <a id="35785" href="NbE.html#10528" class="Function Operator">[</a> <a id="35787" href="NbE.html#35717" class="Bound">σ</a> <a id="35789" href="NbE.html#10528" class="Function Operator">]</a> <a id="35791" href="NbE.html#10528" class="Function Operator">[</a> <a id="35793" href="NbE.html#35701" class="Bound">τ</a> <a id="35795" href="NbE.html#10528" class="Function Operator">]</a> <a id="35797" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="35799" href="NbE.html#35753" class="Bound">t</a> <a id="35801" href="NbE.html#10528" class="Function Operator">[</a> <a id="35803" href="NbE.html#35717" class="Bound">σ</a> <a id="35805" href="NbE.html#10937" class="Function Operator">∘</a> <a id="35807" href="NbE.html#35701" class="Bound">τ</a> <a id="35809" href="NbE.html#10528" class="Function Operator">]</a>

  <a id="subst-compose-↑"></a><a id="35814" href="NbE.html#35814" class="Postulate">subst-compose-↑</a> <a id="35830" class="Symbol">:</a> <a id="35832" class="Symbol">∀</a> <a id="35834" class="Symbol">{</a><a id="35835" href="NbE.html#35835" class="Bound">Γ₁</a> <a id="35838" href="NbE.html#35838" class="Bound">Γ₂</a> <a id="35841" href="NbE.html#35841" class="Bound">Γ₃</a> <a id="35844" class="Symbol">:</a> <a id="35846" href="NbE.html#1943" class="Datatype">Ctx</a><a id="35849" class="Symbol">}</a> <a id="35851" class="Symbol">{</a><a id="35852" href="NbE.html#35852" class="Bound">S</a> <a id="35854" class="Symbol">:</a> <a id="35856" href="NbE.html#1051" class="Datatype">Type</a><a id="35860" class="Symbol">}</a> <a id="35862" class="Symbol">{</a><a id="35863" href="NbE.html#35863" class="Bound">τ</a> <a id="35865" class="Symbol">:</a> <a id="35867" href="NbE.html#6688" class="Datatype">Sub</a> <a id="35871" href="NbE.html#35835" class="Bound">Γ₁</a> <a id="35874" href="NbE.html#35838" class="Bound">Γ₂</a><a id="35876" class="Symbol">}</a>
                      <a id="35900" class="Symbol">{</a><a id="35901" href="NbE.html#35901" class="Bound">σ</a> <a id="35903" class="Symbol">:</a> <a id="35905" href="NbE.html#6688" class="Datatype">Sub</a> <a id="35909" href="NbE.html#35838" class="Bound">Γ₂</a> <a id="35912" href="NbE.html#35841" class="Bound">Γ₃</a><a id="35914" class="Symbol">}</a> <a id="35916" class="Symbol">{</a><a id="35917" href="NbE.html#35917" class="Bound">s</a> <a id="35919" class="Symbol">:</a> <a id="35921" href="NbE.html#35835" class="Bound">Γ₁</a> <a id="35924" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="35926" href="NbE.html#35852" class="Bound">S</a><a id="35927" class="Symbol">}</a>
                  <a id="35947" class="Symbol">→</a> <a id="35949" class="Symbol">(</a><a id="35950" href="NbE.html#35901" class="Bound">σ</a> <a id="35952" href="NbE.html#10252" class="Function Operator">↑</a><a id="35953" class="Symbol">)</a> <a id="35955" href="NbE.html#10937" class="Function Operator">∘</a> <a id="35957" class="Symbol">(</a><a id="35958" href="NbE.html#35863" class="Bound">τ</a> <a id="35960" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="35962" href="NbE.html#35917" class="Bound">s</a><a id="35963" class="Symbol">)</a> <a id="35965" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="35967" href="NbE.html#35901" class="Bound">σ</a> <a id="35969" href="NbE.html#10937" class="Function Operator">∘</a> <a id="35971" href="NbE.html#35863" class="Bound">τ</a>

  <a id="35976" class="Comment">-- Weakening substitutions can be composed</a>
  <a id="weaken-compose"></a><a id="36021" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="36036" class="Symbol">:</a> <a id="36038" class="Symbol">∀</a> <a id="36040" class="Symbol">{</a><a id="36041" href="NbE.html#36041" class="Bound">Γ₃</a> <a id="36044" href="NbE.html#36044" class="Bound">Γ₂</a> <a id="36047" href="NbE.html#36047" class="Bound">Γ₁</a> <a id="36050" class="Symbol">:</a> <a id="36052" href="NbE.html#1943" class="Datatype">Ctx</a><a id="36055" class="Symbol">}</a> <a id="36057" class="Symbol">{</a><a id="36058" href="NbE.html#36058" class="Bound">T</a> <a id="36060" class="Symbol">:</a> <a id="36062" href="NbE.html#1051" class="Datatype">Type</a><a id="36066" class="Symbol">}</a>
    <a id="36072" class="Symbol">→</a> <a id="36074" class="Symbol">(</a><a id="36075" href="NbE.html#36075" class="Bound">Γ₃≤Γ₂</a> <a id="36081" class="Symbol">:</a> <a id="36083" href="NbE.html#36041" class="Bound">Γ₃</a> <a id="36086" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="36088" href="NbE.html#36044" class="Bound">Γ₂</a><a id="36090" class="Symbol">)</a>
    <a id="36096" class="Symbol">→</a> <a id="36098" class="Symbol">(</a><a id="36099" href="NbE.html#36099" class="Bound">Γ₂≤Γ₁</a> <a id="36105" class="Symbol">:</a> <a id="36107" href="NbE.html#36044" class="Bound">Γ₂</a> <a id="36110" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="36112" href="NbE.html#36047" class="Bound">Γ₁</a><a id="36114" class="Symbol">)</a>
    <a id="36120" class="Symbol">→</a> <a id="36122" class="Symbol">(</a><a id="36123" href="NbE.html#36123" class="Bound">t</a> <a id="36125" class="Symbol">:</a> <a id="36127" href="NbE.html#36047" class="Bound">Γ₁</a> <a id="36130" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="36132" href="NbE.html#36058" class="Bound">T</a><a id="36133" class="Symbol">)</a>
    <a id="36139" class="Symbol">→</a> <a id="36141" href="NbE.html#36075" class="Bound">Γ₃≤Γ₂</a> <a id="36147" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="36150" href="NbE.html#36099" class="Bound">Γ₂≤Γ₁</a> <a id="36156" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="36159" href="NbE.html#36123" class="Bound">t</a> <a id="36161" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="36163" class="Symbol">(</a><a id="36164" href="NbE.html#32369" class="Function">≤-trans</a> <a id="36172" href="NbE.html#36075" class="Bound">Γ₃≤Γ₂</a> <a id="36178" href="NbE.html#36099" class="Bound">Γ₂≤Γ₁</a><a id="36183" class="Symbol">)</a> <a id="36185" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="36188" href="NbE.html#36123" class="Bound">t</a>

  <a id="36193" class="Comment">-- TODO: not sure if this lemma will be necessary</a>
  <a id="==-rename"></a><a id="36245" href="NbE.html#36245" class="Postulate">==-rename</a> <a id="36255" class="Symbol">:</a> <a id="36257" class="Symbol">∀</a> <a id="36259" class="Symbol">{</a><a id="36260" href="NbE.html#36260" class="Bound">Γ</a> <a id="36262" href="NbE.html#36262" class="Bound">Δ</a> <a id="36264" class="Symbol">:</a> <a id="36266" href="NbE.html#1943" class="Datatype">Ctx</a><a id="36269" class="Symbol">}</a> <a id="36271" class="Symbol">{</a><a id="36272" href="NbE.html#36272" class="Bound">T</a> <a id="36274" class="Symbol">:</a> <a id="36276" href="NbE.html#1051" class="Datatype">Type</a><a id="36280" class="Symbol">}</a> <a id="36282" class="Symbol">{</a><a id="36283" href="NbE.html#36283" class="Bound">t</a> <a id="36285" href="NbE.html#36285" class="Bound">t′</a> <a id="36288" class="Symbol">:</a> <a id="36290" href="NbE.html#36260" class="Bound">Γ</a> <a id="36292" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="36294" href="NbE.html#36272" class="Bound">T</a><a id="36295" class="Symbol">}</a> <a id="36297" class="Symbol">{</a><a id="36298" href="NbE.html#36298" class="Bound">σᵣ</a> <a id="36301" class="Symbol">:</a> <a id="36303" href="NbE.html#7265" class="Datatype">Ren</a> <a id="36307" href="NbE.html#36262" class="Bound">Δ</a> <a id="36309" href="NbE.html#36260" class="Bound">Γ</a><a id="36310" class="Symbol">}</a>
            <a id="36324" class="Symbol">→</a> <a id="36326" href="NbE.html#36283" class="Bound">t</a> <a id="36328" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="36331" href="NbE.html#36285" class="Bound">t′</a>
            <a id="36346" class="Symbol">→</a> <a id="36348" href="NbE.html#36283" class="Bound">t</a> <a id="36350" href="NbE.html#8616" class="Function Operator">[</a> <a id="36352" href="NbE.html#36298" class="Bound">σᵣ</a> <a id="36355" href="NbE.html#8616" class="Function Operator">]ᵣ</a> <a id="36358" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="36361" href="NbE.html#36285" class="Bound">t′</a> <a id="36364" href="NbE.html#8616" class="Function Operator">[</a> <a id="36366" href="NbE.html#36298" class="Bound">σᵣ</a> <a id="36369" href="NbE.html#8616" class="Function Operator">]ᵣ</a>

  <a id="==-subst"></a><a id="36375" href="NbE.html#36375" class="Postulate">==-subst</a> <a id="36384" class="Symbol">:</a> <a id="36386" class="Symbol">∀</a> <a id="36388" class="Symbol">{</a><a id="36389" href="NbE.html#36389" class="Bound">Γ</a> <a id="36391" href="NbE.html#36391" class="Bound">Δ</a> <a id="36393" class="Symbol">:</a> <a id="36395" href="NbE.html#1943" class="Datatype">Ctx</a><a id="36398" class="Symbol">}</a> <a id="36400" class="Symbol">{</a><a id="36401" href="NbE.html#36401" class="Bound">T</a> <a id="36403" class="Symbol">:</a> <a id="36405" href="NbE.html#1051" class="Datatype">Type</a><a id="36409" class="Symbol">}</a> <a id="36411" class="Symbol">{</a><a id="36412" href="NbE.html#36412" class="Bound">t</a> <a id="36414" href="NbE.html#36414" class="Bound">t′</a> <a id="36417" class="Symbol">:</a> <a id="36419" href="NbE.html#36389" class="Bound">Γ</a> <a id="36421" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="36423" href="NbE.html#36401" class="Bound">T</a><a id="36424" class="Symbol">}</a> <a id="36426" class="Symbol">{</a><a id="36427" href="NbE.html#36427" class="Bound">σ</a> <a id="36429" class="Symbol">:</a> <a id="36431" href="NbE.html#6688" class="Datatype">Sub</a> <a id="36435" href="NbE.html#36391" class="Bound">Δ</a> <a id="36437" href="NbE.html#36389" class="Bound">Γ</a><a id="36438" class="Symbol">}</a>
           <a id="36451" class="Symbol">→</a> <a id="36453" href="NbE.html#36412" class="Bound">t</a> <a id="36455" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="36458" href="NbE.html#36414" class="Bound">t′</a>
           <a id="36472" class="Symbol">→</a> <a id="36474" href="NbE.html#36412" class="Bound">t</a> <a id="36476" href="NbE.html#10528" class="Function Operator">[</a> <a id="36478" href="NbE.html#36427" class="Bound">σ</a> <a id="36480" href="NbE.html#10528" class="Function Operator">]</a> <a id="36482" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="36485" href="NbE.html#36414" class="Bound">t′</a> <a id="36488" href="NbE.html#10528" class="Function Operator">[</a> <a id="36490" href="NbE.html#36427" class="Bound">σ</a> <a id="36492" href="NbE.html#10528" class="Function Operator">]</a>

<a id="36495" class="Comment">-- Applying an increment renaming substitution to a term that already</a>
<a id="36565" class="Comment">-- has a weakening substitution applied to it is equivalent to shifting</a>
<a id="36637" class="Comment">-- the weakening substitution</a>
<a id="incr-↑-≡"></a><a id="36667" href="NbE.html#36667" class="Function">incr-↑-≡</a> <a id="36676" class="Symbol">:</a> <a id="36678" class="Symbol">∀</a> <a id="36680" class="Symbol">{</a><a id="36681" href="NbE.html#36681" class="Bound">Γ</a> <a id="36683" href="NbE.html#36683" class="Bound">Γ′</a> <a id="36686" class="Symbol">:</a> <a id="36688" href="NbE.html#1943" class="Datatype">Ctx</a><a id="36691" class="Symbol">}</a> <a id="36693" class="Symbol">{</a><a id="36694" href="NbE.html#36694" class="Bound">Γ′≤Γ</a> <a id="36699" class="Symbol">:</a> <a id="36701" href="NbE.html#36683" class="Bound">Γ′</a> <a id="36704" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="36706" href="NbE.html#36681" class="Bound">Γ</a><a id="36707" class="Symbol">}</a> <a id="36709" class="Symbol">{</a><a id="36710" href="NbE.html#36710" class="Bound">S</a> <a id="36712" href="NbE.html#36712" class="Bound">T</a> <a id="36714" class="Symbol">:</a> <a id="36716" href="NbE.html#1051" class="Datatype">Type</a><a id="36720" class="Symbol">}</a> <a id="36722" class="Symbol">{</a><a id="36723" href="NbE.html#36723" class="Bound">t</a> <a id="36725" class="Symbol">:</a> <a id="36727" href="NbE.html#36681" class="Bound">Γ</a> <a id="36729" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="36731" href="NbE.html#36712" class="Bound">T</a><a id="36732" class="Symbol">}</a>
         <a id="36743" class="Symbol">→</a> <a id="36745" href="NbE.html#36710" class="Bound">S</a> <a id="36747" href="NbE.html#12039" class="Function Operator">↑⊢</a> <a id="36750" class="Symbol">(</a><a id="36751" href="NbE.html#36723" class="Bound">t</a> <a id="36753" href="NbE.html#10528" class="Function Operator">[</a> <a id="36755" href="NbE.html#11260" class="Function">weaken</a> <a id="36762" href="NbE.html#36694" class="Bound">Γ′≤Γ</a> <a id="36767" href="NbE.html#10528" class="Function Operator">]</a><a id="36768" class="Symbol">)</a> <a id="36770" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="36772" href="NbE.html#36723" class="Bound">t</a> <a id="36774" href="NbE.html#10528" class="Function Operator">[</a> <a id="36776" href="NbE.html#9824" class="Function">subst-ren</a> <a id="36786" class="Symbol">(</a><a id="36787" href="NbE.html#9583" class="Function">ren-≤</a> <a id="36793" href="NbE.html#36694" class="Bound">Γ′≤Γ</a> <a id="36798" href="NbE.html#8198" class="Function Operator">↑ᵣ</a><a id="36800" class="Symbol">)</a> <a id="36802" href="NbE.html#10528" class="Function Operator">]</a>
<a id="36804" href="NbE.html#36667" class="Function">incr-↑-≡</a> <a id="36813" class="Symbol">{</a><a id="36814" class="Argument">Γ′≤Γ</a> <a id="36819" class="Symbol">=</a> <a id="36821" href="NbE.html#2913" class="InductiveConstructor">≤-id</a><a id="36825" class="Symbol">}</a> <a id="36827" class="Symbol">{</a><a id="36828" class="Argument">t</a> <a id="36830" class="Symbol">=</a> <a id="36832" href="NbE.html#36832" class="Bound">t</a><a id="36833" class="Symbol">}</a> <a id="36835" class="Keyword">rewrite</a> <a id="36843" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="36857" class="Symbol">{</a><a id="36858" class="Argument">t</a> <a id="36860" class="Symbol">=</a> <a id="36862" href="NbE.html#36832" class="Bound">t</a><a id="36863" class="Symbol">}</a> <a id="36865" class="Symbol">=</a> <a id="36867" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
<a id="36872" href="NbE.html#36667" class="Function">incr-↑-≡</a> <a id="36881" class="Symbol">{</a><a id="36882" class="Argument">Γ′≤Γ</a> <a id="36887" class="Symbol">=</a> <a id="36889" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="36895" class="Symbol">{</a><a id="36896" class="Argument">T</a> <a id="36898" class="Symbol">=</a> <a id="36900" href="NbE.html#36900" class="Bound">S₁</a><a id="36902" class="Symbol">}</a> <a id="36904" href="NbE.html#36904" class="Bound">Γ′≤Γ</a><a id="36908" class="Symbol">}</a> <a id="36910" class="Symbol">{</a><a id="36911" href="NbE.html#36911" class="Bound">S₂</a><a id="36913" class="Symbol">}</a> <a id="36915" class="Symbol">{</a><a id="36916" class="Argument">t</a> <a id="36918" class="Symbol">=</a> <a id="36920" href="NbE.html#36920" class="Bound">t</a><a id="36921" class="Symbol">}</a>
  <a id="36925" class="Keyword">rewrite</a> <a id="36933" href="NbE.html#750" class="Function">≡-sym</a> <a id="36939" class="Symbol">(</a><a id="36940" href="NbE.html#36667" class="Function">incr-↑-≡</a> <a id="36949" class="Symbol">{</a><a id="36950" class="Argument">Γ′≤Γ</a> <a id="36955" class="Symbol">=</a> <a id="36957" href="NbE.html#36904" class="Bound">Γ′≤Γ</a><a id="36961" class="Symbol">}</a> <a id="36963" class="Symbol">{</a><a id="36964" href="NbE.html#36900" class="Bound">S₁</a><a id="36966" class="Symbol">}</a> <a id="36968" class="Symbol">{</a><a id="36969" class="Argument">t</a> <a id="36971" class="Symbol">=</a> <a id="36973" href="NbE.html#36920" class="Bound">t</a><a id="36974" class="Symbol">})</a>
        <a id="36985" class="Symbol">|</a> <a id="36987" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="37002" class="Symbol">(</a><a id="37003" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="37009" class="Symbol">{</a><a id="37010" class="Argument">T</a> <a id="37012" class="Symbol">=</a> <a id="37014" href="NbE.html#36900" class="Bound">S₁</a><a id="37016" class="Symbol">}</a> <a id="37018" href="NbE.html#2913" class="InductiveConstructor">≤-id</a><a id="37022" class="Symbol">)</a> <a id="37024" href="NbE.html#36904" class="Bound">Γ′≤Γ</a> <a id="37029" href="NbE.html#36920" class="Bound">t</a>
        <a id="37039" class="Symbol">|</a> <a id="37041" href="NbE.html#36021" class="Postulate">weaken-compose</a>
            <a id="37068" class="Symbol">(</a><a id="37069" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="37075" class="Symbol">{</a><a id="37076" class="Argument">T</a> <a id="37078" class="Symbol">=</a> <a id="37080" href="NbE.html#36911" class="Bound">S₂</a><a id="37082" class="Symbol">}</a> <a id="37084" href="NbE.html#2913" class="InductiveConstructor">≤-id</a><a id="37088" class="Symbol">)</a>
            <a id="37102" class="Symbol">(</a><a id="37103" href="NbE.html#32369" class="Function">≤-trans</a> <a id="37111" class="Symbol">(</a><a id="37112" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="37118" class="Symbol">{</a><a id="37119" class="Argument">T</a> <a id="37121" class="Symbol">=</a> <a id="37123" href="NbE.html#36900" class="Bound">S₁</a><a id="37125" class="Symbol">}</a> <a id="37127" href="NbE.html#2913" class="InductiveConstructor">≤-id</a><a id="37131" class="Symbol">)</a> <a id="37133" href="NbE.html#36904" class="Bound">Γ′≤Γ</a><a id="37137" class="Symbol">)</a>
            <a id="37151" href="NbE.html#36920" class="Bound">t</a>
        <a id="37161" class="Symbol">|</a> <a id="37163" href="NbE.html#32011" class="Function">≤-pf-irrelevance</a>
            <a id="37192" class="Symbol">(</a><a id="37193" href="NbE.html#32369" class="Function">≤-trans</a> <a id="37201" class="Symbol">(</a><a id="37202" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="37208" href="NbE.html#2913" class="InductiveConstructor">≤-id</a><a id="37212" class="Symbol">)</a> <a id="37214" class="Symbol">(</a><a id="37215" href="NbE.html#32369" class="Function">≤-trans</a> <a id="37223" class="Symbol">(</a><a id="37224" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="37230" href="NbE.html#2913" class="InductiveConstructor">≤-id</a><a id="37234" class="Symbol">)</a> <a id="37236" href="NbE.html#36904" class="Bound">Γ′≤Γ</a><a id="37240" class="Symbol">))</a>
            <a id="37255" class="Symbol">(</a><a id="37256" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="37262" class="Symbol">{</a><a id="37263" class="Argument">T</a> <a id="37265" class="Symbol">=</a> <a id="37267" href="NbE.html#36911" class="Bound">S₂</a><a id="37269" class="Symbol">}</a> <a id="37271" class="Symbol">(</a><a id="37272" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="37278" class="Symbol">{</a><a id="37279" class="Argument">T</a> <a id="37281" class="Symbol">=</a> <a id="37283" href="NbE.html#36900" class="Bound">S₁</a><a id="37285" class="Symbol">}</a> <a id="37287" href="NbE.html#36904" class="Bound">Γ′≤Γ</a><a id="37291" class="Symbol">))</a>             <a id="37306" class="Symbol">=</a> <a id="37308" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre>
-->


# Soundness

We prove the soundness property of preservation of meaning of NbE
(i.e. `⟦ nf(t) ⟧ = ⟦ t ⟧`), which we just call soundness here for brevity,
by proving the definitional equality of a term and its normal form:

    Γ ⊢ t = nf(t) : T

which expands to:

    Γ ⊢ t = ↓ᵀ a Γ, where a = ⟦ t ⟧ ↑Γ

For this, a logical relation `t Ⓡ a` is defined such that
it implies `Γ ⊢ t = ↓ᵀ a Γ : T`.

For defining the relation in Agda, we will need some functions first. The first
"lifts" definitional equality over liftable neutrals. Formally, this represents the condition `Γ ⊢ 𝓊 = 𝓊̂(Γ) : T`, or equivalently in Agda:
<pre class="Agda"><a id="_==↑_"></a><a id="37949" href="NbE.html#37949" class="Function Operator">_==↑_</a> <a id="37955" class="Symbol">:</a> <a id="37957" class="Symbol">{</a><a id="37958" href="NbE.html#37958" class="Bound">Γ</a> <a id="37960" class="Symbol">:</a> <a id="37962" href="NbE.html#1943" class="Datatype">Ctx</a><a id="37965" class="Symbol">}</a> <a id="37967" class="Symbol">{</a><a id="37968" href="NbE.html#37968" class="Bound">T</a> <a id="37970" class="Symbol">:</a> <a id="37972" href="NbE.html#1051" class="Datatype">Type</a><a id="37976" class="Symbol">}</a> <a id="37978" class="Symbol">→</a> <a id="37980" href="NbE.html#37958" class="Bound">Γ</a> <a id="37982" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="37984" href="NbE.html#37968" class="Bound">T</a> <a id="37986" class="Symbol">→</a> <a id="37988" href="NbE.html#22920" class="Function">Ne↑</a> <a id="37992" href="NbE.html#37968" class="Bound">T</a> <a id="37994" class="Symbol">→</a> <a id="37996" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="38000" href="NbE.html#37949" class="Function Operator">_==↑_</a> <a id="38006" class="Symbol">{</a><a id="38007" href="NbE.html#38007" class="Bound">Γ</a><a id="38008" class="Symbol">}</a> <a id="38010" href="NbE.html#38010" class="Bound">t</a> <a id="38012" href="NbE.html#38012" class="Bound">𝓊̂</a> <a id="38015" class="Keyword">with</a> <a id="38020" href="NbE.html#38012" class="Bound">𝓊̂</a> <a id="38023" href="NbE.html#38007" class="Bound">Γ</a>
<a id="38025" class="Symbol">...</a> <a id="38029" class="Symbol">|</a> <a id="38031" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="38036" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="38038" href="NbE.html#38038" class="Bound">𝓊</a> <a id="38040" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="38042" class="Symbol">_</a> <a id="38044" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="38046" class="Symbol">=</a>
      <a id="38054" class="Comment">-- If the liftable neutral can be lifted to the</a>
      <a id="38108" class="Comment">-- context Γ, this is just definitional equality</a>
      <a id="38163" class="Bound">t</a> <a id="38165" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="38168" href="NbE.html#38038" class="Bound">𝓊</a>
<a id="38170" class="Symbol">...</a> <a id="38174" class="Symbol">|</a> <a id="38176" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="38181" class="Symbol">_</a> <a id="38183" class="Symbol">=</a>
      <a id="38191" class="Comment">-- Otherwise, the proposition cannot be proven,</a>
      <a id="38245" class="Comment">-- as there is no lifted term in the context</a>
      <a id="38296" class="Comment">-- to compare a term to</a>
      <a id="38326" href="Data.Empty.html#526" class="Datatype">⊥</a>

<a id="38329" class="Keyword">infix</a> <a id="38335" class="Number">3</a> <a id="38337" href="NbE.html#37949" class="Function Operator">_==↑_</a>
</pre>
We also provide shorthand for reifying the interpretation of a term t
and then immediately applying a context Γ (we use lowercase γ as our
subscript as Γ is not a valid subscript)
<pre class="Agda"><a id="↓ᵀᵧ"></a><a id="38536" href="NbE.html#38536" class="Function">↓ᵀᵧ</a> <a id="38540" class="Symbol">:</a> <a id="38542" class="Symbol">∀</a> <a id="38544" class="Symbol">{</a><a id="38545" href="NbE.html#38545" class="Bound">Γ</a> <a id="38547" class="Symbol">:</a> <a id="38549" href="NbE.html#1943" class="Datatype">Ctx</a><a id="38552" class="Symbol">}</a> <a id="38554" class="Symbol">{</a><a id="38555" href="NbE.html#38555" class="Bound">T</a> <a id="38557" class="Symbol">:</a> <a id="38559" href="NbE.html#1051" class="Datatype">Type</a><a id="38563" class="Symbol">}</a> <a id="38565" class="Symbol">→</a> <a id="38567" class="Symbol">(</a><a id="38568" href="NbE.html#38568" class="Bound">a</a> <a id="38570" class="Symbol">:</a> <a id="38572" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="38574" href="NbE.html#38555" class="Bound">T</a> <a id="38576" href="NbE.html#15983" class="Field Operator">⟧</a><a id="38577" class="Symbol">)</a> <a id="38579" class="Symbol">→</a> <a id="38581" href="NbE.html#38545" class="Bound">Γ</a> <a id="38583" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="38585" href="NbE.html#38555" class="Bound">T</a>
<a id="38587" href="NbE.html#38536" class="Function">↓ᵀᵧ</a> <a id="38591" class="Symbol">{</a><a id="38592" href="NbE.html#38592" class="Bound">Γ</a><a id="38593" class="Symbol">}</a> <a id="38595" href="NbE.html#38595" class="Bound">a</a> <a id="38597" class="Keyword">with</a> <a id="38602" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="38605" href="NbE.html#38595" class="Bound">a</a>
<a id="38607" class="Symbol">...</a> <a id="38611" class="Symbol">|</a> <a id="38613" href="NbE.html#38613" class="Bound">a↑</a> <a id="38616" class="Symbol">=</a> <a id="38618" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="38624" class="Symbol">(</a><a id="38625" href="NbE.html#38613" class="Bound">a↑</a> <a id="38628" class="Bound">Γ</a><a id="38629" class="Symbol">)</a>
</pre>
With these, we can begin to introduce the Kripe logical relation `Γ ⊢ t : T Ⓡ a`
between a typed term `Γ ⊢ t : T` and a value `a ∈ ⟦ T ⟧`. The logical relation
will be defined inductively on types. At type nat, the relation is defined as:

    Γ : nat Ⓡ 𝓋̂ ⇔ ∀ Γ′ ≤ Γ. Γ′ ⊢ t = 𝓋̂(Γ′) : nat

For Agda's termination checking, we have to define the logical relation at type
nat separately, which we do so in the form of Ⓝ:
<pre class="Agda"><a id="_Ⓝ_"></a><a id="39065" href="NbE.html#39065" class="Function Operator">_Ⓝ_</a> <a id="39069" class="Symbol">:</a> <a id="39071" class="Symbol">∀</a> <a id="39073" class="Symbol">{</a><a id="39074" href="NbE.html#39074" class="Bound">Γ</a> <a id="39076" class="Symbol">:</a> <a id="39078" href="NbE.html#1943" class="Datatype">Ctx</a><a id="39081" class="Symbol">}</a> <a id="39083" class="Symbol">→</a> <a id="39085" href="NbE.html#39074" class="Bound">Γ</a> <a id="39087" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="39089" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="39093" class="Symbol">→</a> <a id="39095" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="39097" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="39101" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="39103" class="Symbol">→</a> <a id="39105" href="Agda.Primitive.html#326" class="Primitive">Set</a>
</pre>
We define Ⓝ mutually with ==ℕ̂, a relation representing
the condition `Γ′ ⊢ t = 𝓋̂(Γ′) : nat`, which lifts definitional equality to
be over naturals with embedded liftable neutrals

<pre class="Agda"><a id="_==ℕ̂_"></a><a id="39304" href="NbE.html#39304" class="Function Operator">_==ℕ̂_</a> <a id="39311" class="Symbol">:</a> <a id="39313" class="Symbol">∀</a> <a id="39315" class="Symbol">{</a><a id="39316" href="NbE.html#39316" class="Bound">Γ</a> <a id="39318" class="Symbol">:</a> <a id="39320" href="NbE.html#1943" class="Datatype">Ctx</a><a id="39323" class="Symbol">}</a> <a id="39325" class="Symbol">→</a> <a id="39327" href="NbE.html#39316" class="Bound">Γ</a> <a id="39329" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="39331" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="39335" class="Symbol">→</a> <a id="39337" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="39339" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="39343" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="39345" class="Symbol">→</a> <a id="39347" href="Agda.Primitive.html#326" class="Primitive">Set</a>

<a id="39352" href="NbE.html#39065" class="Function Operator">_Ⓝ_</a> <a id="39356" class="Symbol">{</a><a id="39357" href="NbE.html#39357" class="Bound">Γ</a><a id="39358" class="Symbol">}</a> <a id="39360" href="NbE.html#39360" class="Bound">n</a> <a id="39362" href="NbE.html#39362" class="Bound">𝓋̂</a> <a id="39365" class="Symbol">=</a>
  <a id="39369" class="Symbol">∀</a> <a id="39371" class="Symbol">{</a><a id="39372" href="NbE.html#39372" class="Bound">Γ′</a> <a id="39375" class="Symbol">:</a> <a id="39377" href="NbE.html#1943" class="Datatype">Ctx</a><a id="39380" class="Symbol">}</a>
  <a id="39384" class="Symbol">→</a> <a id="39386" class="Symbol">(</a><a id="39387" href="NbE.html#39387" class="Bound">Γ′≤Γ</a> <a id="39392" class="Symbol">:</a> <a id="39394" href="NbE.html#39372" class="Bound">Γ′</a> <a id="39397" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="39399" href="NbE.html#39357" class="Bound">Γ</a><a id="39400" class="Symbol">)</a>
    <a id="39406" class="Comment">---------------</a>
  <a id="39424" class="Symbol">→</a> <a id="39426" href="NbE.html#39387" class="Bound">Γ′≤Γ</a> <a id="39431" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="39434" href="NbE.html#39360" class="Bound">n</a> <a id="39436" href="NbE.html#39304" class="Function Operator">==ℕ̂</a> <a id="39441" href="NbE.html#39362" class="Bound">𝓋̂</a>

<a id="39445" class="Keyword">infix</a> <a id="39451" class="Number">4</a> <a id="39453" href="NbE.html#39065" class="Function Operator">_Ⓝ_</a>
</pre>
For `zero`, the ==ℕ̂ relation is a simple definitional equality
judgement:
<pre class="Agda"><a id="39545" href="NbE.html#39304" class="Function Operator">_==ℕ̂_</a> <a id="39552" class="Symbol">{</a><a id="39553" href="NbE.html#39553" class="Bound">Γ</a><a id="39554" class="Symbol">}</a> <a id="39556" href="NbE.html#39556" class="Bound">t</a> <a id="39558" href="NbE.html#23818" class="InductiveConstructor">zero</a> <a id="39563" class="Symbol">=</a> <a id="39565" href="NbE.html#39556" class="Bound">t</a> <a id="39567" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="39570" href="NbE.html#4377" class="InductiveConstructor">zero</a>
</pre>However, for our recursive case (suc 𝓋̂), the definition is a bit
more involved. We want the term to be definitionally equal to `suc · n`
such that n is logically related to 𝓋̂, a condition stronger than ==ℕ̂,
as it holds for all extensions of the context -- this is why we need
to define ==ℕ̂ mutually with Ⓝ. We want our recursive condition to be
stronger to have an easier time with the embedded liftable neutrals
<pre class="Agda"><a id="40004" href="NbE.html#39304" class="Function Operator">_==ℕ̂_</a> <a id="40011" class="Symbol">{</a><a id="40012" href="NbE.html#40012" class="Bound">Γ</a><a id="40013" class="Symbol">}</a> <a id="40015" href="NbE.html#40015" class="Bound">t</a> <a id="40017" class="Symbol">(</a><a id="40018" href="NbE.html#23830" class="InductiveConstructor">suc</a> <a id="40022" href="NbE.html#40022" class="Bound">𝓋̂</a><a id="40024" class="Symbol">)</a> <a id="40026" class="Symbol">=</a> <a id="40028" href="Data.Product.html#1806" class="Function">∃[</a> <a id="40031" href="NbE.html#40031" class="Bound">n</a> <a id="40033" href="Data.Product.html#1806" class="Function">]</a> <a id="40035" href="NbE.html#40015" class="Bound">t</a> <a id="40037" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="40040" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="40044" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="40046" href="NbE.html#40031" class="Bound">n</a> <a id="40048" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="40050" href="NbE.html#40031" class="Bound">n</a> <a id="40052" href="NbE.html#39065" class="Function Operator">Ⓝ</a> <a id="40054" href="NbE.html#40022" class="Bound">𝓋̂</a>
</pre>For an embedded liftable neutral, the relation is the
lifted definitional equality defined earlier
<pre class="Agda"><a id="40168" href="NbE.html#39304" class="Function Operator">_==ℕ̂_</a> <a id="40175" class="Symbol">{</a><a id="40176" href="NbE.html#40176" class="Bound">Γ</a><a id="40177" class="Symbol">}</a> <a id="40179" href="NbE.html#40179" class="Bound">t</a> <a id="40181" class="Symbol">(</a><a id="40182" href="NbE.html#23846" class="InductiveConstructor">ne</a> <a id="40185" href="NbE.html#40185" class="Bound">𝓊̂</a><a id="40187" class="Symbol">)</a> <a id="40189" class="Symbol">=</a> <a id="40191" href="NbE.html#40179" class="Bound">t</a> <a id="40193" href="NbE.html#37949" class="Function Operator">==↑</a> <a id="40197" href="NbE.html#40185" class="Bound">𝓊̂</a>

<a id="40201" class="Keyword">infix</a> <a id="40207" class="Number">3</a> <a id="40209" href="NbE.html#39304" class="Function Operator">_==ℕ̂_</a>
</pre>
With these in place, we can start defining the logical
relation Ⓡ itself by induction on types, using Ⓝ for
the base type nat
<pre class="Agda"><a id="_Ⓡ_"></a><a id="40355" href="NbE.html#40355" class="Function Operator">_Ⓡ_</a> <a id="40359" class="Symbol">:</a> <a id="40361" class="Symbol">∀</a> <a id="40363" class="Symbol">{</a><a id="40364" href="NbE.html#40364" class="Bound">Γ</a> <a id="40366" class="Symbol">:</a> <a id="40368" href="NbE.html#1943" class="Datatype">Ctx</a><a id="40371" class="Symbol">}</a> <a id="40373" class="Symbol">{</a><a id="40374" href="NbE.html#40374" class="Bound">T</a> <a id="40376" class="Symbol">:</a> <a id="40378" href="NbE.html#1051" class="Datatype">Type</a><a id="40382" class="Symbol">}</a> <a id="40384" class="Symbol">→</a> <a id="40386" href="NbE.html#40364" class="Bound">Γ</a> <a id="40388" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="40390" href="NbE.html#40374" class="Bound">T</a> <a id="40392" class="Symbol">→</a> <a id="40394" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="40396" href="NbE.html#40374" class="Bound">T</a> <a id="40398" href="NbE.html#15983" class="Field Operator">⟧</a> <a id="40400" class="Symbol">→</a> <a id="40402" href="Agda.Primitive.html#326" class="Primitive">Set</a>

<a id="40407" href="NbE.html#40355" class="Function Operator">_Ⓡ_</a> <a id="40411" class="Symbol">{</a><a id="40412" href="NbE.html#40412" class="Bound">Γ</a><a id="40413" class="Symbol">}</a> <a id="40415" class="Symbol">{</a><a id="40416" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="40419" class="Symbol">}</a> <a id="40421" href="NbE.html#40421" class="Bound">t</a> <a id="40423" href="NbE.html#40423" class="Bound">𝓋̂</a> <a id="40426" class="Symbol">=</a> <a id="40428" href="NbE.html#40421" class="Bound">t</a> <a id="40430" href="NbE.html#39065" class="Function Operator">Ⓝ</a> <a id="40432" href="NbE.html#40423" class="Bound">𝓋̂</a>
</pre>
For function types, the relation is defined as:
    Γ ⊢ r : S → T Ⓡ f ⇔ ∀ Γ′ ≤ Γ. Γ′ ⊢ s : S Ⓡ a ⇒ Γ′ ⊢ r s : T Ⓡ f(a)
<pre class="Agda"><a id="40567" href="NbE.html#40355" class="Function Operator">_Ⓡ_</a> <a id="40571" class="Symbol">{</a><a id="40572" href="NbE.html#40572" class="Bound">Γ</a><a id="40573" class="Symbol">}</a> <a id="40575" class="Symbol">{</a><a id="40576" href="NbE.html#40576" class="Bound">S</a> <a id="40578" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="40580" href="NbE.html#40580" class="Bound">T</a><a id="40581" class="Symbol">}</a> <a id="40583" href="NbE.html#40583" class="Bound">r</a> <a id="40585" href="NbE.html#40585" class="Bound">f</a> <a id="40587" class="Symbol">=</a>
  <a id="40591" class="Symbol">∀</a> <a id="40593" class="Symbol">{</a><a id="40594" href="NbE.html#40594" class="Bound">Γ′</a> <a id="40597" class="Symbol">:</a> <a id="40599" href="NbE.html#1943" class="Datatype">Ctx</a><a id="40602" class="Symbol">}</a>
  <a id="40606" class="Symbol">→</a> <a id="40608" class="Symbol">(</a><a id="40609" href="NbE.html#40609" class="Bound">Γ′≤Γ</a> <a id="40614" class="Symbol">:</a> <a id="40616" href="NbE.html#40594" class="Bound">Γ′</a> <a id="40619" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="40621" href="NbE.html#40572" class="Bound">Γ</a><a id="40622" class="Symbol">)</a>
  <a id="40626" class="Symbol">→</a> <a id="40628" class="Symbol">∀</a> <a id="40630" class="Symbol">{</a><a id="40631" href="NbE.html#40631" class="Bound">s</a> <a id="40633" class="Symbol">:</a> <a id="40635" href="NbE.html#40594" class="Bound">Γ′</a> <a id="40638" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="40640" href="NbE.html#40576" class="Bound">S</a><a id="40641" class="Symbol">}</a> <a id="40643" class="Symbol">{</a><a id="40644" href="NbE.html#40644" class="Bound">a</a> <a id="40646" class="Symbol">:</a> <a id="40648" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="40650" href="NbE.html#40576" class="Bound">S</a> <a id="40652" href="NbE.html#15983" class="Field Operator">⟧</a><a id="40653" class="Symbol">}</a>
  <a id="40657" class="Symbol">→</a> <a id="40659" href="NbE.html#40631" class="Bound">s</a> <a id="40661" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="40663" href="NbE.html#40644" class="Bound">a</a>
    <a id="40669" class="Comment">----------------------</a>
  <a id="40694" class="Symbol">→</a> <a id="40696" class="Symbol">(</a><a id="40697" href="NbE.html#40609" class="Bound">Γ′≤Γ</a> <a id="40702" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="40705" href="NbE.html#40583" class="Bound">r</a><a id="40706" class="Symbol">)</a> <a id="40708" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="40710" href="NbE.html#40631" class="Bound">s</a> <a id="40712" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="40714" href="NbE.html#40585" class="Bound">f</a> <a id="40716" href="NbE.html#40644" class="Bound">a</a>

<a id="40719" class="Keyword">infix</a> <a id="40725" class="Number">4</a> <a id="40727" href="NbE.html#40355" class="Function Operator">_Ⓡ_</a>
</pre>
A result of defining our Kripe logical relation in terms
of definitional equality is that the relation is transitive
with respect to definitional equality
<pre class="Agda"><a id="==-Ⓡ-trans"></a><a id="40899" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="40910" class="Symbol">:</a> <a id="40912" class="Symbol">∀</a> <a id="40914" class="Symbol">{</a><a id="40915" href="NbE.html#40915" class="Bound">Γ</a> <a id="40917" class="Symbol">:</a> <a id="40919" href="NbE.html#1943" class="Datatype">Ctx</a><a id="40922" class="Symbol">}</a> <a id="40924" class="Symbol">{</a><a id="40925" href="NbE.html#40925" class="Bound">T</a> <a id="40927" class="Symbol">:</a> <a id="40929" href="NbE.html#1051" class="Datatype">Type</a><a id="40933" class="Symbol">}</a> <a id="40935" class="Symbol">{</a><a id="40936" href="NbE.html#40936" class="Bound">t</a> <a id="40938" href="NbE.html#40938" class="Bound">t′</a> <a id="40941" class="Symbol">:</a> <a id="40943" href="NbE.html#40915" class="Bound">Γ</a> <a id="40945" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="40947" href="NbE.html#40925" class="Bound">T</a><a id="40948" class="Symbol">}</a> <a id="40950" class="Symbol">{</a><a id="40951" href="NbE.html#40951" class="Bound">a</a> <a id="40953" class="Symbol">:</a> <a id="40955" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="40957" href="NbE.html#40925" class="Bound">T</a> <a id="40959" href="NbE.html#15983" class="Field Operator">⟧</a><a id="40960" class="Symbol">}</a>
           <a id="40973" class="Symbol">→</a> <a id="40975" href="NbE.html#40936" class="Bound">t</a> <a id="40977" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="40980" href="NbE.html#40938" class="Bound">t′</a>
           <a id="40994" class="Symbol">→</a> <a id="40996" href="NbE.html#40936" class="Bound">t</a> <a id="40998" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="41000" href="NbE.html#40951" class="Bound">a</a>
             <a id="41015" class="Comment">-------</a>
           <a id="41034" class="Symbol">→</a> <a id="41036" href="NbE.html#40938" class="Bound">t′</a> <a id="41039" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="41041" href="NbE.html#40951" class="Bound">a</a>
<a id="41043" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="41054" class="Symbol">{</a><a id="41055" class="Argument">T</a> <a id="41057" class="Symbol">=</a> <a id="41059" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="41062" class="Symbol">}</a> <a id="41064" class="Symbol">{</a><a id="41065" class="Argument">a</a> <a id="41067" class="Symbol">=</a> <a id="41069" href="NbE.html#23818" class="InductiveConstructor">zero</a><a id="41073" class="Symbol">}</a> <a id="41075" href="NbE.html#41075" class="Bound">t==t′</a> <a id="41081" href="NbE.html#41081" class="Bound">pf</a> <a id="41084" href="NbE.html#41084" class="Bound">Γ′≤Γ</a> <a id="41089" class="Symbol">=</a>
  <a id="41093" href="NbE.html#14670" class="InductiveConstructor">trans</a> <a id="41099" class="Symbol">(</a><a id="41100" href="NbE.html#14569" class="InductiveConstructor">sym</a> <a id="41104" class="Symbol">(</a><a id="41105" href="NbE.html#36375" class="Postulate">==-subst</a> <a id="41114" href="NbE.html#41075" class="Bound">t==t′</a><a id="41119" class="Symbol">))</a> <a id="41122" class="Symbol">(</a><a id="41123" href="NbE.html#41081" class="Bound">pf</a> <a id="41126" href="NbE.html#41084" class="Bound">Γ′≤Γ</a><a id="41130" class="Symbol">)</a>
<a id="41132" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="41143" class="Symbol">{</a><a id="41144" class="Argument">T</a> <a id="41146" class="Symbol">=</a> <a id="41148" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="41151" class="Symbol">}</a> <a id="41153" class="Symbol">{</a><a id="41154" class="Argument">a</a> <a id="41156" class="Symbol">=</a> <a id="41158" href="NbE.html#23830" class="InductiveConstructor">suc</a> <a id="41162" href="NbE.html#41162" class="Bound">a</a><a id="41163" class="Symbol">}</a> <a id="41165" href="NbE.html#41165" class="Bound">t==t′</a> <a id="41171" href="NbE.html#41171" class="Bound">pf</a> <a id="41174" href="NbE.html#41174" class="Bound">Γ′≤Γ</a>
  <a id="41181" class="Keyword">with</a> <a id="41186" href="NbE.html#41171" class="Bound">pf</a> <a id="41189" href="NbE.html#41174" class="Bound">Γ′≤Γ</a>
<a id="41194" class="Symbol">...</a> <a id="41198" class="Symbol">|</a> <a id="41200" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="41202" href="NbE.html#41202" class="Bound">n</a> <a id="41204" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="41206" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="41208" href="NbE.html#41208" class="Bound">t==sn</a> <a id="41214" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="41216" href="NbE.html#41216" class="Bound">n==a</a> <a id="41221" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="41223" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="41225" class="Symbol">=</a>
  <a id="41229" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="41231" href="NbE.html#41202" class="Bound">n</a> <a id="41233" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="41235" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="41237" href="NbE.html#14670" class="InductiveConstructor">trans</a> <a id="41243" class="Symbol">(</a><a id="41244" href="NbE.html#14569" class="InductiveConstructor">sym</a> <a id="41248" class="Symbol">(</a><a id="41249" href="NbE.html#36375" class="Postulate">==-subst</a> <a id="41258" class="Bound">t==t′</a><a id="41263" class="Symbol">))</a> <a id="41266" href="NbE.html#41208" class="Bound">t==sn</a> <a id="41272" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="41274" href="NbE.html#41216" class="Bound">n==a</a> <a id="41279" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="41281" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
<a id="41283" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="41294" class="Symbol">{</a><a id="41295" class="Argument">T</a> <a id="41297" class="Symbol">=</a> <a id="41299" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="41302" class="Symbol">}</a> <a id="41304" class="Symbol">{</a><a id="41305" class="Argument">a</a> <a id="41307" class="Symbol">=</a> <a id="41309" href="NbE.html#23846" class="InductiveConstructor">ne</a> <a id="41312" href="NbE.html#41312" class="Bound">𝓊̂</a><a id="41314" class="Symbol">}</a> <a id="41316" href="NbE.html#41316" class="Bound">t==t′</a> <a id="41322" href="NbE.html#41322" class="Bound">pf</a> <a id="41325" class="Symbol">{</a><a id="41326" href="NbE.html#41326" class="Bound">Γ′</a><a id="41328" class="Symbol">}</a> <a id="41330" href="NbE.html#41330" class="Bound">Γ′≤Γ</a>
  <a id="41337" class="Keyword">with</a> <a id="41342" href="NbE.html#41312" class="Bound">𝓊̂</a> <a id="41345" href="NbE.html#41326" class="Bound">Γ′</a>          <a id="41357" class="Symbol">|</a> <a id="41359" href="NbE.html#41322" class="Bound">pf</a> <a id="41362" href="NbE.html#41330" class="Bound">Γ′≤Γ</a>
<a id="41367" class="Symbol">...</a> <a id="41371" class="Symbol">|</a> <a id="41373" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="41378" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="41380" href="NbE.html#41380" class="Bound">𝓊</a> <a id="41382" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="41384" class="Symbol">_</a> <a id="41386" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="41388" class="Symbol">|</a> <a id="41390" href="NbE.html#41390" class="Bound">t==𝓊</a> <a id="41395" class="Symbol">=</a>
  <a id="41399" href="NbE.html#14670" class="InductiveConstructor">trans</a> <a id="41405" class="Symbol">(</a><a id="41406" href="NbE.html#14569" class="InductiveConstructor">sym</a> <a id="41410" class="Symbol">(</a><a id="41411" href="NbE.html#36375" class="Postulate">==-subst</a> <a id="41420" class="Bound">t==t′</a><a id="41425" class="Symbol">))</a> <a id="41428" href="NbE.html#41390" class="Bound">t==𝓊</a>
<a id="41433" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="41444" class="Symbol">{</a><a id="41445" class="Argument">T</a> <a id="41447" class="Symbol">=</a> <a id="41449" href="NbE.html#41449" class="Bound">S</a> <a id="41451" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="41453" href="NbE.html#41453" class="Bound">T</a><a id="41454" class="Symbol">}</a> <a id="41456" href="NbE.html#41456" class="Bound">t==t′</a> <a id="41462" href="NbE.html#41462" class="Bound">pf</a> <a id="41465" href="NbE.html#41465" class="Bound">Γ′≤Γ</a> <a id="41470" href="NbE.html#41470" class="Bound">sⓇa</a> <a id="41474" class="Symbol">=</a>
  <a id="41478" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="41489" class="Symbol">(</a><a id="41490" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="41505" class="Symbol">(</a><a id="41506" href="NbE.html#36375" class="Postulate">==-subst</a> <a id="41515" href="NbE.html#41456" class="Bound">t==t′</a><a id="41520" class="Symbol">)</a> <a id="41522" href="NbE.html#14488" class="InductiveConstructor">refl</a><a id="41526" class="Symbol">)</a> <a id="41528" class="Symbol">(</a><a id="41529" href="NbE.html#41462" class="Bound">pf</a> <a id="41532" href="NbE.html#41465" class="Bound">Γ′≤Γ</a> <a id="41537" href="NbE.html#41470" class="Bound">sⓇa</a><a id="41540" class="Symbol">)</a>
</pre>
Additionally, because we have defined the relation so that its implication
holds for all extensions of a context, we can "weaken" the logical relation
`Γ ⊢ t : T Ⓡ a` for all `Γ′ ≤ Γ`, having that `Γ′ ⊢ t : T Ⓡ a` holds as well
<pre class="Agda"><a id="Ⓡ-weaken"></a><a id="41783" href="NbE.html#41783" class="Function">Ⓡ-weaken</a> <a id="41792" class="Symbol">:</a> <a id="41794" class="Symbol">∀</a> <a id="41796" class="Symbol">{</a><a id="41797" href="NbE.html#41797" class="Bound">Γ′</a> <a id="41800" href="NbE.html#41800" class="Bound">Γ</a> <a id="41802" class="Symbol">:</a> <a id="41804" href="NbE.html#1943" class="Datatype">Ctx</a><a id="41807" class="Symbol">}</a> <a id="41809" class="Symbol">{</a><a id="41810" href="NbE.html#41810" class="Bound">T</a> <a id="41812" class="Symbol">:</a> <a id="41814" href="NbE.html#1051" class="Datatype">Type</a><a id="41818" class="Symbol">}</a> <a id="41820" class="Symbol">{</a><a id="41821" href="NbE.html#41821" class="Bound">Γ′≤Γ</a> <a id="41826" class="Symbol">:</a> <a id="41828" href="NbE.html#41797" class="Bound">Γ′</a> <a id="41831" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="41833" href="NbE.html#41800" class="Bound">Γ</a><a id="41834" class="Symbol">}</a> <a id="41836" class="Symbol">{</a><a id="41837" href="NbE.html#41837" class="Bound">t</a> <a id="41839" class="Symbol">:</a> <a id="41841" href="NbE.html#41800" class="Bound">Γ</a> <a id="41843" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="41845" href="NbE.html#41810" class="Bound">T</a><a id="41846" class="Symbol">}</a> <a id="41848" class="Symbol">{</a><a id="41849" href="NbE.html#41849" class="Bound">a</a> <a id="41851" class="Symbol">:</a> <a id="41853" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="41855" href="NbE.html#41810" class="Bound">T</a> <a id="41857" href="NbE.html#15983" class="Field Operator">⟧</a><a id="41858" class="Symbol">}</a>
      <a id="41866" class="Symbol">→</a> <a id="41868" href="NbE.html#41837" class="Bound">t</a> <a id="41870" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="41872" href="NbE.html#41849" class="Bound">a</a>
      <a id="41880" class="Symbol">→</a> <a id="41882" href="NbE.html#41821" class="Bound">Γ′≤Γ</a> <a id="41887" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="41890" href="NbE.html#41837" class="Bound">t</a> <a id="41892" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="41894" href="NbE.html#41849" class="Bound">a</a>
<a id="41896" href="NbE.html#41783" class="Function">Ⓡ-weaken</a> <a id="41905" class="Symbol">{</a><a id="41906" class="Argument">T</a> <a id="41908" class="Symbol">=</a> <a id="41910" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="41913" class="Symbol">}</a> <a id="41915" class="Symbol">{</a><a id="41916" href="NbE.html#41916" class="Bound">Γ′≤Γ</a><a id="41920" class="Symbol">}</a> <a id="41922" class="Symbol">{</a><a id="41923" href="NbE.html#41923" class="Bound">t</a><a id="41924" class="Symbol">}</a> <a id="41926" href="NbE.html#41926" class="Bound">pf</a> <a id="41929" href="NbE.html#41929" class="Bound">Γ″≤Γ′</a>
  <a id="41937" class="Keyword">rewrite</a> <a id="41945" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="41960" href="NbE.html#41929" class="Bound">Γ″≤Γ′</a> <a id="41966" href="NbE.html#41916" class="Bound">Γ′≤Γ</a> <a id="41971" href="NbE.html#41923" class="Bound">t</a> <a id="41973" class="Symbol">=</a> <a id="41975" href="NbE.html#41926" class="Bound">pf</a> <a id="41978" class="Symbol">(</a><a id="41979" href="NbE.html#32369" class="Function">≤-trans</a> <a id="41987" href="NbE.html#41929" class="Bound">Γ″≤Γ′</a> <a id="41993" href="NbE.html#41916" class="Bound">Γ′≤Γ</a><a id="41997" class="Symbol">)</a>
<a id="41999" href="NbE.html#41783" class="Function">Ⓡ-weaken</a> <a id="42008" class="Symbol">{</a><a id="42009" class="Argument">T</a> <a id="42011" class="Symbol">=</a> <a id="42013" href="NbE.html#42013" class="Bound">S</a> <a id="42015" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="42017" href="NbE.html#42017" class="Bound">T</a><a id="42018" class="Symbol">}</a> <a id="42020" class="Symbol">{</a><a id="42021" href="NbE.html#42021" class="Bound">Γ′≤Γ</a><a id="42025" class="Symbol">}</a> <a id="42027" class="Symbol">{</a><a id="42028" href="NbE.html#42028" class="Bound">t</a><a id="42029" class="Symbol">}</a> <a id="42031" href="NbE.html#42031" class="Bound">pf</a> <a id="42034" href="NbE.html#42034" class="Bound">Γ″≤Γ′</a> <a id="42040" href="NbE.html#42040" class="Bound">sⓇa</a>
  <a id="42046" class="Keyword">rewrite</a> <a id="42054" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="42069" href="NbE.html#42034" class="Bound">Γ″≤Γ′</a> <a id="42075" href="NbE.html#42021" class="Bound">Γ′≤Γ</a> <a id="42080" href="NbE.html#42028" class="Bound">t</a> <a id="42082" class="Symbol">=</a> <a id="42084" href="NbE.html#42031" class="Bound">pf</a> <a id="42087" class="Symbol">(</a><a id="42088" href="NbE.html#32369" class="Function">≤-trans</a> <a id="42096" href="NbE.html#42034" class="Bound">Γ″≤Γ′</a> <a id="42102" href="NbE.html#42021" class="Bound">Γ′≤Γ</a><a id="42106" class="Symbol">)</a> <a id="42108" href="NbE.html#42040" class="Bound">sⓇa</a>
</pre>
The Kripke logical relation is "sandwiched" between
reflection and reification -- to arrive at the logical
relation between a term and a semantic object, the
semantic object must be a reflection of a liftable neutral
that is definitionally equal to the term. Likewise,
if a logical relation holds between a term and a semantic
object, then the term must be definitionally equal
to the reification of that semantic object.

This is intentional, as these results will be exactly
what we will need to prove the soundness of NbE. We
formalize them with the following implications, which
we will prove mutually (as reflection and reification
are themselves defined mutually) by induction on types.

Our first implication is:

    (∀ Γ′ ≤ Γ. Γ′ ⊢ 𝓊 = 𝓊̂(Γ) : T) ⇒ Γ ⊢ 𝓊 : T Ⓡ ↑ᵀ 𝓊̂

which we can now formalize in Agda with our definitions
<pre class="Agda"><a id="==↑-Ⓡ"></a><a id="42958" href="NbE.html#42958" class="Function">==↑-Ⓡ</a> <a id="42964" class="Symbol">:</a> <a id="42966" class="Symbol">∀</a> <a id="42968" class="Symbol">{</a><a id="42969" href="NbE.html#42969" class="Bound">Γ</a> <a id="42971" class="Symbol">:</a> <a id="42973" href="NbE.html#1943" class="Datatype">Ctx</a><a id="42976" class="Symbol">}</a> <a id="42978" class="Symbol">{</a><a id="42979" href="NbE.html#42979" class="Bound">T</a> <a id="42981" class="Symbol">:</a> <a id="42983" href="NbE.html#1051" class="Datatype">Type</a><a id="42987" class="Symbol">}</a> <a id="42989" class="Symbol">{</a><a id="42990" href="NbE.html#42990" class="Bound">𝓊</a> <a id="42992" class="Symbol">:</a> <a id="42994" href="NbE.html#42969" class="Bound">Γ</a> <a id="42996" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="42998" href="NbE.html#42979" class="Bound">T</a><a id="42999" class="Symbol">}</a> <a id="43001" class="Symbol">{</a><a id="43002" href="NbE.html#43002" class="Bound">𝓊̂</a> <a id="43005" class="Symbol">:</a> <a id="43007" href="NbE.html#22920" class="Function">Ne↑</a> <a id="43011" href="NbE.html#42979" class="Bound">T</a><a id="43012" class="Symbol">}</a>
      <a id="43020" class="Symbol">→</a> <a id="43022" class="Symbol">(∀</a> <a id="43025" class="Symbol">{</a><a id="43026" href="NbE.html#43026" class="Bound">Γ′</a> <a id="43029" class="Symbol">:</a> <a id="43031" href="NbE.html#1943" class="Datatype">Ctx</a><a id="43034" class="Symbol">}</a>
         <a id="43045" class="Symbol">→</a> <a id="43047" class="Symbol">(</a><a id="43048" href="NbE.html#43048" class="Bound">Γ′≤Γ</a> <a id="43053" class="Symbol">:</a> <a id="43055" href="NbE.html#43026" class="Bound">Γ′</a> <a id="43058" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="43060" href="NbE.html#42969" class="Bound">Γ</a><a id="43061" class="Symbol">)</a>
         <a id="43072" class="Symbol">→</a> <a id="43074" href="NbE.html#43048" class="Bound">Γ′≤Γ</a> <a id="43079" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="43082" href="NbE.html#42990" class="Bound">𝓊</a> <a id="43084" href="NbE.html#37949" class="Function Operator">==↑</a> <a id="43088" href="NbE.html#43002" class="Bound">𝓊̂</a><a id="43090" class="Symbol">)</a>
        <a id="43100" class="Comment">-------------------</a>
      <a id="43126" class="Symbol">→</a> <a id="43128" href="NbE.html#42990" class="Bound">𝓊</a> <a id="43130" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="43132" class="Symbol">(</a><a id="43133" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="43136" href="NbE.html#43002" class="Bound">𝓊̂</a><a id="43138" class="Symbol">)</a>
</pre>
The second implication is:

    Γ ⊢ t : T Ⓡ a ⇒ ∀ Γ′ ≤ Γ. Γ′ ⊢ t = ↓ᵀ a Γ′ : T

<pre class="Agda"><a id="Ⓡ-==↓"></a><a id="43233" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="43239" class="Symbol">:</a> <a id="43241" class="Symbol">∀</a> <a id="43243" class="Symbol">{</a><a id="43244" href="NbE.html#43244" class="Bound">Γ′</a> <a id="43247" href="NbE.html#43247" class="Bound">Γ</a> <a id="43249" class="Symbol">:</a> <a id="43251" href="NbE.html#1943" class="Datatype">Ctx</a><a id="43254" class="Symbol">}</a> <a id="43256" class="Symbol">{</a><a id="43257" href="NbE.html#43257" class="Bound">T</a> <a id="43259" class="Symbol">:</a> <a id="43261" href="NbE.html#1051" class="Datatype">Type</a><a id="43265" class="Symbol">}</a> <a id="43267" class="Symbol">{</a><a id="43268" href="NbE.html#43268" class="Bound">t</a> <a id="43270" class="Symbol">:</a> <a id="43272" href="NbE.html#43247" class="Bound">Γ</a> <a id="43274" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="43276" href="NbE.html#43257" class="Bound">T</a><a id="43277" class="Symbol">}</a> <a id="43279" class="Symbol">{</a><a id="43280" href="NbE.html#43280" class="Bound">a</a> <a id="43282" class="Symbol">:</a> <a id="43284" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="43286" href="NbE.html#43257" class="Bound">T</a> <a id="43288" href="NbE.html#15983" class="Field Operator">⟧</a><a id="43289" class="Symbol">}</a>
      <a id="43297" class="Symbol">→</a> <a id="43299" href="NbE.html#43268" class="Bound">t</a> <a id="43301" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="43303" href="NbE.html#43280" class="Bound">a</a>
        <a id="43313" class="Comment">---------------------</a>
      <a id="43341" class="Symbol">→</a> <a id="43343" class="Symbol">(</a><a id="43344" href="NbE.html#43344" class="Bound">Γ′≤Γ</a> <a id="43349" class="Symbol">:</a> <a id="43351" href="NbE.html#43244" class="Bound">Γ′</a> <a id="43354" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="43356" href="NbE.html#43247" class="Bound">Γ</a><a id="43357" class="Symbol">)</a>
      <a id="43365" class="Symbol">→</a> <a id="43367" href="NbE.html#43344" class="Bound">Γ′≤Γ</a> <a id="43372" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="43375" href="NbE.html#43268" class="Bound">t</a> <a id="43377" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="43380" href="NbE.html#38536" class="Function">↓ᵀᵧ</a> <a id="43384" href="NbE.html#43280" class="Bound">a</a>
</pre>
A consequence of the first implication is that
`Γ , x:T ⊢ x Ⓡ ↑ᵀ (𝓍̂ Γ)`, which we define now
as it will be the lemma we will need for proving the
second implication
<pre class="Agda"><a id="xⓇ↑ᵀ𝓍̂"></a><a id="43565" href="NbE.html#43565" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="43572" class="Symbol">:</a> <a id="43574" class="Symbol">∀</a> <a id="43576" class="Symbol">{</a><a id="43577" href="NbE.html#43577" class="Bound">Γ</a> <a id="43579" class="Symbol">:</a> <a id="43581" href="NbE.html#1943" class="Datatype">Ctx</a><a id="43584" class="Symbol">}</a> <a id="43586" class="Symbol">{</a><a id="43587" href="NbE.html#43587" class="Bound">T</a> <a id="43589" class="Symbol">:</a> <a id="43591" href="NbE.html#1051" class="Datatype">Type</a><a id="43595" class="Symbol">}</a>
        <a id="43605" class="Comment">-------------------------</a>
      <a id="43637" class="Symbol">→</a> <a id="43639" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="43641" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="43644" class="Symbol">{</a><a id="43645" href="NbE.html#43577" class="Bound">Γ</a><a id="43646" class="Symbol">}</a> <a id="43648" class="Symbol">{</a><a id="43649" href="NbE.html#43587" class="Bound">T</a><a id="43650" class="Symbol">}</a> <a id="43652" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="43654" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="43657" class="Symbol">(</a><a id="43658" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="43661" href="NbE.html#43587" class="Bound">T</a> <a id="43663" href="NbE.html#43577" class="Bound">Γ</a><a id="43664" class="Symbol">)</a>
</pre>
To prove the first implication, first we show that it always
holds for liftable neutral terms of type nat. This is simply
the given proof, so this case follows immediately.
<pre class="Agda"><a id="43852" href="NbE.html#42958" class="Function">==↑-Ⓡ</a> <a id="43858" class="Symbol">{</a><a id="43859" class="Argument">T</a> <a id="43861" class="Symbol">=</a> <a id="43863" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="43866" class="Symbol">}</a> <a id="43868" href="NbE.html#43868" class="Bound">pf</a> <a id="43871" href="NbE.html#43871" class="Bound">Γ′≤Γ</a> <a id="43876" class="Symbol">=</a> <a id="43878" href="NbE.html#43868" class="Bound">pf</a> <a id="43881" href="NbE.html#43871" class="Bound">Γ′≤Γ</a>
</pre>Now, for liftable neutral terms of type S → T, we prove that
the relation holds for `↑ᵀ (𝓊̂ · ↓ˢ a)`

We prove the relation holds by using our induction
hypothesis, so that our new goal is to prove that

    Γ″ ⊢ 𝓊 s = (𝓊̂ · (↓ˢ a)) Γ″ : T

for any Γ″ that is an extension of Γ′ (which itself
extends Γ).

Note that `(𝓊̂ · (↓ˢ a)) Γ″` is equivalent to
`𝓊̂(Γ″) · (↓ˢ a)(Γ″)` (application of liftable neutrals is overloaded.

First, we deconstruct `𝓊̂ (Γ″)`,
using our given proof that it's definitionally
equal to `Γ″ ⊢ 𝓊 : S → T` to both discard the case
where `𝓊̂ (Γ″)` is undefined and simplify our goal
to proving that:

    Γ″ ⊢ 𝓊 · s = 𝓊″ · ↓ˢ a Γ″ : T (𝓊″ is 𝓊̂ lifted to the context Γ″)

We also use the other implication we will prove,
alongside the fact that `s Ⓡ a`, to have evidence
that `Γ″ ⊢ s : S` is definitionally equal to
`↓ˢ a Γ″`.

With these pieces in place, we can use equational reasoning for definitional
equality to prove the desired goal.
<pre class="Agda"><a id="44862" href="NbE.html#42958" class="Function">==↑-Ⓡ</a> <a id="44868" class="Symbol">{</a><a id="44869" class="Argument">T</a> <a id="44871" class="Symbol">=</a> <a id="44873" class="Symbol">_</a> <a id="44875" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="44877" class="Symbol">_}</a> <a id="44880" class="Symbol">{</a><a id="44881" href="NbE.html#44881" class="Bound">𝓊</a><a id="44882" class="Symbol">}</a> <a id="44884" class="Symbol">{</a><a id="44885" href="NbE.html#44885" class="Bound">𝓊̂</a><a id="44887" class="Symbol">}</a> <a id="44889" href="NbE.html#44889" class="Bound">pf</a> <a id="44892" class="Symbol">{</a><a id="44893" href="NbE.html#44893" class="Bound">Γ′</a><a id="44895" class="Symbol">}</a> <a id="44897" href="NbE.html#44897" class="Bound">Γ′≤Γ</a> <a id="44902" class="Symbol">{</a><a id="44903" href="NbE.html#44903" class="Bound">s</a><a id="44904" class="Symbol">}</a> <a id="44906" class="Symbol">{</a><a id="44907" href="NbE.html#44907" class="Bound">a</a><a id="44908" class="Symbol">}</a> <a id="44910" href="NbE.html#44910" class="Bound">sⓇa</a> <a id="44914" class="Symbol">=</a>
  <a id="44918" href="NbE.html#42958" class="Function">==↑-Ⓡ</a> <a id="44924" href="NbE.html#44952" class="Function">𝓊·s==𝓊̂·↓ˢa</a>
    <a id="44940" class="Keyword">where</a>
      <a id="44952" href="NbE.html#44952" class="Function">𝓊·s==𝓊̂·↓ˢa</a> <a id="44964" class="Symbol">:</a> <a id="44966" class="Symbol">∀</a> <a id="44968" class="Symbol">{</a><a id="44969" href="NbE.html#44969" class="Bound">Γ″</a> <a id="44972" class="Symbol">:</a> <a id="44974" href="NbE.html#1943" class="Datatype">Ctx</a><a id="44977" class="Symbol">}</a>
                 <a id="44996" class="Symbol">→</a> <a id="44998" class="Symbol">(</a><a id="44999" href="NbE.html#44999" class="Bound">Γ″≤Γ′</a> <a id="45005" class="Symbol">:</a> <a id="45007" href="NbE.html#44969" class="Bound">Γ″</a> <a id="45010" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="45012" href="NbE.html#44893" class="Bound">Γ′</a><a id="45014" class="Symbol">)</a>
                 <a id="45033" class="Symbol">→</a> <a id="45035" href="NbE.html#44999" class="Bound">Γ″≤Γ′</a> <a id="45041" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="45044" class="Symbol">(</a><a id="45045" href="NbE.html#44897" class="Bound">Γ′≤Γ</a> <a id="45050" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="45053" href="NbE.html#44881" class="Bound">𝓊</a><a id="45054" class="Symbol">)</a> <a id="45056" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="45058" href="NbE.html#44903" class="Bound">s</a> <a id="45060" href="NbE.html#37949" class="Function Operator">==↑</a> <a id="45064" href="NbE.html#44885" class="Bound">𝓊̂</a> <a id="45067" href="NbE.html#23146" class="Function Operator">·↑</a> <a id="45070" class="Symbol">(</a><a id="45071" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="45074" href="NbE.html#44907" class="Bound">a</a><a id="45075" class="Symbol">)</a>
      <a id="45083" href="NbE.html#44952" class="Function">𝓊·s==𝓊̂·↓ˢa</a>  <a id="45096" class="Symbol">{</a><a id="45097" href="NbE.html#45097" class="Bound">Γ″</a><a id="45099" class="Symbol">}</a> <a id="45101" href="NbE.html#45101" class="Bound">Γ″≤Γ′</a>
        <a id="45115" class="Keyword">with</a> <a id="45120" href="NbE.html#44885" class="Bound">𝓊̂</a> <a id="45123" href="NbE.html#45097" class="Bound">Γ″</a>           <a id="45136" class="Symbol">|</a> <a id="45138" href="NbE.html#44889" class="Bound">pf</a> <a id="45141" class="Symbol">(</a><a id="45142" href="NbE.html#32369" class="Function">≤-trans</a> <a id="45150" href="NbE.html#45101" class="Bound">Γ″≤Γ′</a> <a id="45156" href="NbE.html#44897" class="Bound">Γ′≤Γ</a><a id="45160" class="Symbol">)</a>
      <a id="45168" class="Symbol">...</a> <a id="45172" class="Symbol">|</a> <a id="45174" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="45179" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="45181" href="NbE.html#45181" class="Bound">𝓊″</a> <a id="45184" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="45186" class="Symbol">_</a> <a id="45188" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="45190" class="Symbol">|</a> <a id="45192" href="NbE.html#45192" class="Bound">𝓊==𝓊″</a>
        <a id="45206" class="Keyword">with</a> <a id="45211" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="45217" href="NbE.html#44910" class="Bound">sⓇa</a> <a id="45221" class="Bound">Γ″≤Γ′</a>
      <a id="45233" class="Symbol">...</a> <a id="45237" class="Symbol">|</a> <a id="45239" href="NbE.html#45239" class="Bound">s==↓ᵀᵧa</a> <a id="45247" class="Symbol">=</a>
        <a id="45257" href="NbE.html#15061" class="Function Operator">begin</a>
          <a id="45273" class="Bound">Γ″≤Γ′</a> <a id="45279" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="45282" class="Symbol">(</a><a id="45283" href="NbE.html#44897" class="Bound">Γ′≤Γ</a> <a id="45288" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="45291" href="NbE.html#44881" class="Bound">𝓊</a><a id="45292" class="Symbol">)</a> <a id="45294" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="45296" href="NbE.html#44903" class="Bound">s</a>
        <a id="45306" href="NbE.html#15171" class="Function Operator">==⟨</a> <a id="45310" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="45325" class="Symbol">(</a><a id="45326" href="NbE.html#30660" class="Function">≡→==</a> <a id="45331" class="Symbol">(</a><a id="45332" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="45347" class="Bound">Γ″≤Γ′</a> <a id="45353" href="NbE.html#44897" class="Bound">Γ′≤Γ</a> <a id="45358" href="NbE.html#44881" class="Bound">𝓊</a><a id="45359" class="Symbol">))</a> <a id="45362" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="45367" href="NbE.html#15171" class="Function Operator">⟩</a>
          <a id="45379" class="Symbol">(</a><a id="45380" href="NbE.html#45571" class="Function">Γ″≤Γ</a> <a id="45385" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="45388" href="NbE.html#44881" class="Bound">𝓊</a><a id="45389" class="Symbol">)</a> <a id="45391" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="45393" class="Symbol">(</a><a id="45394" class="Bound">Γ″≤Γ′</a> <a id="45400" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="45403" href="NbE.html#44903" class="Bound">s</a><a id="45404" class="Symbol">)</a>
        <a id="45414" href="NbE.html#15171" class="Function Operator">==⟨</a> <a id="45418" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="45433" class="Bound">𝓊==𝓊″</a> <a id="45439" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="45444" href="NbE.html#15171" class="Function Operator">⟩</a>
          <a id="45456" class="Bound">𝓊″</a> <a id="45459" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="45461" class="Symbol">(</a><a id="45462" class="Bound">Γ″≤Γ′</a> <a id="45468" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="45471" href="NbE.html#44903" class="Bound">s</a><a id="45472" class="Symbol">)</a>
        <a id="45482" href="NbE.html#15171" class="Function Operator">==⟨</a> <a id="45486" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="45501" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="45506" href="NbE.html#45239" class="Bound">s==↓ᵀᵧa</a> <a id="45514" href="NbE.html#15171" class="Function Operator">⟩</a>
          <a id="45526" class="Bound">𝓊″</a> <a id="45529" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="45531" href="NbE.html#38536" class="Function">↓ᵀᵧ</a> <a id="45535" href="NbE.html#44907" class="Bound">a</a>
        <a id="45545" href="NbE.html#15344" class="Function Operator">∎</a>
        <a id="45555" class="Keyword">where</a>
          <a id="45571" href="NbE.html#45571" class="Function">Γ″≤Γ</a> <a id="45576" class="Symbol">=</a> <a id="45578" href="NbE.html#32369" class="Function">≤-trans</a> <a id="45586" class="Bound">Γ″≤Γ′</a> <a id="45592" href="NbE.html#44897" class="Bound">Γ′≤Γ</a>
</pre>
To prove the second implication, we proceed similarly
and first prove it for type nat. If the term is logically
related to zero, the implication holds immediately from
our given proof
<pre class="Agda"><a id="45794" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="45800" class="Symbol">{</a><a id="45801" class="Argument">T</a> <a id="45803" class="Symbol">=</a> <a id="45805" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="45808" class="Symbol">}</a> <a id="45810" class="Symbol">{</a><a id="45811" class="Argument">a</a> <a id="45813" class="Symbol">=</a> <a id="45815" href="NbE.html#23818" class="InductiveConstructor">zero</a><a id="45819" class="Symbol">}</a> <a id="45821" href="NbE.html#45821" class="Bound">pf</a> <a id="45824" href="NbE.html#45824" class="Bound">Γ′≤Γ</a> <a id="45829" class="Keyword">with</a> <a id="45834" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="45837" class="Symbol">{</a><a id="45838" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="45841" class="Symbol">}</a> <a id="45843" href="NbE.html#23818" class="InductiveConstructor">zero</a>
<a id="45848" class="Symbol">...</a> <a id="45852" class="Symbol">|</a> <a id="45854" class="Symbol">_</a> <a id="45856" class="Symbol">=</a> <a id="45858" class="Bound">pf</a> <a id="45861" class="Bound">Γ′≤Γ</a>
</pre>Otherwise, if the term is logically related to
a successor of a natural, our given proof
similarly leads to the implication, though for this case,
we additionally need a lemma showing
that if a term of type nat is definitionally
equal to an object a of type ℕ̂ (i.e. a natural
with embedded liftable neutrals), then it is
definitionally equal to the reification of
the object a. We can prove this by induction
on a.
<pre class="Agda"><a id="46294" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="46300" class="Symbol">{</a><a id="46301" href="NbE.html#46301" class="Bound">Γ</a><a id="46302" class="Symbol">}</a> <a id="46304" class="Symbol">{</a><a id="46305" class="Argument">T</a> <a id="46307" class="Symbol">=</a> <a id="46309" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="46312" class="Symbol">}</a> <a id="46314" class="Symbol">{</a><a id="46315" href="NbE.html#46315" class="Bound">t</a><a id="46316" class="Symbol">}</a> <a id="46318" class="Symbol">{</a><a id="46319" href="NbE.html#23830" class="InductiveConstructor">suc</a> <a id="46323" href="NbE.html#46323" class="Bound">a</a><a id="46324" class="Symbol">}</a> <a id="46326" href="NbE.html#46326" class="Bound">pf</a> <a id="46329" href="NbE.html#46329" class="Bound">Γ′≤Γ</a>
  <a id="46336" class="Keyword">with</a> <a id="46341" href="NbE.html#46326" class="Bound">pf</a> <a id="46344" href="NbE.html#46329" class="Bound">Γ′≤Γ</a>
<a id="46349" class="Symbol">...</a> <a id="46353" class="Symbol">|</a> <a id="46355" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="46357" href="NbE.html#46357" class="Bound">n</a> <a id="46359" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="46361" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="46363" href="NbE.html#46363" class="Bound">t==sn</a> <a id="46369" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="46371" href="NbE.html#46371" class="Bound">nⓇa</a> <a id="46375" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="46377" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
  <a id="46381" class="Keyword">with</a> <a id="46386" href="NbE.html#46371" class="Bound">nⓇa</a> <a id="46390" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
<a id="46395" class="Symbol">...</a> <a id="46399" class="Symbol">|</a> <a id="46401" href="NbE.html#46401" class="Bound">n==ℕ̂a</a> <a id="46408" class="Keyword">rewrite</a> <a id="46416" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="46430" class="Symbol">{</a><a id="46431" class="Argument">t</a> <a id="46433" class="Symbol">=</a> <a id="46435" class="Bound">n</a><a id="46436" class="Symbol">}</a> <a id="46438" class="Symbol">=</a>
  <a id="46442" href="NbE.html#15061" class="Function Operator">begin</a>
    <a id="46452" class="Bound">Γ′≤Γ</a> <a id="46457" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="46460" class="Bound">t</a>
  <a id="46464" href="NbE.html#15171" class="Function Operator">==⟨</a> <a id="46468" class="Bound">t==sn</a> <a id="46474" href="NbE.html#15171" class="Function Operator">⟩</a>
    <a id="46480" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="46484" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="46486" class="Bound">n</a>
  <a id="46490" href="NbE.html#15171" class="Function Operator">==⟨</a> <a id="46494" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="46509" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="46514" class="Symbol">(</a><a id="46515" href="NbE.html#46575" class="Function">==ℕ̂→==↓ᵀ</a> <a id="46525" class="Symbol">{</a><a id="46526" class="Argument">a</a> <a id="46528" class="Symbol">=</a> <a id="46530" class="Bound">a</a><a id="46531" class="Symbol">}</a> <a id="46533" href="NbE.html#46401" class="Bound">n==ℕ̂a</a><a id="46539" class="Symbol">)</a> <a id="46541" href="NbE.html#15171" class="Function Operator">⟩</a>
    <a id="46547" href="NbE.html#4395" class="InductiveConstructor">suc</a> <a id="46551" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="46553" href="NbE.html#38536" class="Function">↓ᵀᵧ</a> <a id="46557" class="Bound">a</a>
  <a id="46561" href="NbE.html#15344" class="Function Operator">∎</a>
  <a id="46565" class="Keyword">where</a>
    <a id="46575" href="NbE.html#46575" class="Function">==ℕ̂→==↓ᵀ</a> <a id="46585" class="Symbol">:</a> <a id="46587" class="Symbol">∀</a> <a id="46589" class="Symbol">{</a><a id="46590" href="NbE.html#46590" class="Bound">Γ</a> <a id="46592" class="Symbol">:</a> <a id="46594" href="NbE.html#1943" class="Datatype">Ctx</a><a id="46597" class="Symbol">}</a> <a id="46599" class="Symbol">{</a><a id="46600" href="NbE.html#46600" class="Bound">n</a> <a id="46602" class="Symbol">:</a> <a id="46604" href="NbE.html#46590" class="Bound">Γ</a> <a id="46606" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="46608" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="46611" class="Symbol">}</a> <a id="46613" class="Symbol">{</a><a id="46614" href="NbE.html#46614" class="Bound">a</a> <a id="46616" class="Symbol">:</a> <a id="46618" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="46620" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="46624" href="NbE.html#15983" class="Field Operator">⟧</a><a id="46625" class="Symbol">}</a>
             <a id="46640" class="Symbol">→</a> <a id="46642" href="NbE.html#46600" class="Bound">n</a> <a id="46644" href="NbE.html#39304" class="Function Operator">==ℕ̂</a> <a id="46649" href="NbE.html#46614" class="Bound">a</a>
               <a id="46666" class="Comment">----------</a>
             <a id="46690" class="Symbol">→</a> <a id="46692" href="NbE.html#46600" class="Bound">n</a> <a id="46694" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="46697" href="NbE.html#38536" class="Function">↓ᵀᵧ</a> <a id="46701" href="NbE.html#46614" class="Bound">a</a>
    <a id="46707" href="NbE.html#46575" class="Function">==ℕ̂→==↓ᵀ</a> <a id="46717" class="Symbol">{</a><a id="46718" class="Argument">a</a> <a id="46720" class="Symbol">=</a> <a id="46722" href="NbE.html#23818" class="InductiveConstructor">zero</a><a id="46726" class="Symbol">}</a> <a id="46728" href="NbE.html#46728" class="Bound">pf</a> <a id="46731" class="Keyword">with</a> <a id="46736" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="46739" class="Symbol">{</a><a id="46740" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="46743" class="Symbol">}</a> <a id="46745" href="NbE.html#23818" class="InductiveConstructor">zero</a>
    <a id="46754" class="Symbol">...</a> <a id="46758" class="Symbol">|</a> <a id="46760" class="Symbol">_</a> <a id="46762" class="Symbol">=</a> <a id="46764" class="Bound">pf</a>
    <a id="46771" href="NbE.html#46575" class="Function">==ℕ̂→==↓ᵀ</a> <a id="46781" class="Symbol">{</a><a id="46782" href="NbE.html#46782" class="Bound">Γ</a><a id="46783" class="Symbol">}</a> <a id="46785" class="Symbol">{</a><a id="46786" class="Argument">a</a> <a id="46788" class="Symbol">=</a> <a id="46790" href="NbE.html#23830" class="InductiveConstructor">suc</a> <a id="46794" href="NbE.html#46794" class="Bound">a</a><a id="46795" class="Symbol">}</a> <a id="46797" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="46799" href="NbE.html#46799" class="Bound">n</a> <a id="46801" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="46803" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="46805" href="NbE.html#46805" class="Bound">m==sn</a> <a id="46811" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="46813" href="NbE.html#46813" class="Bound">n==a</a> <a id="46818" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="46820" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
      <a id="46828" class="Keyword">with</a> <a id="46833" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="46836" class="Symbol">{</a><a id="46837" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="46840" class="Symbol">}</a> <a id="46842" class="Symbol">(</a><a id="46843" href="NbE.html#23830" class="InductiveConstructor">suc</a> <a id="46847" href="NbE.html#46794" class="Bound">a</a><a id="46848" class="Symbol">)</a> <a id="46850" class="Symbol">|</a> <a id="46852" href="NbE.html#46575" class="Function">==ℕ̂→==↓ᵀ</a> <a id="46862" class="Symbol">{</a><a id="46863" class="Argument">a</a> <a id="46865" class="Symbol">=</a> <a id="46867" href="NbE.html#46794" class="Bound">a</a><a id="46868" class="Symbol">}</a> <a id="46870" class="Symbol">(</a><a id="46871" href="NbE.html#46813" class="Bound">n==a</a> <a id="46876" href="NbE.html#2913" class="InductiveConstructor">≤-id</a><a id="46880" class="Symbol">)</a>
    <a id="46886" class="Symbol">...</a> <a id="46890" class="Symbol">|</a> <a id="46892" class="Symbol">_</a>                 <a id="46910" class="Symbol">|</a> <a id="46912" href="NbE.html#46912" class="Bound">pf</a>
      <a id="46921" class="Keyword">rewrite</a> <a id="46929" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="46943" class="Symbol">{</a><a id="46944" class="Argument">t</a> <a id="46946" class="Symbol">=</a> <a id="46948" class="Bound">n</a><a id="46949" class="Symbol">}</a> <a id="46951" class="Symbol">=</a> <a id="46953" href="NbE.html#14670" class="InductiveConstructor">trans</a> <a id="46959" class="Bound">m==sn</a> <a id="46965" class="Symbol">(</a><a id="46966" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="46981" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="46986" href="NbE.html#46912" class="Bound">pf</a><a id="46988" class="Symbol">)</a>
    <a id="46994" href="NbE.html#46575" class="Function">==ℕ̂→==↓ᵀ</a> <a id="47004" class="Symbol">{</a><a id="47005" href="NbE.html#47005" class="Bound">Γ</a><a id="47006" class="Symbol">}</a> <a id="47008" class="Symbol">{</a><a id="47009" href="NbE.html#47009" class="Bound">t</a><a id="47010" class="Symbol">}</a> <a id="47012" class="Symbol">{</a><a id="47013" href="NbE.html#23846" class="InductiveConstructor">ne</a> <a id="47016" href="NbE.html#47016" class="Bound">𝓊̂</a><a id="47018" class="Symbol">}</a> <a id="47020" href="NbE.html#47020" class="Bound">pf</a>
      <a id="47029" class="Keyword">with</a> <a id="47034" href="NbE.html#47016" class="Bound">𝓊̂</a> <a id="47037" href="NbE.html#47005" class="Bound">Γ</a>           <a id="47049" class="Symbol">|</a> <a id="47051" href="NbE.html#47020" class="Bound">pf</a>
    <a id="47058" class="Symbol">...</a> <a id="47062" class="Symbol">|</a> <a id="47064" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="47069" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="47071" href="NbE.html#47071" class="Bound">𝓊</a> <a id="47073" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="47075" class="Symbol">_</a> <a id="47077" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="47079" class="Symbol">|</a> <a id="47081" href="NbE.html#47081" class="Bound">t==𝓊</a> <a id="47086" class="Symbol">=</a> <a id="47088" href="NbE.html#47081" class="Bound">t==𝓊</a>
</pre>Lastly for type nat, if the term is logically related to an
embedded liftable neutral, the implication also
holds immediately from our given proof
<pre class="Agda"><a id="47252" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="47258" class="Symbol">{</a><a id="47259" href="NbE.html#47259" class="Bound">Γ′</a><a id="47261" class="Symbol">}</a> <a id="47263" class="Symbol">{</a><a id="47264" class="Argument">T</a> <a id="47266" class="Symbol">=</a> <a id="47268" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="47271" class="Symbol">}</a> <a id="47273" class="Symbol">{</a><a id="47274" class="Argument">a</a> <a id="47276" class="Symbol">=</a> <a id="47278" href="NbE.html#23846" class="InductiveConstructor">ne</a> <a id="47281" href="NbE.html#47281" class="Bound">𝓊̂</a><a id="47283" class="Symbol">}</a> <a id="47285" href="NbE.html#47285" class="Bound">pf</a> <a id="47288" href="NbE.html#47288" class="Bound">Γ′≤Γ</a>
  <a id="47295" class="Keyword">with</a> <a id="47300" href="NbE.html#47281" class="Bound">𝓊̂</a> <a id="47303" href="NbE.html#47259" class="Bound">Γ′</a>           <a id="47316" class="Symbol">|</a> <a id="47318" href="NbE.html#47285" class="Bound">pf</a> <a id="47321" href="NbE.html#47288" class="Bound">Γ′≤Γ</a>
<a id="47326" class="Symbol">...</a> <a id="47330" class="Symbol">|</a> <a id="47332" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="47337" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="47339" href="NbE.html#47339" class="Bound">𝓊</a> <a id="47341" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="47343" class="Symbol">_</a> <a id="47345" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>  <a id="47348" class="Symbol">|</a> <a id="47350" href="NbE.html#47350" class="Bound">t==𝓊</a>     <a id="47359" class="Symbol">=</a> <a id="47361" href="NbE.html#47350" class="Bound">t==𝓊</a>
</pre>For our inductive step, we prove the implication
for terms of type S → T. Our desired implication
is now:

    Γ′ ⊢ t = ↓ᵀ f Γ′ : T

which, by definition, expands to:

    Γ′ ⊢ t = λx. ↓ᵀ f a (Γ′ , x:S) : T (where a = ↑ᵀ 𝓍̂ˢ Γ′)

We prove this by η expanding t to `λx. t x` and
then using the compatibility rule for abstractions
of definitional equality to simplify our goal to
proving:

    Γ′ , x:S ⊢ t x = ↓ᵀ f a (Γ′, x:S)

Note that our inductive hypothesis is:

    t x Ⓡ f a implies t x = ↓ᵀ f a

This is exactly what we want to show, so now
all we need is to prove that `t x Ⓡ f a`.

Luckily, our given proof holds that t and f
are logically related, which is equivalent
to saying that if `x Ⓡ a` , then `t x Ⓡ f a`,
reducing what we have to prove only to
`x Ⓡ a`. We have been using "a" for simplicity,
but `a = ↑ᵀ 𝓍̂ˢ Γ′`, and we are mutually proving
that `x Ⓡ ↑ᵀ 𝓍̂`, so we use this lemma here
to finish our proof.
<pre class="Agda"><a id="48303" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="48309" class="Symbol">{</a><a id="48310" href="NbE.html#48310" class="Bound">Γ′</a><a id="48312" class="Symbol">}</a> <a id="48314" class="Symbol">{</a><a id="48315" class="Argument">T</a> <a id="48317" class="Symbol">=</a> <a id="48319" href="NbE.html#48319" class="Bound">S</a> <a id="48321" href="NbE.html#1083" class="InductiveConstructor Operator">⇒</a> <a id="48323" class="Symbol">_}</a> <a id="48326" class="Symbol">{</a><a id="48327" href="NbE.html#48327" class="Bound">t</a><a id="48328" class="Symbol">}</a> <a id="48330" class="Symbol">{</a><a id="48331" href="NbE.html#48331" class="Bound">f</a><a id="48332" class="Symbol">}</a> <a id="48334" href="NbE.html#48334" class="Bound">pf</a> <a id="48337" href="NbE.html#48337" class="Bound">Γ′≤Γ</a> <a id="48342" class="Symbol">=</a>
  <a id="48346" href="NbE.html#15061" class="Function Operator">begin</a>
    <a id="48356" href="NbE.html#48337" class="Bound">Γ′≤Γ</a> <a id="48361" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="48364" href="NbE.html#48327" class="Bound">t</a>
  <a id="48368" href="NbE.html#15171" class="Function Operator">==⟨</a> <a id="48372" href="NbE.html#13733" class="InductiveConstructor">η</a> <a id="48374" href="NbE.html#15171" class="Function Operator">⟩</a>
    <a id="48380" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="48382" class="Symbol">(</a><a id="48383" href="NbE.html#48319" class="Bound">S</a> <a id="48385" href="NbE.html#12039" class="Function Operator">↑⊢</a> <a id="48388" href="NbE.html#48337" class="Bound">Γ′≤Γ</a> <a id="48393" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="48396" href="NbE.html#48327" class="Bound">t</a><a id="48397" class="Symbol">)</a> <a id="48399" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="48401" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="48403" href="NbE.html#3705" class="InductiveConstructor">`Z</a>
  <a id="48408" href="NbE.html#15171" class="Function Operator">==⟨</a>
    <a id="48416" href="NbE.html#14072" class="InductiveConstructor">abs-compatible</a> <a id="48431" class="Symbol">(</a>
      <a id="48439" href="NbE.html#15061" class="Function Operator">begin</a>
        <a id="48453" class="Symbol">(</a><a id="48454" href="NbE.html#48319" class="Bound">S</a> <a id="48456" href="NbE.html#12039" class="Function Operator">↑⊢</a> <a id="48459" href="NbE.html#48337" class="Bound">Γ′≤Γ</a> <a id="48464" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="48467" href="NbE.html#48327" class="Bound">t</a><a id="48468" class="Symbol">)</a> <a id="48470" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="48472" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="48474" href="NbE.html#3705" class="InductiveConstructor">`Z</a>
      <a id="48483" href="NbE.html#15171" class="Function Operator">==⟨</a> <a id="48487" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="48502" href="NbE.html#48695" class="Function">subst-lemma</a> <a id="48514" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="48519" href="NbE.html#15171" class="Function Operator">⟩</a>
        <a id="48529" class="Symbol">(</a><a id="48530" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="48536" href="NbE.html#48337" class="Bound">Γ′≤Γ</a> <a id="48541" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="48544" href="NbE.html#48327" class="Bound">t</a><a id="48545" class="Symbol">)</a> <a id="48547" href="NbE.html#10528" class="Function Operator">[</a> <a id="48549" href="NbE.html#11739" class="Function">subst-id</a> <a id="48558" href="NbE.html#10528" class="Function Operator">]</a> <a id="48560" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="48562" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="48564" href="NbE.html#3705" class="InductiveConstructor">`Z</a>
      <a id="48573" href="NbE.html#15171" class="Function Operator">==⟨</a> <a id="48577" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="48583" class="Symbol">(</a><a id="48584" href="NbE.html#48334" class="Bound">pf</a> <a id="48587" class="Symbol">(</a><a id="48588" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="48594" href="NbE.html#48337" class="Bound">Γ′≤Γ</a><a id="48598" class="Symbol">)</a> <a id="48600" href="NbE.html#48814" class="Function">xⓇa</a><a id="48603" class="Symbol">)</a> <a id="48605" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="48610" href="NbE.html#15171" class="Function Operator">⟩</a>
        <a id="48620" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="48626" class="Symbol">(</a><a id="48627" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="48630" class="Symbol">(</a><a id="48631" href="NbE.html#48331" class="Bound">f</a> <a id="48633" href="NbE.html#48789" class="Function">a</a><a id="48634" class="Symbol">)</a> <a id="48636" class="Symbol">(</a><a id="48637" href="NbE.html#48310" class="Bound">Γ′</a> <a id="48640" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="48642" href="NbE.html#48319" class="Bound">S</a><a id="48643" class="Symbol">))</a>
      <a id="48652" href="NbE.html#15344" class="Function Operator">∎</a>
  <a id="48656" class="Symbol">)</a><a id="48657" href="NbE.html#15171" class="Function Operator">⟩</a>
    <a id="48663" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="48669" class="Symbol">(</a><a id="48670" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="48673" href="NbE.html#48331" class="Bound">f</a> <a id="48675" href="NbE.html#48310" class="Bound">Γ′</a><a id="48677" class="Symbol">)</a>
  <a id="48681" href="NbE.html#15344" class="Function Operator">∎</a>
  <a id="48685" class="Keyword">where</a>
    <a id="48695" href="NbE.html#48695" class="Function">subst-lemma</a> <a id="48707" class="Symbol">=</a>
      <a id="48715" href="NbE.html#30660" class="Function">≡→==</a> <a id="48720" class="Symbol">(</a><a id="48721" href="NbE.html#766" class="Function">≡-trans</a> <a id="48729" class="Symbol">(</a><a id="48730" href="NbE.html#36667" class="Function">incr-↑-≡</a> <a id="48739" class="Symbol">{</a><a id="48740" class="Argument">Γ′≤Γ</a> <a id="48745" class="Symbol">=</a> <a id="48747" href="NbE.html#48337" class="Bound">Γ′≤Γ</a><a id="48751" class="Symbol">}</a> <a id="48753" class="Symbol">{</a><a id="48754" class="Argument">t</a> <a id="48756" class="Symbol">=</a> <a id="48758" href="NbE.html#48327" class="Bound">t</a><a id="48759" class="Symbol">})</a> <a id="48762" class="Symbol">(</a><a id="48763" href="NbE.html#750" class="Function">≡-sym</a> <a id="48769" href="NbE.html#34900" class="Function">[id]-identity</a><a id="48782" class="Symbol">))</a>
    <a id="48789" href="NbE.html#48789" class="Function">a</a> <a id="48791" class="Symbol">=</a> <a id="48793" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="48796" class="Symbol">{</a><a id="48797" href="NbE.html#48319" class="Bound">S</a><a id="48798" class="Symbol">}</a> <a id="48800" class="Symbol">(</a><a id="48801" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="48804" href="NbE.html#48319" class="Bound">S</a> <a id="48806" href="NbE.html#48310" class="Bound">Γ′</a><a id="48808" class="Symbol">)</a>
    <a id="48814" href="NbE.html#48814" class="Function">xⓇa</a> <a id="48818" class="Symbol">=</a> <a id="48820" href="NbE.html#43565" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="48827" class="Symbol">{</a><a id="48828" href="NbE.html#48310" class="Bound">Γ′</a><a id="48830" class="Symbol">}</a> <a id="48832" class="Symbol">{</a><a id="48833" href="NbE.html#48319" class="Bound">S</a><a id="48834" class="Symbol">}</a>
</pre>
Using our first implication, we can quickly
prove that `Γ , x:T ⊢ x : T Ⓡ ↑ᵀ 𝓍̂`, as `Γ′ ⊢ x = 𝓍̂ Γ′ : T` for all
`Γ′ ≤ Γ , x:T`
<pre class="Agda"><a id="48978" href="NbE.html#43565" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="48985" class="Symbol">{_}</a> <a id="48989" class="Symbol">{</a><a id="48990" href="NbE.html#48990" class="Bound">T</a><a id="48991" class="Symbol">}</a> <a id="48993" class="Symbol">=</a> <a id="48995" href="NbE.html#42958" class="Function">==↑-Ⓡ</a> <a id="49001" href="NbE.html#49015" class="Function">x==𝓍̂</a> <a id="49007" class="Keyword">where</a>
  <a id="49015" href="NbE.html#49015" class="Function">x==𝓍̂</a> <a id="49021" class="Symbol">:</a> <a id="49023" class="Symbol">∀</a> <a id="49025" class="Symbol">{</a><a id="49026" href="NbE.html#49026" class="Bound">Γ</a> <a id="49028" href="NbE.html#49028" class="Bound">Γ′</a> <a id="49031" class="Symbol">:</a> <a id="49033" href="NbE.html#1943" class="Datatype">Ctx</a><a id="49036" class="Symbol">}</a>
       <a id="49045" class="Symbol">→</a> <a id="49047" class="Symbol">(</a><a id="49048" href="NbE.html#49048" class="Bound">Γ′≤Γ,T</a> <a id="49055" class="Symbol">:</a> <a id="49057" href="NbE.html#49028" class="Bound">Γ′</a> <a id="49060" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="49062" class="Symbol">(</a><a id="49063" href="NbE.html#49026" class="Bound">Γ</a> <a id="49065" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="49067" href="NbE.html#48990" class="Bound">T</a><a id="49068" class="Symbol">))</a>
       <a id="49078" class="Symbol">→</a> <a id="49080" href="NbE.html#49048" class="Bound">Γ′≤Γ,T</a> <a id="49087" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="49090" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="49092" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="49095" href="NbE.html#37949" class="Function Operator">==↑</a> <a id="49099" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="49102" href="NbE.html#48990" class="Bound">T</a> <a id="49104" href="NbE.html#49026" class="Bound">Γ</a>
  <a id="49108" href="NbE.html#49015" class="Function">x==𝓍̂</a> <a id="49114" class="Symbol">{</a><a id="49115" href="NbE.html#49115" class="Bound">Γ</a><a id="49116" class="Symbol">}</a> <a id="49118" class="Symbol">{</a><a id="49119" href="NbE.html#49119" class="Bound">Γ′</a><a id="49121" class="Symbol">}</a> <a id="49123" href="NbE.html#49123" class="Bound">pf</a>
    <a id="49130" class="Keyword">with</a> <a id="49135" href="NbE.html#49119" class="Bound">Γ′</a> <a id="49138" href="NbE.html#3153" class="Function Operator">≤?</a> <a id="49141" class="Symbol">(</a><a id="49142" href="NbE.html#49115" class="Bound">Γ</a> <a id="49144" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="49146" href="NbE.html#48990" class="Bound">T</a><a id="49147" class="Symbol">)</a>
  <a id="49151" class="Symbol">...</a> <a id="49155" class="Symbol">|</a> <a id="49157" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="49160" href="NbE.html#49160" class="Bound">¬pf</a> <a id="49164" class="Symbol">=</a> <a id="49166" href="NbE.html#49160" class="Bound">¬pf</a> <a id="49170" class="Bound">pf</a>
  <a id="49175" class="Symbol">...</a> <a id="49179" class="Symbol">|</a> <a id="49181" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="49185" href="NbE.html#49185" class="Bound">pf′</a>
    <a id="49193" class="Keyword">with</a> <a id="49198" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="49201" href="NbE.html#48990" class="Bound">T</a> <a id="49203" class="Bound">Γ</a> <a id="49205" class="Symbol">|</a> <a id="49207" href="NbE.html#32011" class="Function">≤-pf-irrelevance</a> <a id="49224" class="Bound">pf</a> <a id="49227" href="NbE.html#49185" class="Bound">pf′</a>
  <a id="49233" class="Symbol">...</a> <a id="49237" class="Symbol">|</a> <a id="49239" class="Symbol">_</a>      <a id="49246" class="Symbol">|</a> <a id="49248" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
    <a id="49257" class="Keyword">with</a> <a id="49262" href="NbE.html#9583" class="Function">ren-≤</a> <a id="49268" class="Bound">pf′</a>
  <a id="49274" class="Symbol">...|</a> <a id="49279" class="Symbol">_</a> <a id="49281" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="49283" class="Symbol">_</a>  <a id="49286" class="Symbol">=</a> <a id="49288" href="NbE.html#14488" class="InductiveConstructor">refl</a>
</pre>
Before moving forward, we also want to show that rec Ⓡ ⟦rec⟧.
This will be necessary for proving soundness, as we will need
proof that `Γ ⊢ rec = ↓ᵀ ⟦rec⟧ Γ : (T ⇒ (nat ⇒ T ⇒ T) ⇒ nat ⇒ T)`
(i.e. proof that our interpretation of rec is sound) to prove the
soundness of NbE
<pre class="Agda"><a id="recⓇ⟦rec⟧"></a><a id="49579" href="NbE.html#49579" class="Function">recⓇ⟦rec⟧</a> <a id="49589" class="Symbol">:</a> <a id="49591" class="Symbol">∀</a> <a id="49593" class="Symbol">{</a><a id="49594" href="NbE.html#49594" class="Bound">Γ</a> <a id="49596" class="Symbol">:</a> <a id="49598" href="NbE.html#1943" class="Datatype">Ctx</a><a id="49601" class="Symbol">}</a> <a id="49603" class="Symbol">{</a><a id="49604" href="NbE.html#49604" class="Bound">T</a> <a id="49606" class="Symbol">:</a> <a id="49608" href="NbE.html#1051" class="Datatype">Type</a><a id="49612" class="Symbol">}</a> <a id="49614" class="Symbol">→</a> <a id="49616" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="49620" class="Symbol">{</a><a id="49621" href="NbE.html#49594" class="Bound">Γ</a><a id="49622" class="Symbol">}</a> <a id="49624" class="Symbol">{</a><a id="49625" href="NbE.html#49604" class="Bound">T</a><a id="49626" class="Symbol">}</a> <a id="49628" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="49630" href="NbE.html#27745" class="Function">⟦rec⟧</a>
<a id="49636" href="NbE.html#49579" class="Function">recⓇ⟦rec⟧</a> <a id="49646" href="NbE.html#49646" class="Bound">Γ′≤Γ</a> <a id="49651" class="Symbol">{</a><a id="49652" href="NbE.html#49652" class="Bound">z</a><a id="49653" class="Symbol">}</a> <a id="49655" href="NbE.html#49655" class="Bound">pf</a> <a id="49658" href="NbE.html#49658" class="Bound">Γ″≤Γ′</a> <a id="49664" href="NbE.html#49664" class="Bound">pf′</a> <a id="49668" href="NbE.html#49668" class="Bound">Γ‴≤Γ″</a> <a id="49674" class="Symbol">{</a><a id="49675" class="Argument">s</a> <a id="49677" class="Symbol">=</a> <a id="49679" href="NbE.html#49679" class="Bound">n</a><a id="49680" class="Symbol">}</a> <a id="49682" class="Symbol">{</a><a id="49683" href="NbE.html#23818" class="InductiveConstructor">zero</a><a id="49687" class="Symbol">}</a> <a id="49689" href="NbE.html#49689" class="Bound">pf″</a>
  <a id="49695" class="Keyword">with</a> <a id="49700" href="NbE.html#49689" class="Bound">pf″</a> <a id="49704" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
<a id="49709" class="Symbol">...</a> <a id="49713" class="Symbol">|</a> <a id="49715" href="NbE.html#49715" class="Bound">n==zero</a>
  <a id="49725" class="Keyword">rewrite</a> <a id="49733" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="49747" class="Symbol">{</a><a id="49748" class="Argument">t</a> <a id="49750" class="Symbol">=</a> <a id="49752" class="Bound">n</a><a id="49753" class="Symbol">}</a> <a id="49755" class="Symbol">=</a>
  <a id="49759" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="49770" class="Symbol">(</a><a id="49771" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="49786" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="49791" class="Symbol">(</a><a id="49792" href="NbE.html#14569" class="InductiveConstructor">sym</a> <a id="49796" href="NbE.html#49715" class="Bound">n==zero</a><a id="49803" class="Symbol">))</a>
    <a id="49810" class="Symbol">(</a><a id="49811" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="49822" class="Symbol">(</a><a id="49823" href="NbE.html#14569" class="InductiveConstructor">sym</a> <a id="49827" href="NbE.html#13128" class="InductiveConstructor">β-rec-z</a><a id="49834" class="Symbol">)</a> <a id="49836" href="NbE.html#49955" class="Function">zⓇa</a><a id="49839" class="Symbol">)</a>
    <a id="49845" class="Keyword">where</a>
      <a id="49857" href="NbE.html#49857" class="Function">Γ‴≤Γ′</a> <a id="49863" class="Symbol">=</a> <a id="49865" href="NbE.html#32369" class="Function">≤-trans</a> <a id="49873" class="Bound">Γ‴≤Γ″</a> <a id="49879" class="Bound">Γ″≤Γ′</a>
      <a id="49891" href="NbE.html#49891" class="Function">subst-lemma</a> <a id="49903" class="Symbol">=</a> <a id="49905" href="NbE.html#30660" class="Function">≡→==</a> <a id="49910" class="Symbol">(</a><a id="49911" href="NbE.html#750" class="Function">≡-sym</a> <a id="49917" class="Symbol">(</a><a id="49918" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="49933" class="Bound">Γ‴≤Γ″</a> <a id="49939" class="Bound">Γ″≤Γ′</a> <a id="49945" class="Bound">z</a><a id="49946" class="Symbol">))</a>
      <a id="49955" href="NbE.html#49955" class="Function">zⓇa</a> <a id="49959" class="Symbol">=</a> <a id="49961" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="49972" href="NbE.html#49891" class="Function">subst-lemma</a> <a id="49984" class="Symbol">(</a><a id="49985" href="NbE.html#41783" class="Function">Ⓡ-weaken</a> <a id="49994" class="Symbol">{</a><a id="49995" class="Argument">Γ′≤Γ</a> <a id="50000" class="Symbol">=</a> <a id="50002" href="NbE.html#49857" class="Function">Γ‴≤Γ′</a><a id="50007" class="Symbol">}</a> <a id="50009" class="Bound">pf</a><a id="50011" class="Symbol">)</a>

<a id="50014" href="NbE.html#49579" class="Function">recⓇ⟦rec⟧</a> <a id="50024" href="NbE.html#50024" class="Bound">Γ′≤Γ</a> <a id="50029" class="Symbol">{</a><a id="50030" href="NbE.html#50030" class="Bound">z</a><a id="50031" class="Symbol">}</a> <a id="50033" class="Symbol">{</a><a id="50034" href="NbE.html#50034" class="Bound">az</a><a id="50036" class="Symbol">}</a> <a id="50038" href="NbE.html#50038" class="Bound">pf</a> <a id="50041" href="NbE.html#50041" class="Bound">Γ″≤Γ′</a> <a id="50047" class="Symbol">{</a><a id="50048" href="NbE.html#50048" class="Bound">s</a><a id="50049" class="Symbol">}</a> <a id="50051" class="Symbol">{</a><a id="50052" href="NbE.html#50052" class="Bound">aₛ</a><a id="50054" class="Symbol">}</a> <a id="50056" href="NbE.html#50056" class="Bound">pf′</a> <a id="50060" href="NbE.html#50060" class="Bound">Γ‴≤Γ″</a> <a id="50066" class="Symbol">{</a><a id="50067" href="NbE.html#50067" class="Bound">m</a><a id="50068" class="Symbol">}</a> <a id="50070" class="Symbol">{</a><a id="50071" href="NbE.html#23830" class="InductiveConstructor">suc</a> <a id="50075" href="NbE.html#50075" class="Bound">aₙ</a><a id="50077" class="Symbol">}</a> <a id="50079" href="NbE.html#50079" class="Bound">pf″</a>
  <a id="50085" class="Keyword">with</a> <a id="50090" href="NbE.html#50079" class="Bound">pf″</a> <a id="50094" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
<a id="50099" class="Symbol">...</a> <a id="50103" class="Symbol">|</a> <a id="50105" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="50107" href="NbE.html#50107" class="Bound">n</a> <a id="50109" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="50111" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="50113" href="NbE.html#50113" class="Bound">m==saₙ</a> <a id="50120" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="50122" href="NbE.html#50122" class="Bound">nⓇaₙ</a> <a id="50127" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="50129" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
  <a id="50133" class="Keyword">rewrite</a> <a id="50141" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="50155" class="Symbol">{</a><a id="50156" class="Argument">t</a> <a id="50158" class="Symbol">=</a> <a id="50160" class="Bound">m</a><a id="50161" class="Symbol">}</a> <a id="50163" class="Symbol">=</a>
    <a id="50169" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="50180" class="Symbol">(</a><a id="50181" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a> <a id="50196" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="50201" class="Symbol">(</a><a id="50202" href="NbE.html#14569" class="InductiveConstructor">sym</a> <a id="50206" href="NbE.html#50113" class="Bound">m==saₙ</a><a id="50212" class="Symbol">))</a>
      <a id="50221" class="Symbol">(</a><a id="50222" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="50233" class="Symbol">(</a><a id="50234" href="NbE.html#14569" class="InductiveConstructor">sym</a> <a id="50238" href="NbE.html#13302" class="InductiveConstructor">β-rec-s</a><a id="50245" class="Symbol">)</a> <a id="50247" href="NbE.html#50533" class="Function">s·n·recⓇaₛ·aₙ·⟦rec⟧</a><a id="50266" class="Symbol">)</a>
  <a id="50270" class="Keyword">where</a>
    <a id="50280" href="NbE.html#50280" class="Function">subst-lemma₁</a> <a id="50293" class="Symbol">=</a> <a id="50295" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="50309" class="Symbol">{</a><a id="50310" class="Argument">t</a> <a id="50312" class="Symbol">=</a> <a id="50314" class="Bound">Γ‴≤Γ″</a> <a id="50320" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="50323" class="Bound">s</a><a id="50324" class="Symbol">}</a>
    <a id="50330" href="NbE.html#50330" class="Function">subst-lemma₂</a> <a id="50343" class="Symbol">=</a> <a id="50345" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="50359" class="Symbol">{</a><a id="50360" class="Argument">t</a> <a id="50362" class="Symbol">=</a> <a id="50364" href="NbE.html#50107" class="Bound">n</a><a id="50365" class="Symbol">}</a>

    <a id="50372" href="NbE.html#50372" class="Function">rec·z·s·n</a> <a id="50382" class="Symbol">=</a> <a id="50384" class="Symbol">(</a><a id="50385" class="Bound">Γ‴≤Γ″</a> <a id="50391" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="50394" class="Symbol">(</a><a id="50395" class="Bound">Γ″≤Γ′</a> <a id="50401" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="50404" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="50408" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="50410" class="Bound">z</a><a id="50411" class="Symbol">)</a> <a id="50413" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="50415" class="Bound">s</a><a id="50416" class="Symbol">)</a> <a id="50418" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="50420" href="NbE.html#50107" class="Bound">n</a>

    <a id="50427" href="NbE.html#50427" class="Function">ih</a> <a id="50430" class="Symbol">:</a> <a id="50432" href="NbE.html#50372" class="Function">rec·z·s·n</a> <a id="50442" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="50444" href="NbE.html#27745" class="Function">⟦rec⟧</a> <a id="50450" class="Bound">az</a> <a id="50453" class="Bound">aₛ</a> <a id="50456" class="Bound">aₙ</a>
    <a id="50463" href="NbE.html#50427" class="Function">ih</a> <a id="50466" class="Symbol">=</a> <a id="50468" href="NbE.html#49579" class="Function">recⓇ⟦rec⟧</a> <a id="50478" class="Bound">Γ′≤Γ</a> <a id="50483" class="Bound">pf</a> <a id="50486" class="Bound">Γ″≤Γ′</a> <a id="50492" class="Symbol">{</a><a id="50493" class="Argument">s</a> <a id="50495" class="Symbol">=</a> <a id="50497" class="Bound">s</a><a id="50498" class="Symbol">}</a> <a id="50500" class="Bound">pf′</a> <a id="50504" class="Bound">Γ‴≤Γ″</a> <a id="50510" class="Symbol">{</a><a id="50511" class="Argument">s</a> <a id="50513" class="Symbol">=</a> <a id="50515" href="NbE.html#50107" class="Bound">n</a><a id="50516" class="Symbol">}</a> <a id="50518" class="Symbol">{</a><a id="50519" class="Bound">aₙ</a><a id="50521" class="Symbol">}</a> <a id="50523" href="NbE.html#50122" class="Bound">nⓇaₙ</a>

    <a id="50533" href="NbE.html#50533" class="Function">s·n·recⓇaₛ·aₙ·⟦rec⟧</a> <a id="50553" class="Symbol">:</a> <a id="50555" class="Symbol">(</a><a id="50556" class="Bound">Γ‴≤Γ″</a> <a id="50562" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="50565" class="Bound">s</a><a id="50566" class="Symbol">)</a> <a id="50568" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="50570" href="NbE.html#50107" class="Bound">n</a> <a id="50572" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="50574" href="NbE.html#50372" class="Function">rec·z·s·n</a> <a id="50584" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="50586" class="Bound">aₛ</a> <a id="50589" class="Bound">aₙ</a> <a id="50592" class="Symbol">(</a><a id="50593" href="NbE.html#27745" class="Function">⟦rec⟧</a> <a id="50599" class="Bound">az</a> <a id="50602" class="Bound">aₛ</a> <a id="50605" class="Bound">aₙ</a><a id="50607" class="Symbol">)</a>
    <a id="50613" href="NbE.html#50533" class="Function">s·n·recⓇaₛ·aₙ·⟦rec⟧</a> <a id="50633" class="Keyword">with</a> <a id="50638" class="Bound">pf′</a> <a id="50642" class="Bound">Γ‴≤Γ″</a> <a id="50648" class="Symbol">{</a><a id="50649" href="NbE.html#50107" class="Bound">n</a><a id="50650" class="Symbol">}</a> <a id="50652" href="NbE.html#50122" class="Bound">nⓇaₙ</a> <a id="50657" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="50662" href="NbE.html#50427" class="Function">ih</a>
    <a id="50669" href="NbE.html#50533" class="Function">...</a> <a id="50673" class="Symbol">|</a> <a id="50675" href="NbE.html#50675" class="Bound">pf</a>
      <a id="50684" class="Keyword">rewrite</a> <a id="50692" href="NbE.html#50280" class="Function">subst-lemma₁</a> <a id="50705" class="Symbol">|</a> <a id="50707" href="NbE.html#50330" class="Function">subst-lemma₂</a> <a id="50720" class="Symbol">=</a> <a id="50722" href="NbE.html#50675" class="Bound">pf</a>

<a id="50726" href="NbE.html#49579" class="Function">recⓇ⟦rec⟧</a> <a id="50736" class="Symbol">{_}</a> <a id="50740" class="Symbol">{</a><a id="50741" href="NbE.html#50741" class="Bound">T</a><a id="50742" class="Symbol">}</a> <a id="50744" href="NbE.html#50744" class="Bound">Γ′≤Γ</a> <a id="50749" class="Symbol">{</a><a id="50750" href="NbE.html#50750" class="Bound">z</a><a id="50751" class="Symbol">}</a> <a id="50753" class="Symbol">{</a><a id="50754" href="NbE.html#50754" class="Bound">az</a><a id="50756" class="Symbol">}</a> <a id="50758" href="NbE.html#50758" class="Bound">pf</a> <a id="50761" href="NbE.html#50761" class="Bound">Γ″≤Γ′</a> <a id="50767" class="Symbol">{</a><a id="50768" href="NbE.html#50768" class="Bound">s</a><a id="50769" class="Symbol">}</a> <a id="50771" class="Symbol">{</a><a id="50772" href="NbE.html#50772" class="Bound">aₛ</a><a id="50774" class="Symbol">}</a> <a id="50776" href="NbE.html#50776" class="Bound">pf′</a> <a id="50780" class="Symbol">{</a><a id="50781" href="NbE.html#50781" class="Bound">Γ‴</a><a id="50783" class="Symbol">}</a> <a id="50785" href="NbE.html#50785" class="Bound">Γ‴≤Γ″</a> <a id="50791" class="Symbol">{</a><a id="50792" href="NbE.html#50792" class="Bound">n</a><a id="50793" class="Symbol">}</a> <a id="50795" class="Symbol">{</a><a id="50796" href="NbE.html#23846" class="InductiveConstructor">ne</a> <a id="50799" href="NbE.html#50799" class="Bound">𝓊̂</a><a id="50801" class="Symbol">}</a> <a id="50803" href="NbE.html#50803" class="Bound">pf″</a> <a id="50807" class="Symbol">=</a>
  <a id="50811" href="NbE.html#42958" class="Function">==↑-Ⓡ</a> <a id="50817" href="NbE.html#50838" class="Function">rec==↑rec↑</a> <a id="50828" class="Keyword">where</a>
    <a id="50838" href="NbE.html#50838" class="Function">rec==↑rec↑</a> <a id="50849" class="Symbol">:</a> <a id="50851" class="Symbol">∀</a> <a id="50853" class="Symbol">{</a><a id="50854" href="NbE.html#50854" class="Bound">Γ⁗</a> <a id="50857" class="Symbol">:</a> <a id="50859" href="NbE.html#1943" class="Datatype">Ctx</a><a id="50862" class="Symbol">}</a>
      <a id="50870" class="Symbol">→</a> <a id="50872" class="Symbol">(</a><a id="50873" href="NbE.html#50873" class="Bound">Γ⁗≤Γ‴</a> <a id="50879" class="Symbol">:</a> <a id="50881" href="NbE.html#50854" class="Bound">Γ⁗</a> <a id="50884" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="50886" href="NbE.html#50781" class="Bound">Γ‴</a><a id="50888" class="Symbol">)</a>
      <a id="50896" class="Symbol">→</a> <a id="50898" href="NbE.html#50873" class="Bound">Γ⁗≤Γ‴</a> <a id="50904" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="50907" class="Symbol">(</a><a id="50908" href="NbE.html#50785" class="Bound">Γ‴≤Γ″</a> <a id="50914" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="50917" class="Symbol">(</a><a id="50918" href="NbE.html#50761" class="Bound">Γ″≤Γ′</a> <a id="50924" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="50927" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="50931" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="50933" href="NbE.html#50750" class="Bound">z</a><a id="50934" class="Symbol">)</a> <a id="50936" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="50938" href="NbE.html#50768" class="Bound">s</a><a id="50939" class="Symbol">)</a> <a id="50941" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="50943" href="NbE.html#50792" class="Bound">n</a> <a id="50945" href="NbE.html#37949" class="Function Operator">==↑</a> <a id="50949" href="NbE.html#27481" class="Function">rec↑</a> <a id="50954" class="Symbol">(</a><a id="50955" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="50958" href="NbE.html#50754" class="Bound">az</a><a id="50960" class="Symbol">)</a> <a id="50962" class="Symbol">(</a><a id="50963" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="50966" href="NbE.html#50772" class="Bound">aₛ</a><a id="50968" class="Symbol">)</a> <a id="50970" href="NbE.html#50799" class="Bound">𝓊̂</a>
    <a id="50977" href="NbE.html#50838" class="Function">rec==↑rec↑</a> <a id="50988" class="Symbol">{</a><a id="50989" href="NbE.html#50989" class="Bound">Γ⁗</a><a id="50991" class="Symbol">}</a> <a id="50993" href="NbE.html#50993" class="Bound">Γ⁗≤Γ‴</a>
      <a id="51005" class="Keyword">with</a> <a id="51010" href="NbE.html#50799" class="Bound">𝓊̂</a> <a id="51013" href="NbE.html#50989" class="Bound">Γ⁗</a>          <a id="51025" class="Symbol">|</a> <a id="51027" href="NbE.html#50803" class="Bound">pf″</a> <a id="51031" href="NbE.html#50993" class="Bound">Γ⁗≤Γ‴</a>
    <a id="51041" class="Symbol">...</a> <a id="51045" class="Symbol">|</a> <a id="51047" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="51052" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="51054" class="Symbol">_</a> <a id="51056" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="51058" class="Symbol">_</a> <a id="51060" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="51062" class="Symbol">|</a> <a id="51064" href="NbE.html#51064" class="Bound">n==𝓊</a> <a id="51069" class="Symbol">=</a>
      <a id="51077" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a>
        <a id="51100" class="Symbol">(</a><a id="51101" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a>
          <a id="51126" class="Symbol">(</a><a id="51127" href="NbE.html#14231" class="InductiveConstructor">app-compatible</a>
            <a id="51154" href="NbE.html#14488" class="InductiveConstructor">refl</a>
            <a id="51171" class="Symbol">(</a><a id="51172" href="NbE.html#52516" class="Function">z==↓ᵀaz</a><a id="51179" class="Symbol">))</a>
          <a id="51192" class="Symbol">(</a><a id="51193" href="NbE.html#14670" class="InductiveConstructor">trans</a>
            <a id="51211" href="NbE.html#13733" class="InductiveConstructor">η</a>
            <a id="51225" class="Symbol">(</a><a id="51226" href="NbE.html#14072" class="InductiveConstructor">abs-compatible</a>
              <a id="51255" class="Symbol">(</a><a id="51256" href="NbE.html#14670" class="InductiveConstructor">trans</a>
                <a id="51278" href="NbE.html#13733" class="InductiveConstructor">η</a>
                <a id="51296" class="Symbol">(</a><a id="51297" href="NbE.html#14072" class="InductiveConstructor">abs-compatible</a>  <a id="51313" href="NbE.html#52018" class="Function">s·x₁·x₂==↓ᵀas·↑ᵀ𝓍̂₁·↑ᵀ𝓍̂₂</a><a id="51338" class="Symbol">)))))</a>
      <a id="51350" href="NbE.html#51064" class="Bound">n==𝓊</a>
      <a id="51361" class="Keyword">where</a>
        <a id="51375" href="NbE.html#51375" class="Function">Γ‴≤Γ′</a> <a id="51381" class="Symbol">=</a> <a id="51383" href="NbE.html#32369" class="Function">≤-trans</a> <a id="51391" href="NbE.html#50785" class="Bound">Γ‴≤Γ″</a> <a id="51397" href="NbE.html#50761" class="Bound">Γ″≤Γ′</a>
        <a id="51411" href="NbE.html#51411" class="Function">Γ⁗≤Γ″</a> <a id="51417" class="Symbol">=</a> <a id="51419" href="NbE.html#32369" class="Function">≤-trans</a> <a id="51427" class="Bound">Γ⁗≤Γ‴</a> <a id="51433" href="NbE.html#50785" class="Bound">Γ‴≤Γ″</a>
        <a id="51447" href="NbE.html#51447" class="Function">Γ⁗,nat≤Γ⁗</a> <a id="51457" class="Symbol">=</a> <a id="51459" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="51465" class="Symbol">{</a><a id="51466" class="Argument">T</a> <a id="51468" class="Symbol">=</a> <a id="51470" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="51473" class="Symbol">}</a> <a id="51475" href="NbE.html#51411" class="Function">Γ⁗≤Γ″</a>
        <a id="51489" href="NbE.html#51489" class="Function">Γ⁗,nat,T≤Γ⁗</a> <a id="51501" class="Symbol">=</a> <a id="51503" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="51509" class="Symbol">{</a><a id="51510" class="Argument">T</a> <a id="51512" class="Symbol">=</a> <a id="51514" href="NbE.html#50741" class="Bound">T</a><a id="51515" class="Symbol">}</a> <a id="51517" href="NbE.html#51447" class="Function">Γ⁗,nat≤Γ⁗</a>
        <a id="51535" href="NbE.html#51535" class="Function">Γ⁗,nat,T≤Γ⁗,nat</a> <a id="51551" class="Symbol">=</a> <a id="51553" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="51559" class="Symbol">{</a><a id="51560" class="Argument">T</a> <a id="51562" class="Symbol">=</a> <a id="51564" href="NbE.html#50741" class="Bound">T</a><a id="51565" class="Symbol">}</a> <a id="51567" class="Symbol">(</a><a id="51568" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="51573" class="Symbol">{</a><a id="51574" class="Bound">Γ⁗</a> <a id="51577" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="51579" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="51582" class="Symbol">})</a>

        <a id="51594" href="NbE.html#51594" class="Function">subst-lemma₁</a> <a id="51607" class="Symbol">=</a> <a id="51609" href="NbE.html#750" class="Function">≡-sym</a> <a id="51615" class="Symbol">(</a><a id="51616" href="NbE.html#36667" class="Function">incr-↑-≡</a> <a id="51625" class="Symbol">{</a><a id="51626" class="Argument">Γ′≤Γ</a> <a id="51631" class="Symbol">=</a> <a id="51633" href="NbE.html#51411" class="Function">Γ⁗≤Γ″</a><a id="51638" class="Symbol">}</a> <a id="51640" class="Symbol">{</a><a id="51641" class="Argument">S</a> <a id="51643" class="Symbol">=</a> <a id="51645" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="51648" class="Symbol">}</a> <a id="51650" class="Symbol">{</a><a id="51651" class="Argument">t</a> <a id="51653" class="Symbol">=</a> <a id="51655" href="NbE.html#50768" class="Bound">s</a><a id="51656" class="Symbol">})</a>
        <a id="51667" href="NbE.html#51667" class="Function">subst-lemma₂</a> <a id="51680" class="Symbol">=</a>
          <a id="51692" href="NbE.html#750" class="Function">≡-sym</a> <a id="51698" class="Symbol">(</a><a id="51699" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="51714" class="Bound">Γ⁗≤Γ‴</a> <a id="51720" href="NbE.html#50785" class="Bound">Γ‴≤Γ″</a> <a id="51726" href="NbE.html#50768" class="Bound">s</a><a id="51727" class="Symbol">)</a>
        <a id="51737" href="NbE.html#51737" class="Function">subst-lemma₃</a> <a id="51750" class="Symbol">=</a> <a id="51752" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="51766" class="Symbol">{</a><a id="51767" class="Argument">t</a> <a id="51769" class="Symbol">=</a> <a id="51771" href="NbE.html#50741" class="Bound">T</a> <a id="51773" href="NbE.html#12039" class="Function Operator">↑⊢</a> <a id="51776" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="51780" href="NbE.html#12039" class="Function Operator">↑⊢</a> <a id="51783" class="Bound">Γ⁗≤Γ‴</a> <a id="51789" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="51792" href="NbE.html#50785" class="Bound">Γ‴≤Γ″</a> <a id="51798" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="51801" href="NbE.html#50768" class="Bound">s</a><a id="51802" class="Symbol">}</a>

        <a id="51813" href="NbE.html#51813" class="Function">𝓍̂₁</a> <a id="51817" class="Symbol">=</a> <a id="51819" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="51822" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="51826" class="Bound">Γ⁗</a>
        <a id="51837" href="NbE.html#51837" class="Function">𝓍̂₂</a> <a id="51841" class="Symbol">=</a> <a id="51843" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="51846" href="NbE.html#50741" class="Bound">T</a> <a id="51848" class="Symbol">(</a><a id="51849" class="Bound">Γ⁗</a> <a id="51852" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="51854" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="51857" class="Symbol">)</a>

        <a id="51868" href="NbE.html#51868" class="Function">s·x₁·x₂Ⓡaₛ·↑ᵀ𝓍̂₁↑ᵀ𝓍̂₂</a> <a id="51890" class="Symbol">=</a>
          <a id="51902" href="NbE.html#50776" class="Bound">pf′</a> <a id="51906" href="NbE.html#51447" class="Function">Γ⁗,nat≤Γ⁗</a> <a id="51916" class="Symbol">{</a><a id="51917" class="Argument">s</a> <a id="51919" class="Symbol">=</a> <a id="51921" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="51923" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="51925" class="Symbol">}</a> <a id="51927" class="Symbol">{</a><a id="51928" class="Argument">a</a> <a id="51930" class="Symbol">=</a> <a id="51932" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="51935" class="Symbol">{</a><a id="51936" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="51939" class="Symbol">}</a> <a id="51941" class="Symbol">(</a><a id="51942" href="NbE.html#26236" class="Function">𝓍̂</a> <a id="51945" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="51949" class="Bound">Γ⁗</a><a id="51951" class="Symbol">)}</a> <a id="51954" class="Symbol">(</a><a id="51955" href="NbE.html#43565" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="51962" class="Symbol">{</a><a id="51963" class="Bound">Γ⁗</a><a id="51965" class="Symbol">}</a> <a id="51967" class="Symbol">{</a><a id="51968" href="NbE.html#1070" class="InductiveConstructor">nat</a><a id="51971" class="Symbol">})</a>
            <a id="51986" href="NbE.html#51535" class="Function">Γ⁗,nat,T≤Γ⁗,nat</a> <a id="52002" href="NbE.html#43565" class="Function">xⓇ↑ᵀ𝓍̂</a>

        <a id="52018" href="NbE.html#52018" class="Function">s·x₁·x₂==↓ᵀas·↑ᵀ𝓍̂₁·↑ᵀ𝓍̂₂</a> <a id="52044" class="Symbol">:</a>
          <a id="52056" class="Symbol">(</a><a id="52057" href="NbE.html#50741" class="Bound">T</a> <a id="52059" href="NbE.html#12039" class="Function Operator">↑⊢</a> <a id="52062" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="52066" href="NbE.html#12039" class="Function Operator">↑⊢</a> <a id="52069" class="Bound">Γ⁗≤Γ‴</a> <a id="52075" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="52078" href="NbE.html#50785" class="Bound">Γ‴≤Γ″</a> <a id="52084" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="52087" href="NbE.html#50768" class="Bound">s</a><a id="52088" class="Symbol">)</a> <a id="52090" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="52092" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="52094" class="Symbol">(</a><a id="52095" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="52098" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="52100" class="Symbol">)</a> <a id="52102" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="52104" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="52106" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="52109" href="NbE.html#13044" class="Datatype Operator">==</a>
            <a id="52124" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="52130" class="Symbol">(</a><a id="52131" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="52134" class="Symbol">(</a><a id="52135" href="NbE.html#50772" class="Bound">aₛ</a> <a id="52138" class="Symbol">(</a><a id="52139" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="52142" href="NbE.html#51813" class="Function">𝓍̂₁</a><a id="52145" class="Symbol">)</a> <a id="52147" class="Symbol">(</a><a id="52148" href="NbE.html#24275" class="Function">↑ᵀ</a> <a id="52151" href="NbE.html#51837" class="Function">𝓍̂₂</a><a id="52154" class="Symbol">))</a> <a id="52157" class="Symbol">(</a><a id="52158" class="Bound">Γ⁗</a> <a id="52161" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="52163" href="NbE.html#1070" class="InductiveConstructor">nat</a> <a id="52167" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="52169" href="NbE.html#50741" class="Bound">T</a><a id="52170" class="Symbol">))</a>
        <a id="52181" href="NbE.html#52018" class="Function">s·x₁·x₂==↓ᵀas·↑ᵀ𝓍̂₁·↑ᵀ𝓍̂₂</a>
          <a id="52217" class="Keyword">with</a> <a id="52222" href="NbE.html#51868" class="Function">s·x₁·x₂Ⓡaₛ·↑ᵀ𝓍̂₁↑ᵀ𝓍̂₂</a>
        <a id="52252" href="NbE.html#52018" class="Function">...</a> <a id="52256" class="Symbol">|</a> <a id="52258" href="NbE.html#52258" class="Bound">pf-Ⓡ</a>
          <a id="52273" class="Keyword">with</a> <a id="52278" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="52284" href="NbE.html#52258" class="Bound">pf-Ⓡ</a> <a id="52289" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
        <a id="52302" class="Symbol">...</a> <a id="52306" class="Symbol">|</a> <a id="52308" href="NbE.html#52308" class="Bound">pf-==↓</a>
          <a id="52325" class="Keyword">rewrite</a> <a id="52333" href="NbE.html#51594" class="Function">subst-lemma₁</a> <a id="52346" class="Symbol">|</a> <a id="52348" href="NbE.html#51667" class="Function">subst-lemma₂</a> <a id="52361" class="Symbol">|</a> <a id="52363" href="NbE.html#51737" class="Function">subst-lemma₃</a> <a id="52376" class="Symbol">=</a> <a id="52378" href="NbE.html#52308" class="Bound">pf-==↓</a>

        <a id="52394" href="NbE.html#52394" class="Function">subst-lemma₄</a> <a id="52407" class="Symbol">=</a> <a id="52409" href="NbE.html#750" class="Function">≡-sym</a> <a id="52415" class="Symbol">(</a><a id="52416" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="52431" class="Bound">Γ⁗≤Γ‴</a> <a id="52437" href="NbE.html#51375" class="Function">Γ‴≤Γ′</a> <a id="52443" href="NbE.html#50750" class="Bound">z</a><a id="52444" class="Symbol">)</a>
        <a id="52454" href="NbE.html#52454" class="Function">subst-lemma₅</a>  <a id="52468" class="Symbol">=</a> <a id="52470" href="NbE.html#750" class="Function">≡-sym</a> <a id="52476" class="Symbol">(</a><a id="52477" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="52492" href="NbE.html#50785" class="Bound">Γ‴≤Γ″</a> <a id="52498" href="NbE.html#50761" class="Bound">Γ″≤Γ′</a> <a id="52504" href="NbE.html#50750" class="Bound">z</a><a id="52505" class="Symbol">)</a>

        <a id="52516" href="NbE.html#52516" class="Function">z==↓ᵀaz</a> <a id="52524" class="Symbol">:</a> <a id="52526" class="Bound">Γ⁗≤Γ‴</a> <a id="52532" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="52535" href="NbE.html#50785" class="Bound">Γ‴≤Γ″</a> <a id="52541" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="52544" href="NbE.html#50761" class="Bound">Γ″≤Γ′</a> <a id="52550" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="52553" href="NbE.html#50750" class="Bound">z</a> <a id="52555" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="52558" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a> <a id="52564" class="Symbol">(</a><a id="52565" href="NbE.html#24381" class="Function">↓ᵀ</a> <a id="52568" href="NbE.html#50754" class="Bound">az</a> <a id="52571" class="Bound">Γ⁗</a><a id="52573" class="Symbol">)</a>
        <a id="52583" href="NbE.html#52516" class="Function">z==↓ᵀaz</a>
          <a id="52601" class="Keyword">with</a> <a id="52606" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="52612" class="Symbol">{</a><a id="52613" class="Bound">Γ⁗</a><a id="52615" class="Symbol">}</a> <a id="52617" href="NbE.html#50758" class="Bound">pf</a> <a id="52620" class="Symbol">(</a><a id="52621" href="NbE.html#32369" class="Function">≤-trans</a> <a id="52629" class="Bound">Γ⁗≤Γ‴</a> <a id="52635" href="NbE.html#51375" class="Function">Γ‴≤Γ′</a><a id="52640" class="Symbol">)</a>
        <a id="52650" href="NbE.html#52516" class="Function">...</a> <a id="52654" class="Symbol">|</a> <a id="52656" href="NbE.html#52656" class="Bound">pf</a>
          <a id="52669" class="Keyword">rewrite</a> <a id="52677" href="NbE.html#52394" class="Function">subst-lemma₄</a> <a id="52690" class="Symbol">|</a> <a id="52692" href="NbE.html#52454" class="Function">subst-lemma₅</a> <a id="52705" class="Symbol">=</a> <a id="52707" href="NbE.html#52656" class="Bound">pf</a>
</pre>
With that out of the way, having proved the lemma that
`Γ ⊢ t : T Ⓡ a ⇒ ∀ Γ′ ≤ Γ. Γ′ ⊢ t = ↓ᵀ a Γ : T`, we have:
    Γ ⊢ t : T Ⓡ a ⇒ Γ ⊢ t = ↓ᵀ a Γ : T
which is what we wanted our logical relation to imply,
so that we can then show that `Γ ⊢ t : T Ⓡ a` for `a = ⟦t⟧ (↑ Γ)`

For this, we will establish that `Γ ⊢ t : T Ⓡ ⟦t⟧ (↑ Γ)`
using the fundamental lemma of logical relations. First,
we will need to extend logical relations to include
substitutions and environments. We again use ∥Ⓡ∥ for
the "parallel" in parallel substitutions, as Ⓡ is
already defined for terms and semantic objects
<pre class="Agda"><a id="_∥Ⓡ∥_"></a><a id="53313" href="NbE.html#53313" class="Function Operator">_∥Ⓡ∥_</a> <a id="53319" class="Symbol">:</a> <a id="53321" class="Symbol">∀</a> <a id="53323" class="Symbol">{</a><a id="53324" href="NbE.html#53324" class="Bound">Γ</a> <a id="53326" href="NbE.html#53326" class="Bound">Δ</a> <a id="53328" class="Symbol">:</a> <a id="53330" href="NbE.html#1943" class="Datatype">Ctx</a><a id="53333" class="Symbol">}</a>
      <a id="53341" class="Symbol">→</a> <a id="53343" href="NbE.html#6688" class="Datatype">Sub</a> <a id="53347" href="NbE.html#53324" class="Bound">Γ</a> <a id="53349" href="NbE.html#53326" class="Bound">Δ</a>
      <a id="53357" class="Symbol">→</a> <a id="53359" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="53361" href="NbE.html#53326" class="Bound">Δ</a> <a id="53363" href="NbE.html#15983" class="Field Operator">⟧</a>
      <a id="53371" class="Symbol">→</a> <a id="53373" href="Agda.Primitive.html#326" class="Primitive">Set</a>
</pre>
Similarly as for terms and values, a Kripe logical
relation between a parallel substitution and an
environment is defined inductively, though this time
by induction on the rules for parallel substitutions
instead of by induction on types

A substitution from the empty context is always
logically related to an empty environment
<pre class="Agda"><a id="53719" href="NbE.html#6718" class="InductiveConstructor">∅</a> <a id="53721" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="53725" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a> <a id="53728" class="Symbol">=</a> <a id="53730" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
</pre>
An extension to a substition (σ , s / x) is logically
related to an environment (ρ , a) if σ is logically
related to ρ and s is logically related to a
<pre class="Agda"><a id="53896" class="Symbol">(</a><a id="53897" href="NbE.html#53897" class="Bound">σ</a> <a id="53899" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="53901" href="NbE.html#53901" class="Bound">s</a><a id="53902" class="Symbol">)</a> <a id="53904" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="53908" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="53910" href="NbE.html#53910" class="Bound">ρ</a> <a id="53912" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="53914" href="NbE.html#53914" class="Bound">a</a> <a id="53916" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="53918" class="Symbol">=</a> <a id="53920" href="NbE.html#53897" class="Bound">σ</a> <a id="53922" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="53926" href="NbE.html#53910" class="Bound">ρ</a> <a id="53928" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="53930" href="NbE.html#53901" class="Bound">s</a> <a id="53932" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="53934" href="NbE.html#53914" class="Bound">a</a>

<a id="53937" class="Keyword">infix</a> <a id="53943" class="Number">4</a> <a id="53945" href="NbE.html#53313" class="Function Operator">_∥Ⓡ∥_</a>
</pre>
A consequence of how substitutions and their logical
relation with environments are defined is that we
have that a logical relation for a shifted substitution
holds if the logical relation holds for the original
substitution (as the shifted terms will be irrelevant)
<pre class="Agda"><a id="∥Ⓡ∥-↑"></a><a id="54231" href="NbE.html#54231" class="Function">∥Ⓡ∥-↑</a> <a id="54237" class="Symbol">:</a> <a id="54239" class="Symbol">∀</a> <a id="54241" class="Symbol">{</a><a id="54242" href="NbE.html#54242" class="Bound">Γ</a> <a id="54244" href="NbE.html#54244" class="Bound">Δ</a> <a id="54246" class="Symbol">:</a> <a id="54248" href="NbE.html#1943" class="Datatype">Ctx</a><a id="54251" class="Symbol">}</a> <a id="54253" class="Symbol">{</a><a id="54254" href="NbE.html#54254" class="Bound">T</a> <a id="54256" class="Symbol">:</a> <a id="54258" href="NbE.html#1051" class="Datatype">Type</a><a id="54262" class="Symbol">}</a> <a id="54264" class="Symbol">{</a><a id="54265" href="NbE.html#54265" class="Bound">σᵣ</a> <a id="54268" class="Symbol">:</a> <a id="54270" href="NbE.html#7265" class="Datatype">Ren</a> <a id="54274" href="NbE.html#54242" class="Bound">Γ</a> <a id="54276" href="NbE.html#54244" class="Bound">Δ</a><a id="54277" class="Symbol">}</a> <a id="54279" class="Symbol">{</a><a id="54280" href="NbE.html#54280" class="Bound">ρ</a> <a id="54282" class="Symbol">:</a> <a id="54284" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="54286" href="NbE.html#54244" class="Bound">Δ</a> <a id="54288" href="NbE.html#15983" class="Field Operator">⟧</a><a id="54289" class="Symbol">}</a>
      <a id="54297" class="Symbol">→</a> <a id="54299" href="NbE.html#9824" class="Function">subst-ren</a> <a id="54309" href="NbE.html#54265" class="Bound">σᵣ</a> <a id="54312" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="54316" href="NbE.html#54280" class="Bound">ρ</a>
      <a id="54324" class="Symbol">→</a> <a id="54326" href="NbE.html#9824" class="Function">subst-ren</a> <a id="54336" class="Symbol">(</a><a id="54337" href="NbE.html#8198" class="Function Operator">_↑ᵣ</a> <a id="54341" class="Symbol">{</a><a id="54342" class="Argument">T</a> <a id="54344" class="Symbol">=</a> <a id="54346" href="NbE.html#54254" class="Bound">T</a><a id="54347" class="Symbol">}</a> <a id="54349" href="NbE.html#54265" class="Bound">σᵣ</a><a id="54351" class="Symbol">)</a> <a id="54353" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="54357" href="NbE.html#54280" class="Bound">ρ</a>
<a id="54359" href="NbE.html#54231" class="Function">∥Ⓡ∥-↑</a> <a id="54365" class="Symbol">{</a><a id="54366" class="Argument">σᵣ</a> <a id="54369" class="Symbol">=</a> <a id="54371" href="NbE.html#7295" class="InductiveConstructor">∅</a><a id="54372" class="Symbol">}</a> <a id="54374" href="NbE.html#54374" class="Bound">pf</a> <a id="54377" class="Symbol">=</a> <a id="54379" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
<a id="54382" href="NbE.html#54231" class="Function">∥Ⓡ∥-↑</a> <a id="54388" class="Symbol">{</a><a id="54389" class="Argument">T</a> <a id="54391" class="Symbol">=</a> <a id="54393" href="NbE.html#54393" class="Bound">T</a><a id="54394" class="Symbol">}</a> <a id="54396" class="Symbol">{</a><a id="54397" class="Argument">σᵣ</a> <a id="54400" class="Symbol">=</a> <a id="54402" class="Symbol">_</a> <a id="54404" href="NbE.html#7324" class="InductiveConstructor Operator">,</a> <a id="54406" href="NbE.html#54406" class="Bound">x</a><a id="54407" class="Symbol">}</a> <a id="54409" class="Symbol">{</a><a id="54410" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="54412" class="Symbol">_</a> <a id="54414" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="54416" href="NbE.html#54416" class="Bound">a</a> <a id="54418" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a><a id="54419" class="Symbol">}</a> <a id="54421" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="54423" href="NbE.html#54423" class="Bound">pf</a> <a id="54426" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="54428" href="NbE.html#54428" class="Bound">xⓇa</a> <a id="54432" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="54434" class="Symbol">=</a> <a id="54436" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="54438" href="NbE.html#54231" class="Function">∥Ⓡ∥-↑</a> <a id="54444" href="NbE.html#54423" class="Bound">pf</a> <a id="54447" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="54449" href="NbE.html#54598" class="Function">↑⊢xⓇa</a> <a id="54455" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
  <a id="54459" class="Keyword">where</a>
    <a id="54469" href="NbE.html#54469" class="Function">subst-lemma₁</a> <a id="54482" class="Symbol">=</a> <a id="54484" href="NbE.html#33199" class="Function">shift-var</a> <a id="54494" class="Symbol">{</a><a id="54495" class="Argument">S</a> <a id="54497" class="Symbol">=</a> <a id="54499" href="NbE.html#54393" class="Bound">T</a><a id="54500" class="Symbol">}</a> <a id="54502" class="Symbol">{</a><a id="54503" class="Argument">x</a> <a id="54505" class="Symbol">=</a> <a id="54507" href="NbE.html#54406" class="Bound">x</a><a id="54508" class="Symbol">}</a> <a id="54510" class="Symbol">{</a><a id="54511" class="Argument">σᵣ</a> <a id="54514" class="Symbol">=</a> <a id="54516" href="NbE.html#9240" class="Function">ren-id</a><a id="54522" class="Symbol">}</a>
    <a id="54528" href="NbE.html#54528" class="Function">subst-lemma₂</a> <a id="54541" class="Symbol">=</a> <a id="54543" href="NbE.html#33750" class="Function">rename-id</a> <a id="54553" class="Symbol">{</a><a id="54554" class="Argument">x</a> <a id="54556" class="Symbol">=</a> <a id="54558" href="NbE.html#54406" class="Bound">x</a><a id="54559" class="Symbol">}</a>

    <a id="54566" href="NbE.html#54566" class="Function">Γ,T≤Γ</a> <a id="54572" class="Symbol">=</a> <a id="54574" href="NbE.html#2943" class="InductiveConstructor">≤-ext</a> <a id="54580" class="Symbol">{</a><a id="54581" class="Argument">T</a> <a id="54583" class="Symbol">=</a> <a id="54585" href="NbE.html#54393" class="Bound">T</a><a id="54586" class="Symbol">}</a> <a id="54588" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>

    <a id="54598" href="NbE.html#54598" class="Function">↑⊢xⓇa</a> <a id="54604" class="Symbol">:</a> <a id="54606" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="54608" class="Symbol">(</a><a id="54609" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="54612" href="NbE.html#54406" class="Bound">x</a><a id="54613" class="Symbol">)</a> <a id="54615" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="54617" href="NbE.html#54416" class="Bound">a</a>
    <a id="54623" href="NbE.html#54598" class="Function">↑⊢xⓇa</a>
      <a id="54635" class="Keyword">with</a> <a id="54640" href="NbE.html#41783" class="Function">Ⓡ-weaken</a> <a id="54649" class="Symbol">{</a><a id="54650" class="Argument">Γ′≤Γ</a> <a id="54655" class="Symbol">=</a> <a id="54657" href="NbE.html#54566" class="Function">Γ,T≤Γ</a><a id="54662" class="Symbol">}</a> <a id="54664" class="Symbol">{</a><a id="54665" class="Argument">t</a> <a id="54667" class="Symbol">=</a> <a id="54669" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="54671" href="NbE.html#54406" class="Bound">x</a><a id="54672" class="Symbol">}</a> <a id="54674" href="NbE.html#54428" class="Bound">xⓇa</a>
    <a id="54682" href="NbE.html#54598" class="Function">...</a> <a id="54686" class="Symbol">|</a> <a id="54688" href="NbE.html#54688" class="Bound">pf</a>
      <a id="54697" class="Keyword">rewrite</a> <a id="54705" href="NbE.html#54469" class="Function">subst-lemma₁</a> <a id="54718" class="Symbol">|</a> <a id="54720" href="NbE.html#54528" class="Function">subst-lemma₂</a> <a id="54733" class="Symbol">=</a> <a id="54735" href="NbE.html#54688" class="Bound">pf</a>
</pre>
A generalization of this is, similarly as for logical relations
between terms and semantic objects, that if a logical relation
holds between a substitution and an environment, it holds for any
weakening of the substitution (as weakening is really a series
of shifts)
<pre class="Agda"><a id="∥Ⓡ∥-weaken"></a><a id="55018" href="NbE.html#55018" class="Function">∥Ⓡ∥-weaken</a> <a id="55029" class="Symbol">:</a> <a id="55031" class="Symbol">∀</a> <a id="55033" class="Symbol">{</a><a id="55034" href="NbE.html#55034" class="Bound">Γ′</a> <a id="55037" href="NbE.html#55037" class="Bound">Γ</a> <a id="55039" href="NbE.html#55039" class="Bound">Δ</a> <a id="55041" class="Symbol">:</a> <a id="55043" href="NbE.html#1943" class="Datatype">Ctx</a><a id="55046" class="Symbol">}</a> <a id="55048" class="Symbol">{</a><a id="55049" href="NbE.html#55049" class="Bound">Γ′≤Γ</a> <a id="55054" class="Symbol">:</a> <a id="55056" href="NbE.html#55034" class="Bound">Γ′</a> <a id="55059" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="55061" href="NbE.html#55037" class="Bound">Γ</a><a id="55062" class="Symbol">}</a> <a id="55064" class="Symbol">{</a><a id="55065" href="NbE.html#55065" class="Bound">σ</a> <a id="55067" class="Symbol">:</a> <a id="55069" href="NbE.html#6688" class="Datatype">Sub</a> <a id="55073" href="NbE.html#55037" class="Bound">Γ</a> <a id="55075" href="NbE.html#55039" class="Bound">Δ</a><a id="55076" class="Symbol">}</a> <a id="55078" class="Symbol">{</a><a id="55079" href="NbE.html#55079" class="Bound">ρ</a> <a id="55081" class="Symbol">:</a> <a id="55083" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="55085" href="NbE.html#55039" class="Bound">Δ</a> <a id="55087" href="NbE.html#15983" class="Field Operator">⟧</a><a id="55088" class="Symbol">}</a>
        <a id="55098" class="Symbol">→</a> <a id="55100" href="NbE.html#55065" class="Bound">σ</a> <a id="55102" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="55106" href="NbE.html#55079" class="Bound">ρ</a>
        <a id="55116" class="Symbol">→</a> <a id="55118" href="NbE.html#55065" class="Bound">σ</a> <a id="55120" href="NbE.html#10937" class="Function Operator">∘</a> <a id="55122" class="Symbol">(</a><a id="55123" href="NbE.html#11260" class="Function">weaken</a> <a id="55130" href="NbE.html#55049" class="Bound">Γ′≤Γ</a><a id="55134" class="Symbol">)</a> <a id="55136" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="55140" href="NbE.html#55079" class="Bound">ρ</a>
<a id="55142" href="NbE.html#55018" class="Function">∥Ⓡ∥-weaken</a> <a id="55153" class="Symbol">{</a><a id="55154" class="Argument">σ</a> <a id="55156" class="Symbol">=</a> <a id="55158" href="NbE.html#6718" class="InductiveConstructor">∅</a><a id="55159" class="Symbol">}</a> <a id="55161" href="NbE.html#55161" class="Bound">x</a> <a id="55163" class="Symbol">=</a> <a id="55165" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
<a id="55168" href="NbE.html#55018" class="Function">∥Ⓡ∥-weaken</a> <a id="55179" class="Symbol">{</a><a id="55180" class="Argument">Γ′≤Γ</a> <a id="55185" class="Symbol">=</a> <a id="55187" href="NbE.html#55187" class="Bound">Γ′≤Γ</a><a id="55191" class="Symbol">}</a> <a id="55193" class="Symbol">{</a><a id="55194" href="NbE.html#55194" class="Bound">σ</a> <a id="55196" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="55198" href="NbE.html#55198" class="Bound">s</a><a id="55199" class="Symbol">}</a> <a id="55201" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="55203" href="NbE.html#55203" class="Bound">σ∥Ⓡ∥ρ</a> <a id="55209" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="55211" href="NbE.html#55211" class="Bound">sⓇa</a> <a id="55215" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="55217" class="Symbol">=</a>
  <a id="55221" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="55223" href="NbE.html#55018" class="Function">∥Ⓡ∥-weaken</a> <a id="55234" class="Symbol">{</a><a id="55235" class="Argument">Γ′≤Γ</a> <a id="55240" class="Symbol">=</a> <a id="55242" href="NbE.html#55187" class="Bound">Γ′≤Γ</a><a id="55246" class="Symbol">}</a> <a id="55248" href="NbE.html#55203" class="Bound">σ∥Ⓡ∥ρ</a> <a id="55254" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="55256" href="NbE.html#41783" class="Function">Ⓡ-weaken</a> <a id="55265" class="Symbol">{</a><a id="55266" class="Argument">Γ′≤Γ</a> <a id="55271" class="Symbol">=</a> <a id="55273" href="NbE.html#55187" class="Bound">Γ′≤Γ</a><a id="55277" class="Symbol">}</a> <a id="55279" href="NbE.html#55211" class="Bound">sⓇa</a> <a id="55283" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
</pre>
We are now ready to introduce the semantic typing judgement
`Γ ⊨ t : T`, which will be the what we will use to arrive
at `Γ ⊢ t : T Ⓡ ⟦ t ⟧ ↑Γ Γ`
<pre class="Agda"><a id="_⊨_"></a><a id="55444" href="NbE.html#55444" class="Function Operator">_⊨_</a> <a id="55448" class="Symbol">:</a> <a id="55450" class="Symbol">∀</a> <a id="55452" class="Symbol">{</a><a id="55453" href="NbE.html#55453" class="Bound">T</a> <a id="55455" class="Symbol">:</a> <a id="55457" href="NbE.html#1051" class="Datatype">Type</a><a id="55461" class="Symbol">}</a> <a id="55463" class="Symbol">→</a> <a id="55465" class="Symbol">(</a><a id="55466" href="NbE.html#55466" class="Bound">Γ</a> <a id="55468" class="Symbol">:</a> <a id="55470" href="NbE.html#1943" class="Datatype">Ctx</a><a id="55473" class="Symbol">)</a> <a id="55475" class="Symbol">→</a> <a id="55477" href="NbE.html#55466" class="Bound">Γ</a> <a id="55479" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="55481" href="NbE.html#55453" class="Bound">T</a> <a id="55483" class="Symbol">→</a> <a id="55485" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="55489" href="NbE.html#55444" class="Function Operator">_⊨_</a> <a id="55493" class="Symbol">{</a><a id="55494" href="NbE.html#55494" class="Bound">T</a><a id="55495" class="Symbol">}</a> <a id="55497" href="NbE.html#55497" class="Bound">Γ</a> <a id="55499" href="NbE.html#55499" class="Bound">t</a> <a id="55501" class="Symbol">=</a>
  <a id="55505" class="Symbol">∀</a> <a id="55507" class="Symbol">{</a><a id="55508" href="NbE.html#55508" class="Bound">Δ</a> <a id="55510" class="Symbol">:</a> <a id="55512" href="NbE.html#1943" class="Datatype">Ctx</a><a id="55515" class="Symbol">}</a> <a id="55517" class="Symbol">{</a><a id="55518" href="NbE.html#55518" class="Bound">σ</a> <a id="55520" class="Symbol">:</a> <a id="55522" href="NbE.html#6688" class="Datatype">Sub</a> <a id="55526" href="NbE.html#55508" class="Bound">Δ</a> <a id="55528" href="NbE.html#55497" class="Bound">Γ</a><a id="55529" class="Symbol">}</a> <a id="55531" class="Symbol">{</a><a id="55532" href="NbE.html#55532" class="Bound">ρ</a> <a id="55534" class="Symbol">:</a> <a id="55536" href="NbE.html#15983" class="Field Operator">⟦</a> <a id="55538" href="NbE.html#55497" class="Bound">Γ</a> <a id="55540" href="NbE.html#15983" class="Field Operator">⟧</a><a id="55541" class="Symbol">}</a>
  <a id="55545" class="Symbol">→</a> <a id="55547" href="NbE.html#55518" class="Bound">σ</a> <a id="55549" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="55553" href="NbE.html#55532" class="Bound">ρ</a>
    <a id="55559" class="Comment">-------</a>
  <a id="55569" class="Symbol">→</a> <a id="55571" href="NbE.html#55499" class="Bound">t</a> <a id="55573" href="NbE.html#10528" class="Function Operator">[</a> <a id="55575" href="NbE.html#55518" class="Bound">σ</a> <a id="55577" href="NbE.html#10528" class="Function Operator">]</a> <a id="55579" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="55581" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="55584" href="NbE.html#55499" class="Bound">t</a> <a id="55586" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="55588" href="NbE.html#55532" class="Bound">ρ</a>
</pre>
By induction on the typing judgement `Γ ⊢ t : T`,
we prove the semantic typing judgement `Γ ⊨ t : T`,
this is called the fundamental lemma of logical
relations
<pre class="Agda"><a id="fundamental-lemma"></a><a id="55763" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="55781" class="Symbol">:</a> <a id="55783" class="Symbol">∀</a> <a id="55785" class="Symbol">{</a><a id="55786" href="NbE.html#55786" class="Bound">Γ</a> <a id="55788" class="Symbol">:</a> <a id="55790" href="NbE.html#1943" class="Datatype">Ctx</a><a id="55793" class="Symbol">}</a> <a id="55795" class="Symbol">{</a><a id="55796" href="NbE.html#55796" class="Bound">T</a> <a id="55798" class="Symbol">:</a> <a id="55800" href="NbE.html#1051" class="Datatype">Type</a><a id="55804" class="Symbol">}</a> <a id="55806" class="Symbol">{</a><a id="55807" href="NbE.html#55807" class="Bound">t</a> <a id="55809" class="Symbol">:</a> <a id="55811" href="NbE.html#55786" class="Bound">Γ</a> <a id="55813" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="55815" href="NbE.html#55796" class="Bound">T</a><a id="55816" class="Symbol">}</a>
                  <a id="55836" class="Symbol">→</a> <a id="55838" href="NbE.html#55786" class="Bound">Γ</a> <a id="55840" href="NbE.html#55444" class="Function Operator">⊨</a> <a id="55842" href="NbE.html#55807" class="Bound">t</a>
<a id="55844" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="55862" class="Symbol">{</a><a id="55863" class="Argument">t</a> <a id="55865" class="Symbol">=</a> <a id="55867" href="NbE.html#4377" class="InductiveConstructor">zero</a><a id="55871" class="Symbol">}</a> <a id="55873" href="NbE.html#55873" class="Bound">σ∥Ⓡ∥ρ</a> <a id="55879" class="Symbol">_</a> <a id="55881" class="Symbol">=</a> <a id="55883" href="NbE.html#14488" class="InductiveConstructor">refl</a>
<a id="55888" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="55906" class="Symbol">{</a><a id="55907" class="Argument">t</a> <a id="55909" class="Symbol">=</a> <a id="55911" href="NbE.html#4395" class="InductiveConstructor">suc</a><a id="55914" class="Symbol">}</a> <a id="55916" href="NbE.html#55916" class="Bound">σ∥Ⓡ∥ρ</a> <a id="55922" href="NbE.html#55922" class="Bound">Δ′≤Δ</a> <a id="55927" class="Symbol">{</a><a id="55928" href="NbE.html#55928" class="Bound">s</a><a id="55929" class="Symbol">}</a> <a id="55931" class="Symbol">{</a><a id="55932" href="NbE.html#55932" class="Bound">a</a><a id="55933" class="Symbol">}</a> <a id="55935" href="NbE.html#55935" class="Bound">pf</a> <a id="55938" class="Symbol">{</a><a id="55939" href="NbE.html#55939" class="Bound">Δ″</a><a id="55941" class="Symbol">}</a> <a id="55943" href="NbE.html#55943" class="Bound">Δ″≤Δ′</a> <a id="55949" class="Symbol">=</a>
  <a id="55953" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="55955" href="NbE.html#55943" class="Bound">Δ″≤Δ′</a> <a id="55961" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="55964" href="NbE.html#55928" class="Bound">s</a> <a id="55966" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="55968" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="55970" href="NbE.html#14488" class="InductiveConstructor">refl</a> <a id="55975" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="55977" href="NbE.html#55998" class="Function">s==a</a> <a id="55982" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="55984" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
  <a id="55988" class="Keyword">where</a>
    <a id="55998" href="NbE.html#55998" class="Function">s==a</a> <a id="56003" class="Symbol">:</a> <a id="56005" class="Symbol">∀</a> <a id="56007" class="Symbol">{</a><a id="56008" href="NbE.html#56008" class="Bound">Δ‴</a> <a id="56011" class="Symbol">:</a> <a id="56013" href="NbE.html#1943" class="Datatype">Ctx</a><a id="56016" class="Symbol">}</a> <a id="56018" class="Symbol">→</a> <a id="56020" class="Symbol">(</a><a id="56021" href="NbE.html#56021" class="Bound">Δ‴≤Δ″</a> <a id="56027" class="Symbol">:</a> <a id="56029" href="NbE.html#56008" class="Bound">Δ‴</a> <a id="56032" href="NbE.html#2883" class="Datatype Operator">≤</a> <a id="56034" href="NbE.html#55939" class="Bound">Δ″</a><a id="56036" class="Symbol">)</a> <a id="56038" class="Symbol">→</a> <a id="56040" href="NbE.html#56021" class="Bound">Δ‴≤Δ″</a> <a id="56046" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="56049" href="NbE.html#55943" class="Bound">Δ″≤Δ′</a> <a id="56055" href="NbE.html#11480" class="Function Operator">≤⊢</a> <a id="56058" href="NbE.html#55928" class="Bound">s</a> <a id="56060" href="NbE.html#39304" class="Function Operator">==ℕ̂</a> <a id="56065" href="NbE.html#55932" class="Bound">a</a>
    <a id="56071" href="NbE.html#55998" class="Function">s==a</a> <a id="56076" href="NbE.html#56076" class="Bound">Δ‴≤Δ″</a>
      <a id="56088" class="Keyword">with</a> <a id="56093" href="NbE.html#55935" class="Bound">pf</a> <a id="56096" class="Symbol">(</a><a id="56097" href="NbE.html#32369" class="Function">≤-trans</a> <a id="56105" href="NbE.html#56076" class="Bound">Δ‴≤Δ″</a> <a id="56111" href="NbE.html#55943" class="Bound">Δ″≤Δ′</a><a id="56116" class="Symbol">)</a>
    <a id="56122" class="Symbol">...</a> <a id="56126" class="Symbol">|</a> <a id="56128" href="NbE.html#56128" class="Bound">pf</a>
      <a id="56137" class="Keyword">rewrite</a> <a id="56145" href="NbE.html#36021" class="Postulate">weaken-compose</a> <a id="56160" class="Bound">Δ‴≤Δ″</a> <a id="56166" href="NbE.html#55943" class="Bound">Δ″≤Δ′</a> <a id="56172" href="NbE.html#55928" class="Bound">s</a> <a id="56174" class="Symbol">=</a> <a id="56176" href="NbE.html#56128" class="Bound">pf</a>
<a id="56179" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="56197" class="Symbol">{</a><a id="56198" class="Argument">t</a> <a id="56200" class="Symbol">=</a> <a id="56202" href="NbE.html#4418" class="InductiveConstructor">rec</a> <a id="56206" class="Symbol">{</a><a id="56207" href="NbE.html#56207" class="Bound">T</a><a id="56208" class="Symbol">}}</a> <a id="56211" class="Symbol">_</a> <a id="56213" class="Symbol">=</a> <a id="56215" href="NbE.html#49579" class="Function">recⓇ⟦rec⟧</a>
<a id="56225" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="56243" class="Symbol">{</a><a id="56244" class="Argument">t</a> <a id="56246" class="Symbol">=</a> <a id="56248" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="56250" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="56252" class="Symbol">}</a> <a id="56254" class="Symbol">{</a><a id="56255" class="Argument">σ</a> <a id="56257" class="Symbol">=</a> <a id="56259" class="Symbol">_</a> <a id="56261" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56263" class="Symbol">_</a> <a id="56265" class="Symbol">}</a> <a id="56267" class="Symbol">{</a><a id="56268" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="56270" class="Symbol">_</a> <a id="56272" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="56274" class="Symbol">_</a> <a id="56276" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a><a id="56277" class="Symbol">}</a> <a id="56279" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="56281" class="Symbol">_</a> <a id="56283" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="56285" href="NbE.html#56285" class="Bound">xⓇa</a> <a id="56289" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="56291" class="Symbol">=</a> <a id="56293" href="NbE.html#56285" class="Bound">xⓇa</a>
<a id="56297" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="56315" class="Symbol">{</a><a id="56316" class="Argument">t</a> <a id="56318" class="Symbol">=</a> <a id="56320" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="56322" class="Symbol">(</a><a id="56323" href="NbE.html#3772" class="InductiveConstructor Operator">`S</a> <a id="56326" href="NbE.html#56326" class="Bound">x</a><a id="56327" class="Symbol">)}</a> <a id="56330" class="Symbol">{</a><a id="56331" class="Argument">σ</a> <a id="56333" class="Symbol">=</a> <a id="56335" class="Symbol">_</a> <a id="56337" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56339" class="Symbol">_}</a> <a id="56342" class="Symbol">{</a><a id="56343" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="56345" class="Symbol">_</a> <a id="56347" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="56349" class="Symbol">_</a> <a id="56351" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a><a id="56352" class="Symbol">}</a> <a id="56354" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="56356" href="NbE.html#56356" class="Bound">σ∥Ⓡ∥ρ</a> <a id="56362" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="56364" class="Symbol">_</a> <a id="56366" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a> <a id="56368" class="Symbol">=</a>
  <a id="56372" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="56390" class="Symbol">{</a><a id="56391" class="Argument">t</a> <a id="56393" class="Symbol">=</a> <a id="56395" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="56397" href="NbE.html#56326" class="Bound">x</a><a id="56398" class="Symbol">}</a> <a id="56400" href="NbE.html#56356" class="Bound">σ∥Ⓡ∥ρ</a>
<a id="56406" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="56424" class="Symbol">{</a><a id="56425" class="Argument">t</a> <a id="56427" class="Symbol">=</a> <a id="56429" href="NbE.html#4587" class="InductiveConstructor Operator">ƛ</a> <a id="56431" href="NbE.html#56431" class="Bound">t</a><a id="56432" class="Symbol">}</a> <a id="56434" class="Symbol">{</a><a id="56435" class="Argument">σ</a> <a id="56437" class="Symbol">=</a> <a id="56439" href="NbE.html#56439" class="Bound">σ</a><a id="56440" class="Symbol">}</a> <a id="56442" class="Symbol">{</a><a id="56443" href="NbE.html#56443" class="Bound">ρ</a><a id="56444" class="Symbol">}</a> <a id="56446" href="NbE.html#56446" class="Bound">σ∥Ⓡ∥ρ</a> <a id="56452" href="NbE.html#56452" class="Bound">Γ′≤Γ</a> <a id="56457" class="Symbol">{</a><a id="56458" href="NbE.html#56458" class="Bound">s</a><a id="56459" class="Symbol">}</a> <a id="56461" class="Symbol">{</a><a id="56462" href="NbE.html#56462" class="Bound">a</a><a id="56463" class="Symbol">}</a> <a id="56465" href="NbE.html#56465" class="Bound">sⓇa</a> <a id="56469" class="Symbol">=</a>
  <a id="56473" href="NbE.html#40899" class="Function">==-Ⓡ-trans</a> <a id="56484" class="Symbol">(</a><a id="56485" href="NbE.html#14569" class="InductiveConstructor">sym</a> <a id="56489" href="NbE.html#13522" class="InductiveConstructor">β-ƛ</a><a id="56492" class="Symbol">)</a> <a id="56494" href="NbE.html#57162" class="Function">t[σ′][s/x]Ⓡ⟦t⟧⟨ρ,a⟩</a>
  <a id="56516" class="Keyword">where</a>
    <a id="56526" href="NbE.html#56526" class="Function">subst-lemma₁</a> <a id="56539" class="Symbol">=</a>
      <a id="56547" href="NbE.html#35654" class="Postulate">subst-compose</a> <a id="56561" class="Symbol">{</a><a id="56562" class="Argument">τ</a> <a id="56564" class="Symbol">=</a> <a id="56566" href="NbE.html#11739" class="Function">subst-id</a> <a id="56575" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56577" href="NbE.html#56458" class="Bound">s</a><a id="56578" class="Symbol">}</a> <a id="56580" class="Symbol">{</a><a id="56581" href="NbE.html#11260" class="Function">weaken</a> <a id="56588" href="NbE.html#56452" class="Bound">Γ′≤Γ</a> <a id="56593" href="NbE.html#10252" class="Function Operator">↑</a> <a id="56595" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56597" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="56599" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="56601" class="Symbol">}</a> <a id="56603" class="Symbol">{</a><a id="56604" href="NbE.html#56431" class="Bound">t</a> <a id="56606" href="NbE.html#10528" class="Function Operator">[</a> <a id="56608" href="NbE.html#56439" class="Bound">σ</a> <a id="56610" href="NbE.html#10252" class="Function Operator">↑</a> <a id="56612" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56614" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="56616" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="56619" href="NbE.html#10528" class="Function Operator">]</a><a id="56620" class="Symbol">}</a>
    <a id="56626" href="NbE.html#56626" class="Function">subst-lemma₂</a> <a id="56639" class="Symbol">=</a>
     <a id="56646" href="NbE.html#35654" class="Postulate">subst-compose</a> <a id="56660" class="Symbol">{</a><a id="56661" class="Argument">τ</a> <a id="56663" class="Symbol">=</a> <a id="56665" class="Symbol">((</a><a id="56667" href="NbE.html#11260" class="Function">weaken</a> <a id="56674" href="NbE.html#56452" class="Bound">Γ′≤Γ</a> <a id="56679" href="NbE.html#10252" class="Function Operator">↑</a><a id="56680" class="Symbol">)</a> <a id="56682" href="NbE.html#10937" class="Function Operator">∘</a> <a id="56684" class="Symbol">(</a><a id="56685" href="NbE.html#11739" class="Function">subst-id</a> <a id="56694" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56696" href="NbE.html#56458" class="Bound">s</a><a id="56697" class="Symbol">))</a> <a id="56700" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56702" href="NbE.html#56458" class="Bound">s</a><a id="56703" class="Symbol">}</a> <a id="56705" class="Symbol">{</a><a id="56706" href="NbE.html#56439" class="Bound">σ</a> <a id="56708" href="NbE.html#10252" class="Function Operator">↑</a> <a id="56710" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56712" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="56714" href="NbE.html#3705" class="InductiveConstructor">`Z</a><a id="56716" class="Symbol">}</a> <a id="56718" class="Symbol">{</a><a id="56719" href="NbE.html#56431" class="Bound">t</a><a id="56720" class="Symbol">}</a>

    <a id="56727" href="NbE.html#56727" class="Function">t[σ′]</a> <a id="56733" class="Symbol">=</a> <a id="56735" href="NbE.html#56431" class="Bound">t</a> <a id="56737" href="NbE.html#10528" class="Function Operator">[</a> <a id="56739" href="NbE.html#56439" class="Bound">σ</a> <a id="56741" href="NbE.html#10252" class="Function Operator">↑</a> <a id="56743" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56745" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="56747" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="56750" href="NbE.html#10528" class="Function Operator">]</a> <a id="56752" href="NbE.html#10528" class="Function Operator">[</a> <a id="56754" href="NbE.html#11260" class="Function">weaken</a> <a id="56761" href="NbE.html#56452" class="Bound">Γ′≤Γ</a> <a id="56766" href="NbE.html#10252" class="Function Operator">↑</a> <a id="56768" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="56770" href="NbE.html#4527" class="InductiveConstructor Operator">`</a> <a id="56772" href="NbE.html#3705" class="InductiveConstructor">`Z</a> <a id="56775" href="NbE.html#10528" class="Function Operator">]</a>

    <a id="56782" href="NbE.html#56782" class="Function">subst-lemma₃</a> <a id="56795" class="Symbol">=</a> <a id="56797" href="NbE.html#35814" class="Postulate">subst-compose-↑</a> <a id="56813" class="Symbol">{</a><a id="56814" class="Argument">τ</a> <a id="56816" class="Symbol">=</a> <a id="56818" href="NbE.html#11739" class="Function">subst-id</a><a id="56826" class="Symbol">}</a> <a id="56828" class="Symbol">{</a><a id="56829" href="NbE.html#11260" class="Function">weaken</a> <a id="56836" href="NbE.html#56452" class="Bound">Γ′≤Γ</a><a id="56840" class="Symbol">}</a> <a id="56842" class="Symbol">{</a><a id="56843" href="NbE.html#56458" class="Bound">s</a><a id="56844" class="Symbol">}</a>
    <a id="56850" href="NbE.html#56850" class="Function">subst-lemma₄</a> <a id="56863" class="Symbol">=</a> <a id="56865" href="NbE.html#35814" class="Postulate">subst-compose-↑</a> <a id="56881" class="Symbol">{</a><a id="56882" class="Argument">τ</a> <a id="56884" class="Symbol">=</a> <a id="56886" href="NbE.html#11260" class="Function">weaken</a> <a id="56893" href="NbE.html#56452" class="Bound">Γ′≤Γ</a> <a id="56898" href="NbE.html#10937" class="Function Operator">∘</a> <a id="56900" href="NbE.html#11739" class="Function">subst-id</a><a id="56908" class="Symbol">}</a> <a id="56910" class="Symbol">{</a><a id="56911" href="NbE.html#56439" class="Bound">σ</a><a id="56912" class="Symbol">}</a> <a id="56914" class="Symbol">{</a><a id="56915" href="NbE.html#56458" class="Bound">s</a><a id="56916" class="Symbol">}</a>
    <a id="56922" href="NbE.html#56922" class="Function">subst-lemma₅</a> <a id="56935" class="Symbol">=</a> <a id="56937" href="NbE.html#35416" class="Function">id-compose-identity</a> <a id="56957" class="Symbol">{</a><a id="56958" class="Argument">σ</a> <a id="56960" class="Symbol">=</a> <a id="56962" href="NbE.html#11260" class="Function">weaken</a> <a id="56969" href="NbE.html#56452" class="Bound">Γ′≤Γ</a><a id="56973" class="Symbol">}</a>

    <a id="56980" href="NbE.html#56980" class="Function">σ″</a> <a id="56983" class="Symbol">=</a> <a id="56985" class="Symbol">((</a><a id="56987" href="NbE.html#56439" class="Bound">σ</a> <a id="56989" href="NbE.html#10252" class="Function Operator">↑</a><a id="56990" class="Symbol">)</a> <a id="56992" href="NbE.html#10937" class="Function Operator">∘</a> <a id="56994" class="Symbol">(((</a><a id="56997" href="NbE.html#11260" class="Function">weaken</a> <a id="57004" href="NbE.html#56452" class="Bound">Γ′≤Γ</a> <a id="57009" href="NbE.html#10252" class="Function Operator">↑</a><a id="57010" class="Symbol">)</a> <a id="57012" href="NbE.html#10937" class="Function Operator">∘</a> <a id="57014" class="Symbol">(</a><a id="57015" href="NbE.html#11739" class="Function">subst-id</a> <a id="57024" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="57026" href="NbE.html#56458" class="Bound">s</a><a id="57027" class="Symbol">))</a> <a id="57030" href="NbE.html#6741" class="InductiveConstructor Operator">,</a> <a id="57032" href="NbE.html#56458" class="Bound">s</a><a id="57033" class="Symbol">))</a>

    <a id="57041" href="NbE.html#57041" class="Function">σ″Ⓡρ</a> <a id="57046" class="Symbol">:</a> <a id="57048" href="NbE.html#56980" class="Function">σ″</a>  <a id="57052" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="57056" href="NbE.html#56443" class="Bound">ρ</a>
    <a id="57062" href="NbE.html#57041" class="Function">σ″Ⓡρ</a> <a id="57067" class="Keyword">rewrite</a> <a id="57075" href="NbE.html#56782" class="Function">subst-lemma₃</a> <a id="57088" class="Symbol">|</a> <a id="57090" href="NbE.html#56850" class="Function">subst-lemma₄</a> <a id="57103" class="Symbol">|</a> <a id="57105" href="NbE.html#56922" class="Function">subst-lemma₅</a> <a id="57118" class="Symbol">=</a>
      <a id="57126" href="NbE.html#55018" class="Function">∥Ⓡ∥-weaken</a> <a id="57137" class="Symbol">{</a><a id="57138" class="Argument">Γ′≤Γ</a> <a id="57143" class="Symbol">=</a> <a id="57145" href="NbE.html#56452" class="Bound">Γ′≤Γ</a><a id="57149" class="Symbol">}</a> <a id="57151" href="NbE.html#56446" class="Bound">σ∥Ⓡ∥ρ</a>

    <a id="57162" href="NbE.html#57162" class="Function">t[σ′][s/x]Ⓡ⟦t⟧⟨ρ,a⟩</a> <a id="57182" class="Symbol">:</a> <a id="57184" href="NbE.html#56727" class="Function">t[σ′]</a> <a id="57190" href="NbE.html#12371" class="Function Operator">[</a> <a id="57192" href="NbE.html#56458" class="Bound">s</a> <a id="57194" href="NbE.html#12371" class="Function Operator">/x]</a> <a id="57198" href="NbE.html#40355" class="Function Operator">Ⓡ</a> <a id="57200" href="NbE.html#28275" class="Function Operator">⟦⊢</a> <a id="57203" href="NbE.html#56431" class="Bound">t</a> <a id="57205" href="NbE.html#28275" class="Function Operator">⟧</a> <a id="57207" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="57209" href="NbE.html#56443" class="Bound">ρ</a> <a id="57211" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="57213" href="NbE.html#56462" class="Bound">a</a> <a id="57215" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
    <a id="57221" href="NbE.html#57162" class="Function">t[σ′][s/x]Ⓡ⟦t⟧⟨ρ,a⟩</a> <a id="57241" class="Keyword">rewrite</a> <a id="57249" href="NbE.html#56526" class="Function">subst-lemma₁</a> <a id="57262" class="Symbol">|</a> <a id="57264" href="NbE.html#56626" class="Function">subst-lemma₂</a> <a id="57277" class="Symbol">=</a>
        <a id="57287" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="57305" class="Symbol">{</a><a id="57306" class="Argument">t</a> <a id="57308" class="Symbol">=</a> <a id="57310" href="NbE.html#56431" class="Bound">t</a><a id="57311" class="Symbol">}</a> <a id="57313" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="57315" href="NbE.html#57041" class="Function">σ″Ⓡρ</a> <a id="57320" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="57322" href="NbE.html#56465" class="Bound">sⓇa</a> <a id="57326" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
<a id="57328" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="57346" class="Symbol">{</a><a id="57347" class="Argument">t</a> <a id="57349" class="Symbol">=</a> <a id="57351" href="NbE.html#57351" class="Bound">r</a> <a id="57353" href="NbE.html#4661" class="InductiveConstructor Operator">·</a> <a id="57355" href="NbE.html#57355" class="Bound">s</a><a id="57356" class="Symbol">}</a> <a id="57358" class="Symbol">{</a><a id="57359" class="Argument">σ</a> <a id="57361" class="Symbol">=</a> <a id="57363" href="NbE.html#57363" class="Bound">σ</a><a id="57364" class="Symbol">}</a> <a id="57366" href="NbE.html#57366" class="Bound">σ∥Ⓡ∥ρ</a>
  <a id="57374" class="Keyword">with</a> <a id="57379" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="57397" class="Symbol">{</a><a id="57398" class="Argument">t</a> <a id="57400" class="Symbol">=</a> <a id="57402" href="NbE.html#57351" class="Bound">r</a><a id="57403" class="Symbol">}</a> <a id="57405" href="NbE.html#57366" class="Bound">σ∥Ⓡ∥ρ</a> <a id="57411" class="Symbol">|</a> <a id="57413" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="57431" class="Symbol">{</a><a id="57432" class="Argument">t</a> <a id="57434" class="Symbol">=</a> <a id="57436" href="NbE.html#57355" class="Bound">s</a><a id="57437" class="Symbol">}</a> <a id="57439" href="NbE.html#57366" class="Bound">σ∥Ⓡ∥ρ</a>
<a id="57445" class="Symbol">...</a> <a id="57449" class="Symbol">|</a> <a id="57451" href="NbE.html#57451" class="Bound">Γ⊨r</a>                              <a id="57484" class="Symbol">|</a> <a id="57486" href="NbE.html#57486" class="Bound">Γ⊨s</a>
  <a id="57492" class="Keyword">with</a> <a id="57497" href="NbE.html#57451" class="Bound">Γ⊨r</a> <a id="57501" href="NbE.html#2913" class="InductiveConstructor">≤-id</a> <a id="57506" href="NbE.html#57486" class="Bound">Γ⊨s</a>
<a id="57510" class="Symbol">...</a> <a id="57514" class="Symbol">|</a> <a id="57516" href="NbE.html#57516" class="Bound">pf</a>
  <a id="57521" class="Keyword">rewrite</a> <a id="57529" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="57543" class="Symbol">{</a><a id="57544" class="Argument">t</a> <a id="57546" class="Symbol">=</a> <a id="57548" class="Bound">r</a> <a id="57550" href="NbE.html#10528" class="Function Operator">[</a> <a id="57552" class="Bound">σ</a> <a id="57554" href="NbE.html#10528" class="Function Operator">]</a><a id="57555" class="Symbol">}</a> <a id="57557" class="Symbol">=</a> <a id="57559" href="NbE.html#57516" class="Bound">pf</a>
</pre>
For the identity substitution we have that `Γ ⊢ id : Γ Ⓡ ↑Γ` ,
which we prove by induction using our lemma that
`Γ,x:T ⊢ x : T Ⓡ ↑ᵀ (𝓍ᵀ Γ)` for every variable that we
are substituting for itself.

<pre class="Agda"><a id="idⓇ↑Γ"></a><a id="57772" href="NbE.html#57772" class="Function">idⓇ↑Γ</a> <a id="57778" class="Symbol">:</a> <a id="57780" class="Symbol">∀</a> <a id="57782" class="Symbol">{</a><a id="57783" href="NbE.html#57783" class="Bound">Γ</a> <a id="57785" class="Symbol">:</a> <a id="57787" href="NbE.html#1943" class="Datatype">Ctx</a><a id="57790" class="Symbol">}</a>
       <a id="57799" class="Symbol">→</a> <a id="57801" href="NbE.html#11739" class="Function">subst-id</a> <a id="57810" href="NbE.html#53313" class="Function Operator">∥Ⓡ∥</a> <a id="57814" class="Symbol">(</a><a id="57815" href="NbE.html#27178" class="Function">↑ᶜᵗˣ</a> <a id="57820" href="NbE.html#57783" class="Bound">Γ</a><a id="57821" class="Symbol">)</a>
<a id="57823" href="NbE.html#57772" class="Function">idⓇ↑Γ</a> <a id="57829" class="Symbol">{</a><a id="57830" href="NbE.html#1961" class="InductiveConstructor">∅</a><a id="57831" class="Symbol">}</a> <a id="57833" class="Symbol">=</a> <a id="57835" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
</pre>For our inductive step, our IH will give us that
`Γ ⊢ id : Γ Ⓡ ↑Γ Γ`, but we want proof that `Γ , x:T ⊢ id ↑ : Γ Ⓡ Γ`
(because the identity substitution is unwrapped to `(id ↑ , x / x)`
for the context` Γ , x:T`). Here, we use our lemma that if a
logical relation holds for a substitution and an environment
it holds for a shifting of the substition, allowing us to
transform our IH into our goal
<pre class="Agda"><a id="58247" href="NbE.html#57772" class="Function">idⓇ↑Γ</a> <a id="58253" class="Symbol">{</a><a id="58254" href="NbE.html#58254" class="Bound">Γ</a> <a id="58256" href="NbE.html#1971" class="InductiveConstructor Operator">,</a> <a id="58258" href="NbE.html#58258" class="Bound">T</a><a id="58259" class="Symbol">}</a> <a id="58261" class="Symbol">=</a> <a id="58263" href="NbE.html#620" class="InductiveConstructor Operator">⟨</a> <a id="58265" href="NbE.html#54231" class="Function">∥Ⓡ∥-↑</a> <a id="58271" class="Symbol">{</a><a id="58272" class="Argument">T</a> <a id="58274" class="Symbol">=</a> <a id="58276" href="NbE.html#58258" class="Bound">T</a><a id="58277" class="Symbol">}</a> <a id="58279" href="NbE.html#57772" class="Function">idⓇ↑Γ</a> <a id="58285" href="NbE.html#620" class="InductiveConstructor Operator">,</a> <a id="58287" href="NbE.html#43565" class="Function">xⓇ↑ᵀ𝓍̂</a> <a id="58294" href="NbE.html#620" class="InductiveConstructor Operator">⟩</a>
</pre>
With this fact, we arrive at the soundness of NbE. By the fundamental lemma,
given `Γ ⊢ id : Γ Ⓡ ↑Γ`, we have that `Γ ⊢ t [ id ] Ⓡ ⟦ t ⟧ ↑Γ` -- and
`t [ id ] ≡ t`.

Using the lemma that logical relation implies definitional
equality to the reified semantic object, we arrive at
`Γ ⊢ t = ↓ᵀᵧ ⟦ t ⟧ ↑Γ : T`, which is what we want to show
(i.e. `Γ ⊢ t = nf(t) : T`)
<pre class="Agda"><a id="soundness"></a><a id="58672" href="NbE.html#58672" class="Function">soundness</a> <a id="58682" class="Symbol">:</a> <a id="58684" class="Symbol">∀</a> <a id="58686" class="Symbol">{</a><a id="58687" href="NbE.html#58687" class="Bound">Γ</a> <a id="58689" class="Symbol">:</a> <a id="58691" href="NbE.html#1943" class="Datatype">Ctx</a><a id="58694" class="Symbol">}</a> <a id="58696" class="Symbol">{</a><a id="58697" href="NbE.html#58697" class="Bound">T</a> <a id="58699" class="Symbol">:</a> <a id="58701" href="NbE.html#1051" class="Datatype">Type</a><a id="58705" class="Symbol">}</a> <a id="58707" class="Symbol">{</a><a id="58708" href="NbE.html#58708" class="Bound">t</a> <a id="58710" class="Symbol">:</a> <a id="58712" href="NbE.html#58687" class="Bound">Γ</a> <a id="58714" href="NbE.html#4342" class="Datatype Operator">⊢</a> <a id="58716" href="NbE.html#58697" class="Bound">T</a><a id="58717" class="Symbol">}</a>
          <a id="58729" class="Symbol">→</a> <a id="58731" href="NbE.html#58708" class="Bound">t</a> <a id="58733" href="NbE.html#13044" class="Datatype Operator">==</a> <a id="58736" href="NbE.html#28653" class="Function">nf</a> <a id="58739" href="NbE.html#58708" class="Bound">t</a>
<a id="58741" href="NbE.html#58672" class="Function">soundness</a> <a id="58751" class="Symbol">{</a><a id="58752" href="NbE.html#58752" class="Bound">Γ</a><a id="58753" class="Symbol">}</a> <a id="58755" class="Symbol">{</a><a id="58756" href="NbE.html#58756" class="Bound">T</a><a id="58757" class="Symbol">}</a> <a id="58759" class="Symbol">{</a><a id="58760" href="NbE.html#58760" class="Bound">t</a><a id="58761" class="Symbol">}</a>
  <a id="58765" class="Keyword">with</a> <a id="58770" href="NbE.html#55763" class="Function">fundamental-lemma</a> <a id="58788" class="Symbol">{</a><a id="58789" class="Argument">t</a> <a id="58791" class="Symbol">=</a> <a id="58793" href="NbE.html#58760" class="Bound">t</a><a id="58794" class="Symbol">}</a> <a id="58796" class="Symbol">(</a><a id="58797" href="NbE.html#57772" class="Function">idⓇ↑Γ</a> <a id="58803" class="Symbol">{</a><a id="58804" href="NbE.html#58752" class="Bound">Γ</a><a id="58805" class="Symbol">})</a>
<a id="58808" class="Symbol">...</a> <a id="58812" class="Symbol">|</a> <a id="58814" href="NbE.html#58814" class="Bound">tⓇ⟦t⟧↑Γ</a>
  <a id="58824" class="Keyword">with</a> <a id="58829" href="NbE.html#43233" class="Function">Ⓡ-==↓</a> <a id="58835" href="NbE.html#58814" class="Bound">tⓇ⟦t⟧↑Γ</a> <a id="58843" href="NbE.html#2913" class="InductiveConstructor">≤-id</a>
<a id="58848" class="Symbol">...</a> <a id="58852" class="Symbol">|</a> <a id="58854" href="NbE.html#58854" class="Bound">t==↓ᵀᵧ⟦t⟧↑Γ</a>
  <a id="58868" class="Keyword">rewrite</a> <a id="58876" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="58890" class="Symbol">{</a><a id="58891" class="Argument">t</a> <a id="58893" class="Symbol">=</a> <a id="58895" class="Bound">t</a> <a id="58897" href="NbE.html#10528" class="Function Operator">[</a> <a id="58899" href="NbE.html#11739" class="Function">subst-id</a> <a id="58908" href="NbE.html#10528" class="Function Operator">]</a><a id="58909" class="Symbol">}</a>
        <a id="58919" class="Symbol">|</a> <a id="58921" href="NbE.html#34900" class="Function">[id]-identity</a> <a id="58935" class="Symbol">{</a><a id="58936" class="Argument">t</a> <a id="58938" class="Symbol">=</a> <a id="58940" class="Bound">t</a><a id="58941" class="Symbol">}</a>              <a id="58956" class="Symbol">=</a> <a id="58958" href="NbE.html#58854" class="Bound">t==↓ᵀᵧ⟦t⟧↑Γ</a>
</pre>
#### References
